!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).gdp=t()}(this,(function(){"use strict";var e,t,i,s,r,n,o,a="function"==typeof Array.from?Array.from:(t||(t=1,i=function(e){return"function"==typeof e},s=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),9007199254740991)},r=function(e){if(null!=e){if(["string","number","boolean","symbol"].indexOf(typeof e)>-1)return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in e)return Symbol.iterator;if("@@iterator"in e)return"@@iterator"}},n=function(e,t){if(null!=e&&null!=t){var s=e[t];if(null==s)return;if(!i(s))throw new TypeError(s+" is not a function");return s}},o=function(e){var t=e.next();return!t.done&&t},e=function(e){var t,a,d,l=this,c=arguments.length>1?arguments[1]:void 0;if(void 0!==c){if(!i(c))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(t=arguments[2])}var h=n(e,r(e));if(void 0!==h){a=i(l)?Object(new l):[];var g,u,m=h.call(e);if(null==m)throw new TypeError("Array.from requires an array-like or iterable object");for(d=0;;){if(!(g=o(m)))return a.length=d,a;u=g.value,a[d]=c?c.call(t,u,d):u,d++}}else{var p=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var I,f=s(p.length);for(a=i(l)?Object(new l(f)):Array(f),d=0;f>d;)I=p[d],a[d]=c?c.call(t,I,d):I,d++;a.length=f}return a}),e);Array.prototype.includes=function(){return this.indexOf(arguments[0])>=0},Array.prototype.find=function(){const e=arguments[0];let t;return this.forEach((i=>{e(i)&&void 0===t&&(t=i)})),t},Array.prototype.findIndex=function(){const e=arguments[0];let t=-1;return this.forEach(((i,s)=>{e(i)&&-1===t&&(t=s)})),t},Array.from=a,Number.isNaN=function(){return""+Number(arguments[0])=="NaN"},String.prototype.includes=function(){return this.indexOf(arguments[0])>=0},String.prototype.startsWith=function(){const e=arguments[0],t=this.slice(0,e.length);return t===e},String.prototype.endsWith=function(){const e=arguments[0],t=this.slice(-e.length);return t===e};const d=["web","wxwv","minp","alip","baidup","qq","bytedance"],l={autotrack:{type:"boolean",default:!0},compress:{type:"boolean",default:!0},dataCollect:{type:"boolean",default:!0},debug:{type:"boolean",default:!1},hashtag:{type:"boolean",default:!1},touch:{type:"boolean",default:!1},version:{type:"string",default:"1.0.0"},platform:{type:"string",default:"web"},cookieDomain:{type:"string",default:""}},c={enableIdMapping:{type:"boolean",default:!1},gtouchHost:{type:"string",default:""},host:{type:"string",default:""},ignoreFields:{type:"array",default:[]},penetrateHybrid:{type:"boolean",default:!0},scheme:{type:"string",default:location.protocol.indexOf("http")>-1?location.protocol.replace(":",""):"https"},sessionExpires:{type:"number",default:30},performance:{type:"object",default:{monitor:!0,exception:!0}},embeddedIgnore:{type:"array",default:[]}},h={},g=["clearUserId","getGioInfo","getLocation","getOption","init","setDataCollect","setOption","setUserId","track","setGeneralProps","clearGeneralProps","enableDebug","enableHT","setAutotrack","setTrackerHost","setTrackerScheme","setUserAttributes","getVisitorId","getDeviceId","registerPlugins","sendPage","sendVisit","trackTimerStart","trackTimerPause","trackTimerResume","trackTimerEnd","removeTimer","clearTrackTimer"],u=["autotrack","dataCollect","dataSourceId","debug","host","hashtag","scheme"],m={autotrack:"无埋点采集",dataCollect:"数据采集",debug:"调试模式"},p=["send","setConfig","collectImp","setPlatformProfile"],I=["screenHeight","screenWidth"],f=e=>["undefined","null"].includes(H(e)),v=e=>"string"===H(e),w=e=>"number"===H(e),y=e=>"object"===H(e)&&!f(e),O=e=>"function"===H(e),S=e=>Array.isArray(e)&&"array"===H(e),b=e=>"date"===H(e),E=e=>{try{return Array.from(e)[0]}catch(e){return}},N=e=>{try{const t=Array.from(e);return t[t.length-1]}catch(e){return}},T=(e,t=1)=>S(e)&&w(t)?e.slice(t>0?t:1,e.length):e,C=e=>{if(S(e)){let t=0;const i=[];for(const s of e)s&&!L(s)&&(i[t++]=s);return i}return e},x=e=>f(e)?"":""+e,k=(e,t)=>"string"==typeof e?e.split(t):e,j=e=>{if(v(e)){const t=k(e,"");return`${E(t).toLowerCase()}${T(t).join("")}`}return e},_=(e,t)=>!!v(e)&&e.slice(0,t.length)===t,q=(e,t)=>{if(v(e)){const{length:i}=e;let s=i;s>i&&(s=i);const r=s;return s-=t.length,s>=0&&e.slice(s,r)===t}return!1},A={}.hasOwnProperty,P=(e,t)=>!f(e)&&A.call(e,t),D=e=>y(e)?Object.keys(e):[],U=(e,t)=>{D(e).forEach((i=>t(e[i],i)))},R=(e,t)=>{const i=D(e);return!(!y(e)||!y(t)||i.length!==D(t).length||i.map(((i,s)=>y(e[i])?R(e[i],t[i]):e[i]===t[i])).includes(!1))},K=(e,t)=>{if(!y(e))return!1;try{if("string"===H(t))return delete e[t];if("array"===H(t))return t.map((t=>delete e[t]));"object"===H(t)&&t.constructor===RegExp&&D(e).forEach((i=>{t.test(i)&&K(e,i)}))}catch(e){return!1}},L=e=>S(e)?0===e.length:y(e)?0===D(e).length:!e,H=e=>({}.toString.call(e).slice(8,-1).toLowerCase());var B=Object.freeze({__proto__:null,isNil:f,isString:v,isNumber:w,isBoolean:e=>"boolean"===H(e),isObject:y,isRegExp:e=>"regexp"===H(e),isFunction:O,isArray:S,isDate:b,fixed:(e,t)=>w(e)?Number(e.toFixed(w(t)?t:2)):v(e)&&"NaN"!==x(Number(e))?Number(Number(e).toFixed(w(t)?t:2)):e,head:E,last:N,drop:T,dropWhile:(e,t)=>S(e)?e.filter((e=>!t(e))):e,compact:C,find:(e,t)=>{if(S(e)){const i=e.findIndex(t);return 0>i?void 0:e[i]}},toString:x,split:k,lowerFirst:j,upperFirst:e=>{if(v(e)){const t=k(e,"");return`${E(t).toUpperCase()}${T(t).join("")}`}return e},startsWith:_,endsWith:q,hasOwnProperty:A,has:P,keys:D,forEach:U,isEqual:R,get:(e,t,i)=>{let s=e;return y(e)?(t.split(".").forEach((e=>{s=s?s[e]:i})),s):i},unset:K,isEmpty:L,typeOf:H,formatDate:e=>{if(b(e)){const t=e=>10>e?"0"+e:e;return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+t(e.getMilliseconds())}return e}});const $=(e,t)=>{console.log("%c [GrowingIO]："+e,{info:"color: #3B82F6;",error:"color: #EF4444",warn:"color: #F59E0B",success:"color: #10B981"}[t]||"")},F=e=>{try{return e()}catch(e){return}},V=e=>{const t={};return y(e)&&U(e,((e,i)=>{const s=x(i).slice(0,100);y(e)?t[s]=V(e):S(e)?(t[s]=e.slice(0,100),"cdp"===window.gioEnvironment&&(t[s]=t[s].join("||"))):t[s]=f(e)?"":x(e).slice(0,1e3)})),t},G=(e,t,i,s={})=>{document.addEventListener?e.addEventListener(t,i,Object.assign(Object.assign({},{capture:!0}),s)):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i},W=(e,t)=>v(e)&&!L(e)&&e.match(/^[a-zA-Z_][0-9a-zA-Z_]{0,100}$/)?t():($("事件名格式不正确，只能包含数字、字母和下划线，且不能以数字开头，字符总长度不能超过100!","error"),!1);var M=Object.freeze({__proto__:null,consoleText:$,niceTry:F,limitObject:V,addListener:G,flattenObject:(e={})=>{const t=Object.assign({},e);return D(t).forEach((e=>{y(t[e])?(D(t[e]).forEach((i=>{t[`${e}_${i}`]=x(t[e][i])})),K(t,e)):S(t[e])?(t[e].forEach(((i,s)=>{y(i)?D(i).forEach((r=>{t[`${e}_${s}_${r}`]=x(i[r])})):t[`${e}_${s}`]=x(i)})),K(t,e)):f(t[e])||""===t[e]?K(t,e):t[e]=x(t[e])})),t},eventNameValidate:W});const z=e=>v(e)&&e.length>0||w(e)&&e>0,X=e=>e.vdsConfig||e.gioSDKInitialized||window.gioSDKInitialized?($("SDK重复初始化，请检查是否重复加载SDK或接入其他平台SDK导致冲突!","warn"),!1):!(["","localhost","127.0.0.1"].includes(location.hostname)&&!window._gr_ignore_local_rule&&($("当前SDK不允许在本地环境初始化!","warn"),1)),J=e=>!L(C(e))||($('SDK初始化失败，请使用 gdp("init", "您的GrowingIO项目 accountId", "您项目的 dataSourceId", options); 进行初始化!',"error"),!1),Q=e=>{const t=E(e);let i=N(e);return z(x(t).trim())?(y(i)&&i||(i={}),{projectId:t,userOptions:i}):($("SDK初始化失败，accountId 参数不合法!","error"),!1)},Z=e=>{const t=e[1],i=e[2],s=N(e);return t&&v(t)?y(s)&&s.host?{dataSourceId:t,appId:v(i)?i:"",cdpOptions:s}:($("SDK初始化失败，未在配置中指定 host!","error"),!1):($("SDK初始化失败，dataSourceId 参数不合法!","error"),!1)},Y=/^((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})(\.((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})){3}/i,ee=/^(https?:\/\/)|(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i;var te="SESSIONID_UPDATE",ie={},se={}.hasOwnProperty;function re(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function ne(e){try{return encodeURIComponent(e)}catch(e){return null}}ie.stringify=function(e,t){t=t||"";var i,s,r=[];for(s in"string"!=typeof t&&(t="?"),e)if(se.call(e,s)){if((i=e[s])||null!=i&&!isNaN(i)||(i=""),s=ne(s),i=ne(i),null===s||null===i)continue;r.push(s+"="+i)}return r.length?t+r.join("&"):""},ie.parse=function(e){for(var t,i=/([^=?#&]+)=?([^&]*)/g,s={};t=i.exec(e);){var r=re(t[1]),n=re(t[2]);null===r||null===n||r in s||(s[r]=n)}return s};var oe={name:"gioCustomTracking",method:class{constructor(e){this.growingIO=e,this.getValidResourceItem=e=>{if(e&&y(e)&&e.id&&e.key){const t={id:v(e.id)?e.id:x(e.id),key:v(e.key)?e.key:x(e.key)};return e.attributes&&(t.attributes=e.attributes),t}},this.getDynamicAttributes=e=>(f(e)||D(e).forEach((t=>{O(e[t])?e[t]=e[t]():y(e[t])?K(e,t):S(e[t])||(e[t]=x(e[t]))})),e),this.buildCustomEvent=(e,t,i,s)=>{W(e,(()=>{const{dataStore:{eventContextBuilder:r,eventConverter:n,currentPage:o}}=this.growingIO;let a=Object.assign({eventType:"CUSTOM",eventName:e,pageShowTimestamp:null==o?void 0:o.time,attributes:V(this.getDynamicAttributes(y(t)&&!L(t)?t:void 0)),resourceItem:V(this.getValidResourceItem(i))},r());L(s)||(a=Object.assign(Object.assign({},a),s)),n(a)}))},this.buildUserAttributesEvent=(e,t)=>{const{dataStore:{eventContextBuilder:i,eventConverter:s}}=this.growingIO;let r=Object.assign({eventType:"LOGIN_USER_ATTRIBUTES",attributes:V(e)},i());L(t)||(r=Object.assign(Object.assign({},r),t)),s(r)}}}};const ae=["gioPerformance"];class de extends class{constructor(e){var t,i,s,r;this.growingIO=e,this.innerPluginInit=()=>{var e;ae.forEach((e=>{var t;return K(null===(t=this.pluginsContext)||void 0===t?void 0:t.plugins,e)})),D(null===(e=this.pluginsContext)||void 0===e?void 0:e.plugins).forEach((e=>{var t;const{name:i,method:s}=null===(t=this.pluginsContext)||void 0===t?void 0:t.plugins[e];this.pluginItems.find((e=>e.name===i))||this.pluginItems.push({name:j(i||e),method:s||(e=>{})})})),L(this.pluginItems)||this.installAll()},this.install=(e,t,i)=>{var s,r;const n=t||this.pluginItems.find((t=>t.name===e));if((null===(s=this.growingIO)||void 0===s?void 0:s.plugins)[e])return $(`重复加载插件 ${e} 或插件重名，已跳过加载!`,"warn"),!1;if(!n)return $(`插件加载失败!不存在名为 ${e} 的插件!`,"error"),!1;try{return(null===(r=this.growingIO)||void 0===r?void 0:r.plugins)[e]=new n.method(this.growingIO,i),"cdp"===this.growingIO.gioEnvironment&&t&&$("加载插件："+e,"info"),!0}catch(e){return $("插件加载异常："+e,"error"),!1}},this.installAll=e=>{(e||this.pluginItems).forEach((t=>this.install(t.name,e?t:void 0,e?null==t?void 0:t.options:void 0)))},this.uninstall=e=>{var t;K(this.pluginItems,e);const i=K(null===(t=this.growingIO)||void 0===t?void 0:t.plugins,e);return i||$(`卸载插件 ${e} 失败!`,"error"),i},this.uninstallAll=()=>{this.pluginItems.forEach((e=>this.uninstall(e.name)))},this.lifeError=(e,t)=>$(`插件执行错误 ${e.name} ${t}`,"error"),this.onComposeBefore=e=>{this.pluginItems.forEach((t=>{var i;const s=null===(i=this.growingIO.plugins[t.name])||void 0===i?void 0:i.onComposeBefore;if(s&&O(s))try{s(e)}catch(e){this.lifeError(t,e)}}))},this.onComposeAfter=e=>{this.pluginItems.forEach((t=>{var i;const s=null===(i=this.growingIO.plugins[t.name])||void 0===i?void 0:i.onComposeAfter;if(s&&O(s))try{s(e)}catch(e){this.lifeError(t,e)}}))},this.onSendBefore=e=>{this.pluginItems.forEach((t=>{var i;const s=null===(i=this.growingIO.plugins[t.name])||void 0===i?void 0:i.onSendBefore;if(s&&O(s))try{s(e)}catch(e){this.lifeError(t,e)}}))},this.onSendAfter=e=>{this.pluginItems.forEach((t=>{var i;const s=null===(i=this.growingIO.plugins[t.name])||void 0===i?void 0:i.onSendAfter;if(s&&O(s))try{s(e)}catch(e){this.lifeError(t,e)}}))},this.pluginsContext={plugins:{}},this.pluginItems=[],null===(t=this.growingIO.emitter)||void 0===t||t.on("onComposeBefore",this.onComposeBefore),null===(i=this.growingIO.emitter)||void 0===i||i.on("onComposeAfter",this.onComposeAfter),null===(s=this.growingIO.emitter)||void 0===s||s.on("onSendBefore",this.onSendBefore),null===(r=this.growingIO.emitter)||void 0===r||r.on("onSendAfter",this.onSendAfter)}}{constructor(e){super(e),this.growingIO=e,this.pluginsContext={plugins:{gioCustomTracking:oe}}}}function le(e){for(var t=1;arguments.length>t;t++){var i=arguments[t];for(var s in i)e[s]=i[s]}return e}var ce=function e(t,i){function s(e,s,r){if("undefined"!=typeof document){"number"==typeof(r=le({},i,r)).expires&&(r.expires=new Date(Date.now()+864e5*r.expires)),r.expires&&(r.expires=r.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var n="";for(var o in r)r[o]&&(n+="; "+o,!0!==r[o]&&(n+="="+r[o].split(";")[0]));return document.cookie=e+"="+t.write(s,e)+n}}return Object.create({set:s,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var i=document.cookie?document.cookie.split("; "):[],s={},r=0;r<i.length;r++){var n=i[r].split("="),o=n.slice(1).join("=");try{var a=decodeURIComponent(n[0]);if(s[a]=t.read(o,a),e===a)break}catch(e){}}return e?s[e]:s}},remove:function(e,t){s(e,"",le({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,le({},this.attributes,t))},withConverter:function(t){return e(le({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(i)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});const he=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),ge=()=>{var e;const t=!!(null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.sendBeacon),i=window.navigator.userAgent;if(i.match(/(iPad|iPhone|iPod)/g)){const e=ue(i);return t&&e>13}return t},ue=e=>{const t=e.toLowerCase().match(/cpu.*os (.*?) like mac os/i);return!t||2>t.length?0:+t[1].split("_").slice(0,2).join(".")},me=e=>{ce.set("gioCookie","yes",{domain:e});const t=!!ce.get("gioCookie",{domain:e});return ce.remove("gioCookie",{domain:e}),t},pe=e=>e.endsWith("_gioenc")?e.slice(0,-7):e,Ie=e=>Number.isNaN(Number(e))&&F((()=>JSON.parse(e)))||e,fe={A:1,a:1,Z:1,z:1,"@":1},ve=e=>f(e)?e:F((()=>"gioenc-"+ye(e)))||e,we=e=>v(e)&&e.startsWith("gioenc-")&&F((()=>ye(e.replace("gioenc-",""))))||e,ye=e=>(e=e||"").split("").map((e=>fe[e]?e:Oe(e))).join(""),Oe=e=>{if(/[0-9]/.test(e))return 1^+e;{let t=e.charCodeAt(0);return String.fromCharCode(1^t)}};const Se={};let be;const Ee=(()=>{let e=window.location.hostname;const t=F((()=>{const t=e.split("."),i=N(t);if("localhost"!==e&&(isNaN(Number(i))||0>Number(i)||Number(i)>255))return["."+t.slice(-2).join("."),"."+t.slice(-3).join(".")]}))||[e];let i="";return t.some((e=>!!me(e)&&(i=e,!0))),i})();be=!["","localhost","127.0.0.1"].includes(window.location.hostname)&&["http:","https:"].includes(window.location.protocol)&&Ee?new class{constructor(e){this.domain=e,this.getItem=e=>Ie(we(ce.get(pe(e)))),this.setItem=(e,t,i)=>{let s;s=v(t)?t.length?e.endsWith("_gioenc")?ve(t):t:"":JSON.stringify(t),ce.set(pe(e),s,{expires:i?new Date(i):3650,domain:this.domain})},this.removeItem=e=>{ce.remove(pe(e),{domain:this.domain})},this.hasItem=e=>D(ce.get()).includes(pe(e)),this.getKeys=()=>D(ce.get()),this.type="Cookie"}}(Ee):(e=>{try{const e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(e){return!1}})()?new class{constructor(){this.getItem=e=>{const t=F((()=>JSON.parse(localStorage.getItem(pe(e))||"")))||{};return y(t)&&t.expiredAt>+Date.now()?Ie(we(t.value)):void 0},this.setItem=(e,t,i)=>{const s=null!=i?i:+new Date(9999,12);localStorage.setItem(pe(e),JSON.stringify({value:v(t)&&t.length&&e.endsWith("_gioenc")?ve(t):t,expiredAt:s}))},this.removeItem=e=>localStorage.removeItem(pe(e)),this.hasItem=e=>!!localStorage.getItem(pe(e)),this.getKeys=()=>Array.from(Array(localStorage.length)).map(((e,t)=>localStorage.key(t))),this.type="localStorage"}}:new class{constructor(){this.getItem=e=>{const t=F((()=>JSON.parse(Se[pe(e)]||"")));return y(t)&&t.expiredAt>+Date.now()?Ie(we(t.value)):void 0},this.setItem=(e,t,i)=>{const s=null!=i?i:+new Date(9999,12);Se[pe(e)]=JSON.stringify({value:v(t)&&t.length?ve(t):t,expiredAt:s})},this.removeItem=e=>K(Se,pe(e)),this.hasItem=e=>P(Se,pe(e)),this.getKeys=()=>D(Se),this.type="memory"}};var Ne=be;class Te{constructor(e){var t;this.growingIO=e;const{projectId:i}=this.growingIO.vdsConfig,{getItem:s,setItem:r}=this.growingIO.storage;this.getItem=s,this.setItem=r,this.sIdStorageName=i+"_gdp_session_id",this.uidStorageName="gdp_user_id_gioenc",this.userIdStorageName=i+"_gdp_cs1_gioenc",this.userKeyStorageName=i+"_gdp_user_key_gioenc",this.gioIdStorageName=i+"_gdp_gio_id_gioenc",null===(t=this.growingIO.emitter)||void 0===t||t.on(te,(()=>{this.growingIO.gioSDKInitialized&&(this.growingIO.dataStore.sendVisit(!0),this.growingIO.dataStore.sendPage(!0))}))}get sessionId(){return this.getItem(this.sIdStorageName)||(this.sessionId=he(),this.sessionId)}set sessionId(e){var t;e||(e=he());const i=this.getItem(this.sIdStorageName)||this.prevSessionId,{sessionExpires:s=30}=this.growingIO.vdsConfig;this.setItem(this.sIdStorageName,e,+Date.now()+60*s*1e3),i!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit(te,{newSessionId:e,oldSessionId:i})),this.prevSessionId=e}get uid(){return this.getItem(this.uidStorageName)||(this.uid=he(),this.uid)}set uid(e){var t;const i=this.getItem(this.uidStorageName)||this.prevUId;this.setItem(this.uidStorageName,e),i!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit("UID_UPDATE",{newUId:e,oldUId:i})),this.prevUId=e}get userId(){return this.getItem(this.userIdStorageName)||""}set userId(e){var t;const i=this.getItem(this.userIdStorageName)||this.prevUserId;this.setItem(this.userIdStorageName,e),i!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit("USERID_UPDATE",{newUserId:e,oldUserId:i,userKey:this.userKey})),e&&(this.gioId=e),this.prevUserId=e}get userKey(){return this.getItem(this.userKeyStorageName)||""}set userKey(e){var t;const i=this.getItem(this.userKeyStorageName)||this.prevUserKey;this.setItem(this.userKeyStorageName,e),i!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit("USERKEY_UPDATE",{newUserKey:e,oldUserKey:i,userId:this.userId})),this.prevUserKey=e}get gioId(){return this.getItem(this.gioIdStorageName)||""}set gioId(e){var t;const i=this.getItem(this.gioIdStorageName)||this.prevGioId;this.setItem(this.gioIdStorageName,e),i!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit("GIOID_UPDATE",{newGioId:e,oldGioId:i})),this.prevGioId=e}}class Ce{constructor(e){this.growingIO=e,this.main=()=>{var e;const{sdkVersion:t,useEmbeddedInherit:i,vdsConfig:s,userStore:r,dataStore:n,trackingId:o}=this.growingIO,{path:a,query:d}=n.currentPage;let l={appVersion:s.version,dataSourceId:s.dataSourceId,deviceId:r.uid,domain:i?s.appId:window.location.host,gioId:r.gioId,language:navigator.language,path:a,platform:s.platform,query:d,referralPage:(null===(e=n.lastPageEvent)||void 0===e?void 0:e.referralPage)||"",screenHeight:window.screen.height,screenWidth:window.screen.width,sdkVersion:t,sessionId:r.sessionId,timestamp:+Date.now(),title:document.title.slice(0,255),userId:r.userId};if(s.enableIdMapping&&(l.userKey=r.userKey),L(s.ignoreFields)||s.ignoreFields.forEach((e=>{K(l,e)})),i&&!L(this.minpExtraParams)){const e=Object.assign({},l);U(Object.assign(Object.assign({},l),this.minpExtraParams),((t,i)=>{var r;s.embeddedIgnore.includes(i)?(l[i]=e[i],"domain"===i&&(l[i]=window.location.host)):l[i]=null!==(r=this.minpExtraParams[i])&&void 0!==r?r:l[i]}))}return l.trackingId=o,l},this.minpExtraParams={}}}class xe{constructor(e){this.growingIO=e,this.parsePage=()=>{const{hashtag:e}=this.growingIO.vdsConfig,t=location.pathname,i=location.search,s=location.hash,r=s.indexOf("?");this.domain=window.location.host,this.title=document.title.slice(0,255),this.time=+Date.now(),this.path=t,this.query=i,e&&(r>-1?(this.path+=s.slice(0,r),this.query=this.query+"&"+s.slice(r+1)):this.path+=s),this.query&&["?","&"].includes(this.query.charAt(0))&&(this.query=this.query.slice(1))},this._getNoHashHref=()=>{const{protocol:e,host:t,pathname:i,search:s}=window.location;return`${e}://${t}${i}${s}`},this.pageListener=()=>{const{hashtag:e}=this.growingIO.vdsConfig;let t=window.location.href,i=this.lastHref;e||(t=this._getNoHashHref(),i=this.lastNoHashHref),i!==t&&(this.parsePage(),this.buildPageEvent())},this.hookHistory=()=>{const e=window.history.pushState,t=window.history.replaceState,i=this;e&&F((()=>window.history.pushState=function(){e.apply(window.history,arguments),setTimeout(i.pageListener)})),t&&F((()=>window.history.replaceState=function(){t.apply(window.history,arguments),setTimeout(i.pageListener)})),G(window,"popstate",this.pageListener);const{hashtag:s}=this.growingIO.vdsConfig;s&&G(window,"hashchange",this.pageListener)},this.buildPageEvent=e=>{const{dataStore:{lastPageEvent:t,eventContextBuilder:i,eventConverter:s}}=this.growingIO;let r=Object.assign(Object.assign({eventType:"PAGE"},i()),{protocolType:location.protocol.substring(0,location.protocol.length-1),referralPage:(null==t?void 0:t.path)===this.path&&(null==t?void 0:t.query)===this.query?null==t?void 0:t.referralPage:(null==t?void 0:t.path)?this.lastHref:document.referrer});L(e)||(r=Object.assign(Object.assign({},r),e)),r.timestamp=this.time,s(r),this.lastHref=window.location.href,this.lastNoHashHref=this._getNoHashHref(),this.lastLocation=Object.assign({},window.location)},this.title=document.title.slice(0,255),this.lastLocation=Object.assign({},window.location)}}class ke extends class{constructor(e){var t,i;this.growingIO=e,this.ALLOW_SETTING=Object.assign(Object.assign({},l),"saas"===this.growingIO.gioEnvironment?h:c),this.allowOptKeys=Object.keys(this.ALLOW_SETTING),this.trackTimers={},this.initStorageId=()=>{const e=this.growingIO.storage.getItem(this.seqStorageIdName)||{};let t=Object.assign({},e);K(t,"globalKey"),t=y(t)&&!f(t)?t:{},this._esid={},D(t).forEach((e=>{this._esid[e]=Number.isNaN(Number(t[e]))||t[e]>=1e9||1>t[e]?1:t[e]})),R(t,this._esid)||this.setSequenceIds("esid",this._esid);const i=Number(e.globalKey);this._gsid=Number.isNaN(i)||i>=1e9||1>i?1:i,i!==this._gsid&&this.setSequenceIds("gsid",this._gsid)},this.setSequenceIds=(e,t)=>{let i=this.growingIO.storage.getItem(this.seqStorageIdName)||{};"gsid"===e?i.globalKey=t:i=Object.assign(Object.assign({},i),t),this.growingIO.storage.setItem(this.seqStorageIdName,i)},this.initOptions=e=>{var t,i,s,r,n,o;const{projectId:a,dataSourceId:l,appId:c}=e;this.initialDataSourceId=l;const h={};this.allowOptKeys.forEach((t=>{const i=this.ALLOW_SETTING[t].type;let s=S(i)?!i.includes(H(e[t])):H(e[t])!==this.ALLOW_SETTING[t].type;"platform"!==t||d.includes(e[t])||(s=!0),s?h[t]=this.ALLOW_SETTING[t].default:"ignoreFields"===t?h.ignoreFields=e.ignoreFields.filter((e=>I.includes(e))):(h[t]=e[t],["dataCollect","autotrack"].includes(t)&&(h[t]||$("已关闭"+m[t],"info")))})),h.sessionExpires=Math.round(h.sessionExpires),(Number.isNaN(h.sessionExpires)||1>h.sessionExpires||h.sessionExpires>360)&&(h.sessionExpires=30),"Cookie"===this.growingIO.storage.type&&h.cookieDomain&&me(h.cookieDomain)&&(this.growingIO.storage.domain=h.cookieDomain),this.growingIO.vdsConfig=Object.assign(Object.assign({},h),{projectId:a,dataSourceId:l,appId:c,sdkVer:this.growingIO.sdkVersion,performance:{monitor:null===(i=null===(t=h.performance)||void 0===t?void 0:t.monitor)||void 0===i||i,exception:null===(r=null===(s=h.performance)||void 0===s?void 0:s.exception)||void 0===r||r,network:null!==(o=null===(n=h.performance)||void 0===n?void 0:n.network)&&void 0!==o&&o}}),window.vds=this.growingIO.vdsConfig,this.seqStorageIdName=a+"_gdp_sequence_ids"},this.setOption=(e,t)=>{var i;const{vdsConfig:s,callError:r,uploader:n,emitter:o}=this.growingIO,a=v(e)&&u.includes(e),d=a&&typeof t===((null===(i=this.ALLOW_SETTING[e])||void 0===i?void 0:i.type)||"string"),l=Object.assign({},s);return a&&d?(s[e]=t,"dataCollect"===e&&l.dataCollect!==t&&(t?(this.sendVisit(!0),this.sendPage()):this.growingIO.clearTrackTimer()),["host","scheme"].includes(e)&&(null==n||n.generateHost()),null==o||o.emit("OPTION_CHANGE",{optionName:e,optionValue:t}),!0):(r("setOption > "+e),!1)},this.getOption=e=>{const{vdsConfig:t,callError:i}=this.growingIO;return e&&P(t,x(e))?t[x(e)]:f(e)?Object.assign({},t):void i("getOption > "+e)},this.sendVisit=e=>{const{userStore:{sessionId:t},vdsConfig:{projectId:i,dataCollect:s},storage:r}=this.growingIO;if(s){const s=`${i}_gdp_session_id_${t}`,n=r.getItem(s);!e&&[!0,"true"].includes(n)||(this.buildVisitEvent(),r.setItem(s,!0))}},this.buildVisitEvent=e=>{const{dataStore:{eventContextBuilder:t,eventConverter:i}}=this.growingIO;let s=Object.assign(Object.assign({eventType:"VISIT"},t()),{referral:this.lastVisitEvent.referral,referralPage:this.lastPageEvent.referralPage});L(e)||(s.session=(null==e?void 0:e.session)||s.session,s.trackingId=null==e?void 0:e.trackingId,s=Object.assign(Object.assign({},s),e)),i(s)},this.sendPage=e=>{e&&this.currentPage.parsePage(),this.currentPage.buildPageEvent()},this.buildErrorEvent=e=>{const{dataStore:{eventContextBuilder:t,eventConverter:i}}=this.growingIO;i(Object.assign({eventType:"CUSTOM",pageShowTimestamp:this.currentPage.time,eventName:"onError",attributes:e},t()))},this.currentPage=new xe(this.growingIO),this.eventContextBuilderInst=new Ce(this.growingIO),this.eventContextBuilder=this.eventContextBuilderInst.main,this.generalProps={},this.lastVisitEvent={referralPage:document.referrer},null===(t=this.growingIO.emitter)||void 0===t||t.on("onComposeAfter",(({composedEvent:e})=>{"VISIT"!==e.eventType&&"vst"!==e.t||e.trackingId!==this.growingIO.trackingId||(this.lastVisitEvent=e)})),this.lastPageEvent={},null===(i=this.growingIO.emitter)||void 0===i||i.on("onComposeAfter",(({composedEvent:e})=>{"PAGE"!==e.eventType&&"page"!==e.t||e.trackingId!==this.growingIO.trackingId||(this.lastPageEvent=e)}))}get esid(){const e=this.growingIO.storage.getItem(this.seqStorageIdName)||{};let t=Object.assign({},e);return K(t,"globalKey"),t=y(t)&&!f(t)?t:{},this._esid={},D(t).forEach((e=>{this._esid[e]=Number.isNaN(Number(t[e]))||t[e]>=1e9||1>t[e]?1:t[e]})),this._esid}set esid(e){const t={};D(e).forEach((i=>{t[i]=Number.isNaN(e[i])||e[i]>=1e9||1>e[i]?1:e[i]})),R(this._esid,t)||(this._esid=t,this.setSequenceIds("esid",this._esid))}get gsid(){const e=this.growingIO.storage.getItem(this.seqStorageIdName)||{},t=Number(e.globalKey);return this._gsid=Number.isNaN(t)||t>=1e9||1>t?1:t,this._gsid}set gsid(e){const t=Number(e);this._gsid=Number.isNaN(t)||e>=1e9||1>e?1:e,this.setSequenceIds("gsid",this._gsid)}}{constructor(e){super(e),this.growingIO=e,this.eventConverter=e=>{var t;const{vdsConfig:i,dataStore:s,uploader:r}=this.growingIO;if(i.dataCollect){e.trackingId===this.growingIO.trackingId&&(e.globalSequenceId=s.gsid,e.eventSequenceId=s.esid[e.eventType]||1);const i={};U(e,((e,t)=>{var s;if("element"===t){const t=null!==(s=E(e))&&void 0!==s?s:{};U(t,((e,t)=>{L(e)&&0!==e||(i[t]=e)}))}else(L(e)||f(e))&&0!==e||(i[t]=e)})),e.trackingId===this.growingIO.trackingId&&(this.growingIO.dataStore.gsid+=1,this.growingIO.dataStore.esid=Object.assign(Object.assign({},this.growingIO.dataStore.esid),{[i.eventType]:(this.growingIO.dataStore.esid[i.eventType]||1)+1})),null===(t=this.growingIO.emitter)||void 0===t||t.emit("onComposeAfter",{composedEvent:Object.assign({},i)}),e.trackingId===this.growingIO.trackingId&&r.commitRequest(i)}}}}class je extends class{constructor(e){this.growingIO=e,this.commitRequest=e=>{const t=Object.assign({},e);this.requestQueue.push(Object.assign(Object.assign({},t),{requestType:ge()?"Beacon":"XHR"})),this.initiateRequest()},this.initiateRequest=()=>{var e,t;if([...this.requestQueue].length>0&&this.requestingNum<this.requestLimit){const{vdsConfig:i,emitter:s,plugins:r,useHybridInherit:n}=this.growingIO;if(this.requestQueue=[...this.requestQueue].filter((e=>(this.retryIds[e.globalSequenceId||e.esid]||0)<=this.retryLimit)),L(this.requestQueue))return;const o=this.requestQueue.shift(),{requestType:a}=o;if(null==s||s.emit("onSendBefore",{requestData:o}),K(o,["requestType","trackingId"]),i.debug&&console.log("[GrowingIO Debug]:",JSON.stringify(o,null,2).replace(/\"/g,(()=>{const e=window.navigator.userAgent;return/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(e)&&!/chrome\/(\d+\.\d+)/i.test(e)})()?"":'"')),this.requestingNum+=1,n)return this.requestSuccessFn(o),!1;let d=Object.assign({},o);switch(i.compress&&(null===(e=null==r?void 0:r.gioCompress)||void 0===e?void 0:e.compressToUint8Array)?(this.compressType="1",d=null===(t=null==r?void 0:r.gioCompress)||void 0===t?void 0:t.compressToUint8Array(JSON.stringify([d]))):(this.compressType="0",d=JSON.stringify([d])),a){case"Beacon":default:this.sendByBeacon(o,d);break;case"XHR":this.sendByXHR(o,d);break;case"Image":this.sendByImage(o,d)}}},this.generateURL=()=>`${this.requestURL}?stm=${+Date.now()}&compress=${this.compressType}`,this.sendByBeacon=(e,t)=>{navigator.sendBeacon(this.generateURL(),t)?this.requestSuccessFn(e):this.requestFailFn(e,"Beacon")},this.sendByXHR=(e,t)=>{var i;const s=["unload","beforeunload","pagehide"].includes(null===(i=null===window||void 0===window?void 0:window.event)||void 0===i?void 0:i.type),r=new XMLHttpRequest;if(r)return r.open("POST",this.generateURL(),s),r.onreadystatechange=()=>{4===r.readyState&&204===r.status?this.requestSuccessFn(e):this.requestFailFn(e,"XHR")},r.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),void r.send(t);if(null===window||void 0===window?void 0:window.XDomainRequest){const i=new window.XDomainRequest;i.open("POST",this.generateURL().replace("https://","http://"),s),i.onload=()=>{204===i.status?this.requestSuccessFn(e):this.requestFailFn(e,"XHR")},i.onerror=i.ontimeout=()=>{this.requestFailFn(e,"XHR")},i.send(t)}},this.sendByImage=(e,t)=>{const i=`${this.generateURL()}&data=${t}`;let s=document.createElement("img");s.width=1,s.height=1,s.onload=()=>{this.requestSuccessFn(e),this.clearImage(s)},s.onerror=s.onabort=()=>{this.requestFailFn(e,"Image"),this.clearImage(s)},s.src=i},this.clearImage=e=>{e.src="",e.onload=()=>{},e.onerror=e.onerabort=()=>{},e=null},this.requestSuccessFn=e=>{var t;this.requestingNum-=1;const i=e.globalSequenceId||e.esid||-1;this.retryIds[i]&&(this.retryIds[i]=0),this.growingIO.userStore.sessionId=this.growingIO.userStore.sessionId,null===(t=this.growingIO.emitter)||void 0===t||t.emit("onSendAfter",{requestData:e}),this.initiateRequest()},this.requestFailFn=(e,t)=>{this.requestingNum-=1;const i=e.globalSequenceId||e.esid||-1;this.retryIds[i]||(this.retryIds[i]=0),this.retryIds[i]+=1;const s=this.requestQueue.some((t=>t.globalSequenceId===e.globalSequenceId&&t.esid===e.esid));let r=t;this.retryIds[i]<this.retryLimit+1||(r="Beacon"===t?"XHR":"XHR"===t?"Image":void 0,this.retryIds[i]=0),!s&&r&&this.requestQueue.push(Object.assign(Object.assign({},e),{requestType:r}))},this.requestQueue=[],this.requestLimit=10,this.requestTimeout=5e3,this.retryLimit=1,this.retryIds={},this.requestingNum=0,this.requestURL=""}}{constructor(e){super(e),this.growingIO=e,this.generateHost=()=>{let{scheme:e,host:t="",projectId:i}=this.growingIO.vdsConfig;e?q(x(e),"://")||(e+="://"):e=(location.protocol.indexOf("http")>-1?location.protocol.replace(":",""):"https")+"//",_(t,"http")&&(t=t.substring(t.indexOf("://")+(q(x(e),"://")?3:0))),this.requestURL=`${e}${t}/v3/projects/${i}/collect`},this.requestURL="",this.generateHost()}}class _e extends class{constructor(){var e;this.trackingId="g0",this.init=e=>{var t,i,s,r,n,o;$("Gio Web SDK 初始化中...","info");const{initOptions:a,currentPage:d,sendVisit:l,sendPage:c}=this.dataStore;a(e),this.useEmbeddedInherit=null===(i=null===(t=this.plugins)||void 0===t?void 0:t.gioEmbeddedAdapter)||void 0===i?void 0:i.main(e),this.useHybridInherit=null===(r=null===(s=this.plugins)||void 0===s?void 0:s.gioHybridAdapter)||void 0===r?void 0:r.main(e),null==this||this.initCallback(),d.hookHistory(),d.parsePage(),null===(n=this.emitter)||void 0===n||n.emit("SDK_INITIALIZED",this),$("Gio Web SDK 初始化完成！","success"),this.useEmbeddedInherit||l(),c(),this.gioSDKInitialized=!0,null===(o=this.emitter)||void 0===o||o.emit("SDK_INITIALIZED_COMPLATE",this)},this.setOption=(e,t)=>{if(u.includes(e)){const i=this.dataStore.setOption(e,t);return i&&m[e]&&$(`已${t?"开启":"关闭"}${m[e]}`,"info"),i}return $(`不存在可修改的配置项：${e}，请检查后重试!`,"warn"),!1},this.getOption=e=>this.dataStore.getOption(e),this.setGeneralProps=e=>{y(e)&&!L(e)?(this.dataStore.generalProps=Object.assign(Object.assign({},this.dataStore.generalProps),e),D(this.dataStore.generalProps).forEach((e=>{[void 0,null].includes(this.dataStore.generalProps[e])&&(this.dataStore.generalProps[e]="")}))):this.callError("setGeneralProps")},this.clearGeneralProps=e=>{S(e)&&!L(e)?e.forEach((e=>{K(this.dataStore.generalProps,e)})):this.dataStore.generalProps={}},this.reissuePage=()=>{this.dataStore.sendPage()},this.notRecommended=()=>$("不推荐的方法使用，建议使用 gio('setOption', [optionName], [value])!","info"),this.callError=(e,t=!0,i="参数不合法")=>$(`${t?"调用":"设置"} ${e} 失败，${i}!`,"warn"),this.gioEnvironment="cdp",this.sdkVersion="3.8.0-rc.9",this.utils=Object.assign(Object.assign(Object.assign({},B),M),{qs:ie}),this.emitter={all:e=e||new Map,on:function(t,i){var s=e.get(t);s?s.push(i):e.set(t,[i])},off:function(t,i){var s=e.get(t);s&&(i?s.splice(s.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var s=e.get(t);s&&s.slice().map((function(e){e(i)})),(s=e.get("*"))&&s.slice().map((function(e){e(t,i)}))}},this.gioSDKInitialized=!1,this.storage=Ne,this.plugins=new de(this),this.plugins.innerPluginInit()}}{constructor(){super(),this.registerPlugins=e=>{S(e)?(e.forEach(((t,i)=>{var s,r;L(t)||f(t)?$("插件不合法，跳过加载!","warn"):(null===(s=t.js)||void 0===s?void 0:s.default)&&(e[i]=Object.assign(Object.assign({},null===(r=t.js)||void 0===r?void 0:r.default),{options:t.options}))})),e=C(e),this.plugins.pluginItems=[...this.plugins.pluginItems,...e],this.plugins.installAll(e)):$("插件注册失败，请检查!","error")},this.initCallback=()=>{var e,t;this.userStore=new Te(this),this.uploader=new je(this),null===(t=null===(e=this.plugins)||void 0===e?void 0:e.gioEventAutoTracking)||void 0===t||t.main(),this.vdsConfig.enableIdMapping||(this.userStore.userKey="")},this.setTrackerScheme=e=>{["http","https"].includes(e)?(this.dataStore.setOption("scheme",e),this.notRecommended()):this.callError("scheme",!1)},this.setTrackerHost=e=>{Y.test(e)||ee.test(e)?(this.dataStore.setOption("host",e),this.notRecommended()):this.callError("host",!1)},this.setDataCollect=e=>{this.setOption("dataCollect",!!e),this.notRecommended()},this.setAutotrack=e=>{this.setOption("autotrack",!!e),this.notRecommended()},this.enableDebug=e=>{this.setOption("debug",!!e),this.notRecommended()},this.enableHT=e=>{this.setOption("hashtag",!!e),this.notRecommended()},this.getVisitorId=()=>this.userStore.uid,this.getDeviceId=()=>this.userStore.uid,this.setUserAttributes=(e,t)=>{var i,s;!L(e)&&y(e)?null===(s=null===(i=this.plugins)||void 0===i?void 0:i.gioCustomTracking)||void 0===s||s.buildUserAttributesEvent(e,t):this.callError("setUserAttributes")},this.setUserId=(e,t)=>{if(z(x(e).trim())){const i=this.userStore.gioId;this.vdsConfig.enableIdMapping&&(this.userStore.userKey=!f(t)&&x(t).length>0?x(t).slice(0,1e3):""),e=x(e).slice(0,1e3),this.userStore.userId=e,i&&i!==e&&(this.userStore.sessionId=""),i||i===e||this.dataStore.sendVisit(!0)}else this.clearUserId(),this.callError("setUserId")},this.clearUserId=()=>{this.userStore.userId="",this.userStore.userKey=""},this.track=(e,t,i,s)=>{var r,n;((null===(n=null===(r=this.plugins)||void 0===r?void 0:r.gioCustomTracking)||void 0===n?void 0:n.buildCustomEvent)||function(){})(e,Object.assign(Object.assign({},this.dataStore.generalProps),y(t)&&!L(t)?t:{}),i,s)},this.sendPage=e=>this.dataStore.currentPage.buildPageEvent(e),this.sendVisit=e=>this.dataStore.buildVisitEvent(e),this.trackTimerStart=(e,t)=>{this.vdsConfig.dataCollect&&W(e,(()=>{const i=he();O(t)?(this.dataStore.trackTimers[i]={eventName:e,leng:0,start:+Date.now()},t(i)):$("回调方法不合法，返回timerId失败!")}))},this.trackTimerPause=e=>{if(e&&this.dataStore.trackTimers[e]){const t=this.dataStore.trackTimers[e];t.start&&(t.leng=t.leng+(+Date.now()-t.start)),t.start=0}},this.trackTimerResume=e=>{if(e&&this.dataStore.trackTimers[e]){const t=this.dataStore.trackTimers[e];0===t.start&&(t.start=+Date.now())}},this.trackTimerEnd=(e,t)=>{if(this.vdsConfig.dataCollect){const i=864e5;if(e&&this.dataStore.trackTimers[e]){const s=this.dataStore.trackTimers[e];if(0!==s.start){const e=+Date.now()-s.start;s.leng=e>0?s.leng+e:0}this.track(s.eventName,Object.assign(Object.assign({},t),{eventDuration:s.leng>i?0:s.leng/1e3})),this.removeTimer(e)}else $("未查找到对应的计时器，请检查!","error")}},this.removeTimer=e=>{e&&this.dataStore.trackTimers[e]&&delete this.dataStore.trackTimers[e]},this.clearTrackTimer=()=>{this.dataStore.trackTimers={}},this.dataStore=new ke(this)}}let qe;return function(){var e,t,i;if(window.gioSDKInstalled)return qe=window.gdp,void $("重复加载GrowingIO SDK","warn");window.gioSDKInstalled=!0;const s=new _e;qe=function(){const e=arguments[0];if(v(e)&&g.includes(e)&&s[e]){const t=T(Array.from(arguments));if("init"===e){if(!X(s))return;if(!J(t))return;const e=Q(t);if(!e)return;const i=Z(t);if(!i)return;const{projectId:r}=e,{dataSourceId:n,appId:o,cdpOptions:a}=i;s.init(Object.assign(Object.assign({},a),{projectId:r,dataSourceId:n,appId:o}))}else if("registerPlugins"===e)s.registerPlugins(t[0]);else{if(s.gioSDKInitialized&&s.vdsConfig)return s[e](...t);$("SDK未初始化!","error")}}else p.includes(e)?$(`方法 ${x(e)} 已被弃用，请移除!`,"warn"):$(`不存在名为 ${x(e)} 的方法调用!`,"error");window.gioEnvironment="cdp",window.gioSDKVersion=s.sdkVersion};const r=null===(e=null===window||void 0===window?void 0:window.gdp)||void 0===e?void 0:e.q,n=null===(t=null===window||void 0===window?void 0:window.gdp)||void 0===t?void 0:t.e,o=null===(i=null===window||void 0===window?void 0:window.gdp)||void 0===i?void 0:i.ef;window.gdp=qe,window.gdp.e=n,window.gdp.ef=o,S(r)&&!L(r)&&r.forEach((e=>{qe.apply(null,e)}))}(),qe}));
