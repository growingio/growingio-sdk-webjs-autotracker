!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).gdp=t()}(this,(function(){"use strict";var e,t,i,n,r,s,o,a="function"==typeof Array.from?Array.from:(t||(t=1,i=function(e){return"function"==typeof e},n=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),9007199254740991)},r=function(e){if(null!=e){if(["string","number","boolean","symbol"].indexOf(typeof e)>-1)return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in e)return Symbol.iterator;if("@@iterator"in e)return"@@iterator"}},s=function(e,t){if(null!=e&&null!=t){var n=e[t];if(null==n)return;if(!i(n))throw new TypeError(n+" is not a function");return n}},o=function(e){var t=e.next();return!t.done&&t},e=function(e){var t,a,c,d=this,h=arguments.length>1?arguments[1]:void 0;if(void 0!==h){if(!i(h))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(t=arguments[2])}var l=s(e,r(e));if(void 0!==l){a=i(d)?Object(new d):[];var u,g,p=l.call(e);if(null==p)throw new TypeError("Array.from requires an array-like or iterable object");for(c=0;;){if(!(u=o(p)))return a.length=c,a;g=u.value,a[c]=h?h.call(t,g,c):g,c++}}else{var f=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var m,v=n(f.length);for(a=i(d)?Object(new d(v)):Array(v),c=0;v>c;)m=f[c],a[c]=h?h.call(t,m,c):m,c++;a.length=v}return a}),e);Array.prototype.includes=function(){return this.indexOf(arguments[0])>=0},Array.prototype.find=function(){const e=arguments[0];let t;return this.forEach((i=>{e(i)&&void 0===t&&(t=i)})),t},Array.prototype.findIndex=function(){const e=arguments[0];let t=-1;return this.forEach(((i,n)=>{e(i)&&-1===t&&(t=n)})),t},Array.from=a,Number.isNaN=function(){return""+Number(arguments[0])=="NaN"},String.prototype.includes=function(){return this.indexOf(arguments[0])>=0},String.prototype.startsWith=function(){const e=arguments[0],t=this.slice(0,e.length);return t===e},String.prototype.endsWith=function(){const e=arguments[0],t=this.slice(-e.length);return t===e};const c=["web","wxwv","minp","alip","baidup","qq","bytedance"],d={autotrack:{type:"boolean",default:!0},compress:{type:"boolean",default:!0},dataCollect:{type:"boolean",default:!0},debug:{type:"boolean",default:!1},hashtag:{type:"boolean",default:!1},touch:{type:"boolean",default:!1},version:{type:"string",default:"1.0.0"},platform:{type:"string",default:"web"}},h={enableIdMapping:{type:"boolean",default:!1},gtouchHost:{type:"string",default:""},host:{type:"string",default:""},ignoreFields:{type:"array",default:[]},penetrateHybrid:{type:"boolean",default:!0},scheme:{type:"string",default:location.protocol.indexOf("http")>-1?location.protocol.replace(":",""):"https"},sessionExpires:{type:"number",default:30}},l={},u=["clearUserId","getGioInfo","getLocation","getOption","init","setDataCollect","setOption","setUserId","track","setGeneralProps","clearGeneralProps","enableDebug","enableHT","setAutotrack","setTrackerHost","setTrackerScheme","setUserAttributes","getVisitorId","getDeviceId","registerPlugins","sendPage","sendVisit","trackTimerStart","trackTimerPause","trackTimerResume","trackTimerEnd","removeTimer","clearTrackTimer"],g=["autotrack","dataCollect","dataSourceId","debug","host","hashtag","scheme"],p={autotrack:"无埋点采集",dataCollect:"数据采集",debug:"调试模式"},f=["send","setConfig","collectImp","setPlatformProfile"],m=["screenHeight","screenWidth"],v={click:"VIEW_CLICK",change:"VIEW_CHANGE",submit:"FORM_SUBMIT"},w=e=>null==e||void 0===e,I=e=>"string"==typeof e,y=e=>"number"==typeof e,b=e=>"boolean"==typeof e,O=e=>"[object Object]"==={}.toString.call(e)&&!w(e),S=e=>"function"==typeof e,E=e=>Array.isArray(e)&&"[object Array]"==={}.toString.call(e),N=e=>"[object Date]"==={}.toString.call(e),T=e=>{try{return Array.from(e)[0]}catch(e){return}},x=e=>{try{const t=Array.from(e);return t[t.length-1]}catch(e){return}},C=(e,t=1)=>E(e)&&y(t)?e.slice(t>0?t:1,e.length):e,A=e=>{if(E(e)){let t=0;const i=[];for(const n of e)n&&!K(n)&&(i[t++]=n);return i}return e},_=e=>w(e)?"":""+e,k=(e,t)=>"string"==typeof e?e.split(t):e,j=e=>{if(I(e)){const t=k(e,"");return`${T(t).toLowerCase()}${C(t).join("")}`}return e},P=(e,t)=>!!I(e)&&e.slice(0,t.length)===t,D=(e,t)=>{if(I(e)){const{length:i}=e;let n=i;n>i&&(n=i);const r=n;return n-=t.length,n>=0&&e.slice(n,r)===t}return!1},U={}.hasOwnProperty,L=(e,t)=>!w(e)&&U.call(e,t),q=e=>"object"===M(e)?Object.keys(e):[],R=(e,t)=>{q(e).forEach((i=>t(e[i],i)))},B=(e,t)=>{const i=q(e);return!(!O(e)||!O(t)||i.length!==q(t).length||i.map(((i,n)=>O(e[i])?B(e[i],t[i]):e[i]===t[i])).includes(!1))},H=(e,t)=>{if(!O(e))return!1;try{if("string"===M(t))return delete e[t];if("array"===M(t))return t.map((t=>delete e[t]));"object"===M(t)&&t.constructor===RegExp&&q(e).forEach((i=>{t.test(i)&&H(e,i)}))}catch(e){return!1}},K=e=>E(e)?0===e.length:O(e)?0===q(e).length:!e,M=e=>{const t=typeof e;return"object"===t?null===e?"null":E(e)?"array":t:t};var V=Object.freeze({__proto__:null,isNil:w,isString:I,isNumber:y,isBoolean:b,isObject:O,isFunction:S,isArray:E,isDate:N,fixed:(e,t)=>y(e)?Number(e.toFixed(y(t)?t:2)):I(e)&&"NaN"!==_(Number(e))?Number(Number(e).toFixed(y(t)?t:2)):e,head:T,last:x,drop:C,dropWhile:(e,t)=>E(e)?e.filter((e=>!t(e))):e,compact:A,find:(e,t)=>{if(E(e)){const i=e.findIndex(t);return 0>i?void 0:e[i]}},toString:_,split:k,lowerFirst:j,upperFirst:e=>{if(I(e)){const t=k(e,"");return`${T(t).toUpperCase()}${C(t).join("")}`}return e},startsWith:P,endsWith:D,hasOwnProperty:U,has:L,keys:q,forEach:R,isEqual:B,get:(e,t,i)=>{let n=e;return O(e)?(t.split(".").forEach((e=>{n=n?n[e]:i})),n):i},unset:H,isEmpty:K,typeOf:M,formatDate:e=>{if(N(e)){const t=e=>10>e?"0"+e:e;return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+t(e.getMilliseconds())}return e}});const W=(e,t)=>{console.log("%c[GrowingIO]："+e,{info:"color: #3B82F6;",error:"color: #EF4444",warn:"color: #F59E0B",success:"color: #10B981"}[t]||"")},F=e=>{try{return e()}catch(e){return}},G=e=>{const t={};return O(e)&&R(e,((e,i)=>{const n=_(i).slice(0,50);O(e)?t[n]=G(e):E(e)?(t[n]=e.slice(0,100),"cdp"===window.gioEnvironment&&(t[n]=t[n].join("||"))):t[n]=w(e)?"":_(e).slice(0,1e3)})),t},$=(e,t,i,n={})=>{document.addEventListener?e.addEventListener(t,i,Object.assign(Object.assign({},{capture:!0}),n)):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i};var z=Object.freeze({__proto__:null,consoleText:W,niceTry:F,limitObject:G,addListener:$,flattenObject:(e={})=>{const t=Object.assign({},e);return q(t).forEach((e=>{O(t[e])?(q(t[e]).forEach((i=>{t[`${e}_${i}`]=_(t[e][i])})),H(t,e)):E(t[e])?(t[e].forEach(((i,n)=>{O(i)?q(i).forEach((r=>{t[`${e}_${n}_${r}`]=_(i[r])})):t[`${e}_${n}`]=_(i)})),H(t,e)):w(t[e])||""===t[e]?H(t,e):t[e]=_(t[e])})),t}});const J=e=>I(e)&&e.length>0||y(e)&&e>0,X=e=>e.vdsConfig||e.gioSDKInitialized||window.vds||window.gioSDKInitialized?(W("SDK重复初始化，请检查是否重复加载SDK或接入其他平台SDK导致冲突!","warn"),!1):!(["","localhost","127.0.0.1"].includes(location.hostname)&&!window._gr_ignore_local_rule&&(W("当前SDK不允许在本地环境初始化!","warn"),1)),Z=e=>!K(A(e))||(W('SDK初始化失败，请使用 gdp("init", "您的GrowingIO项目 accountId", "您项目的 dataSourceId", options); 进行初始化!',"error"),!1),Q=e=>{const t=T(e);let i=x(e);return J(_(t).trim())?(O(i)&&i||(i={}),{projectId:t,userOptions:i}):(W("SDK初始化失败，accountId 参数不合法!","error"),!1)},Y=e=>{const t=e[1],i=e[2],n=x(e);return t&&I(t)?O(n)&&n.host?{dataSourceId:t,appId:I(i)?i:"",cdpOptions:n}:(W("SDK初始化失败，未在配置中指定 host!","error"),!1):(W("SDK初始化失败，dataSourceId 参数不合法!","error"),!1)},ee=/^((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})(\.((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})){3}/i,te=/^(https?:\/\/)|(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i;var ie="SDK_INITIALIZED",ne="USERID_UPDATE",re="USERKEY_UPDATE",se="SESSIONID_UPDATE",oe={},ae={}.hasOwnProperty;function ce(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function de(e){try{return encodeURIComponent(e)}catch(e){return null}}oe.stringify=function(e,t){t=t||"";var i,n,r=[];for(n in"string"!=typeof t&&(t="?"),e)if(ae.call(e,n)){if((i=e[n])||null!=i&&!isNaN(i)||(i=""),n=de(n),i=de(i),null===n||null===i)continue;r.push(n+"="+i)}return r.length?t+r.join("&"):""},oe.parse=function(e){for(var t,i=/([^=?#&]+)=?([^&]*)/g,n={};t=i.exec(e);){var r=ce(t[1]),s=ce(t[2]);null===r||null===s||r in n||(n[r]=s)}return n};class he{constructor(e){var t;this.growingIO=e,this.injectCircle=(e,t)=>{const i=document.createElement("link"),n=document.createElement("script");i.rel="stylesheet",i.href=e,n.src=t,document.head.appendChild(i),document.head.appendChild(n)},null===(t=this.growingIO.emitter)||void 0===t||t.on(ie,(()=>{window.addEventListener("message",(e=>{const{data:t,source:i}=e,n=window.vds;if(t&&i){const e=i.vds,r=t.cssURL,s=t.jsURL;e&&"SDK_INJECT_CIRCLE_SCRIPT"===t.type&&n.projectId===e.projectId&&n.dataSourceId===e.dataSourceId&&this.injectCircle(r,s)}}))}))}}window.gioWebCircle={name:"gioWebCircle",method:he};var le={name:"gioWebCircle",method:he};const ue=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),ge=()=>{var e;const t=!!(null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.sendBeacon),i=window.navigator.userAgent;if(i.match(/(iPad|iPhone|iPod)/g)){const e=pe(i);return t&&e>13}return t},pe=e=>{const t=e.toLowerCase().match(/cpu.*os (.*?) like mac os/i);return!t||2>t.length?0:+t[1].split("_").slice(0,2).join(".")},fe=()=>{let e=window.location.hostname;return F((()=>{const t=e.split("."),i=x(t);if("localhost"!==e&&(!y(Number(i))||0>Number(i)||Number(i)>255))return["."+t.slice(-2).join("."),"."+t.slice(-3).join(".")]}))||[e]},me=e=>e.endsWith("_gioenc")?e.slice(0,-7):e,ve=e=>Number.isNaN(Number(e))&&F((()=>JSON.parse(e)))||e;class we{constructor(e){var t;this.growingIO=e,this.documentReady=!1,this.main=e=>{"listener"===e?(this.documentReady=!0,this.growingIO.gioSDKInitialized&&this.initMutationObserver()):"emitter"===e&&this.documentReady&&this.initMutationObserver()},this.initIntersectionObserver=()=>{this.intersectionObserver=new IntersectionObserver((e=>{K(e)||e.map((e=>{const{dataset:t}=e.target;if(e.intersectionRatio>0){const{eventId:e,properties:i,items:n}=this.getImpressionProperties(t),r=t.id;if(r){if("once"===t.gioImpType&&L(this.sentImps,r))return;this.sentImps[r]={eventId:e,properties:i,items:n}}e&&this.growingIO.track(e,i,n)}}))}))},this.initMutationObserver=()=>{const e=document.querySelectorAll("[data-gio-imp-track]");Array.from(e).map((e=>{var t;null===(t=this.intersectionObserver)||void 0===t||t.observe(e)})),this.mutationObserver=new MutationObserver((e=>e.map((e=>{var t;if("attributes"===e.type){const{dataset:i}=e.target;if(i.gioImpTrack)return null===(t=this.intersectionObserver)||void 0===t?void 0:t.observe(e.target)}})))),this.mutationObserver.observe(document.body,{attributes:!0,childList:!0,subtree:!0,attributeOldValue:!0,attributeFilter:["data-gio-imp-track","data-gio-imp-attrs","data-gio-imp-items",/^data-gio-track-[a-z]+$/i]})},this.getImpressionProperties=e=>{let t={eventId:void 0,properties:{}};if(!(null==e?void 0:e.gioImpTrack))return t;if(t.eventId=e.gioImpTrack,L(e,"gioImpAttrs"))t.properties=F((()=>O(e.gioImpAttrs)?e.gioImpAttrs:JSON.parse(e.gioImpAttrs))),t.items=F((()=>O(e.gioImpItems)?e.gioImpItems:JSON.parse(e.gioImpItems)));else{const i=/^gioTrack(.+)/;for(const n in e){let r;const s=n.match(i);s&&(r=j(s[1]),"track"!==r&&(t.properties[r]=e[n]))}}return t.properties=G(t.properties),t.items=G(t.items),/^\w+$/.test(t.eventId)&&!Number.isInteger(Number(T(t.eventId.split(""))))||(t.eventId=null,t={}),t},this.sentImps={},window.ActiveXObject||"ActiveXObject"in window||navigator.userAgent.indexOf("compatible")>-1&&navigator.userAgent.indexOf("MSIE")>-1||navigator.userAgent.indexOf("Trident")>-1&&navigator.userAgent.indexOf("rv:11.0")>-1?W("IE浏览器不支持半自动埋点，gioImpressionTracking已自动关闭！","warn"):(this.initIntersectionObserver(),$(document,"readystatechange",(()=>{"complete"===document.readyState&&this.main("listener")}),{once:!0}),null===(t=this.growingIO.emitter)||void 0===t||t.on(ie,(()=>this.main("emitter"))),$(window,"unload",(()=>{this.intersectionObserver.disconnect(),this.mutationObserver.disconnect()})))}}window.gioImpressionTracking={name:"gioImpressionTracking",method:we};var Ie={name:"gioImpressionTracking",method:we},ye=["TR","LI","DL"],be=function(e,t){for(var i=0,n=t.length,r=e.length;n>i;i++,r++)e[r]=t[i];return e}(["A","BUTTON"],function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,r,s=i.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return o}(ye)),Oe=["button","submit","reset"],Se=["radio","checkbox","search"],Ee=["I","EM","svg","IMG"],Ne=["TEXTAREA","HTML","BODY"],Te=["I","SPAN","EM","B","STRONG"],xe=["tspan","text","g","rect","path","defs","clippath","desc","title","math","use"],Ce=/(^| |[^ ]+\-)(clear|clearfix|active|hover|enabled|current|selected|unselected|hidden|display|focus|disabled|undisabled|open|checked|unchecked|undefined|null|ng-|growing-)[^\. ]*/g,Ae=/^[a-zA-Z-\_][a-zA-Z\-\_0-9]+$/,_e=/^([a-zA-Z\-\_0-9]+)$/,ke="data-growing-ignore",je=function(e,t){if(void 0===t&&(t=!0),e&&(null==(e=e.replace(/[\n \t]+/g," ").trim())?void 0:e.length))return e.slice(0,t?50:void 0)},Pe=function(e,t){if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var i=0,n=e.length;n>i;i++)if(e[i]!==t[i])return!1;return!0},De=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,r,s=i.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return o},Ue=function(e,t){for(var i=0,n=t.length,r=e.length;n>i;i++,r++)e[r]=t[i];return e},Le=function(e,t){return e instanceof Element&&e.hasAttribute(t)&&"false"!==e.getAttribute(t)},qe=function(e){return!e||-1!==["BODY","HTML","#document"].indexOf(e.nodeName)},Re=function(e,t){for(var i=e.parentNode;i&&!qe(i);){if(t(i))return i;i=i.parentNode}},Be=function(e){return Array.from((null==e?void 0:e.childNodes)||[]).reduce((function(e,t){return t instanceof Element?Ue(Ue(Ue([],De(e)),[t]),De(Be(t))):e}),[])},He=function(e){return Array.from((null==e?void 0:e.childNodes)||[]).filter((function(e){return e instanceof Element}))},Ke=function(e){return!e.hasChildNodes()||"svg"===e.nodeName||0===He(e).length},Me=function(e){return!(!e.hasChildNodes()||"svg"===e.nodeName)&&0===Array.from(e.childNodes).filter((function(e){return!Ke(e)})).length},Ve=function(e){return Le(e,"data-growing-container")||-1!==be.indexOf(e.nodeName)},We=function(e){var t=e.nodeName;return-1!==Ee.indexOf(t)},Fe=function(e){var t,i;if(e.textContent)return!1;var n=He(e);if(0===n.length)return!1;try{for(var r=function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),s=r.next();!s.done;s=r.next()){var o=s.value;if(!We(o)&&"SPAN"!==o.nodeName)return!1}}catch(e){t={error:e}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}return!0},Ge=function(e){return e instanceof HTMLInputElement&&"INPUT"===e.tagName&&-1!==Oe.indexOf(e.type)},$e=function(e){return e instanceof HTMLInputElement&&"INPUT"===e.tagName&&-1!==Se.indexOf(e.type)},ze=function(e,t,i){if(void 0===t&&(t=4),void 0===i&&(i=1),i>t)return!1;for(var n="svg"===e.tagName?[]:He(e),r=0;r<n.length;r++){var s=n[r];if(!ze(s,t,i+1))return!1}return t>=i},Je=function(e){if(!(e instanceof Element)||Le(e,ke))return!0;for(var t=e.parentNode;t&&!qe(t);){if(Le(t,ke))return!0;t=t.parentNode}return!1};function Xe(e){var t;if(e instanceof Element){var i=e.getAttribute("name");if(i)return[i];if(e.hasAttribute("class")){var n=null===(t=e.getAttribute("class"))||void 0===t?void 0:t.replace(Ce,"").trim();if(null==n?void 0:n.length)return n.split(/\s+/).filter((function(e){return _e.test(e)&&!e.match(/[a-z][A-Z][a-z][A-Z]/)&&!e.match(/[0-9][0-9][0-9][0-9]/)})).sort()}}return[]}var Ze=function(){function e(e){var t;this.node=e,this.tagName=this.node.nodeName,this.name=this.tagName.toLowerCase(),this.id=(t=this.node).id&&Ae.test(t.id)?t.id:null,this.classList=Xe(this.node),this.guessListAndIndex()}return e.prototype.guessListAndIndex=function(){var e,t,i=this;this._tagList=(t=this.node,-1!==ye.indexOf(t.nodeName));var n,r,s,o,a,c=(n=He(this.node.parentNode),r=this.node,o=function(e,t){if(null==e||"function"!=typeof t)return-1;for(var i=0;i<e.length;i++){var n=e[i];if(t.call(void 0,n))return i}return-1}(n,s=function(e){return e.nodeName===r.nodeName}),a=function(e,t){if(null==e||"function"!=typeof t)return-1;for(var i=e.length-1;i>=0;i--){var n=e[i];if(t.call(void 0,n))return i}return-1}(n,s),-1===o||-1===a?[]:n.slice(o,a+1));if(this._tagList&&-1!==(l=c.filter((function(e){return e.tagName===i.tagName})).indexOf(this.node))&&(this._index=l+1),c.length>=3&&(null===(e=this.classList)||void 0===e?void 0:e.length)){for(var d=0,h=0,l=1;l<=c.length;l++){var u=c[l-1];if(u.tagName!==this.tagName){h=0;break}Pe(this.classList,Xe(u))&&(h+=1),this.node===u&&(d=l)}3>h||(this._pseudoList=!0,this._index=this._index||d)}},Object.defineProperty(e.prototype,"path",{get:function(){var e;return this._path||(this._path="/"+this.name,this.id&&(this._path+="#"+this.id),(null===(e=this.classList)||void 0===e?void 0:e.length)&&(this._path+="."+this.classList.join("."))),this._path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pseudoList",{get:function(){return!!this._pseudoList},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"list",{get:function(){return!!this._tagList||!!this._pseudoList},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return function(e){if(e instanceof Element){var t=e.getAttribute("data-growing-index")||e.getAttribute("data-growing-idx")||e.getAttribute("data-index");if(t){if(/^\d{1,10}$/.test(t)&&+t>0&&2147483647>+t)return+t;window.console.error("[GioNode]：标记的index不符合规范（index必须是大于0且小于2147483647的整数字）。",t)}}}(this.node)||this._index},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"container",{get:function(){return Ve(this.node)||this.list},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.node.parentNode?new e(this.node.parentNode):null},enumerable:!1,configurable:!0}),e.prototype.parentPaths=function(e){void 0===e&&(e=!1);for(var t=e?[this]:[],i=this.parent;i&&!qe(i.node);)t.push(i),i=i.parent;return t},e}();function Qe(e){if(e.hasAttribute("href")){var t=e.getAttribute("href");if(t&&0!==t.indexOf("javascript"))return(n=(i=t.slice(0,320)).length)>1&&"/"===i.charAt(n-1)?i.slice(0,n-1):i}var i,n}function Ye(e){if(e.src&&-1===e.src.indexOf("data:image"))return e.src}var et=function(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},tt=function(e){return e.htmlFor||e.getAttribute("for")};function it(e){var t=e.node;return e.list?nt(t):je(t.textContent)||void 0}function nt(e){var t,i,n=void 0,r=!1;try{for(var s=et(Array.from(e.childNodes)),o=s.next();!o.done;o=s.next()){var a=o.value;if(a.nodeType===Node.TEXT_NODE){var c=je(a.textContent);if(c)return c}if(a.nodeType===Node.ELEMENT_NODE&&-1===["INPUT","SELECT"].indexOf(a.nodeName)){if(new Ze(a).pseudoList)return;r=Fe(a)||We(a);var d=rt(a);if(r)n=d,r=!1;else if(d||(d=nt(a)),d)return d}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}return n}function rt(e){return function(e){var t=e;if(t){var i=function(e){var t=e.getAttribute("data-growing-title")||e.getAttribute("data-title")||e.getAttribute("growing-title")||e.getAttribute("title");return(null==t?void 0:t.trim())||void 0}(t);if(i)return i;var n,r=new Ze(e);switch(e.nodeName.toLowerCase()){case"a":return function(e){if((Ke(e)||Fe(e))&&e.textContent){var t=je(e.textContent);if(t)return t}var i=Qe(e);if(i){var n=i.indexOf("?");return n>-1?i.slice(0,n):i}}(t);case"svg":return function(e){var t,i;try{for(var n=et(Array.from(e.childNodes)),r=n.next();!r.done;r=n.next()){var s=r.value;if(s.nodeType===Node.ELEMENT_NODE&&"use"===s.tagName.toLowerCase()&&s.hasAttribute("xlink:href"))return s.getAttribute("xlink:href")}}catch(e){t={error:e}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}}(t);case"button":return function(e){var t;return(null===(t=e.name)||void 0===t?void 0:t.length)?e.name:je(e.textContent)||nt(e)}(t);case"img":return function(e){if(e.alt)return e.alt;var t=Ye(e);if(t){var i=t.split("?")[0].split("/");if(i.length>0)return i[i.length-1]}}(t);case"label":return it(r);case"input":return function(e){if(Ge(e))return e.value;if("password"!==e.type&&Le(e,"data-growing-track"))return e.value;if($e(e)){var t=Re(e,(function(e){return"LABEL"===e.nodeName}));if(!t&&e.id)for(var i=document.body.getElementsByTagName("label"),n=0;n<i.length;n++){var r=i[n];if(tt(r)===e.id){t=r;break}}if(t){var s=it(new Ze(t));if(s&&s.length>0)return s+" ("+e.checked+")"}return e.value}}(t);case"select":return Array.from((n=t).options).filter((function(e){return e.selected})).map((function(e){return e.label})).join(", ")||n.value;case"form":return function(e){var t,i,n=e.getElementsByTagName("input");try{for(var r=et(Array.from(n)),s=r.next();!s.done;s=r.next()){var o=s.value;if(("search"===o.type||"text"===o.type&&("q"===o.id||-1!==o.id.indexOf("search")||"q"===o.name||-1!==o.name.indexOf("search")))&&!Je(o)){var a=rt(o);if(a)return a}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}}(t)}return Ke(t)?function(e){var t=je(e.textContent);if(t)return t}(t):Me(t)&&!Fe(t)?function(e){var t,i,n="";try{for(var r=et(Array.from(e.childNodes)),s=r.next();!s.done;s=r.next()){var o=s.value;n+=(o.nodeType===Node.TEXT_NODE&&o.textContent?o.textContent.trim():"")+" "}}catch(e){t={error:e}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}return je(n,!1)}(t):r.container||Fe(e)?nt(t):void 0}}(e)||void 0}var st,ot=(st=function(e,t){return st=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)({}).hasOwnProperty.call(t,i)&&(e[i]=t[i])},st(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+t+" is not a constructor or null");function i(){this.constructor=e}st(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),at=function(e){function t(t){var i=e.call(this,t)||this;i.node=t;var n=function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,r,s=i.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return o}(function(e){for(var t=e.parentPaths(!0),i=Math.min(t.length,+(t.length>=10)+4),n=["","",""],r=0;r<t.length;r++){var s=t[r].path,o=t[r].name;n[0]=s+n[0],n[2]="/"+o+n[2],i>r&&(n[1]=s+n[1])}return n}(i),3),r=n[0],s=n[1],o=n[2];return i.fullXpath=r,i.xpath=s,i.skeleton=o,i}return ot(t,e),Object.defineProperty(t.prototype,"href",{get:function(){return function(e){var t=e;if(t)switch(e.nodeName.toLowerCase()){case"a":return Qe(t);case"img":return Ye(t)}}(this.node)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return rt(this.node)},enumerable:!1,configurable:!0}),t}(Ze),ct=function(){return ct=Object.assign||function(e){for(var t,i=1,n=arguments.length;n>i;i++)for(var r in t=arguments[i])({}).hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},ct.apply(this,arguments)},dt=function(){function e(e,t,i){void 0===t&&(t=null),void 0===i&&(i=!0),this.origin=e,this.action=t,this.direct=i,this.target="self"===t?e:function(e){for(var t;e&&!((t=e)instanceof Element&&-1===xe.indexOf(function(e){var t;return null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase()}(t)))&&e.parentNode;)e=e.parentNode;var i,n=e.parentNode;return!qe(n)&&(Fe(n)||"BUTTON"===(i=n).tagName&&function(e){return 0!==He(e).length&&!Be(e).map((function(e){return e.tagName})).some((function(e){return-1===Te.indexOf(e)}))}(i))?n:e}(e),this.ignore=Je(this.target),this.vnode=new at(this.target),this.tagName=this.vnode.tagName}return Object.defineProperty(e.prototype,"content",{get:function(){return this.vnode.content},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"href",{get:function(){return this.vnode.href},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this.vnode.index},enumerable:!1,configurable:!0}),e.prototype.inferParentIndex=function(){var t=this;return this.parentIndex||Re(this.target,(function(i){var n=new e(i,t.action,!1);n.traceable()&&n.index&&(t.parentIndex=n.index)})),this.parentIndex},Object.defineProperty(e.prototype,"xpath",{get:function(){return this.vnode.xpath},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fullXpath",{get:function(){return this.vnode.fullXpath},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skeleton",{get:function(){return this.vnode.skeleton},enumerable:!1,configurable:!0}),e.prototype.info=function(e){return void 0===e&&(e=!0),e&&this.inferParentIndex(),{skeleton:this.skeleton,fullXpath:this.fullXpath,xpath:this.xpath,content:this.content,href:this.href,index:this.parentIndex||this.index}},e.prototype.traceable=function(){if(this.ignore)return!1;if(this.direct){if("click"===this.action||"hover"===this.action){if(-1!==Ne.indexOf(this.target.tagName))return!1;if("INPUT"===this.target.tagName&&!Ge(this.target))return!1;if(!Ve(this.target)&&!ze(this.target,5))return!1}return!0}return this.vnode.container},e.prototype.trackNodes=function(){if(!this.traceable())return[];var e=[this];if("submit"!==this.action)for(var t=this.parentElement;t;){if(t.ignore)return[];t.traceable()&&e.unshift(t),t=t.parentElement}var i=void 0;return e.map((function(e){var t=e.info(!1),n=t.index;return!i&&n&&(i=n),ct(ct({},t),{index:i||n})}))},Object.defineProperty(e.prototype,"parentElement",{get:function(){var t=this.target.parentNode;if(t&&t.nodeName&&!qe(t))return new e(t,this.action,!1)},enumerable:!1,configurable:!0}),e}();const ht=["i","span","em","b","strong","svg"];var lt;!function(e){e[e.OUTER=0]="OUTER",e[e.INNER_COVERED=1]="INNER_COVERED",e[e.INNER_SHOW=2]="INNER_SHOW"}(lt||(lt={}));const ut=["HR","BR","SCRIPT","NOSCRIPT","STYLE","HEAD","BASE","LINK","META","TITLE","BODY","HTML","TEMPLATE","CODE",...Ne],gt=["SELECT","A","BUTTON","INPUT","IMG","FORM"],pt=(e,t,i)=>document.elementFromPoint(t,i)===e;class ft{constructor(e,t,i){this.node=e,this.parentNodeDesc=t,this.devicesInfo=i,this.proxy=new dt(e),this.tagName=this.node.tagName,this.name=this.tagName.toLowerCase(),this.isIgnore=!!this.node.dataset.growingIgnore,this.isUnSupported=-1!==ut.indexOf(this.tagName),this.rect=this.computeWindowRect()}info(){const e=this.desc();e.zLevel+=this.devicesInfo.webviewZLevel;const t=this.getDeviceRect(this.rect);return H(e,"isContainer"),Object.assign(Object.assign(Object.assign({},e),t),{parentXPath:this.parentNodeDesc.isContainer?this.parentNodeDesc.xpath:void 0,href:this.proxy.href,content:this.proxy.content,nodeType:this.nodeType()})}nodeType(){return"input"!==this.name||$e(this.node)?this.node.tagName:"INPUT_BTN"}desc(){return{index:this.parentNodeDesc.index||this.proxy.index,zLevel:this.zLevel(),xpath:this.proxy.xpath,isContainer:this.isDefinedContainer()}}cssVisible(){const e=this.computedStyle();return Number(e.opacity)>0&&"visible"===e.visibility&&"none"!==e.display}viewportStatus(){const{top:e,left:t,width:i,height:n}=this.rect,{winWidth:r,winHeight:s}=this.devicesInfo;if(0>=i||0>=n)return lt.OUTER;const o=this.node;return s>e&&r>t&&i>0&&n>0?pt(o,t+i/2,e+n/2)||pt(o,t+1,e+1)||pt(o,t+i-1,e+1)||pt(o,t+1,e+n-1)||pt(o,t+i-1,e+n-1)?lt.INNER_SHOW:lt.INNER_COVERED:lt.OUTER}isCircleable(){return this.proxy.target===this.proxy.origin&&(!!this.isDefinedContainer()||!("input"===this.name&&this.node instanceof HTMLInputElement&&"password"===this.node.type)&&(-1!==gt.indexOf(this.name)||(Ke(this.node)?!this.isBigBlank():this.hasBackgroundImage()&&ze(this.node,4))))}isSimpleContainer(){return"select"===this.name||this.isDefaultContainer()&&(function(e,t){if(0===e.children.length)return!1;for(const i of Array.from(e.children))if(-1===t.indexOf(i.tagName.toLowerCase()))return!1;return!0}(this.node,ht)||!this.node.childElementCount)}isDefinedContainer(){var e;return w(this.isContainer)?this.isDefaultContainer()||this.isMarkContainer()||Me(this.node)&&(!!(null===(e=this.node.innerText)||void 0===e?void 0:e.trim().length)||function(e){const t=e.attributes;if(t.length>0)for(let e=0;e<t.length;e++){const i=t[e].value;if(i&&"false"!==i)return!0}return!1}(this.node))||"select"===this.name:!!this.isContainer}isDefaultContainer(){return-1!==be.indexOf(this.tagName)||Ge(this.node)}isMarkContainer(){return this.node.hasAttribute("data-growing-container")||this.node.hasAttribute("growing-container")}isBigBlank(){const e=this.node.innerText.trim().length,{width:t,height:i}=this.rect,{winWidth:n,winHeight:r}=this.devicesInfo;return!e&&(t>n>>1||i>r>>1)}hasBackgroundImage(){const e=this.computedStyle().backgroundImage;return!!e&&"none"!==e&&e.length>0}zLevel(){const e=this.computedStyle(),t=e.zIndex;if("auto"!==t)return Number(t||"0")+this.parentNodeDesc.zLevel;switch(e.position){case"relative":return this.parentNodeDesc.zLevel+2;case"sticky":return this.parentNodeDesc.zLevel+3;case"absolute":return this.parentNodeDesc.zLevel+4;case"fixed":return this.parentNodeDesc.zLevel+5;default:return this.parentNodeDesc.zLevel+1}}computeWindowRect(){if(this.rect)return this.rect;const e=this.node.getBoundingClientRect(),t=e.top,i=e.bottom,n=e.left;let r=e.right-n,s=i-t;return 0>t?s=t+s:t+s>this.devicesInfo.winHeight&&(s=this.devicesInfo.winHeight-t),0>n?r=n+r:n+r>this.devicesInfo.winWidth&&(r=this.devicesInfo.winWidth-n),this.rect={top:t,left:n,width:r,height:s},this.rect}computedStyle(){return window.getComputedStyle(this.node)}getDeviceRect(e){const{scale:t,webviewTop:i,webviewLeft:n}=this.devicesInfo;return{top:e.top*t+i,left:e.left*t+n,width:e.width*t,height:e.height*t}}}const mt=["DOMContentLoaded","onreadystatechange"],vt=["scroll","resize","load","beforeunload","popstate","hashchange","pagehide","unload"];class wt{constructor(e){this.growingIO=e,this.addDomChangeListener()}getDomTree(e,t,i,n,r,s){console.info("HYBRID: 调用getDomTre方法，参数",arguments);const o=function(e,t,i,n,r){const s=document.documentElement.clientWidth;return{winWidth:s,winHeight:document.documentElement.clientHeight,scale:i/s,webviewTop:t,webviewLeft:e,webviewWidth:i,webviewHeight:n,webviewZLevel:r}}(e,t,i,n,r),a=this.getElementsByParent(s||document.body,{isContainer:!1,zLevel:0},o),c={page:this.growingIO.dataStore.currentPage,elements:a};return console.log("HYBRID: 元素节点信息",c),c}getElementsByParent(e,t,i){const n=[];return[].slice.call(e.childNodes,0).filter((e=>1===e.nodeType)).forEach((e=>{const r=new ft(e,t,i);if(r.cssVisible()&&!r.isIgnore){switch(r.viewportStatus()){case lt.INNER_SHOW:r.isCircleable()&&n.push(r.info());break;case lt.INNER_COVERED:r.isDefaultContainer()&&n.push(r.info())}r.isSimpleContainer()||[].push.apply(n,this.getElementsByParent(e,r.desc(),i))}})),n}addDomChangeListener(){let e;const t=(t="")=>()=>{var i;"beforeunload"===t&&e&&e.disconnect(),console.log("HYBRID: 调用桥onDomChanged方法，事件类型:",t),null===(i=window.GrowingWebViewJavascriptBridge)||void 0===i||i.onDomChanged()};e=new MutationObserver(t("mutation")),e.observe(document.body,{attributes:!0,characterData:!0,childList:!0,subtree:!0}),mt.forEach((e=>{$(document,e,t(e))})),vt.forEach((e=>{$(window,e,t(e))}))}}let It;class yt{constructor(e){var t;this.growingIO=e,null===(t=this.growingIO.emitter)||void 0===t||t.on(ie,(()=>{window.GrowingWebViewJavascriptBridge&&(It=new wt(this.growingIO),window.GrowingWebViewJavascriptBridge.getDomTree=It.getDomTree.bind(It))}))}}window.gioHybridCircle={name:"gioHybridCircle",method:yt};var bt={name:"gioHybridCircle",method:yt};const Ot=["VIEW_CLICK","VIEW_CHANGE","FORM_SUBMIT","PAGE","CUSTOM","LOGIN_USER_ATTRIBUTES"],St=["LOGIN_USER_ATTRIBUTES"];class Et{constructor(e){this.growingIO=e,this.penetrateHybrid=!0,this.main=e=>{var t;this.projectId=e.projectId,b(e.penetrateHybrid)&&(this.penetrateHybrid=e.penetrateHybrid),this._initHybridBridge();const i=this.projectId===(null===(t=this.hybridConfig)||void 0===t?void 0:t.projectId);if(i){const{emitter:e}=this.growingIO;null==e||e.on(ne,(({newUserId:e,oldUserId:t,userKey:i})=>{this.penetrateHybrid&&(!e&&t?i?this._clearNativeUserIdAndUserKey():this._clearNativeUserId():i?this._setNativeUserIdAndUserKey(_(e),_(i)):this._setNativeUserId(_(e)))})),null==e||e.on(re,(({newUserKey:e,oldUserKey:t,userId:i})=>{this.penetrateHybrid&&(!e&&t?this._clearNativeUserIdAndUserKey():this._setNativeUserIdAndUserKey(_(i),_(e)))}))}return i},this._initHybridBridge=()=>{var e,t,i;this.hasHybridBridge=!!window.GrowingWebViewJavascriptBridge,this.hasHybridBridge&&((null===(e=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===e?void 0:e.configuration)||(window.GrowingWebViewJavascriptBridge.configuration=JSON.parse(window.GrowingWebViewJavascriptBridge.getConfiguration())),(null===(t=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===t?void 0:t.configuration)&&(this.hybridConfig=null===(i=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===i?void 0:i.configuration))},this.onSendBefore=({requestData:e})=>{var t,i;this.hasHybridBridge&&Ot.includes(e.eventType)&&(St.includes(e.eventType)?this.penetrateHybrid&&(null===(t=window.GrowingWebViewJavascriptBridge)||void 0===t||t.dispatchEvent(JSON.stringify(e))):(this.penetrateHybrid||(H(e,"userId"),H(e,"userKey"),H(e,"cs1")),null===(i=window.GrowingWebViewJavascriptBridge)||void 0===i||i.dispatchEvent(JSON.stringify(e))))},this._setNativeUserId=e=>{F((()=>window.GrowingWebViewJavascriptBridge.setNativeUserId(e)))},this._clearNativeUserId=()=>{F((()=>window.GrowingWebViewJavascriptBridge.clearNativeUserId()))},this._setNativeUserIdAndUserKey=(e,t)=>{F((()=>window.GrowingWebViewJavascriptBridge.setNativeUserIdAndUserKey(e,t)))},this._clearNativeUserIdAndUserKey=()=>{F((()=>window.GrowingWebViewJavascriptBridge.clearNativeUserIdAndUserKey()))}}}window.gioHybridAdapter={name:"gioHybridAdapter",method:Et};var Nt={name:"gioHybridAdapter",method:Et};class Tt{constructor(e){this.handler=e;const t=navigator.userAgent,i=/chrome/i.exec(t),n=/android/i.exec(t);this.hasTouch="ontouchstart"in window&&!(i&&!n)}main(){const e=this.hasTouch?["touchstart"]:["mousedown"],t=this.hasTouch?["touchend","touchcancel"]:["mouseup","mouseleave"],i=this.hasTouch?["touchmove"]:["mousemove"];for(const t of e)$(window,t,this.touchStartHandler.bind(this));for(const e of i)$(window,e,this.touchMoveHandler.bind(this));for(const e of t)$(window,e,this.touchStopHandler.bind(this))}touchStartHandler(e){if(e.which>1)return;const t=+Date.now();this.safeguard!==t&&(this.touchTimeout&&clearTimeout(this.touchTimeout),this.safeguard=t,this.touchEvent={time:t,target:e.target,x:this._page("x",e),y:this._page("y",e),isTrusted:!0,type:"click"})}touchMoveHandler(e){const t=Math.abs(this._page("x",e)-(this.touchEvent&&this.touchEvent.x)||0),i=Math.abs(this._page("y",e)-(this.touchEvent&&this.touchEvent.y)||0);(t>10||i>10)&&(this.touchEvent=null)}touchStopHandler(e){const t=+Date.now()-(this.touchEvent&&this.touchEvent.time)||0;this.touchEvent&&200>t?this.touchTimeout=setTimeout((()=>{this.handler(this.touchEvent),this.touchEvent=null}),200):this.touchEvent&&t>=200&&700>t&&(this.handler(this.touchEvent),this.touchEvent=null)}_page(e,t){return(this.hasTouch?t.touches[0]:t)["page"+e.toUpperCase()]}}class xt{constructor(e){this.growingIO=e,this.main=()=>{$(document,"submit",this._handleAction),$(document,"change",this._handleAction);const{vdsConfig:e}=this.growingIO;e.touch?new Tt(this._handleAction).main():$(document,"click",this._handleAction)},this._handleAction=(e,t)=>{const{vdsConfig:i,emitter:n}=this.growingIO;if(!i.autotrack)return!1;const r=e.target;if(!r)return!1;let s=new dt(r,e.type,!0).trackNodes();if("click"!==e.type&&(s=K(x(s))?[]:[x(s)]),K(s))return!1;i.debug&&console.log("Action：",e.type,Date.now()),null==n||n.emit("onComposeBefore",{event:t,params:null!=e?e:{}}),s.forEach((t=>{const{fullXpath:i,index:n,content:r,href:s}=t;if(!P(t.fullXpath||"","/div#__vconsole")&&i){const{dataStore:{eventContextBuilder:t,eventConverter:o,currentPage:a}}=this.growingIO;o(Object.assign(Object.assign({eventType:v[e.type],element:[{xpath:i,index:n,textValue:r,hyperlink:s}]},t()),{pageShowTimestamp:a.time}))}}))}}}window.gioEventAutoTracking={name:"gioEventAutoTracking",method:xt};var Ct={name:"gioEventAutoTracking",method:xt};let At;const _t=["gioappid","giocs1","giodatacollect","gioprojectid","gios","giou","gioappchannel","giodevicebrand","giodevicemodel","giodevicetype","giolanguage","gionetworkstate","giooperatingsystem","gioplatform","gioplatformversion","gioscreenheight","gioscreenwidth"],kt=["giodatasourceid","gioid","giouserkey"],jt={gioappchannel:"appChannel",giodevicebrand:"deviceBrand",giodevicemodel:"deviceModel",giodevicetype:"deviceType",giolanguage:"language",gionetworkstate:"networkState",giooperatingsystem:"operatingSystem",gioplatform:"platform",gioplatformversion:"platformVersion",gioscreenheight:"screenHeight",gioscreenwidth:"screenWidth"},Pt="gio_search_cookie_gioenc";class Dt{constructor(e){this.growingIO=e,this.main=e=>{var t;const{projectId:i,appId:n}=e,r=this.getGQS();let s=!1;return"none"!==this.qsFrom&&r.gioprojectid===i&&r.gioappid===n&&(K(r)?this.growingIO.storage.removeItem(Pt):this.growingIO.storage.setItem(Pt,oe.stringify(r)),this.growingIO.setUserId=()=>{},this.growingIO.clearUserId=()=>{},"cdp"===At&&(this.growingIO.vdsConfig.dataSourceId=r.giodatasourceid,this.growingIO.vdsConfig.ignoreFields=this.growingIO.vdsConfig.ignoreFields.filter((e=>L(r,e))),L(r,"giodatacollect")&&(this.growingIO.vdsConfig.dataCollect=["true",!0].includes(r.giodatacollect),this.growingIO.setDataCollect=()=>{},this.growingIO.setOption=()=>{})),null===(t=this.growingIO.emitter)||void 0===t||t.on("SDK_INITIALIZED",(()=>{this.growingIO.userStore.sessionId=r.gios,this.growingIO.userStore.uid=r.giou,r.gioid&&(this.growingIO.userStore.gioId=r.gioid),r.giocs1&&(this.growingIO.userStore.userId=r.giocs1),"cdp"===At&&L(r,"giouserkey")&&(this.growingIO.userStore.userKey=r.giouserkey),window.setInterval((()=>{this.growingIO.userStore.sessionId=r.gios}),.8*this.growingIO.vdsConfig.sessionExpires*60*1e3)})),q(jt).forEach((e=>{L(r,e)&&(this.growingIO.dataStore.eventContextBuilderInst.minpExtraParams[jt[e]]=r[e])})),s=!0),this.gioURLRewrite(),s},this.getGQS=()=>{const{hashtag:e}=this.growingIO.vdsConfig,t=this.growingIO.storage.getItem(Pt),i=window.location.search,n=window.location.hash,r=e?n.substring(n.indexOf("?")+1):"",s=oe.parse(i),o=oe.parse(r),a=oe.parse((t||"").replace("gioenc-",""));let c="";if(L(s,"gioprojectid"))c=s,this.qsFrom="search";else if(L(o,"gioprojectid"))c=o,this.qsFrom="hash";else{if(!L(a,"gioprojectid"))return this.qsFrom="none",{};c=a,this.qsFrom="cookie"}const d={},h={},l="cdp"===At?[..._t,...kt]:_t;return q(c).forEach((e=>{const t=e.toLowerCase();l.includes(t)?["","undefined","null",void 0,null].includes(c[e])||(d[t]=c[e],"true"===c[e]&&(d[t]=!0),"false"===c[e]&&(d[t]=!1)):h[e]=c[e]})),this.gqs=d,this.ngqs=h,d},this.gioURLRewrite=()=>{const{hashtag:e}=this.growingIO.vdsConfig;let t=window.location.search,i=window.location.hash,n=!1;if("search"===this.qsFrom&&(t=oe.stringify(this.ngqs,!0),n=!0),e&&"hash"===this.qsFrom&&(i=`${i.split("?")[0]}${oe.stringify(this.ngqs,!0)}`,n=!0),n){const e=`${window.location.pathname}${t||""}${i||""}`;window.history.replaceState(null,document.title,e)}},At=this.growingIO.gioEnvironment,this.gqs={},this.ngqs={},this.qsFrom="search"}}window.gioEmbeddedAdapter={name:"gioEmbeddedAdapter",method:Dt};var Ut={name:"gioEmbeddedAdapter",method:Dt};class Lt{constructor(e){this.growingIO=e,this.getValidResourceItem=e=>{if(e&&O(e)&&e.id&&e.key){const t={id:I(e.id)?e.id:_(e.id),key:I(e.key)?e.key:_(e.key)};return e.attributes&&(t.attributes=e.attributes),t}},this.getDynamicAttributes=e=>(w(e)||q(e).forEach((t=>{S(e[t])?e[t]=e[t]():O(e[t])?H(e,t):E(e[t])||(e[t]=_(e[t]))})),e),this.buildCustomEvent=(e,t,i,n)=>{if(I(e)&&e.match(/^[a-zA-Z_][0-9a-zA-Z_]{0,50}$/)){const{dataStore:{eventContextBuilder:r,eventConverter:s,currentPage:o}}=this.growingIO;let a=Object.assign({eventType:"CUSTOM",eventName:e,pageShowTimestamp:null==o?void 0:o.time,attributes:G(this.getDynamicAttributes(O(t)&&!K(t)?t:void 0)),resourceItem:G(this.getValidResourceItem(i))},r());K(n)||(a=Object.assign(Object.assign({},a),n)),s(a)}else W("埋点事件格式不正确，事件名只能包含数字、字母和下划线，且不能以数字开头!","warn")},this.buildUserAttributesEvent=(e,t)=>{const{dataStore:{eventContextBuilder:i,eventConverter:n}}=this.growingIO;let r=Object.assign({eventType:"LOGIN_USER_ATTRIBUTES",attributes:G(e)},i());K(t)||(r=Object.assign(Object.assign({},r),t)),n(r)}}}window.gioCustomTracking={name:"gioCustomTracking",method:Lt};var qt={name:"gioCustomTracking",method:Lt};class Rt{constructor(e){this.growingIO=e,this._compress=function(e,t,i){if(null===e)return"";let n,r,s,o={},a={},c="",d="",h="",l=2,u=3,g=2,p=[],f=0,m=0;for(s=0;s<e.length;s+=1)if(c=e.charAt(s),{}.hasOwnProperty.call(o,c)||(o[c]=u++,a[c]=!0),d=h+c,{}.hasOwnProperty.call(o,d))h=d;else{if({}.hasOwnProperty.call(a,h)){if(256>h.charCodeAt(0)){for(n=0;g>n;n++)f<<=1,m===t-1?(m=0,p.push(i(f)),f=0):m++;for(r=h.charCodeAt(0),n=0;8>n;n++)f=f<<1|1&r,m===t-1?(m=0,p.push(i(f)),f=0):m++,r>>=1}else{for(r=1,n=0;g>n;n++)f=f<<1|r,m===t-1?(m=0,p.push(i(f)),f=0):m++,r=0;for(r=h.charCodeAt(0),n=0;16>n;n++)f=f<<1|1&r,m===t-1?(m=0,p.push(i(f)),f=0):m++,r>>=1}l--,0===l&&(l=Math.pow(2,g),g++),delete a[h]}else for(r=o[h],n=0;g>n;n++)f=f<<1|1&r,m===t-1?(m=0,p.push(i(f)),f=0):m++,r>>=1;l--,0===l&&(l=Math.pow(2,g),g++),o[d]=u++,h=c+""}if(""!==h){if({}.hasOwnProperty.call(a,h)){if(256>h.charCodeAt(0)){for(n=0;g>n;n++)f<<=1,m===t-1?(m=0,p.push(i(f)),f=0):m++;for(r=h.charCodeAt(0),n=0;8>n;n++)f=f<<1|1&r,m===t-1?(m=0,p.push(i(f)),f=0):m++,r>>=1}else{for(r=1,n=0;g>n;n++)f=f<<1|r,m===t-1?(m=0,p.push(i(f)),f=0):m++,r=0;for(r=h.charCodeAt(0),n=0;16>n;n++)f=f<<1|1&r,m===t-1?(m=0,p.push(i(f)),f=0):m++,r>>=1}l--,0===l&&(l=Math.pow(2,g),g++),delete a[h]}else for(r=o[h],n=0;g>n;n++)f=f<<1|1&r,m===t-1?(m=0,p.push(i(f)),f=0):m++,r>>=1;l--,0===l&&(l=Math.pow(2,g),g++)}for(r=2,n=0;g>n;n++)f=f<<1|1&r,m===t-1?(m=0,p.push(i(f)),f=0):m++,r>>=1;for(;;){if(f<<=1,m===t-1){p.push(i(f));break}m++}return p.join("")},this.compress=e=>{const t=this;return this._compress(e,16,(function(e){return t.f(e)}))},this.compressToUTF16=e=>{const t=this;return null===e?"":this._compress(e,15,(function(e){return t.f(e+32)}))+" "},this.compressToUint8Array=e=>{const t=this.compress(e),i=new Uint8Array(2*t.length);for(let e=0,n=t.length;n>e;e++){const n=t.charCodeAt(e);i[2*e]=n>>>8,i[2*e+1]=n%256}return i},this.compressToEncodedURIComponent=e=>null==e?"":this._compress(e,6,(function(e){return this.keyStrUriSafe.charAt(e)})),this.f=String.fromCharCode,this.keyStrUriSafe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"}}window.gioCompress={name:"gioCompress",method:Rt};const Bt={};function Ht(e,t,i){var n=e;t.map((function(e,r){n[e]=r==t.length-1?i:n[e]||{},n=n[e]}))}Ht(Bt,["plugins","gioCompress"],{name:"gioCompress",method:Rt}),Ht(Bt,["plugins","gioCustomTracking"],qt),Ht(Bt,["plugins","gioEmbeddedAdapter"],Ut),Ht(Bt,["plugins","gioEventAutoTracking"],Ct),Ht(Bt,["plugins","gioHybridAdapter"],Nt),Ht(Bt,["plugins","gioHybridCircle"],bt),Ht(Bt,["plugins","gioImpressionTracking"],Ie),Ht(Bt,["plugins","gioWebCircle"],le);class Kt extends class{constructor(e){var t,i,n,r;this.growingIO=e,this.innerPluginInit=()=>{var e;q(null===(e=this.pluginsContext)||void 0===e?void 0:e.plugins).forEach((e=>{var t;const{name:i,method:n}=null===(t=this.pluginsContext)||void 0===t?void 0:t.plugins[e];this.pluginItems.find((e=>e.name===i))||this.pluginItems.push({name:j(i||e),method:n||(e=>{})})})),K(this.pluginItems)||this.installAll()},this.install=(e,t,i)=>{var n,r;const s=t||this.pluginItems.find((t=>t.name===e));if((null===(n=this.growingIO)||void 0===n?void 0:n.plugins)[e])return W(`重复加载插件 ${e} 或插件重名，已跳过加载!`,"warn"),!1;if(!s)return W(`插件加载失败!不存在名为 ${e} 的插件!`,"error"),!1;try{return(null===(r=this.growingIO)||void 0===r?void 0:r.plugins)[e]=new s.method(this.growingIO,i),"cdp"===this.growingIO.gioEnvironment&&t&&W("加载插件："+e,"info"),!0}catch(e){return W("插件加载异常："+e,"error"),!1}},this.installAll=e=>{(e||this.pluginItems).forEach((t=>this.install(t.name,e?t:void 0,e?null==t?void 0:t.options:void 0)))},this.uninstall=e=>{var t;H(this.pluginItems,e);const i=H(null===(t=this.growingIO)||void 0===t?void 0:t.plugins,e);return i||W(`卸载插件 ${e} 失败!`,"error"),i},this.uninstallAll=()=>{this.pluginItems.forEach((e=>this.uninstall(e.name)))},this.lifeError=(e,t)=>W(`插件执行错误 ${e.name} ${t}`,"error"),this.onComposeBefore=e=>{this.pluginItems.forEach((t=>{var i;const n=null===(i=this.growingIO.plugins[t.name])||void 0===i?void 0:i.onComposeBefore;if(n&&S(n))try{n(e)}catch(e){this.lifeError(t,e)}}))},this.onComposeAfter=e=>{this.pluginItems.forEach((t=>{var i;const n=null===(i=this.growingIO.plugins[t.name])||void 0===i?void 0:i.onComposeAfter;if(n&&S(n))try{n(e)}catch(e){this.lifeError(t,e)}}))},this.onSendBefore=e=>{this.pluginItems.forEach((t=>{var i;const n=null===(i=this.growingIO.plugins[t.name])||void 0===i?void 0:i.onSendBefore;if(n&&S(n))try{n(e)}catch(e){this.lifeError(t,e)}}))},this.onSendAfter=e=>{this.pluginItems.forEach((t=>{var i;const n=null===(i=this.growingIO.plugins[t.name])||void 0===i?void 0:i.onSendAfter;if(n&&S(n))try{n(e)}catch(e){this.lifeError(t,e)}}))},this.pluginsContext={plugins:{}},this.pluginItems=[],null===(t=this.growingIO.emitter)||void 0===t||t.on("onComposeBefore",this.onComposeBefore),null===(i=this.growingIO.emitter)||void 0===i||i.on("onComposeAfter",this.onComposeAfter),null===(n=this.growingIO.emitter)||void 0===n||n.on("onSendBefore",this.onSendBefore),null===(r=this.growingIO.emitter)||void 0===r||r.on("onSendAfter",this.onSendAfter)}}{constructor(e){super(e),this.growingIO=e,this.pluginsContext=Bt}}function Mt(e){for(var t=1;arguments.length>t;t++){var i=arguments[t];for(var n in i)e[n]=i[n]}return e}var Vt=function e(t,i){function n(e,n,r){if("undefined"!=typeof document){"number"==typeof(r=Mt({},i,r)).expires&&(r.expires=new Date(Date.now()+864e5*r.expires)),r.expires&&(r.expires=r.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var s="";for(var o in r)r[o]&&(s+="; "+o,!0!==r[o]&&(s+="="+r[o].split(";")[0]));return document.cookie=e+"="+t.write(n,e)+s}}return Object.create({set:n,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var i=document.cookie?document.cookie.split("; "):[],n={},r=0;r<i.length;r++){var s=i[r].split("="),o=s.slice(1).join("=");try{var a=decodeURIComponent(s[0]);if(n[a]=t.read(o,a),e===a)break}catch(e){}}return e?n[e]:n}},remove:function(e,t){n(e,"",Mt({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,Mt({},this.attributes,t))},withConverter:function(t){return e(Mt({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(i)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});const Wt={A:1,a:1,Z:1,z:1,"@":1},Ft=e=>w(e)?e:F((()=>"gioenc-"+$t(e)))||e,Gt=e=>I(e)&&e.startsWith("gioenc-")&&F((()=>$t(e.replace("gioenc-",""))))||e,$t=e=>(e=e||"").split("").map((e=>Wt[e]?e:zt(e))).join(""),zt=e=>{if(/[0-9]/.test(e))return 1^+e;{let t=e.charCodeAt(0);return String.fromCharCode(1^t)}};const Jt={};let Xt;Xt=window.self===window.top&&!["","localhost","127.0.0.1"].includes(window.location.hostname)&&["http:","https:"].includes(window.location.protocol)||!(e=>{try{const e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(e){return!1}})()?(()=>{let e=!1;if(navigator.cookieEnabled)return!0;const t=document.cookie;return document.cookie="gioCookie=yes;",document.cookie.indexOf("gioCookie=yes")>-1&&(e=!0),document.cookie=t,e})()?class{constructor(){this.getItem=e=>ve(Gt(Vt.get(me(e)))),this.setItem=(e,t,i)=>fe().forEach((n=>{let r;r=I(t)?t.length?e.endsWith("_gioenc")?Ft(t):t:"":JSON.stringify(t),Vt.set(me(e),r,{expires:i?new Date(i):3650,domain:n})})),this.removeItem=e=>fe().forEach((t=>Vt.remove(me(e),{domain:t}))),this.hasItem=e=>q(Vt.get()).includes(me(e)),this.getKeys=()=>q(Vt.get())}}:class{constructor(){this.getItem=e=>{const t=F((()=>JSON.parse(Jt[me(e)]||"")));return O(t)&&t.expiredAt>+Date.now()?ve(Gt(t.value)):void 0},this.setItem=(e,t,i)=>{const n=null!=i?i:+new Date(9999,12);Jt[me(e)]=JSON.stringify({value:I(t)&&t.length?Ft(t):t,expiredAt:n})},this.removeItem=e=>H(Jt,me(e)),this.hasItem=e=>L(Jt,me(e)),this.getKeys=()=>q(Jt)}}:class{constructor(){this.getItem=e=>{const t=F((()=>JSON.parse(localStorage.getItem(me(e))||"")))||{};return O(t)&&t.expiredAt>+Date.now()?ve(Gt(t.value)):void 0},this.setItem=(e,t,i)=>{const n=null!=i?i:+new Date(9999,12);localStorage.setItem(me(e),JSON.stringify({value:I(t)&&t.length&&e.endsWith("_gioenc")?Ft(t):t,expiredAt:n}))},this.removeItem=e=>localStorage.removeItem(me(e)),this.hasItem=e=>!!localStorage.getItem(me(e)),this.getKeys=()=>Array.from(Array(localStorage.length)).map(((e,t)=>localStorage.key(t)))}};var Zt,Qt=Xt;class Yt{constructor(e){var t;this.growingIO=e;const{projectId:i}=this.growingIO.vdsConfig,{getItem:n,setItem:r}=this.growingIO.storage;this.getItem=n,this.setItem=r,this.sIdStorageName=i+"_gdp_session_id",this.uidStorageName="gdp_user_id_gioenc",this.userIdStorageName=i+"_gdp_cs1_gioenc",this.userKeyStorageName=i+"_gdp_user_key_gioenc",this.gioIdStorageName=i+"_gdp_gio_id_gioenc",null===(t=this.growingIO.emitter)||void 0===t||t.on(se,(()=>{this.growingIO.gioSDKInitialized&&(this.growingIO.dataStore.sendVisit(!0),this.growingIO.dataStore.sendPage(!0))}))}get sessionId(){return this.getItem(this.sIdStorageName)||(this.sessionId=ue(),this.sessionId)}set sessionId(e){var t;e||(e=ue());const i=this.getItem(this.sIdStorageName)||this.prevSessionId,{sessionExpires:n=30}=this.growingIO.vdsConfig;this.setItem(this.sIdStorageName,e,+Date.now()+60*n*1e3),i!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit(se,{newSessionId:e,oldSessionId:i})),this.prevSessionId=e}get uid(){return this.getItem(this.uidStorageName)||(this.uid=ue(),this.uid)}set uid(e){var t;const i=this.getItem(this.uidStorageName)||this.prevUId;this.setItem(this.uidStorageName,e),i!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit("UID_UPDATE",{newUId:e,oldUId:i})),this.prevUId=e}get userId(){return this.getItem(this.userIdStorageName)||""}set userId(e){var t;const i=this.getItem(this.userIdStorageName)||this.prevUserId;this.setItem(this.userIdStorageName,e),i!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit(ne,{newUserId:e,oldUserId:i,userKey:this.userKey})),e&&(this.gioId=e),this.prevUserId=e}get userKey(){return this.getItem(this.userKeyStorageName)||""}set userKey(e){var t;const i=this.getItem(this.userKeyStorageName)||this.prevUserKey;this.setItem(this.userKeyStorageName,e),i!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit(re,{newUserKey:e,oldUserKey:i,userId:this.userId})),this.prevUserKey=e}get gioId(){return this.getItem(this.gioIdStorageName)||""}set gioId(e){var t;const i=this.getItem(this.gioIdStorageName)||this.prevGioId;this.setItem(this.gioIdStorageName,e),i!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit("GIOID_UPDATE",{newGioId:e,oldGioId:i})),this.prevGioId=e}}class ei{constructor(e){this.growingIO=e,this.main=()=>{var e;const{sdkVersion:t,useEmbeddedInherit:i,vdsConfig:n,userStore:r,dataStore:s,trackingId:o}=this.growingIO,{path:a,query:c}=s.currentPage;let d={appVersion:n.version,dataSourceId:n.dataSourceId,deviceId:r.uid,domain:i?n.appId:window.location.host,gioId:r.gioId,language:navigator.language,path:a,platform:n.platform,query:c,referralPage:(null===(e=s.lastPageEvent)||void 0===e?void 0:e.referralPage)||"",screenHeight:window.screen.height,screenWidth:window.screen.width,sdkVersion:t,sessionId:r.sessionId,timestamp:+Date.now(),title:document.title.slice(0,255),userId:r.userId};return n.enableIdMapping&&(d.userKey=r.userKey),K(this.minpExtraParams)||(d=Object.assign(Object.assign({},d),this.minpExtraParams)),K(n.ignoreFields)||n.ignoreFields.forEach((e=>{H(d,e)})),d.trackingId=o,d},this.minpExtraParams={}}}class ti{constructor(e){this.growingIO=e,this.parsePage=()=>{const{hashtag:e}=this.growingIO.vdsConfig,t=location.pathname,i=location.search,n=location.hash,r=n.indexOf("?");this.domain=window.location.host,this.path=t,e&&(this.path+=r>-1?n.slice(0,r):n),this.query=i,e&&r>-1&&(this.query=this.query+"&"+n.slice(r+1)),this.query&&["?","&"].includes(this.query.charAt(0))&&(this.query=this.query.slice(1)),this.time=+Date.now()},this.pageListener=()=>{this.lastHref!==window.location.href&&(this.parsePage(),this.buildPageEvent(),this.lastHref=window.location.href,this.lastLocation=window.location)},this.hookHistory=()=>{const e=window.history.pushState,t=window.history.replaceState;e&&(F((()=>window.history.pushState=(t,i,n)=>{e.call(window.history,t,i,n),setTimeout(this.pageListener)})),$(window,"popstate",(()=>{location.pathname===this.lastLocation.pathname&&location.search===this.lastLocation.search||this.pageListener}))),t&&F((()=>window.history.replaceState=(e,i,n)=>{t.call(window.history,e,i,n),setTimeout(this.pageListener)})),this.growingIO.vdsConfig.hashtag&&$(window,"hashchange",this.pageListener)},this.buildPageEvent=e=>{const{dataStore:{lastPageEvent:t,eventContextBuilder:i,eventConverter:n}}=this.growingIO;let r=Object.assign(Object.assign({eventType:"PAGE"},i()),{protocolType:location.protocol.substring(0,location.protocol.length-1),referralPage:(null==t?void 0:t.path)===this.path&&(null==t?void 0:t.query)===this.query?null==t?void 0:t.referralPage:(null==t?void 0:t.path)?this.lastHref:document.referrer});K(e)||(r=Object.assign(Object.assign({},r),e)),r.timestamp=this.time,n(r)},this.lastHref=window.location.href,this.lastLocation=window.location}}class ii extends class{constructor(e){var t,i;this.growingIO=e,this.ALLOW_SETTING=Object.assign(Object.assign({},d),"saas"===this.growingIO.gioEnvironment?l:h),this.allowOptKeys=Object.keys(this.ALLOW_SETTING),this.trackTimers={},this.initStorageId=()=>{const e=this.growingIO.storage.getItem(this.seqStorageIdName)||{};let t=Object.assign({},e);H(t,"globalKey"),t=O(t)&&!w(t)?t:{},this._esid={},q(t).forEach((e=>{this._esid[e]=Number.isNaN(Number(t[e]))||t[e]>=1e9||1>t[e]?1:t[e]})),B(t,this._esid)||this.setSequenceIds("esid",this._esid);const i=Number(e.globalKey);this._gsid=Number.isNaN(i)||i>=1e9||1>i?1:i,i!==this._gsid&&this.setSequenceIds("gsid",this._gsid)},this.setSequenceIds=(e,t)=>{let i=this.growingIO.storage.getItem(this.seqStorageIdName)||{};"gsid"===e?i.globalKey=t:i=Object.assign(Object.assign({},i),t),this.growingIO.storage.setItem(this.seqStorageIdName,i)},this.initOptions=e=>{const{projectId:t,dataSourceId:i,appId:n}=e;this.initialDataSourceId=i;const r={};this.allowOptKeys.forEach((t=>{const i=this.ALLOW_SETTING[t].type;let n=E(i)?!i.includes(M(e[t])):M(e[t])!==this.ALLOW_SETTING[t].type;"platform"!==t||c.includes(e[t])||(n=!0),n?r[t]=this.ALLOW_SETTING[t].default:"ignoreFields"===t?r.ignoreFields=e.ignoreFields.filter((e=>m.includes(e))):(r[t]=e[t],["dataCollect","autotrack"].includes(t)&&(r[t]||W("已关闭"+p[t],"info")))})),r.sessionExpires=Math.round(r.sessionExpires),(Number.isNaN(r.sessionExpires)||1>r.sessionExpires||r.sessionExpires>360)&&(r.sessionExpires=30),this.growingIO.vdsConfig=Object.assign(Object.assign({},r),{projectId:t,dataSourceId:i,appId:n,sdkVer:this.growingIO.sdkVersion}),window.vds=this.growingIO.vdsConfig,this.seqStorageIdName=t+"_gdp_sequence_ids"},this.setOption=(e,t)=>{var i;const{vdsConfig:n,callError:r,uploader:s,emitter:o}=this.growingIO,a=I(e)&&g.includes(e),c=a&&typeof t===((null===(i=this.ALLOW_SETTING[e])||void 0===i?void 0:i.type)||"string"),d=Object.assign({},n);return a&&c?(n[e]=t,"dataCollect"===e&&d.dataCollect!==t&&(t?(this.sendVisit(!0),this.sendPage()):this.growingIO.clearTrackTimer()),["host","scheme"].includes(e)&&(null==s||s.generateHost()),null==o||o.emit("OPTION_CHANGE",{optionName:e,optionValue:t}),!0):(r("setOption > "+e),!1)},this.getOption=e=>{const{vdsConfig:t,callError:i}=this.growingIO;return e&&L(t,_(e))?t[_(e)]:w(e)?Object.assign({},t):void i("getOption > "+e)},this.sendVisit=e=>{const{userStore:{sessionId:t},vdsConfig:{projectId:i,dataCollect:n},storage:r}=this.growingIO;if(n){const n=`${i}_gdp_session_id_${t}`,s=r.getItem(n);!e&&[!0,"true"].includes(s)||(this.buildVisitEvent(),r.setItem(n,!0))}},this.buildVisitEvent=e=>{const{dataStore:{eventContextBuilder:t,eventConverter:i}}=this.growingIO;let n=Object.assign(Object.assign({eventType:"VISIT"},t()),{referral:this.lastVisitEvent.referral,referralPage:this.lastPageEvent.referralPage});K(e)||(n.session=(null==e?void 0:e.session)||n.session,n.trackingId=null==e?void 0:e.trackingId,n=Object.assign(Object.assign({},n),e)),i(n)},this.sendPage=e=>{e&&this.currentPage.parsePage(),this.currentPage.buildPageEvent()},this.buildErrorEvent=e=>{const{dataStore:{eventContextBuilder:t,eventConverter:i}}=this.growingIO;i(Object.assign({eventType:"CUSTOM",pageShowTimestamp:this.currentPage.time,eventName:"onError",attributes:e},t()))},this.currentPage=new ti(this.growingIO),this.eventContextBuilderInst=new ei(this.growingIO),this.eventContextBuilder=this.eventContextBuilderInst.main,this.generalProps={},this.lastVisitEvent={referralPage:document.referrer},null===(t=this.growingIO.emitter)||void 0===t||t.on("onComposeAfter",(({composedEvent:e})=>{"VISIT"!==e.eventType&&"vst"!==e.t||e.trackingId!==this.growingIO.trackingId||(this.lastVisitEvent=e)})),this.lastPageEvent={},null===(i=this.growingIO.emitter)||void 0===i||i.on("onComposeAfter",(({composedEvent:e})=>{"PAGE"!==e.eventType&&"page"!==e.t||e.trackingId!==this.growingIO.trackingId||(this.lastPageEvent=e)}))}get esid(){const e=this.growingIO.storage.getItem(this.seqStorageIdName)||{};let t=Object.assign({},e);return H(t,"globalKey"),t=O(t)&&!w(t)?t:{},this._esid={},q(t).forEach((e=>{this._esid[e]=Number.isNaN(Number(t[e]))||t[e]>=1e9||1>t[e]?1:t[e]})),this._esid}set esid(e){const t={};q(e).forEach((i=>{t[i]=Number.isNaN(e[i])||e[i]>=1e9||1>e[i]?1:e[i]})),B(this._esid,t)||(this._esid=t,this.setSequenceIds("esid",this._esid))}get gsid(){const e=this.growingIO.storage.getItem(this.seqStorageIdName)||{},t=Number(e.globalKey);return this._gsid=Number.isNaN(t)||t>=1e9||1>t?1:t,this._gsid}set gsid(e){const t=Number(e);this._gsid=Number.isNaN(t)||e>=1e9||1>e?1:e,this.setSequenceIds("gsid",this._gsid)}}{constructor(e){super(e),this.growingIO=e,this.eventConverter=e=>{var t;const{vdsConfig:i,dataStore:n,uploader:r}=this.growingIO;if(i.dataCollect){e.trackingId===this.growingIO.trackingId&&(e.globalSequenceId=n.gsid,e.eventSequenceId=n.esid[e.eventType]||1);const i={};R(e,((e,t)=>{var n;if("element"===t){const t=null!==(n=T(e))&&void 0!==n?n:{};R(t,((e,t)=>{K(e)&&0!==e||(i[t]=e)}))}else(K(e)||w(e))&&0!==e||(i[t]=e)})),e.trackingId===this.growingIO.trackingId&&(this.growingIO.dataStore.gsid+=1,this.growingIO.dataStore.esid=Object.assign(Object.assign({},this.growingIO.dataStore.esid),{[i.eventType]:(this.growingIO.dataStore.esid[i.eventType]||1)+1})),null===(t=this.growingIO.emitter)||void 0===t||t.emit("onComposeAfter",{composedEvent:Object.assign({},i)}),e.trackingId===this.growingIO.trackingId&&r.commitRequest(i)}}}}class ni extends class{constructor(e){this.growingIO=e,this.commitRequest=e=>{const t=Object.assign({},e);this.requestQueue.push(Object.assign(Object.assign({},t),{requestType:ge()?"Beacon":"XHR"})),this.initiateRequest()},this.initiateRequest=()=>{var e,t;if([...this.requestQueue].length>0&&this.requestingNum<this.requestLimit){const{vdsConfig:i,emitter:n,plugins:r,useHybridInherit:s}=this.growingIO;if(this.requestQueue=[...this.requestQueue].filter((e=>(this.retryIds[e.globalSequenceId||e.esid]||0)<=this.retryLimit)),K(this.requestQueue))return;const o=this.requestQueue.shift(),{requestType:a}=o;if(null==n||n.emit("onSendBefore",{requestData:o}),H(o,["requestType","trackingId"]),i.debug&&console.log("[GrowingIO Debug]:",JSON.stringify(o,null,2).replace(/\"/g,(()=>{const e=window.navigator.userAgent;return/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(e)&&!/chrome\/(\d+\.\d+)/i.test(e)})()?"":'"')),this.requestingNum+=1,s)return this.requestSuccessFn(o),!1;let c=Object.assign({},o);switch(i.compress&&(null===(e=null==r?void 0:r.gioCompress)||void 0===e?void 0:e.compressToUint8Array)?(this.compressType="1",c=null===(t=null==r?void 0:r.gioCompress)||void 0===t?void 0:t.compressToUint8Array(JSON.stringify([c]))):(this.compressType="0",c=JSON.stringify([c])),a){case"Beacon":default:this.sendByBeacon(o,c);break;case"XHR":this.sendByXHR(o,c);break;case"Image":this.sendByImage(o,c)}}},this.generateURL=()=>`${this.requestURL}?stm=${+Date.now()}&compress=${this.compressType}`,this.sendByBeacon=(e,t)=>{navigator.sendBeacon(this.generateURL(),t)?this.requestSuccessFn(e):this.requestFailFn(e,"Beacon")},this.sendByXHR=(e,t)=>{var i;const n=["unload","beforeunload","pagehide"].includes(null===(i=null===window||void 0===window?void 0:window.event)||void 0===i?void 0:i.type),r=new XMLHttpRequest;if(r)return r.open("POST",this.generateURL(),n),r.onreadystatechange=()=>{4===r.readyState&&204===r.status?this.requestSuccessFn(e):this.requestFailFn(e,"XHR")},r.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),void r.send(t);if(null===window||void 0===window?void 0:window.XDomainRequest){const i=new window.XDomainRequest;i.open("POST",this.generateURL().replace("https://","http://"),n),i.onload=()=>{204===i.status?this.requestSuccessFn(e):this.requestFailFn(e,"XHR")},i.onerror=i.ontimeout=()=>{this.requestFailFn(e,"XHR")},i.send(t)}},this.sendByImage=(e,t)=>{const i=`${this.generateURL()}&data=${t}`;let n=document.createElement("img");n.width=1,n.height=1,n.onload=()=>{this.requestSuccessFn(e),this.clearImage(n)},n.onerror=n.onabort=()=>{this.requestFailFn(e,"Image"),this.clearImage(n)},n.src=i},this.clearImage=e=>{e.src="",e.onload=()=>{},e.onerror=e.onerabort=()=>{},e=null},this.requestSuccessFn=e=>{var t;this.requestingNum-=1;const i=e.globalSequenceId||e.esid||-1;this.retryIds[i]&&(this.retryIds[i]=0),this.growingIO.userStore.sessionId=this.growingIO.userStore.sessionId,null===(t=this.growingIO.emitter)||void 0===t||t.emit("onSendAfter",{requestData:e}),this.initiateRequest()},this.requestFailFn=(e,t)=>{this.requestingNum-=1;const i=e.globalSequenceId||e.esid||-1;this.retryIds[i]||(this.retryIds[i]=0),this.retryIds[i]+=1;const n=this.requestQueue.some((t=>t.globalSequenceId===e.globalSequenceId&&t.esid===e.esid));let r=t;this.retryIds[i]<this.retryLimit+1||(r="Beacon"===t?"XHR":"XHR"===t?"Image":void 0,this.retryIds[i]=0),!n&&r&&this.requestQueue.push(Object.assign(Object.assign({},e),{requestType:r}))},this.requestQueue=[],this.requestLimit=10,this.requestTimeout=5e3,this.retryLimit=1,this.retryIds={},this.requestingNum=0,this.requestURL=""}}{constructor(e){super(e),this.growingIO=e,this.generateHost=()=>{let{scheme:e,host:t="",projectId:i}=this.growingIO.vdsConfig;e?D(_(e),"://")||(e+="://"):e=(location.protocol.indexOf("http")>-1?location.protocol.replace(":",""):"https")+"//",P(t,"http")&&(t=t.substring(t.indexOf("://")+(D(_(e),"://")?3:0))),this.requestURL=`${e}${t}/v3/projects/${i}/collect`},this.requestURL="",this.generateHost()}}const ri=new class extends class{constructor(){var e;this.trackingId="g0",this.init=e=>{var t,i,n,r,s;W("Gio Web SDK 初始化中...","info");const{initOptions:o,currentPage:a,sendVisit:c,sendPage:d}=this.dataStore;o(e),this.useEmbeddedInherit=null===(i=null===(t=this.plugins)||void 0===t?void 0:t.gioEmbeddedAdapter)||void 0===i?void 0:i.main(e),this.useHybridInherit=null===(r=null===(n=this.plugins)||void 0===n?void 0:n.gioHybridAdapter)||void 0===r?void 0:r.main(e),null==this||this.initCallback(),a.hookHistory(),a.parsePage(),null===(s=this.emitter)||void 0===s||s.emit(ie,this),W("Gio Web SDK 初始化完成！","success"),this.useEmbeddedInherit||c(),d(),this.gioSDKInitialized=!0},this.setOption=(e,t)=>{if(g.includes(e)){const i=this.dataStore.setOption(e,t);return i&&p[e]&&W(`已${t?"开启":"关闭"}${p[e]}`,"info"),i}return W(`不存在可修改的配置项：${e}，请检查后重试!`,"warn"),!1},this.getOption=e=>this.dataStore.getOption(e),this.setGeneralProps=e=>{O(e)&&!K(e)?(this.dataStore.generalProps=Object.assign(Object.assign({},this.dataStore.generalProps),e),q(this.dataStore.generalProps).forEach((e=>{[void 0,null].includes(this.dataStore.generalProps[e])&&(this.dataStore.generalProps[e]="")}))):this.callError("setGeneralProps")},this.clearGeneralProps=e=>{E(e)&&!K(e)?e.forEach((e=>{H(this.dataStore.generalProps,e)})):this.dataStore.generalProps={}},this.reissuePage=()=>{this.dataStore.sendPage()},this.notRecommended=()=>W("不推荐的方法使用，建议使用 gio('setOption', [optionName], [value])!","info"),this.callError=(e,t=!0,i="参数不合法")=>W(`${t?"调用":"设置"} ${e} 失败，${i}!`,"warn"),this.gioEnvironment="cdp",this.sdkVersion="3.8.0-rc.7",this.utils=Object.assign(Object.assign(Object.assign({},V),z),{qs:oe}),this.emitter={all:e=e||new Map,on:function(t,i){var n=e.get(t);n?n.push(i):e.set(t,[i])},off:function(t,i){var n=e.get(t);n&&(i?n.splice(n.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var n=e.get(t);n&&n.slice().map((function(e){e(i)})),(n=e.get("*"))&&n.slice().map((function(e){e(t,i)}))}},this.gioSDKInitialized=!1,this.storage=new Qt,this.plugins=new Kt(this),this.plugins.innerPluginInit()}}{constructor(){super(),this.registerPlugins=e=>{e.forEach(((t,i)=>{var n;K(t)||w(t)?W("插件不合法，跳过加载!","warn"):t.js&&(e[i]=Object.assign(Object.assign({},null===(n=t.js)||void 0===n?void 0:n.default),{options:t.options}))})),e=A(e),this.plugins.pluginItems=[...this.plugins.pluginItems,...e],this.plugins.installAll(e)},this.initCallback=()=>{var e,t;this.userStore=new Yt(this),this.uploader=new ni(this),null===(t=null===(e=this.plugins)||void 0===e?void 0:e.gioEventAutoTracking)||void 0===t||t.main(),this.vdsConfig.enableIdMapping||(this.userStore.userKey="")},this.setTrackerScheme=e=>{["http","https"].includes(e)?(this.dataStore.setOption("scheme",e),this.notRecommended()):this.callError("scheme",!1)},this.setTrackerHost=e=>{ee.test(e)||te.test(e)?(this.dataStore.setOption("host",e),this.notRecommended()):this.callError("host",!1)},this.setDataCollect=e=>{this.setOption("dataCollect",!!e),this.notRecommended()},this.setAutotrack=e=>{this.setOption("autotrack",!!e),this.notRecommended()},this.enableDebug=e=>{this.setOption("debug",!!e),this.notRecommended()},this.enableHT=e=>{this.setOption("hashtag",!!e),this.notRecommended()},this.getVisitorId=()=>this.userStore.uid,this.getDeviceId=()=>this.userStore.uid,this.setUserAttributes=(e,t)=>{var i,n;!K(e)&&O(e)?null===(n=null===(i=this.plugins)||void 0===i?void 0:i.gioCustomTracking)||void 0===n||n.buildUserAttributesEvent(e,t):this.callError("setUserAttributes")},this.setUserId=(e,t)=>{if(J(_(e).trim())){const i=this.userStore.gioId;this.vdsConfig.enableIdMapping&&(this.userStore.userKey=!w(t)&&_(t).length>0?_(t).slice(0,1e3):""),e=_(e).slice(0,1e3),this.userStore.userId=e,i&&i!==e&&(this.userStore.sessionId=""),i||i===e||this.dataStore.sendVisit(!0)}else this.clearUserId(),this.callError("setUserId")},this.clearUserId=()=>{this.userStore.userId="",this.userStore.userKey=""},this.track=(e,t,i,n)=>{var r,s;((null===(s=null===(r=this.plugins)||void 0===r?void 0:r.gioCustomTracking)||void 0===s?void 0:s.buildCustomEvent)||function(){})(e,Object.assign(Object.assign({},this.dataStore.generalProps),O(t)&&!K(t)?t:{}),i,n)},this.sendPage=e=>this.dataStore.currentPage.buildPageEvent(e),this.sendVisit=e=>this.dataStore.buildVisitEvent(e),this.trackTimerStart=(e,t)=>{if(this.vdsConfig.dataCollect)if(I(e)&&!K(e)&&e.match(/^[a-zA-Z_][0-9a-zA-Z_]{0,50}$/)){const i=ue();S(t)?(this.dataStore.trackTimers[i]={eventName:e,leng:0,start:+Date.now()},t(i)):W("回调方法不合法，返回timerId失败!")}else W("事件名格式不正确，只能包含数字、字母和下划线，且不能以数字开头!","error")},this.trackTimerPause=e=>{if(e&&this.dataStore.trackTimers[e]){const t=this.dataStore.trackTimers[e];t.start&&(t.leng=t.leng+(+Date.now()-t.start)),t.start=0}},this.trackTimerResume=e=>{if(e&&this.dataStore.trackTimers[e]){const t=this.dataStore.trackTimers[e];0===t.start&&(t.start=+Date.now())}},this.trackTimerEnd=(e,t)=>{if(this.vdsConfig.dataCollect){const i=864e5;if(e&&this.dataStore.trackTimers[e]){const n=this.dataStore.trackTimers[e];if(0!==n.start){const e=+Date.now()-n.start;n.leng=e>0?n.leng+e:0}this.track(n.eventName,Object.assign(Object.assign({},t),{eventDuration:n.leng>i?0:n.leng/1e3})),this.removeTimer(e)}else W("未查找到对应的计时器，请检查!","error")}},this.removeTimer=e=>{e&&this.dataStore.trackTimers[e]&&delete this.dataStore.trackTimers[e]},this.clearTrackTimer=()=>{this.dataStore.trackTimers={}},this.dataStore=new ii(this)}},si=function(){const e=arguments[0];if(I(e)&&u.includes(e)&&ri[e]){const t=C(Array.from(arguments));if("init"===e){if(!X(ri))return;if(!Z(t))return;const e=Q(t);if(!e)return;const i=Y(t);if(!i)return;const{projectId:n}=e,{dataSourceId:r,appId:s,cdpOptions:o}=i;ri.init(Object.assign(Object.assign({},o),{projectId:n,dataSourceId:r,appId:s}))}else if("registerPlugins"===e)ri.registerPlugins(t[0]);else{if(ri.gioSDKInitialized&&ri.vdsConfig)return ri[e](...t);W("SDK未初始化!","error")}}else f.includes(e)?W(`方法 ${_(e)} 已被弃用，请移除!`,"warn"):W(`不存在名为 ${_(e)} 的方法调用!`,"error");window.gioEnvironment="cdp",window.gioSDKVersion=ri.sdkVersion},oi=null===(Zt=null===window||void 0===window?void 0:window.gdp)||void 0===Zt?void 0:Zt.q;return window.gdp=si,E(oi)&&!K(oi)&&oi.forEach((e=>{si.apply(null,e)})),si}));
