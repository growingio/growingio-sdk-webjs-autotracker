var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)({}).hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+n+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}var n=function(){return n=Object.assign||function(e){for(var t,n=1,i=arguments.length;i>n;n++)for(var r in t=arguments[n])({}).hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},n.apply(this,arguments)};function i(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;o>r;r++)!i&&r in t||(i||(i=[].slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||[].slice.call(t))}var r=["web","wxwv","minp","alip","baidup","qq","bytedance"],o={autotrack:{type:"boolean",default:!0},compress:{type:"boolean",default:!0},dataCollect:{type:"boolean",default:!0},debug:{type:"boolean",default:!1},hashtag:{type:"boolean",default:!1},touch:{type:"boolean",default:!1},version:{type:"string",default:"1.0.0"},platform:{type:"string",default:"web"},cookieDomain:{type:"string",default:""},sendType:{type:"string",default:"beacon"}},a={enableIdMapping:{type:"boolean",default:!1},gtouchHost:{type:"string",default:""},host:{type:"string",default:"napi.growingio.com"},ignoreFields:{type:"array",default:[]},penetrateHybrid:{type:"boolean",default:!0},scheme:{type:"string",default:location.protocol.indexOf("http")>-1?location.protocol.replace(":",""):"https"},sessionExpires:{type:"number",default:30},performance:{type:"object",default:{monitor:!0,exception:!0}},embeddedIgnore:{type:"array",default:[]},storageType:{type:"string",default:"cookie"},requestTimeout:{type:"number",default:5e3}},s={},u=["clearUserId","getGioInfo","getLocation","getOption","init","setDataCollect","setOption","setUserId","track","setGeneralProps","clearGeneralProps"];i(i([],u,!0),["setEvar","setPage","setUser","setVisitor"],!1);var c,d,l,g,f,m=i(i([],u,!0),["enableDebug","enableHT","setAutotrack","setTrackerHost","setTrackerScheme","setUserAttributes","getVisitorId","getDeviceId","registerPlugins","getPlugins","sendPage","sendVisit","trackTimerStart","trackTimerPause","trackTimerResume","trackTimerEnd","removeTimer","clearTrackTimer","updateImpression"],!1),p=["autotrack","dataCollect","dataSourceId","debug","host","hashtag","scheme"],v={autotrack:"无埋点采集",dataCollect:"数据采集",debug:"调试模式"},h=["send","setConfig","collectImp","setPlatformProfile"],I=["screenHeight","screenWidth"],w="function"==typeof Array.from?Array.from:(d||(d=1,l=function(e){return"function"==typeof e},g=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),9007199254740991)},f=function(e){var t=e.next();return!t.done&&t},c=function(e){var t,n,i,r=this,o=arguments.length>1?arguments[1]:void 0;if(void 0!==o){if(!l(o))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(t=arguments[2])}var a=function(e,t){if(null!=e&&null!=t){var n=e[t];if(null==n)return;if(!l(n))throw new TypeError(n+" is not a function");return n}}(e,function(e){if(null!=e){if(["string","number","boolean","symbol"].indexOf(typeof e)>-1)return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in e)return Symbol.iterator;if("@@iterator"in e)return"@@iterator"}}(e));if(void 0!==a){n=l(r)?Object(new r):[];var s,u,c=a.call(e);if(null==c)throw new TypeError("Array.from requires an array-like or iterable object");for(i=0;;){if(!(s=f(c)))return n.length=i,n;u=s.value,n[i]=o?o.call(t,u,i):u,i++}}else{var d=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var m,p=g(d.length);for(n=l(r)?Object(new r(p)):Array(p),i=0;p>i;)m=d[i],n[i]=o?o.call(t,m,i):m,i++;n.length=p}return n}),c),y=function(e){return U(["undefined","null"],Q(e))},S=function(e){return"string"===Q(e)},O=function(e){return"number"===Q(e)},b=function(e){return"NaN"===R(Number(e))},E=function(e){return"object"===Q(e)&&!y(e)},T=function(e){return"regexp"===Q(e)},_=function(e){return U(["function","asyncfunction"],Q(e))},C=function(e){return Array.isArray(e)&&"array"===Q(e)},k=function(e){return"date"===Q(e)},P=function(e){try{return K(e)[0]}catch(e){return}},x=function(e){try{var t=K(e);return t[t.length-1]}catch(e){return}},q=function(e,t){return void 0===t&&(t=1),C(e)&&O(t)?e.slice(t>0?t:1,e.length):e},N=function(e){if(C(e)){for(var t=0,n=[],i=0,r=e;i<r.length;i++){var o=r[i];o&&!J(o)&&(n[t++]=o)}return n}return e},D=function(e,t){return e[A(e,t)]},A=function(e,t){var n=-1;return C(e)&&e.every((function(e,i){return!t(e)||(n=i,!1)})),n},U=function(e,t){return("array"===Q(e)||"string"===Q(e))&&e.indexOf(t)>=0},K=w,R=function(e){return y(e)?"":"".concat(e)},L=function(e,t){return"string"==typeof e?e.split(t):e},j=function(e){if(S(e)){var t=L(e,"");return"".concat(P(t).toLowerCase()).concat(q(t).join(""))}return e},F=function(e,t){return!!S(e)&&e.slice(0,t.length)===t},B=function(e,t){if(S(e)){var n=e.length,i=n;i>n&&(i=n);var r=i;return(i-=t.length)>=0&&e.slice(i,r)===t}return!1},V={}.hasOwnProperty,H=function(e,t){return!y(e)&&V.call(e,t)},G=function(e){return E(e)?Object.keys(e):[]},M=function(e,t){G(e).forEach((function(n){return t(e[n],n)}))},z=function(e,t){var n=G(e);return!(!E(e)||!E(t)||n.length!==G(t).length||U(n.map((function(n,i){return E(e[n])?z(e[n],t[n]):e[n]===t[n]})),!1))},W=function(e,t){if(!E(e))return!1;try{return"string"===Q(t)?delete e[t]:"array"===Q(t)?t.map((function(t){return delete e[t]})):(T(t)&&G(e).forEach((function(n){t.test(n)&&W(e,n)})),!0)}catch(e){return!1}},J=function(e){return C(e)?0===e.length:E(e)?0===G(e).length:!e},Q=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},Z=Object.freeze({__proto__:null,isNil:y,isString:S,isNumber:O,isNaN:b,isBoolean:function(e){return"boolean"===Q(e)},isObject:E,isRegExp:T,isFunction:_,isArray:C,isDate:k,fixed:function(e,t){return O(e)?Number(e.toFixed(O(t)?t:2)):S(e)&&"NaN"!==R(Number(e))?Number(Number(e).toFixed(O(t)?t:2)):e},head:P,last:x,drop:q,dropWhile:function(e,t){return C(e)?e.filter((function(e){return!t(e)})):e},compact:N,find:D,findIndex:A,includes:U,arrayFrom:K,toString:R,split:L,lowerFirst:j,upperFirst:function(e){if(S(e)){var t=L(e,"");return"".concat(P(t).toUpperCase()).concat(q(t).join(""))}return e},startsWith:F,endsWith:B,has:H,keys:G,forEach:M,isEqual:z,get:function(e,t,n){var i=e;return E(e)?(t.split(".").forEach((function(e){i=i?i[e]:n})),i):n},unset:W,isEmpty:J,typeOf:Q,formatDate:function(e){if(k(e)){var t=function(e){return 10>e?"0"+e:e};return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+t(e.getMilliseconds())}return e}}),X=function(e,t){console.log("%c [GrowingIO]：".concat(e),{info:"color: #3B82F6;",error:"color: #EF4444;",warn:"color: #F59E0B;",success:"color: #10B981;"}[t]||"")},Y=function(e){try{return e()}catch(e){return}},$=function(e){var t={};return E(e)&&M(e,(function(e,n){var i,r=R(n).slice(0,100);E(e)?t[r]=$(e):C(e)?(t[r]=e.slice(0,100),"cdp"===(null===(i=window.vds)||void 0===i?void 0:i.gioEnvironment)&&(t[r]=t[r].join("||").slice(0,1e3))):t[r]=y(e)?"":R(e).slice(0,1e3)})),t},ee=function(e,t,i,r){void 0===r&&(r={}),document.addEventListener?e.addEventListener(t,i,n(n({},{capture:!0}),r)):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i},te=function(e,t){return S(e)&&!J(e)&&e.match(/^[a-zA-Z_][0-9a-zA-Z_]{0,100}$/)?t():(X("事件名格式不正确，只能包含数字、字母和下划线，且不能以数字开头，字符总长度不能超过100!","error"),!1)},ne=Object.freeze({__proto__:null,consoleText:X,niceTry:Y,limitObject:$,addListener:ee,flattenObject:function(e){void 0===e&&(e={});var t=n({},e);return G(t).forEach((function(e){E(t[e])?(G(t[e]).forEach((function(n){t["".concat(e,"_").concat(n)]=R(t[e][n])})),W(t,e)):C(t[e])?(t[e].forEach((function(n,i){E(n)?G(n).forEach((function(r){t["".concat(e,"_").concat(i,"_").concat(r)]=R(n[r])})):t["".concat(e,"_").concat(i)]=R(n)})),W(t,e)):y(t[e])||""===t[e]?W(t,e):t[e]=R(t[e])})),$(t)},eventNameValidate:te,getGioFunction:function(){var e,t,n,i,r=window._gio_local_vds||"vds",o=null!==(t=null===(e=window[r])||void 0===e?void 0:e.namespace)&&void 0!==t?t:"gdp";return _(window[o])?window[o]:null!==(i=null!==(n=window.gdp)&&void 0!==n?n:window.gio)&&void 0!==i?i:function(){}}}),ie=function(e){return S(e)&&e.length>0||O(e)&&e>0},re=/^((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})(\.((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})){3}/i,oe=/^(https?:\/\/)|(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i;function ae(e){for(var t=1;arguments.length>t;t++){var n=arguments[t];for(var i in n)e[i]=n[i]}return e}var se,ue,ce=function e(t,n){function i(e,i,r){if("undefined"!=typeof document){"number"==typeof(r=ae({},n,r)).expires&&(r.expires=new Date(Date.now()+864e5*r.expires)),r.expires&&(r.expires=r.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var a in r)r[a]&&(o+="; "+a,!0!==r[a]&&(o+="="+r[a].split(";")[0]));return document.cookie=e+"="+t.write(i,e)+o}}return Object.create({set:i,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var n=document.cookie?document.cookie.split("; "):[],i={},r=0;r<n.length;r++){var o=n[r].split("="),a=o.slice(1).join("=");try{var s=decodeURIComponent(o[0]);if(i[s]=t.read(a,s),e===s)break}catch(e){}}return e?i[e]:i}},remove:function(e,t){i(e,"",ae({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,ae({},this.attributes,t))},withConverter:function(t){return e(ae({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"}),de=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},le=function(e){return B(e,"_gioenc")?e.slice(0,-7):e},ge=function(e){return b(Number(e))&&Y((function(){return JSON.parse(e)}))||e},fe={A:1,a:1,Z:1,z:1,"@":1,"{":1},me=function(e){return y(e)?e:Y((function(){return"gioenc-".concat(ve(e))}))||e},pe=function(e){return S(e)&&F(e,"gioenc-")&&Y((function(){return ve(e.replace("gioenc-",""))}))||e},ve=function(e){return(e=e||"").split("").map((function(e){return fe[e]?e:he(e)})).join("")},he=function(e){if(/[0-9]/.test(e))return 1^+e;var t=e.charCodeAt(0);return String.fromCharCode(1^t)},Ie=function(e){var t=this;this.domain=e,this.getItem=function(e){return ge(pe(ce.get(le(e),{domain:t.domain,path:"/"})))},this.setItem=function(e,n,i){var r;r=S(n)?n.length?B(e,"_gioenc")?me(n):n:"":JSON.stringify(n),ce.set(le(e),r,{expires:i?new Date(i):3650,domain:t.domain,path:"/"})},this.removeItem=function(e){ce.remove(le(e),{domain:t.domain,path:"/"})},this.hasItem=function(e){return U(G(ce.get()),le(e))},this.getKeys=function(){return G(ce.get())},this.type="Cookie"},we=function(){this.getItem=function(e){var t=Y((function(){return JSON.parse(localStorage.getItem(le(e))||"")}))||{};return E(t)&&t.expiredAt>+Date.now()?ge(pe(t.value)):void 0},this.setItem=function(e,t,n){var i=null!=n?n:+new Date(9999,12);localStorage.setItem(le(e),JSON.stringify({value:S(t)&&t.length&&B(e,"_gioenc")?me(t):t,expiredAt:i}))},this.removeItem=function(e){return localStorage.removeItem(le(e))},this.hasItem=function(e){return!!localStorage.getItem(le(e))},this.getKeys=function(){return K(Array(localStorage.length)).map((function(e,t){return localStorage.key(t)}))},this.type="localStorage"},ye={},Se=function(){this.getItem=function(e){var t=Y((function(){return JSON.parse(ye[le(e)]||"")}));return E(t)&&t.expiredAt>+Date.now()?ge(pe(t.value)):void 0},this.setItem=function(e,t,n){var i=null!=n?n:+new Date(9999,12);ye[le(e)]=JSON.stringify({value:S(t)&&t.length?me(t):t,expiredAt:i})},this.removeItem=function(e){return W(ye,le(e))},this.hasItem=function(e){return H(ye,le(e))},this.getKeys=function(){return G(ye)},this.type="memory"},Oe=/^(\.ac\.|\.br\.|\.co\.|\.com\.|\.edu\.|\.gov\.|\.org\.|\.net\.)/,be=function(e){var t=[];try{var n=e.split("."),i=x(n);if(n.length>=2&&(isNaN(Number(i))||0>Number(i)||Number(i)>255)){var r=".".concat(n.slice(-2).join("."));Oe.test(r)?se=r:t.push(r);var o=".".concat(n.slice(-3).join("."));Oe.test(o)||U(t,o)||t.push(o);var a=".".concat(n.slice(-4).join("."));Oe.test(a)||U(t,a)||t.push(a)}}catch(e){}return t},Ee=function(e){var t="";return e.every((function(e){return!Te(e)||(t=e,!1)})),t},Te=function(e){try{ce.set("gioCookie","yes",{domain:e});var t=!!ce.get("gioCookie",{domain:e});return ce.remove("gioCookie",{domain:e}),t}catch(e){return!1}},_e=function(e){var t,n,r,o=e.storageType,a=e.cookieDomain,s=e.projectId;if(U(["cookie","localstorage"],o)||(o="cookie"),"cookie"===o&&(n=!!(r=navigator.userAgent.indexOf("Electron")>-1||U(["","localhost","127.0.0.1"],window.location.hostname)||!U(["http:","https:"],window.location.protocol)?"":Ee(i(i([],be(window.location.hostname),!0),[window.location.hostname],!1)))),"cookie"===o&&n){var u=new Ie(r);if(a){var c=be(a),d=Ee(J(c)?[]:i([a],be(a),!0));d&&Te(d)?u.domain=d:X("指定Cookie域无效或无权限，使用默认域！","warn")}t=u}else t=function(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(e){return!1}}()?new we:new Se;return"cookie"===o&&se&&Te(se)&&function(e,t,n){if(t&&Te(t)){var i=new Ie(t);["".concat(n,"_gdp_session_id"),"gdp_user_id_gioenc","".concat(n,"_gdp_cs1_gioenc"),"".concat(n,"_gdp_user_key_gioenc"),"".concat(n,"_gdp_gio_id_gioenc"),"".concat(n,"_gdp_sequence_ids"),"".concat(n,"_gdp_session_id_sent")].forEach((function(t){var n=i.getItem(t);i.hasItem(t)&&(e.setItem(t,n),i.removeItem(t))})),i=void 0}}(t,se,s),t},Ce="SESSIONID_UPDATE",ke={name:"gioCustomTracking",method:function(e){var t=this;this.growingIO=e,this.getValidResourceItem=function(e){if(e&&E(e)&&e.id&&e.key){var t={id:S(e.id)?e.id:R(e.id),key:S(e.key)?e.key:R(e.key)};return e.attributes&&(t.attributes=e.attributes),t}},this.getDynamicAttributes=function(e){return y(e)||G(e).forEach((function(t){_(e[t])?e[t]=e[t]():E(e[t])?W(e,t):C(e[t])||(e[t]=R(e[t]))})),e},this.buildCustomEvent=function(e,i,r,o){te(e,(function(){var a=t.growingIO.dataStore,s=a.eventContextBuilder,u=a.eventConverter,c=a.currentPage,d=n({eventType:"CUSTOM",eventName:e,pageShowTimestamp:null==c?void 0:c.time,attributes:$(t.getDynamicAttributes(E(i)&&!J(i)?i:void 0)),resourceItem:$(t.getValidResourceItem(r))},s());J(o)||(d=n(n({},d),o)),u(d)}))},this.buildUserAttributesEvent=function(e,i){var r=t.growingIO.dataStore,o=r.eventContextBuilder,a=r.eventConverter,s=n({eventType:"LOGIN_USER_ATTRIBUTES",attributes:$(e)},o());J(i)||(s=n(n({},s),i)),a(s)}}},Pe=["gioPerformance"],xe=function(e){function n(t){var n=e.call(this,t)||this;return n.growingIO=t,n.growingIO.gioSDKFull=!1,n.pluginsContext={plugins:{gioCustomTracking:ke}},n}return t(n,e),n}((function(e){var t,n,i,r,o=this;this.growingIO=e,this.innerPluginInit=function(){var e;Pe.forEach((function(e){var t;return W(null===(t=o.pluginsContext)||void 0===t?void 0:t.plugins,e)})),G(null===(e=o.pluginsContext)||void 0===e?void 0:e.plugins).forEach((function(e){var t,n=null===(t=o.pluginsContext)||void 0===t?void 0:t.plugins[e],i=n.name,r=n.method;D(o.pluginItems,(function(e){return e.name===i}))||o.pluginItems.push({name:j(i||e),method:r||function(e){}})})),J(o.pluginItems)||o.installAll()},this.install=function(e,t,n){var i,r,a=t||D(o.pluginItems,(function(t){return t.name===e}));if((null===(i=o.growingIO)||void 0===i?void 0:i.plugins)[e])return X("重复加载插件 ".concat(e," 或插件重名，已跳过加载!"),"warn"),!1;if(!a)return X("插件加载失败!不存在名为 ".concat(e," 的插件!"),"error"),!1;try{return(null===(r=o.growingIO)||void 0===r?void 0:r.plugins)[e]=new a.method(o.growingIO,n),"cdp"===o.growingIO.gioEnvironment&&t&&X("加载插件 ".concat(e),"info"),!0}catch(e){return X("插件加载异常 ".concat(e),"error"),!1}},this.installAll=function(e){(e||o.pluginItems).forEach((function(t){o.install(t.name,e?t:void 0,e?null==t?void 0:t.options:void 0)&&!D(o.pluginItems,(function(e){return e.name===t.name}))&&o.pluginItems.push({name:j(t.name),method:t.method?t.method:function(){}})}))},this.uninstall=function(e){var t;W(o.pluginItems,e);var n=W(null===(t=o.growingIO)||void 0===t?void 0:t.plugins,e);return n||X("卸载插件 ".concat(e," 失败!"),"error"),n},this.uninstallAll=function(){o.pluginItems.forEach((function(e){return o.uninstall(e.name)}))},this.lifeError=function(e,t){return X("插件执行错误 ".concat(e.name," ").concat(t),"error")},this.onComposeBefore=function(e){o.pluginItems.forEach((function(t){var n,i=null===(n=o.growingIO.plugins[t.name])||void 0===n?void 0:n.onComposeBefore;if(i&&_(i))try{i(e)}catch(e){o.lifeError(t,e)}}))},this.onComposeAfter=function(e){o.pluginItems.forEach((function(t){var n,i=null===(n=o.growingIO.plugins[t.name])||void 0===n?void 0:n.onComposeAfter;if(i&&_(i))try{i(e)}catch(e){o.lifeError(t,e)}}))},this.onSendBefore=function(e){o.pluginItems.forEach((function(t){var n,i=null===(n=o.growingIO.plugins[t.name])||void 0===n?void 0:n.onSendBefore;if(i&&_(i))try{i(e)}catch(e){o.lifeError(t,e)}}))},this.onSendAfter=function(e){o.pluginItems.forEach((function(t){var n,i=null===(n=o.growingIO.plugins[t.name])||void 0===n?void 0:n.onSendAfter;if(i&&_(i))try{i(e)}catch(e){o.lifeError(t,e)}}))},this.pluginsContext={plugins:{}},this.pluginItems=[],null===(t=this.growingIO.emitter)||void 0===t||t.on("onComposeBefore",this.onComposeBefore),null===(n=this.growingIO.emitter)||void 0===n||n.on("onComposeAfter",this.onComposeAfter),null===(i=this.growingIO.emitter)||void 0===i||i.on("onSendBefore",this.onSendBefore),null===(r=this.growingIO.emitter)||void 0===r||r.on("onSendAfter",this.onSendAfter)})),qe=function(){function e(e){this.growingIO=e;var t=this.growingIO.vdsConfig.projectId,n=this.growingIO.storage,i=n.getItem,r=n.setItem,o=n.getKeys,a=n.removeItem;this.getItem=i,this.setItem=r,this.getKeys=o,this.removeItem=a,this.sIdStorageName="".concat(t,"_gdp_session_id"),this.uidStorageName="gdp_user_id_gioenc",this.userIdStorageName="".concat(t,"_gdp_cs1_gioenc"),this.userKeyStorageName="".concat(t,"_gdp_user_key_gioenc"),this.gioIdStorageName="".concat(t,"_gdp_gio_id_gioenc")}return Object.defineProperty(e.prototype,"sessionId",{get:function(){return this.getItem(this.sIdStorageName)||(this.sessionId=de(),this.sessionId)},set:function(e){var t,n=this;e||(e=de());var i=this.getItem(this.sIdStorageName)||this.prevSessionId,r=this.growingIO.vdsConfig.sessionExpires,o=void 0===r?30:r;this.setItem(this.sIdStorageName,e,+Date.now()+60*o*1e3),i!==e&&(this.getKeys().filter((function(e){return/.+_gdp_session_id_.{36}/.test(e)})).forEach((function(e){n.removeItem(e)})),this.setItem(this.growingIO.dataStore.visitStorageName,""),null===(t=this.growingIO.emitter)||void 0===t||t.emit(Ce,{newSessionId:e,oldSessionId:i})),this.prevSessionId=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this.getItem(this.uidStorageName)||(this.uid=de(),this.uid)},set:function(e){var t,n=this.getItem(this.uidStorageName)||this.prevUId;this.setItem(this.uidStorageName,e),n!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit("UID_UPDATE",{newUId:e,oldUId:n})),this.prevUId=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userId",{get:function(){return this.getItem(this.userIdStorageName)||""},set:function(e){var t,n,i=this.getItem(this.userIdStorageName)||this.prevUserId;this.setItem(this.userIdStorageName,e),null===(t=this.growingIO.emitter)||void 0===t||t.emit("SET_USERID",{newUserId:e,oldUserId:i,userKey:this.userKey}),i!==e&&(null===(n=this.growingIO.emitter)||void 0===n||n.emit("USERID_UPDATE",{newUserId:e,oldUserId:i,userKey:this.userKey})),e&&(this.gioId=e),this.prevUserId=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userKey",{get:function(){return this.getItem(this.userKeyStorageName)||""},set:function(e){var t,n,i=this.getItem(this.userKeyStorageName)||this.prevUserKey;this.setItem(this.userKeyStorageName,e),null===(t=this.growingIO.emitter)||void 0===t||t.emit("SET_USERKEY",{newUserKey:e,oldUserKey:i,userId:this.userId}),i!==e&&(null===(n=this.growingIO.emitter)||void 0===n||n.emit("USERKEY_UPDATE",{newUserKey:e,oldUserKey:i,userId:this.userId})),this.prevUserKey=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"gioId",{get:function(){return this.getItem(this.gioIdStorageName)||""},set:function(e){var t,n=this.getItem(this.gioIdStorageName)||this.prevGioId;this.setItem(this.gioIdStorageName,e),n!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit("GIOID_UPDATE",{newGioId:e,oldGioId:n})),this.prevGioId=e},enumerable:!1,configurable:!0}),e}(),Ne=function(e){var t=this;this.growingIO=e,this.main=function(){var e,i,r=t.growingIO,o=r.sdkVersion,a=r.useEmbeddedInherit,s=r.vdsConfig,u=r.userStore,c=r.dataStore,d=r.trackingId,l=c.currentPage,g=l.path,f=l.query,m={appVersion:s.version,dataSourceId:s.dataSourceId,deviceId:u.uid,domain:a?s.appId:window.location.host,gioId:u.gioId,language:navigator.language,path:g,platform:s.platform,query:f,referralPage:(null===(e=c.lastPageEvent)||void 0===e?void 0:e.referralPage)||"",screenHeight:window.screen.height,screenWidth:window.screen.width,sdkVersion:o,sessionId:u.sessionId,timestamp:+Date.now(),title:null!==(i=Y((function(){return document.title.slice(0,255)})))&&void 0!==i?i:"",userId:u.userId};if(s.enableIdMapping&&(m.userKey=u.userKey),J(s.ignoreFields)||s.ignoreFields.forEach((function(e){W(m,e)})),a&&!J(t.minpExtraParams)){var p=n({},m);M(n(n({},m),t.minpExtraParams),(function(e,n){var i;U(s.embeddedIgnore,n)?(m[n]=p[n],"domain"===n&&(m[n]=window.location.host)):m[n]=null!==(i=t.minpExtraParams[n])&&void 0!==i?i:m[n]}))}return m.trackingId=d,m},this.minpExtraParams={}},De=function(e){var t=this;this.growingIO=e,this.parsePage=function(){var e=t.growingIO.vdsConfig.hashtag,n=location.pathname,i=location.search,r=location.hash,o=r.indexOf("?");t.domain=window.location.host,t.title=document.title.slice(0,255),t.time=+Date.now(),t.path=n,t.query=i,e&&(o>-1?(t.path+=r.slice(0,o),t.query=t.query+"&"+r.slice(o+1)):t.path+=r),t.query&&U(["?","&"],t.query.charAt(0))&&(t.query=t.query.slice(1))},this._getNoHashHref=function(){var e=window.location,t=e.protocol,n=e.host,i=e.pathname,r=e.search;return"".concat(t,"://").concat(n).concat(i).concat(r)},this.getReferralPage=function(){var e,n,i=t.growingIO.dataStore.lastPageEvent;return(null==i?void 0:i.path)===t.path&&(null!==(e=null==i?void 0:i.query)&&void 0!==e?e:"")===(null!==(n=t.query)&&void 0!==n?n:"")?null==i?void 0:i.referralPage:(null==i?void 0:i.path)?t.lastHref:document.referrer},this.pageListener=function(){var e=t.growingIO.vdsConfig.hashtag,n=window.location.href,i=t.lastHref;e||(n=t._getNoHashHref(),i=t.lastNoHashHref),i!==n&&(t.parsePage(),t.buildPageEvent())},this.hookHistory=function(){var e=window.history.pushState,n=window.history.replaceState,i=t;e&&Y((function(){return window.history.pushState=function(){e.apply(window.history,arguments),setTimeout(i.pageListener)}})),n&&Y((function(){return window.history.replaceState=function(){n.apply(window.history,arguments),setTimeout(i.pageListener)}})),ee(window,"popstate",t.pageListener),t.growingIO.vdsConfig.hashtag&&ee(window,"hashchange",t.pageListener)},this.buildPageEvent=function(e){var i=t.growingIO.dataStore;i.lastPageEvent;var r=i.eventContextBuilder,o=i.eventConverter,a=n(n({eventType:"PAGE"},r()),{protocolType:location.protocol.substring(0,location.protocol.length-1),referralPage:t.getReferralPage()});J(e)||(a=n(n({},a),e)),a.timestamp=t.time,o(a),t.lastHref=window.location.href,t.lastNoHashHref=t._getNoHashHref(),t.lastLocation=n({},window.location)},this.title=document.title.slice(0,255),this.lastLocation=n({},window.location)},Ae={referralPage:document.referrer},Ue=function(){function e(e){var t,i,u,c=this;this.growingIO=e,this.ALLOW_SETTING=n(n({},o),"saas"===this.growingIO.gioEnvironment?s:a),this.allowOptKeys=Object.keys(this.ALLOW_SETTING),this.trackTimers={},this.setSequenceIds=function(e,t){var i=c.growingIO.storage.getItem(c.seqStorageIdName)||{};"gsid"===e?i.globalKey=t:i=n(n({},i),t),c.growingIO.storage.setItem(c.seqStorageIdName,i)},this.initOptions=function(e){var t,i,o,a,s,u,d,l=e.projectId,g=e.dataSourceId,f=e.appId;c.initialDataSourceId=g;var m={};c.allowOptKeys.forEach((function(t){var n=c.ALLOW_SETTING[t].type,i=C(n)?!U(n,Q(e[t])):Q(e[t])!==n;"platform"!==t||U(r,e[t])||(i=!0),i?m[t]=c.ALLOW_SETTING[t].default:"ignoreFields"===t?m.ignoreFields=e.ignoreFields.filter((function(e){return U(I,e)})):(m[t]=e[t],U(["dataCollect","autotrack"],t)&&(m[t]||X("已关闭".concat(v[t]),"info")))})),m.sessionExpires=Math.round(m.sessionExpires),(b(m.sessionExpires)||1>m.sessionExpires||m.sessionExpires>360)&&(m.sessionExpires=30),m.storageType=m.storageType.toLowerCase(),m.sendType=m.sendType.toLowerCase(),U(["beacon","xhr","image"],m.sendType)||(m.sendType="beacon"),!b(Number(m.requestTimeout))&&m.requestTimeout>0||(m.requestTimeout=5e3),c.growingIO.vdsConfig=n(n(n({},null!==(t=window.vds)&&void 0!==t?t:{}),m),{projectId:l,dataSourceId:g,appId:f,performance:{monitor:null===(o=null===(i=m.performance)||void 0===i?void 0:i.monitor)||void 0===o||o,exception:null===(s=null===(a=m.performance)||void 0===a?void 0:a.exception)||void 0===s||s,network:null!==(d=null===(u=m.performance)||void 0===u?void 0:u.network)&&void 0!==d&&d}}),window.vds=c.growingIO.vdsConfig,c.seqStorageIdName="".concat(l,"_gdp_sequence_ids"),c.visitStorageName="".concat(l,"_gdp_session_id_sent")},this.setOption=function(e,t){var i,r=c.growingIO,o=r.vdsConfig,a=r.callError,s=r.uploader,u=r.emitter,d=S(e)&&U(p,e),l=d&&typeof t===((null===(i=c.ALLOW_SETTING[e])||void 0===i?void 0:i.type)||"string"),g=n({},o);return d&&l?(o[e]=t,"dataCollect"===e&&g.dataCollect!==t&&(t?(c.sendVisit(!0),c.sendPage()):c.growingIO.clearTrackTimer()),U(["host","scheme"],e)&&(null==s||s.generateHost()),null==u||u.emit("OPTION_CHANGE",{optionName:e,optionValue:t}),window.vds[e]=t,!0):(a("setOption > ".concat(e)),!1)},this.getOption=function(e){var t=c.growingIO,i=t.vdsConfig,r=t.callError;return e&&H(i,R(e))?i[R(e)]:y(e)?n({},i):void r("getOption > ".concat(e))},this.sendVisit=function(e){var t=c.growingIO,n=t.userStore.sessionId,i=t.storage.getItem(c.visitStorageName);!e&&n===i||(c.lastVisitEvent.timestamp=c.currentPage.time-1,c.buildVisitEvent())},this.buildVisitEvent=function(e){var t=c.growingIO,i=t.dataStore,r=i.eventContextBuilder,o=i.eventConverter,a=t.emitter,s=t.storage,u=t.userStore,d=c.lastVisitEvent,l=d.referralPage,g=d.title,f=d.path,m=d.query,p=d.timestamp,v=n(n({eventType:"VISIT"},r()),{referralPage:l||c.currentPage.getReferralPage(),timestamp:p});f&&(v.title=g,v.path=f,v.query=m),J(e)||(v.session=(null==e?void 0:e.session)||v.session,v.trackingId=null==e?void 0:e.trackingId,v=n(n({},v),e));var h=function(e){var t=e.requestData;"VISIT"===t.eventType&&t.trackingId===c.growingIO.trackingId&&(u.sessionId===t.sessionId&&s.setItem(c.visitStorageName,t.sessionId),a.off("onSendAfter",h))};a.on("onSendAfter",h),o(v)},this.sendPage=function(e){e&&c.currentPage.parsePage(),c.currentPage.buildPageEvent()},this.buildErrorEvent=function(e){var t=c.growingIO.dataStore,i=t.eventContextBuilder;(0,t.eventConverter)(n({eventType:"CUSTOM",pageShowTimestamp:c.currentPage.time,eventName:"onError",attributes:e},i()))},this.currentPage=new De(this.growingIO),this.eventContextBuilderInst=new Ne(this.growingIO),this.eventContextBuilder=this.eventContextBuilderInst.main,this.generalProps={},this.lastVisitEvent=Ae,null===(t=this.growingIO.emitter)||void 0===t||t.on("onComposeAfter",(function(e){var t=e.composedEvent;"VISIT"!==t.eventType&&"vst"!==t.t||t.trackingId!==c.growingIO.trackingId||(c.lastVisitEvent=t)})),this.lastPageEvent={},null===(i=this.growingIO.emitter)||void 0===i||i.on("onComposeAfter",(function(e){var t=e.composedEvent;"PAGE"!==t.eventType&&"page"!==t.t||t.trackingId!==c.growingIO.trackingId||(c.lastPageEvent=t)})),null===(u=this.growingIO.emitter)||void 0===u||u.on(Ce,(function(){if(c.growingIO.gioSDKInitialized){c.currentPage.parsePage();var e=c.currentPage,t=e.title,n=e.path,i=e.query,r=e.time,o=e.getReferralPage;c.lastVisitEvent={referralPage:document.referrer||o(),title:t,path:n,query:i,timestamp:r-1},c.sendVisit(!0),c.sendPage(!0)}}))}return Object.defineProperty(e.prototype,"esid",{get:function(){var e=this,t=this.growingIO.storage.getItem(this.seqStorageIdName)||{},i=n({},t);return W(i,"globalKey"),i=E(i)&&!y(i)?i:{},this._esid={},G(i).forEach((function(t){e._esid[t]=b(Number(i[t]))||i[t]>=1e9||1>i[t]?1:i[t]})),this._esid},set:function(e){var t={};G(e).forEach((function(n){t[n]=b(e[n])||e[n]>=1e9||1>e[n]?1:e[n]})),z(this._esid,t)||(this._esid=t,this.setSequenceIds("esid",this._esid))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"gsid",{get:function(){var e=this.growingIO.storage.getItem(this.seqStorageIdName)||{},t=Number(e.globalKey);return this._gsid=b(t)||t>=1e9||1>t?1:t,this._gsid},set:function(e){b(Number(e))||e>=1e9||1>e?this._gsid=1:this._gsid=e,this.setSequenceIds("gsid",this._gsid)},enumerable:!1,configurable:!0}),e}(),Ke=function(e){function i(t){var i=e.call(this,t)||this;return i.growingIO=t,i.eventConverter=function(e){var t,r,o=i.growingIO,a=o.vdsConfig,s=o.dataStore,u=o.uploader;if(a.dataCollect){e.trackingId===i.growingIO.trackingId&&(e.globalSequenceId=s.gsid,e.eventSequenceId=s.esid[e.eventType]||1);var c={};M(e,(function(e,t){var n;if("element"===t){var i=null!==(n=P(e))&&void 0!==n?n:{};M(i,(function(e,t){J(e)&&0!==e||(c[t]=e)}))}else(J(e)||y(e))&&0!==e||(c[t]=e)})),e.trackingId===i.growingIO.trackingId&&(i.growingIO.dataStore.gsid+=1,i.growingIO.dataStore.esid=n(n({},i.growingIO.dataStore.esid),((t={})[c.eventType]=(i.growingIO.dataStore.esid[c.eventType]||1)+1,t))),null===(r=i.growingIO.emitter)||void 0===r||r.emit("onComposeAfter",{composedEvent:n({},c)}),e.trackingId===i.growingIO.trackingId&&u.commitRequest(c)}else"VISIT"===e.eventType&&(i.lastVisitEvent=e)},i}return t(i,e),i}(Ue),Re=function(e){function n(t){var n=e.call(this,t)||this;return n.growingIO=t,n.generateHost=function(){var e=n.growingIO.vdsConfig,t=e.scheme,i=e.host,r=void 0===i?"":i,o=e.projectId;t?B(R(t),"://")||(t="".concat(t,"://")):t="".concat(location.protocol.indexOf("http")>-1?location.protocol.replace(":",""):"https","//"),F(r,"http")&&(r=r.substring(r.indexOf("://")+(B(R(t),"://")?3:0))),n.requestURL="".concat(t).concat(r,"/v3/projects/").concat(o,"/collect")},n.requestURL="",n.generateHost(),n}return t(n,e),n}((function(e){var t=this;this.growingIO=e,this.getSendType=function(){var e=t.growingIO.vdsConfig.sendType;return"beacon"===e?function(){var e,t,n=!!(null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.sendBeacon),i=window.navigator.userAgent;if(i.match(/(iPad|iPhone|iPod)/g)){var r=!(t=i.toLowerCase().match(/cpu.*os (.*?) like mac os/i))||2>t.length?0:+t[1].split("_").slice(0,2).join(".");return n&&r>13}return n}()?"beacon":"xhr":e},this.commitRequest=function(e){var i=n({},e);t.requestQueue.push(n(n({},i),{requestType:t.getSendType()})),t.initiateRequest()},this.initiateRequest=function(){var e,r,o;if(i([],t.requestQueue,!0).length>0&&t.requestingNum<t.requestLimit){var a=t.growingIO,s=a.vdsConfig,u=a.emitter,c=a.plugins,d=a.useHybridInherit;if(t.requestQueue=i([],t.requestQueue,!0).filter((function(e){return(t.retryIds[e.globalSequenceId||e.esid]||0)<=t.retryLimit})),J(t.requestQueue))return;var l=t.requestQueue.shift(),g=l.requestType;null==u||u.emit("onSendBefore",{requestData:n({},l)});var f=n({},l);if(W(f,["requestType","trackingId"]),s.debug&&console.log("[GrowingIO Debug]:",JSON.stringify(f,null,2).replace(/\"/g,(o=window.navigator.userAgent,/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(o)&&!/chrome\/(\d+\.\d+)/i.test(o)?"":'"'))),t.requestingNum+=1,d)return t.requestSuccessFn(l),!1;var m=n({},f);switch(s.compress&&(null==c?void 0:c.gioCompress)?"image"===g?(t.compressType="11",m=null===(e=null==c?void 0:c.gioCompress)||void 0===e?void 0:e.compressToEncodedURIComponent(JSON.stringify([m]))):(t.compressType="1",m=null===(r=null==c?void 0:c.gioCompress)||void 0===r?void 0:r.compressToUint8Array(JSON.stringify([m]))):(t.compressType="0",m=JSON.stringify([m])),g){case"beacon":default:t.sendByBeacon(l,m);break;case"xhr":t.sendByXHR(l,m);break;case"image":t.sendByImage(l,m)}}},this.generateURL=function(){return"".concat(t.requestURL,"?stm=").concat(+Date.now(),"&compress=").concat(t.compressType)},this.sendByBeacon=function(e,n){navigator.sendBeacon(t.generateURL(),n)?t.requestSuccessFn(e):t.requestFailFn(e,"beacon")},this.sendByXHR=function(e,n){var i=new XMLHttpRequest;if(i)return i.open("POST",t.generateURL(),!0),i.onload=function(){204===i.status?t.requestSuccessFn(e):t.requestFailFn(e,"xhr")},i.ontimeout=i.onerror=i.onabort=function(){t.requestFailFn(e,"xhr")},i.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),i.timeout=t.growingIO.vdsConfig.requestTimeout,void i.send(n);if(null===window||void 0===window?void 0:window.XDomainRequest){var r=new window.XDomainRequest;r.open("POST",t.generateURL().replace("https://","http://"),!0),r.onload=function(){204===r.status?t.requestSuccessFn(e):t.requestFailFn(e,"xhr")},r.onerror=r.ontimeout=function(){t.requestFailFn(e,"xhr")},r.send(n)}},this.sendByImage=function(e,n){var i="".concat(t.generateURL(),"&data=").concat(n),r=document.createElement("img");r.width=1,r.height=1;var o=window.setTimeout((function(){t.requestingNum-=1,t.clearImage(r),window.clearTimeout(o),o=null,t.initiateRequest()}),t.growingIO.vdsConfig.requestTimeout);r.onload=function(){t.requestSuccessFn(e),t.clearImage(r),window.clearTimeout(o),o=null},r.onerror=r.onabort=function(){t.requestSuccessFn(e),t.clearImage(r),window.clearTimeout(o),o=null},r.src=i},this.clearImage=function(e){e.src="",e.onload=function(){},e.onerror=e.onabort=function(){},e=null},this.requestSuccessFn=function(e){var i;t.requestingNum-=1;var r=e.globalSequenceId||e.esid||-1;t.retryIds[r]&&(t.retryIds[r]=0),e.trackingId===t.growingIO.trackingId&&t.growingIO.userStore.sessionId===e.sessionId&&(t.growingIO.userStore.sessionId=e.sessionId),null===(i=t.growingIO.emitter)||void 0===i||i.emit("onSendAfter",{requestData:n({},e)}),t.initiateRequest()},this.requestFailFn=function(e,i){t.requestingNum-=1;var r=e.globalSequenceId||e.esid||-1;t.retryIds[r]||(t.retryIds[r]=0),t.retryIds[r]+=1;var o=t.requestQueue.some((function(t){return t.globalSequenceId===e.globalSequenceId&&t.esid===e.esid})),a=i;if(t.retryIds[r]<t.retryLimit+1||(a="beacon"===i?"xhr":"xhr"===i?"image":void 0,t.retryIds[r]=0),!o&&a)var s=window.setTimeout((function(){t.requestQueue.push(n(n({},e),{requestType:a})),t.initiateRequest(),window.clearTimeout(s),s=null}),800);t.initiateRequest()},this.requestQueue=[],this.requestLimit=10,this.requestTimeout=5e3,this.retryLimit=2,this.retryIds={},this.requestingNum=0,this.requestURL=""})),Le=function(e){function i(){var t=e.call(this)||this;return t.registerPlugins=function(e){C(e)?(e.forEach((function(t,i){var r,o;J(t)||y(t)?X("插件不合法，跳过加载!","warn"):(null===(r=t.js)||void 0===r?void 0:r.default)&&(e[i]=n(n({},null===(o=t.js)||void 0===o?void 0:o.default),{options:t.options}))})),e=N(e),t.plugins.installAll(e)):X("插件注册失败，请检查!","error")},t.initCallback=function(){t.uploader=new Re(t),t.userStore=new qe(t)},t.getPlugins=function(){return t.plugins.pluginItems},t.setTrackerScheme=function(e){U(["http","https"],e)?(t.dataStore.setOption("scheme",e),t.notRecommended()):t.callError("scheme",!1)},t.setTrackerHost=function(e){re.test(e)||oe.test(e)?(t.dataStore.setOption("host",e),t.notRecommended()):t.callError("host",!1)},t.setDataCollect=function(e){t.setOption("dataCollect",!!e),t.notRecommended()},t.setAutotrack=function(e){t.setOption("autotrack",!!e),t.notRecommended()},t.enableDebug=function(e){t.setOption("debug",!!e),t.notRecommended()},t.enableHT=function(e){t.setOption("hashtag",!!e),t.notRecommended()},t.getVisitorId=function(){return t.userStore.uid},t.getDeviceId=function(){return t.userStore.uid},t.setUserAttributes=function(e,n){var i,r;!J(e)&&E(e)?null===(r=null===(i=t.plugins)||void 0===i?void 0:i.gioCustomTracking)||void 0===r||r.buildUserAttributesEvent(e,n):t.callError("setUserAttributes")},t.setUserId=function(e,n){if(ie(R(e).trim())){var i=t.userStore.gioId;t.vdsConfig.enableIdMapping&&(t.userStore.userKey=!y(n)&&R(n).length>0?R(n).slice(0,1e3):""),t.userStore.userId=R(e).slice(0,1e3),i&&i!==t.userStore.userId&&(t.userStore.sessionId="")}else t.clearUserId(),t.callError("setUserId")},t.clearUserId=function(){t.userStore.userId="",t.userStore.userKey=""},t.track=function(e,i,r,o){var a,s;((null===(s=null===(a=t.plugins)||void 0===a?void 0:a.gioCustomTracking)||void 0===s?void 0:s.buildCustomEvent)||function(){})(e,n(n({},t.dataStore.generalProps),E(i)&&!J(i)?i:{}),r,o)},t.sendPage=function(e){return t.dataStore.currentPage.buildPageEvent(e)},t.sendVisit=function(e){return t.dataStore.buildVisitEvent(e)},t.trackTimerStart=function(e,n){t.vdsConfig.dataCollect&&te(e,(function(){var i=de();_(n)?(t.dataStore.trackTimers[i]={eventName:e,leng:0,start:+Date.now()},n(i)):X("回调方法不合法，返回timerId失败!")}))},t.trackTimerPause=function(e){if(e&&t.dataStore.trackTimers[e]){var n=t.dataStore.trackTimers[e];n.start&&(n.leng=n.leng+(+Date.now()-n.start)),n.start=0}},t.trackTimerResume=function(e){if(e&&t.dataStore.trackTimers[e]){var n=t.dataStore.trackTimers[e];0===n.start&&(n.start=+Date.now())}},t.trackTimerEnd=function(e,i){if(t.vdsConfig.dataCollect)if(e&&t.dataStore.trackTimers[e]){var r=t.dataStore.trackTimers[e];if(0!==r.start){var o=+Date.now()-r.start;r.leng=o>0?r.leng+o:0}t.track(r.eventName,n(n({},i),{event_duration:r.leng>864e5?0:r.leng/1e3})),t.removeTimer(e)}else X("未查找到对应的计时器，请检查!","error")},t.removeTimer=function(e){e&&t.dataStore.trackTimers[e]&&delete t.dataStore.trackTimers[e]},t.clearTrackTimer=function(){t.dataStore.trackTimers={}},t.dataStore=new Ke(t),t}return t(i,e),i}((function(){var e,t=this;this.trackingId="g0",this.init=function(e){var n,i,r,o,a;X("Gio Web SDK 初始化中...","info");var s=t.dataStore,u=s.initOptions,c=s.currentPage,d=s.sendVisit,l=s.sendPage;u(e),t.storage=_e(t.vdsConfig),t.initCallback(),null===(n=t.emitter)||void 0===n||n.emit("OPTION_INITIALIZED",t),null===(r=null===(i=t.plugins)||void 0===i?void 0:i.gioEventAutoTracking)||void 0===r||r.main(),c.hookHistory(),c.parsePage(),null===(o=t.emitter)||void 0===o||o.emit("SDK_INITIALIZED",t),X("Gio Web SDK 初始化完成！","success"),t.useEmbeddedInherit||(t.dataStore.lastVisitEvent.timestamp=c.time,d()),l(),t.gioSDKInitialized=!0,t.vdsConfig.gioSDKInitialized=!0,window[t.vds]=t.vdsConfig,null===(a=t.emitter)||void 0===a||a.emit("SDK_INITIALIZED_COMPLATE",t)},this.setOption=function(e,n){if(U(p,e)){var i=t.dataStore.setOption(e,n);return i&&v[e]&&X("已".concat(n?"开启":"关闭").concat(v[e]),"info"),i}return X("不存在可修改的配置项：".concat(e,"，请检查后重试!"),"warn"),!1},this.getOption=function(e){return t.dataStore.getOption(e)},this.setGeneralProps=function(e){E(e)&&!J(e)?(t.dataStore.generalProps=n(n({},t.dataStore.generalProps),e),G(t.dataStore.generalProps).forEach((function(e){U([void 0,null],t.dataStore.generalProps[e])&&(t.dataStore.generalProps[e]="")}))):t.callError("setGeneralProps")},this.clearGeneralProps=function(e){C(e)&&!J(e)?e.forEach((function(e){W(t.dataStore.generalProps,e)})):t.dataStore.generalProps={}},this.reissuePage=function(){t.dataStore.sendPage()},this.notRecommended=function(){return X("不推荐的方法使用，建议使用 gio('setOption', [optionName], [value])!","info")},this.callError=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n="参数不合法"),X("".concat(t?"调用":"设置"," ").concat(e," 失败，").concat(n,"!"),"warn")},this.updateImpression=function(){var e,n,i=null===(n=null===(e=t.plugins)||void 0===e?void 0:e.gioImpressionTracking)||void 0===n?void 0:n.main;i?i("emitter"):X("updateImpression 错误! 请集成半自动埋点浏览插件后重试!","error")},this.gioEnvironment="cdp",this.sdkVersion="3.8.6",this.vds=window.gioCompatibilityVds?"gdp_vds":"vds",this.utils=n(n({},Z),ne),this.emitter={all:e=e||new Map,on:function(t,n){var i=e.get(t);i?i.push(n):e.set(t,[n])},off:function(t,n){var i=e.get(t);i&&(n?i.splice(i.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var i=e.get(t);i&&i.slice().map((function(e){e(n)})),(i=e.get("*"))&&i.slice().map((function(e){e(t,n)}))}},this.useEmbeddedInherit=!1,this.useHybridInherit=!1,this.gioSDKInitialized=!1,this.plugins=new xe(this),this.plugins.innerPluginInit()}));!function(){var e,t,i,r,o,a=window.gioCompatibilityVds?"gdp_vds":"vds";if(null===(e=window[a])||void 0===e?void 0:e.gioSDKInstalled)return ue=window.gdp,void X("SDK重复加载，请检查是否重复加载SDK或接入其他平台SDK导致冲突!","warn");window[a]=n(n({},null!==(t=window[a])&&void 0!==t?t:{}),{gioSDKInstalled:!0});var s=new Le;ue=function(){var e,t=arguments[0];if(S(t)&&U(m,t)&&s[t]){var i=q(K(arguments));if("init"===t){var r=function(e){var t;return e.vdsConfig||e.gioSDKInitialized||(null===(t=window.vds)||void 0===t?void 0:t.gioSDKInitialized)?(X("SDK重复初始化，请检查是否重复加载SDK或接入其他平台SDK导致冲突!","warn"),!1):!(U(["","localhost","127.0.0.1"],location.hostname)&&!window._gr_ignore_local_rule&&(X("当前SDK不允许在本地环境初始化!","warn"),1))}(s);if(!r)return;var o=function(e){return!J(N(e))||(X('SDK初始化失败，请使用 gdp("init", "您的GrowingIO项目 accountId", "您项目的 dataSourceId", options); 进行初始化!',"error"),!1)}(i);if(!o)return;var u=function(e){var t=P(e),n=x(e);return ie(R(t).trim())?(E(n)&&n||(n={}),{projectId:t,userOptions:n}):(X("SDK初始化失败，accountId 参数不合法!","error"),!1)}(i);if(!u)return;var c=function(e){var t=e[1],n=e[2],i=x(e);return t&&S(t)?{dataSourceId:t,appId:S(n)?n:"",cdpOptions:i}:(X("SDK初始化失败，dataSourceId 参数不合法!","error"),!1)}(i);if(!c)return;var d=u.projectId,l=c.dataSourceId,g=c.appId,f=c.cdpOptions;s.init(n(n({},f),{projectId:d,dataSourceId:l,appId:g}))}else if("registerPlugins"===t)s.registerPlugins(i[0]);else{if(s.gioSDKInitialized&&s.vdsConfig)return s[t].apply(s,i);s.emitter.emit("UNINITIALIZED_CALL",arguments),X("SDK未初始化!","error")}}else U(h,t)?X("方法 ".concat(R(t)," 已被弃用，请移除!"),"warn"):X("不存在名为 ".concat(R(t)," 的方法调用!"),"error");window[a]=n(n({},window[a]),{_gr_ignore_local_rule:null!==(e=window._gr_ignore_local_rule)&&void 0!==e&&e,gioEnvironment:"cdp",gioSDKVersion:s.sdkVersion,gioSDKFull:s.gioSDKFull,canIUse:function(e){return U(m,e)&&s[e]}})};var u=null===(i=null===window||void 0===window?void 0:window.gdp)||void 0===i?void 0:i.q,c=null===(r=null===window||void 0===window?void 0:window.gdp)||void 0===r?void 0:r.e,d=null===(o=null===window||void 0===window?void 0:window.gdp)||void 0===o?void 0:o.ef;window.gdp=ue,window.gdp.e=c,window.gdp.ef=d,C(u)&&!J(u)&&u.forEach((function(e){ue.apply(null,e)}))}();var je=ue;export{je as default};
