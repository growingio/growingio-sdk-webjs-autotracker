var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)({}).hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)},t=function(){return t=Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++)for(var i in t=arguments[n])({}).hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},t.apply(this,arguments)};function n(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;o>i;i++)!r&&i in t||(r||(r=[].slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||[].slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var r,i,o,a,s,u=/^(\.ac\.|\.br\.|\.co\.|\.com\.|\.edu\.|\.gov\.|\.org\.|\.net\.)/,c=/^[a-zA-Z][a-zA-Z0-9_]{0,99}$/,l="function"==typeof Array.from?Array.from:(i||(i=1,o=function(e){return"function"==typeof e},a=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),9007199254740991)},s=function(e){var t=e.next();return!t.done&&t},r=function(e){var t,n,r,i=this,u=arguments.length>1?arguments[1]:void 0;if(void 0!==u){if(!o(u))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(t=arguments[2])}var c=function(e,t){if(null!=e&&null!=t){var n=e[t];if(null==n)return;if(!o(n))throw new TypeError(n+" is not a function");return n}}(e,function(e){if(null!=e){if(["string","number","boolean","symbol"].indexOf(typeof e)>-1)return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in e)return Symbol.iterator;if("@@iterator"in e)return"@@iterator"}}(e));if(void 0!==c){n=o(i)?Object(new i):[];var l,d,g=c.call(e);if(null==g)throw new TypeError("Array.from requires an array-like or iterable object");for(r=0;;){if(!(l=s(g)))return n.length=r,n;d=l.value,n[r]=u?u.call(t,d,r):d,r++}}else{var f=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var v,p=a(f.length);for(n=o(i)?Object(new i(p)):Array(p),r=0;p>r;)v=f[r],n[r]=u?u.call(t,v,r):v,r++;n.length=p}return n}),r),d=function(e){return T(["undefined","null"],R(e))},g=function(e){return"string"===R(e)},f=function(e){return"number"===R(e)},v=function(e){return"NaN"===C(Number(e))},p=function(e){return"object"===R(e)&&!d(e)},h=function(e){return"regexp"===R(e)},m=function(e){return["function","asyncfunction"].includes(R(e))},I=function(e){return Array.isArray(e)&&"array"===R(e)},w=function(e){return"date"===R(e)},y=function(e){try{return N(e)[0]}catch(e){return}},S=function(e){try{var t=N(e);return t[t.length-1]}catch(e){return}},O=function(e,t){return void 0===t&&(t=1),I(e)&&f(t)?e.slice(t>0?t:1,e.length):e},_=function(e){if(I(e)){for(var t=0,n=[],r=0,i=e;r<i.length;r++){var o=i[r];o&&!F(o)&&(n[t++]=o)}return n}return e},b=function(e,t){return e[E(e,t)]},E=function(e,t){var n=-1;return I(e)&&e.every((function(e,r){return!t(e)||(n=r,!1)})),n},T=function(e,t){return("array"===R(e)||"string"===R(e))&&e.indexOf(t)>=0},N=l,C=function(e){return d(e)?"":"".concat(e)},x=function(e,t){return"string"==typeof e?e.split(t):e},P=function(e){if(g(e)){var t=x(e,"");return"".concat(y(t).toLowerCase()).concat(O(t).join(""))}return e},D=function(e,t){return!!g(e)&&e.slice(0,t.length)===t},k=function(e,t){if(g(e)){var n=e.length,r=n;r>n&&(r=n);var i=r;return(r-=t.length)>=0&&e.slice(r,i)===t}return!1},q={}.hasOwnProperty,A=function(e,t){return!d(e)&&q.call(e,t)},U=function(e){return p(e)?Object.keys(e):[]},L=function(e,t){U(e).forEach((function(n){return t(e[n],n)}))},K=function(e,t){var n=U(e);return!(!p(e)||!p(t)||n.length!==U(t).length||T(n.map((function(n,r){return p(e[n])?K(e[n],t[n]):e[n]===t[n]})),!1))},j=function(e,t){if(!p(e))return!1;try{return"string"===R(t)?delete e[t]:"array"===R(t)?t.map((function(t){return delete e[t]})):(h(t)&&U(e).forEach((function(n){t.test(n)&&j(e,n)})),!0)}catch(e){return!1}},F=function(e){return I(e)?0===e.length:p(e)?0===U(e).length:!e},R=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},B=Object.freeze({__proto__:null,isNil:d,isString:g,isNumber:f,isNaN:v,isBoolean:function(e){return"boolean"===R(e)},isObject:p,isRegExp:h,isFunction:m,isArray:I,isDate:w,fixed:function(e,t){return f(e)?Number(e.toFixed(f(t)?t:2)):g(e)&&"NaN"!==C(Number(e))?Number(Number(e).toFixed(f(t)?t:2)):e},head:y,last:S,drop:O,dropWhile:function(e,t){return I(e)?e.filter((function(e){return!t(e)})):e},compact:_,find:b,findIndex:E,includes:T,arrayFrom:N,toString:C,split:x,lowerFirst:P,upperFirst:function(e){if(g(e)){var t=x(e,"");return"".concat(y(t).toUpperCase()).concat(O(t).join(""))}return e},startsWith:D,endsWith:k,has:A,keys:U,forEach:L,isEqual:K,get:function(e,t,n){var r=e;return p(e)?(t.split(".").forEach((function(e){r=r?r[e]:n})),r):n},unset:j,isEmpty:F,typeOf:R,formatDate:function(e){if(w(e)){var t=function(e){return 10>e?"0"+e:e};return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+t(e.getMilliseconds())}return e}}),H=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},M=function(e,t){console.log("%c [GrowingIO]：".concat(e),{info:"color: #3B82F6;",error:"color: #EF4444;",warn:"color: #F59E0B;",success:"color: #10B981;"}[t]||"")},G=function(e){try{return e()}catch(e){return}},V=function(e,t){if(m(e))try{e(t)}catch(e){M("回调执行失败！".concat(e),"error")}},Q=function(){var e,t=!!(null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.sendBeacon),n=window.navigator.userAgent;if(n.match(/(iPad|iPhone|iPod)/g)){var r=z(n);return t&&r>13}return t},z=function(e){var t=e.toLowerCase().match(/cpu.*os (.*?) like mac os/i);return!t||2>t.length?0:+t[1].split("_").slice(0,2).join(".")},J=function(){var e=window.navigator.userAgent;return/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(e)&&!/chrome\/(\d+\.\d+)/i.test(e)},W=function(){return/bot|crawler|spider|scrapy|jiankongbao|slurp|transcoder|networkbench/i.test(navigator.userAgent.toLowerCase())},X=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n="参数不合法"),M("".concat(t?"调用":"设置"," ").concat(e," 失败，").concat(n,"!"),"warn")},Y=function(e,n,r,i){void 0===i&&(i={}),document.addEventListener?e.addEventListener(n,r,t(t({},{capture:!0}),i)):e.attachEvent?e.attachEvent("on"+n,r):e["on"+n]=r},Z=function(e){return k(e,"_gioenc")?e.slice(0,-7):e},$=function(e){return isNaN(Number(e))&&G((function(){return JSON.parse(e)}))||e},ee=function(e){var t={};return p(e)&&L(e,(function(e,n){var r=C(n).slice(0,100);p(e)?t[r]=ee(e):I(e)?(t[r]=e.slice(0,100),t[r]=t[r].join("||").slice(0,1e3)):t[r]=d(e)?"":C(e).slice(0,1e3)})),t},te=function(e){return d(e)||U(e).forEach((function(t){m(e[t])?e[t]=e[t]():p(e[t])?j(e,t):I(e[t])||(e[t]=C(e[t]))})),e},ne=Object.freeze({__proto__:null,guid:H,consoleText:M,niceTry:G,niceCallback:V,hashCode:function(e){var t=0;if(F(e)||"boolean"==typeof e)return t;for(var n=0;n<e.length;)t=(t<<5)-t+e.charCodeAt(n),t&=t,n++;return t},supportBeacon:Q,getIOSVersion:z,isSafari:J,isIE:function(){return!!window.ActiveXObject||"ActiveXObject"in window||navigator.userAgent.indexOf("compatible")>-1&&navigator.userAgent.indexOf("MSIE")>-1||navigator.userAgent.indexOf("Trident")>-1&&navigator.userAgent.indexOf("rv:11.0")>-1},isBot:W,callError:X,addListener:Y,getActualKey:Z,parseStorageValue:$,limitObject:ee,flattenObject:function(e){void 0===e&&(e={});var n=t({},e);return U(n).forEach((function(e){p(n[e])?(U(n[e]).forEach((function(t){n["".concat(e,"_").concat(t)]=C(n[e][t])})),j(n,e)):I(n[e])?(n[e].forEach((function(t,r){p(t)?U(t).forEach((function(i){n["".concat(e,"_").concat(r,"_").concat(i)]=C(t[i])})):n["".concat(e,"_").concat(r)]=C(t)})),j(n,e)):d(n[e])||""===n[e]?j(n,e):n[e]=C(n[e])})),ee(n)},compareVersion:function(e,t){for(var n=function(e){return e.replace(/\s+/g,"")},r=function(e){return e.replace(/[vV]/g,"")},i=n(r(e)),o=n(r(t)),a=i.split("."),s=o.split("."),u=0;3>u;u++){var c=Number(a[u]),l=Number(s[u]);if(c>l)return 1;if(l>c)return-1;if(!isNaN(c)&&isNaN(l))return 1;if(isNaN(c)&&!isNaN(l))return-1}return 0},getDynamicAttributes:te,getGioFunction:function(){var e,t,n,r,i=window._gio_local_vds||"vds",o=null!==(t=null===(e=window[i])||void 0===e?void 0:e.namespace)&&void 0!==t?t:"gdp";return m(window[o])?window[o]:null!==(r=null!==(n=window.gdp)&&void 0!==n?n:window.gio)&&void 0!==r?r:function(){}}}),re=function(e){return g(e)&&e.length>0||f(e)&&e>0},ie=function(e,t){return g(e)&&!F(e)&&e.match(c)?t():(M("事件名格式不正确，只能包含数字、字母和下划线，且不能以数字开头，字符总长度不能超过100!","error"),!1)},oe=["web","wxwv","Android","iOS","minp","alip","baidup","qq","bytedance","kuaishoup","jdp"],ae={autotrack:{type:"boolean",default:!0},compress:{type:"boolean",default:!0},cookieDomain:{type:"string",default:""},dataCollect:{type:"boolean",default:!0},debug:{type:"boolean",default:!1},embeddedIgnore:{type:"array",default:[]},forceLogin:{type:"boolean",default:!1},idMapping:{type:"boolean",default:!1},enableIdMapping:{type:"boolean",default:!1},gtouchHost:{type:"string",default:""},hashtag:{type:"boolean",default:!1},ignoreFields:{type:"array",default:[]},originalSource:{type:"boolean",default:!0},penetrateHybrid:{type:"boolean",default:!0},performance:{type:"object",default:{monitor:!0,exception:!0}},platform:{type:"string",default:"web"},sendType:{type:"string",default:"beacon"},serverUrl:{type:"string",default:"https://napi.growingio.com"},sessionExpires:{type:"number",default:30},storageType:{type:"string",default:"cookie"},touch:{type:"boolean",default:!1},trackBot:{type:"boolean",default:!0},version:{type:"string",default:"1.0.0"}},se=["clearGeneralProps","clearTrackTimer","clearUserId","getDeviceId","getOption","getPlugins","identify","init","registerPlugins","removeTimer","sendPage","sendVisit","setGeneralProps","setOption","setUserAttributes","setUserId","track","trackTimerEnd","trackTimerPause","trackTimerResume","trackTimerStart","getABTest"],ue={autotrack:"无埋点采集",dataCollect:"数据采集",dataSourceId:"数据源ID",debug:"调试模式",forceLogin:"强制登录",hashtag:"哈希解析",serverUrl:"数据上报服务地址"},ce=["collectImp","enableDebug","enableHT","getVisitorId","send","setAutotrack","setConfig","setDataCollect","setPlatformProfile","setTrackerHost","setTrackerScheme"],le=["screenHeight","screenWidth"];function de(e){for(var t=1;arguments.length>t;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}var ge,fe=function e(t,n){function r(e,r,i){if("undefined"!=typeof document){"number"==typeof(i=de({},n,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var a in i)i[a]&&(o+="; "+a,!0!==i[a]&&(o+="="+i[a].split(";")[0]));return document.cookie=e+"="+t.write(r,e)+o}}return Object.create({set:r,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var n=document.cookie?document.cookie.split("; "):[],r={},i=0;i<n.length;i++){var o=n[i].split("="),a=o.slice(1).join("=");try{var s=decodeURIComponent(o[0]);if(r[s]=t.read(a,s),e===s)break}catch(e){}}return e?r[e]:r}},remove:function(e,t){r(e,"",de({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,de({},this.attributes,t))},withConverter:function(t){return e(de({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"}),ve={A:1,a:1,Z:1,z:1,"@":1,"{":1},pe=function(e){return d(e)?e:G((function(){return"gioenc-".concat(me(e))}))||e},he=function(e){return g(e)&&D(e,"gioenc-")&&G((function(){return me(e.replace("gioenc-",""))}))||e},me=function(e){return(e=e||"").split("").map((function(e){return ve[e]?e:Ie(e)})).join("")},Ie=function(e){if(/[0-9]/.test(e))return 1^+e;var t=e.charCodeAt(0);return String.fromCharCode(1^t)},we=function(e){var t=this;this.domain=e,this.getItem=function(e){return $(he(fe.get(Z(e),{domain:t.domain,path:"/"})))},this.setItem=function(e,n,r){var i;i=g(n)?n.length?k(e,"_gioenc")?pe(n):n:"":JSON.stringify(n),fe.set(Z(e),i,{expires:r?new Date(r):new Date((new Date).getFullYear()+3,(new Date).getMonth(),(new Date).getDay()),domain:t.domain,path:"/"})},this.removeItem=function(e){fe.remove(Z(e),{domain:t.domain,path:"/"})},this.hasItem=function(e){return T(U(fe.get()),Z(e))},this.getKeys=function(){return U(fe.get())},this.type="Cookie"},ye=function(){this.getItem=function(e){var t=G((function(){return JSON.parse(localStorage.getItem(Z(e))||"")}))||{};return p(t)&&t.expiredAt>+Date.now()?$(he(t.value)):void 0},this.setItem=function(e,t,n){var r=null!=n?n:+new Date((new Date).getFullYear()+3,(new Date).getMonth(),(new Date).getDay()).getTime();localStorage.setItem(Z(e),JSON.stringify({value:g(t)&&t.length&&k(e,"_gioenc")?pe(t):t,expiredAt:r}))},this.removeItem=function(e){return localStorage.removeItem(Z(e))},this.hasItem=function(e){return!!localStorage.getItem(Z(e))},this.getKeys=function(){return N(Array(localStorage.length)).map((function(e,t){return localStorage.key(t)}))},this.type="localStorage"},Se={},Oe=function(){this.getItem=function(e){var t=G((function(){return JSON.parse(Se[Z(e)]||"")}));return p(t)&&t.expiredAt>+Date.now()?$(he(t.value)):void 0},this.setItem=function(e,t,n){var r=null!=n?n:+new Date((new Date).getFullYear()+3,(new Date).getMonth(),(new Date).getDay()).getTime();Se[Z(e)]=JSON.stringify({value:g(t)&&t.length?pe(t):t,expiredAt:r})},this.removeItem=function(e){return j(Se,Z(e))},this.hasItem=function(e){return A(Se,Z(e))},this.getKeys=function(){return U(Se)},this.type="memory"},_e=function(e){var t=[];try{var n=e.split("."),r=S(n);if(n.length>=2&&(isNaN(Number(r))||0>Number(r)||Number(r)>255)){var i=".".concat(n.slice(-2).join("."));u.test(i)?ge=i:t.push(i);var o=".".concat(n.slice(-3).join("."));u.test(o)||t.includes(o)||t.push(o);var a=".".concat(n.slice(-4).join("."));u.test(a)||t.includes(a)||t.push(a)}}catch(e){}return t},be=function(e){var t="";return e.every((function(e){return!Ee(e)||(t=e,!1)})),t},Ee=function(e){try{fe.set("gioCookie","yes",{domain:e});var t=!!fe.get("gioCookie",{domain:e});return fe.remove("gioCookie",{domain:e}),t}catch(e){return!1}},Te=function(e){var t,r,i,o=e.storageType,a=e.cookieDomain,s=e.projectId;if(T(["cookie","localstorage"],o)||(o="cookie"),"cookie"===o&&(r=!!(i=navigator.userAgent.indexOf("Electron")>-1||T(["","localhost","127.0.0.1"],window.location.hostname)||!T(["http:","https:"],window.location.protocol)?"":be(n(n([],_e(window.location.hostname),!0),[window.location.hostname],!1)))),"cookie"===o&&r){var u=new we(i);if(a){var c=_e(a),l=be(F(c)?[]:n([a],_e(a),!0));l&&Ee(l)?u.domain=l:M("指定Cookie域无效或无权限，使用默认域！","warn")}t=u}else t=function(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(e){return!1}}()?new ye:new Oe;return"cookie"===o&&ge&&Ee(ge)&&function(e,t,n){if(t&&Ee(t)){var r=new we(t);["".concat(n,"_gdp_session_id"),"gdp_user_id_gioenc","".concat(n,"_gdp_cs1_gioenc"),"".concat(n,"_gdp_user_key_gioenc"),"".concat(n,"_gdp_gio_id_gioenc"),"".concat(n,"_gdp_sequence_ids"),"".concat(n,"_gdp_session_id_sent")].forEach((function(t){var n=r.getItem(t);r.hasItem(t)&&(e.setItem(t,n),r.removeItem(t))})),r=void 0}}(t,ge,s),t},Ne="OPTION_INITIALIZED",Ce="SDK_INITIALIZED_COMPLATE",xe="SESSIONID_UPDATE",Pe="ON_INSTALL",De="ON_ERROR",ke="ON_COMPOSE_AFTER",qe="ON_SEND_BEFORE",Ae="ON_SEND_AFTER",Ue=function(e){var n=this;this.growingIO=e,this.main=function(){var e,r,i=n.growingIO,o=i.sdkVersion,a=i.useEmbeddedInherit,s=i.vdsConfig,u=i.userStore,c=i.dataStore,l=i.trackingId,d=c.currentPage,g=d.path,f=d.query,v={appVersion:s.version,dataSourceId:s.dataSourceId,deviceId:u.uid,domain:a?s.appId:window.location.host,language:navigator.language,path:g,platform:s.platform,query:f,referralPage:(null===(e=c.lastPageEvent)||void 0===e?void 0:e.referralPage)||"",screenHeight:window.screen.height,screenWidth:window.screen.width,sdkVersion:o,sessionId:u.sessionId,timestamp:+Date.now(),timezoneOffset:(new Date).getTimezoneOffset(),title:null!==(r=G((function(){return document.title.slice(0,255)})))&&void 0!==r?r:"",userId:u.userId};if(s.idMapping&&(v.userKey=u.userKey),F(s.ignoreFields)||s.ignoreFields.forEach((function(e){j(v,e)})),a&&!F(n.minpExtraParams)){var p=t({},v);L(t(t({},v),n.minpExtraParams),(function(e,t){var r;T(s.embeddedIgnore,t)?(v[t]=p[t],"domain"===t&&(v[t]=window.location.host)):v[t]=null!==(r=n.minpExtraParams[t])&&void 0!==r?r:v[t]}))}return v.trackingId=l,v},this.minpExtraParams={}},Le=function(e){var n=this;this.growingIO=e,this.parsePage=function(){var e=n.growingIO.vdsConfig.hashtag,t=location.pathname,r=location.search,i=location.hash,o=i.indexOf("?");n.domain=window.location.host,n.title=document.title.slice(0,255),n.time=+Date.now(),n.path=t,n.query=r,e&&(o>-1?(n.path+=i.slice(0,o),n.query=n.query+"&"+i.slice(o+1)):n.path+=i),n.query&&T(["?","&"],n.query.charAt(0))&&(n.query=n.query.slice(1))},this._getNoHashHref=function(){var e=window.location,t=e.protocol,n=e.host,r=e.pathname,i=e.search;return"".concat(t,"://").concat(n).concat(r).concat(i)},this.getReferralPage=function(){var e,t,r=n.growingIO.dataStore.lastPageEvent;return(null==r?void 0:r.path)===n.path&&(null!==(e=null==r?void 0:r.query)&&void 0!==e?e:"")===(null!==(t=n.query)&&void 0!==t?t:"")?null==r?void 0:r.referralPage:(null==r?void 0:r.path)?n.lastHref:document.referrer},this.pageListener=function(){var e=n.growingIO.vdsConfig.hashtag,t=window.location.href,r=n.lastHref;e||(t=n._getNoHashHref(),r=n.lastNoHashHref),r!==t&&(n.parsePage(),n.buildPageEvent())},this.hookHistory=function(){var e=window.history.pushState,t=window.history.replaceState,r=n;e&&G((function(){return window.history.pushState=function(){e.apply(window.history,arguments),setTimeout(r.pageListener)}})),t&&G((function(){return window.history.replaceState=function(){t.apply(window.history,arguments),setTimeout(r.pageListener)}})),Y(window,"popstate",n.pageListener),n.growingIO.vdsConfig.hashtag&&Y(window,"hashchange",n.pageListener)},this.buildPageEvent=function(e){var r=n.growingIO.dataStore,i=r.eventContextBuilder,o=r.eventConverter,a=t(t({eventType:"PAGE"},i()),{protocolType:location.protocol.substring(0,location.protocol.length-1),referralPage:n.getReferralPage()});F(e)||(a=t(t({},a),e)),a.timestamp=n.time,o(a),n.lastHref=window.location.href,n.lastNoHashHref=n._getNoHashHref(),n.lastLocation=t({},window.location)},this.title=document.title.slice(0,255),this.lastLocation=t({},window.location)},Ke=function(){function e(e){var n,r=this;this.growingIO=e,this.ALLOW_SETTING=t({},ae),this.allowOptKeys=Object.keys(this.ALLOW_SETTING),this.trackTimers={},this.setSequenceIds=function(e){var t=r.growingIO.storage.getItem(r.seqStorageIdName)||{};t.globalKey=e,r.growingIO.storage.setItem(r.seqStorageIdName,t)},this.initOptions=function(e){var n,i,o,a,s,u,c,l=e.projectId,d=e.dataSourceId,g=e.appId;r.initialDataSourceId=d;var f={};r.allowOptKeys.forEach((function(t){var n=r.ALLOW_SETTING[t].type,i=I(n)?!T(n,R(e[t])):R(e[t])!==n;"platform"!==t||T(oe,e[t])||(i=!0),i?f[t]=r.ALLOW_SETTING[t].default:"ignoreFields"===t?f.ignoreFields=e.ignoreFields.filter((function(e){return T(le,e)})):(f[t]=e[t],T(["dataCollect","autotrack"],t)&&(f[t]||M("已关闭".concat(ue[t]),"info")))})),f.sessionExpires=Math.round(f.sessionExpires),(v(f.sessionExpires)||1>f.sessionExpires||f.sessionExpires>360)&&(f.sessionExpires=30),f.storageType=f.storageType.toLowerCase(),f.enableIdMapping&&!f.idMapping&&(f.idMapping=!0),f.sendType=f.sendType.toLowerCase(),T(["beacon","xhr"],f.sendType)||(f.sendType="beacon"),!f.trackBot&&W()&&(f.dataCollect=!1),r.growingIO.vdsConfig=t(t(t({},null!==(n=window[r.growingIO.vds])&&void 0!==n?n:{}),f),{projectId:l,dataSourceId:d,appId:g,performance:{monitor:null===(o=null===(i=f.performance)||void 0===i?void 0:i.monitor)||void 0===o||o,exception:null===(s=null===(a=f.performance)||void 0===a?void 0:a.exception)||void 0===s||s,network:null!==(c=null===(u=f.performance)||void 0===u?void 0:u.network)&&void 0!==c&&c}}),window[r.growingIO.vds]=r.growingIO.vdsConfig,r.seqStorageIdName="".concat(l,"_gdp_sequence_ids"),r.visitStorageName="".concat(l,"_gdp_session_id_sent")},this.setOriginalSource=function(){var e=r.growingIO,t=e.storage,n=e.userStore,i=t.getItem(r.visitStorageName);if(n.sessionId!==i&&d(r.getOriginalSource())){var o=r.currentPage,a=o.path,s=o.query,u=o.getReferralPage,c={path:a,query:s,referralPage:document.referrer||u()};localStorage.setItem(r.originalSourceName,JSON.stringify(c))}},this.getOriginalSource=function(){return G((function(){return JSON.parse(localStorage.getItem(r.originalSourceName))}))},this.setOption=function(e,n){var i,o=r.growingIO,a=o.vdsConfig,s=o.uploader,u=o.emitter,c=o.userStore,l=o.vds,d=g(e)&&T(U(ue),e),f=d&&typeof n===((null===(i=r.ALLOW_SETTING[e])||void 0===i?void 0:i.type)||"string"),v=t({},a);return d&&f?(a[e]=n,"dataCollect"===e&&v.dataCollect!==n&&(n?c.sessionId=H():r.growingIO.clearTrackTimer()),"serverUrl"===e&&(null==s||s.generateHost()),null==u||u.emit("OPTION_CHANGE",{optionName:e,optionValue:n}),window[l][e]=n,!0):(X("setOption > ".concat(e)),!1)},this.getOption=function(e){var n=r.growingIO.vdsConfig;return e&&A(n,C(e))?n[C(e)]:d(e)?t({},n):void X("getOption > ".concat(e))},this.sendVisit=function(e){var t=r.growingIO,n=t.userStore.sessionId,i=t.storage.getItem(r.visitStorageName);!e&&n===i||r.buildVisitEvent()},this.buildVisitEvent=function(e){var n=r.growingIO,i=n.dataStore,o=i.eventContextBuilder,a=i.eventConverter,s=i.currentPage,u=n.emitter,c=n.storage,l=n.vdsConfig,g=r.getOriginalSource(),v=t(t({eventType:"VISIT"},o()),{referralPage:document.referrer||r.currentPage.getReferralPage(),timestamp:s.time-1});l.originalSource&&!d(g)&&(v=t(t({},v),g)),F(e)||L(v,(function(t,n){A(e,n)&&(f(e[n])?v[n]=e[n]:F(e[n])||(v[n]=e[n]||v[n]))}));var p=function(e){var t=e.requestData;"VISIT"===t.eventType&&t.trackingId===r.growingIO.trackingId&&(c.setItem(r.visitStorageName,t.sessionId),localStorage.removeItem(r.originalSourceName),u.off(Ae,p))};u.on(Ae,p),a(v)},this.sendPage=function(e){e&&r.currentPage.parsePage(),r.currentPage.buildPageEvent()},this.buildErrorEvent=function(e){var n=r.growingIO.dataStore,i=n.eventContextBuilder;(0,n.eventConverter)(t({eventType:"CUSTOM",eventName:"onError",attributes:e},i()))},this.eventConverter=function(e){var n,i=r.growingIO,o=i.vdsConfig,a=i.dataStore,s=i.uploader;if(o.dataCollect){"LOGIN_USER_ATTRIBUTES"===e.eventType?j(e,"timezoneOffset"):e.trackingId===r.growingIO.trackingId&&(e.eventSequenceId=a.gsid);var u={};L(e,(function(e,t){var n;if("element"===t){var r=null!==(n=y(e))&&void 0!==n?n:{};L(r,(function(e,t){F(e)&&0!==e||(u[t]=e)}))}else(F(e)||d(e))&&0!==e||(u[t]=e)})),e.trackingId===r.growingIO.trackingId&&(r.growingIO.dataStore.gsid+=1),null===(n=r.growingIO.emitter)||void 0===n||n.emit(ke,{composedEvent:t({},u)}),e.trackingId===r.growingIO.trackingId&&s.commitRequest(t(t({},u),{requestId:H()}))}},this.currentPage=new Le(this.growingIO),this.eventContextBuilderInst=new Ue(this.growingIO),this.eventContextBuilder=null===(n=this.eventContextBuilderInst)||void 0===n?void 0:n.main,this.generalProps={},this.lastPageEvent={},this.originalSourceName="gdp_original_source";var i=this.growingIO.emitter;null==i||i.on(ke,(function(e){var t=e.composedEvent;"PAGE"!==t.eventType&&"page"!==t.t||t.trackingId!==r.growingIO.trackingId||(r.lastPageEvent=t)})),i.on(Ce,(function(){null==i||i.on(xe,(function(){r.growingIO.uploader.hoardingQueue=[],r.currentPage.parsePage(),r.sendVisit(!0),r.sendPage(!0)}))}))}return Object.defineProperty(e.prototype,"gsid",{get:function(){var e=this.growingIO.storage.getItem(this.seqStorageIdName)||{},t=Number(e.globalKey);return this._gsid=v(t)||t>=1e9||1>t?1:t,this._gsid},set:function(e){v(Number(e))||e>=1e9||1>e?this._gsid=1:this._gsid=e,this.setSequenceIds(this._gsid)},enumerable:!1,configurable:!0}),e}(),je=["gioPerformance"],Fe=function(t){function n(e){var n=t.call(this,e)||this;return n.growingIO=e,n.growingIO.gioSDKFull=!1,n.pluginsContext={plugins:{}},n}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+n+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}(n,t),n}((function(e){var t,n,r,i,o,a,s=this;this.growingIO=e,this.innerPluginInit=function(){var e;je.forEach((function(e){var t;return j(null===(t=s.pluginsContext)||void 0===t?void 0:t.plugins,e)})),U(null===(e=s.pluginsContext)||void 0===e?void 0:e.plugins).forEach((function(e){var t,n,r=null!==(n=null===(t=s.pluginsContext)||void 0===t?void 0:t.plugins[e])&&void 0!==n?n:{},i=r.name,o=r.method;b(s.pluginItems,(function(e){return e.name===i}))||s.pluginItems.push({name:P(i||e),method:o||function(e){}})})),F(s.pluginItems)||s.installAll()},this.install=function(e,t,n){var r,i,o=s.growingIO.emitter,a=t||b(s.pluginItems,(function(t){return t.name===e}));if((null===(r=s.growingIO)||void 0===r?void 0:r.plugins)[e])return M("重复加载插件 ".concat(e," 或插件重名，已跳过加载!"),"warn"),!1;if(!a)return M("插件加载失败!不存在名为 ".concat(e," 的插件!"),"error"),!1;try{return(null===(i=s.growingIO)||void 0===i?void 0:i.plugins)[e]=new a.method(s.growingIO,n),t&&(o.emit(Pe,e),M("加载插件 ".concat(e),"info")),!0}catch(n){return s.lifeError(t,n),M("插件【".concat(e,"】加载异常 ").concat(n),"error"),!1}},this.installAll=function(e){(e||s.pluginItems).forEach((function(t){s.install(t.name,e?t:void 0,e?null==t?void 0:t.options:void 0)&&!b(s.pluginItems,(function(e){return e.name===t.name}))&&s.pluginItems.push({name:P(t.name),method:t.method?t.method:function(){}})}))},this.uninstall=function(e){var t;j(s.pluginItems,e);var n=j(null===(t=s.growingIO)||void 0===t?void 0:t.plugins,e);return n||M("卸载插件 ".concat(e," 失败!"),"error"),n},this.uninstallAll=function(){s.pluginItems.forEach((function(e){return s.uninstall(e.name)}))},this.lifeError=function(e,t){s.growingIO.emitter.emit(De,{plugin:e,error:t}),M("插件执行错误 ".concat(e.name," ").concat(t),"error")},this.callLifeCycle=function(e,t){s.pluginItems.forEach((function(n){var r=s.growingIO.plugins[n.name]?s.growingIO.plugins[n.name][e]:void 0;if(r&&m(r))try{r(t)}catch(e){s.lifeError(n,e)}}))},this.pluginsContext={plugins:{}},this.pluginItems=[],null===(t=this.growingIO.emitter)||void 0===t||t.on(Pe,(function(e){return s.callLifeCycle("onInstall",e)})),null===(n=this.growingIO.emitter)||void 0===n||n.on(De,(function(e){return s.callLifeCycle("onError",e)})),null===(r=this.growingIO.emitter)||void 0===r||r.on("ON_COMPOSE_BEFORE",(function(e){return s.callLifeCycle("onComposeBefore",e)})),null===(i=this.growingIO.emitter)||void 0===i||i.on(ke,(function(e){return s.callLifeCycle("onComposeAfter",e)})),null===(o=this.growingIO.emitter)||void 0===o||o.on(qe,(function(e){return s.callLifeCycle("onSendBefore",e)})),null===(a=this.growingIO.emitter)||void 0===a||a.on(Ae,(function(e){return s.callLifeCycle("onSendAfter",e)}))})),Re={},Be={}.hasOwnProperty;function He(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function Me(e){try{return encodeURIComponent(e)}catch(e){return null}}Re.stringify=function(e,t){t=t||"";var n,r,i=[];for(r in"string"!=typeof t&&(t="?"),e)if(Be.call(e,r)){if((n=e[r])||null!=n&&!isNaN(n)||(n=""),r=Me(r),n=Me(n),null===r||null===n)continue;i.push(r+"="+n)}return i.length?t+i.join("&"):""},Re.parse=function(e){for(var t,n=/([^=?#&]+)=?([^&]*)/g,r={};t=n.exec(e);){var i=He(t[1]),o=He(t[2]);null===i||null===o||i in r||(r[i]=o)}return r};var Ge,Ve,Qe,ze=function(e){var r=this;this.growingIO=e,this.generateHost=function(){var e=r.growingIO.vdsConfig,t=e.serverUrl,n=e.projectId;return D(t,"http")?"".concat(t,"/v3/projects/").concat(n,"/collect"):"https://".concat(t,"/v3/projects/").concat(n,"/collect")},this.getSendType=function(){var e=r.growingIO.vdsConfig.sendType;return"beacon"===e?Q()?"beacon":"xhr":e},this.commitRequest=function(e,n){var i=r.growingIO.vdsConfig.forceLogin,o=t(t({},e),{requestType:r.getSendType()});i?r.hoardingQueue.push(o):(r.requestQueue.push(o),r.initiateRequest(n))},this.initiateRequest=function(e){var i,o;if(n(n([],r.hoardingQueue,!0),r.requestQueue,!0).length>0&&r.requestingNum<r.requestLimit){var a=r.growingIO,s=a.vdsConfig,u=a.emitter,c=a.plugins,l=a.useHybridInherit;if(r.requestQueue=n(n([],r.hoardingQueue,!0),r.requestQueue,!0).filter((function(e){return(r.retryIds[e.requestId]||0)<=r.retryLimit})),r.hoardingQueue=[],F(r.requestQueue))return;var d=r.requestQueue.shift(),g=d.requestType;null==u||u.emit(qe,{requestData:t({},d)});var f=t({},d);if(j(f,["requestType","trackingId","requestId","customEventType"]),s.debug&&console.log("[GrowingIO Debug]:",JSON.stringify(f,null,2).replace(/\"/g,J()?"":'"')),r.requestingNum+=1,l)return r.requestSuccessFn(d),!1;var v=t({},f);s.compress&&(null==c?void 0:c.gioCompress)?(r.compressType="1",v="image"===g?null===(i=null==c?void 0:c.gioCompress)||void 0===i?void 0:i.compressToUTF16(JSON.stringify([v])):null===(o=null==c?void 0:c.gioCompress)||void 0===o?void 0:o.compressToUint8Array(JSON.stringify([v]))):(r.compressType="0",v=JSON.stringify([v]));var p=r.generateURL(null!=e?e:r.requestURL);switch(g){case"beacon":default:r.sendByBeacon(d,v,p);break;case"xhr":r.sendByXHR(d,v,p);break;case"image":r.sendByImage(d,v,p)}}},this.generateURL=function(e){return"".concat(e,"?stm=").concat(+Date.now(),"&compress=").concat(r.compressType)},this.sendByBeacon=function(e,t,n){navigator.sendBeacon(n,t)?r.requestSuccessFn(e):r.requestFailFn(e,"beacon")},this.sendByXHR=function(e,t,n){var i,o=T(["unload","beforeunload","pagehide"],null===(i=null===window||void 0===window?void 0:window.event)||void 0===i?void 0:i.type),a=new XMLHttpRequest;if(a)return a.open("POST",n,o),a.onreadystatechange=function(){4===a.readyState&&204===a.status?r.requestSuccessFn(e):r.requestFailFn(e,"xhr")},a.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),void a.send(t);if(null===window||void 0===window?void 0:window.XDomainRequest){var s=new window.XDomainRequest;s.open("POST",n.replace("https://","http://"),o),s.onload=function(){204===s.status?r.requestSuccessFn(e):r.requestFailFn(e,"xhr")},s.onerror=s.ontimeout=function(){r.requestFailFn(e,"xhr")},s.send(t)}},this.sendByImage=function(e,t,n){var i="".concat(n,"&data=").concat(t),o=document.createElement("img");o.width=1,o.height=1,o.onload=function(){r.requestSuccessFn(e),r.clearImage(o)},o.onerror=o.onabort=function(){r.requestSuccessFn(e),r.clearImage(o)},o.src=i},this.clearImage=function(e){e.src="",e.onload=function(){},e.onerror=e.onerabort=function(){},e=null},this.requestSuccessFn=function(e){var n;r.requestingNum-=1;var i=e.requestId||-1;r.retryIds[i]&&(r.retryIds[i]=0),e.trackingId===r.growingIO.trackingId&&(r.growingIO.userStore.sessionId=e.sessionId),null===(n=r.growingIO.emitter)||void 0===n||n.emit(Ae,{requestData:t({},e)}),r.initiateRequest()},this.requestFailFn=function(e,n){r.requestingNum-=1;var i=e.requestId||-1;r.retryIds[i]||(r.retryIds[i]=0),r.retryIds[i]+=1;var o=r.requestQueue.some((function(t){return t.requestId===e.requestId})),a=n;if(r.retryIds[i]<r.retryLimit+1||(a="beacon"===n?"xhr":"xhr"===n?"image":void 0,r.retryIds[i]=0),!o&&a)var s=window.setTimeout((function(){F(r.requestQueue)?(r.requestQueue.push(t(t({},e),{requestType:a})),r.initiateRequest()):r.requestQueue.push(t(t({},e),{requestType:a})),window.clearTimeout(s),s=null}),800)},this.hoardingQueue=[],this.requestQueue=[],this.requestLimit=10,this.requestTimeout=5e3,this.retryLimit=1,this.retryIds={},this.requestingNum=0,this.requestURL=this.generateHost()},Je=function(){function e(e){var t=this;this.growingIO=e,this.transferStorage=function(){var e=t.growingIO,n=e.vdsConfig.projectId,r=e.storage;t.uid=r.getItem("gr_user_id")||t.uid,t.userId=r.getItem("".concat(n,"_gr_cs1"))||t.userId,r.removeItem("gr_user_id"),r.removeItem("".concat(n,"_gr_cs1")),r.removeItem("".concat(n,"_gr_last_sent_cs1")),r.removeItem("".concat(n,"_gr_last_sent_sid_with_cs1")),r.removeItem("".concat(n,"_gr_session_id")),r.removeItem("".concat(n,"_gr_session_id_sent_vst"));var i=r.getKeys().find((function(e){return e.indexOf("gr_imp_")>-1}));i&&r.removeItem(i)};var n=this.growingIO,r=n.vdsConfig.projectId,i=n.storage;this.sIdStorageName="".concat(r,"_gdp_session_id"),this.uidStorageName="gdp_user_id_gioenc",this.userIdStorageName="".concat(r,"_gdp_cs1_gioenc"),this.userKeyStorageName="".concat(r,"_gdp_user_key_gioenc"),this.gioIdStorageName="".concat(r,"_gdp_gio_id_gioenc"),this.growingIO.emitter.on(Ne,(function(){i.getItem("gr_user_id")&&t.transferStorage()}))}return Object.defineProperty(e.prototype,"sessionId",{get:function(){return this.growingIO.storage.getItem(this.sIdStorageName)||(this.sessionId=H(),this.sessionId)},set:function(e){var t;e||(e=H());var n=this.growingIO.storage,r=n.getItem(this.sIdStorageName)||this.prevSessionId,i=this.growingIO.vdsConfig.sessionExpires,o=void 0===i?30:i;n.setItem(this.sIdStorageName,e,+Date.now()+60*o*1e3),r!==e&&(n.getKeys().filter((function(e){return/.+_gdp_session_id_.{36}/.test(e)})).forEach((function(e){n.removeItem(e)})),n.setItem(this.growingIO.dataStore.visitStorageName,""),null===(t=this.growingIO.emitter)||void 0===t||t.emit(xe,{newSessionId:e,oldSessionId:r})),this.prevSessionId=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this.growingIO.storage.getItem(this.uidStorageName)||(this.uid=H(),this.uid)},set:function(e){var t,n=this.growingIO.storage,r=n.getItem(this.uidStorageName)||this.prevUId;n.setItem(this.uidStorageName,e),r!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit("UID_UPDATE",{newUId:e,oldUId:r})),this.prevUId=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userId",{get:function(){return this.growingIO.storage.getItem(this.userIdStorageName)||""},set:function(e){var t,n,r=this.growingIO.storage,i=r.getItem(this.userIdStorageName)||this.prevUserId;r.setItem(this.userIdStorageName,e),null===(t=this.growingIO.emitter)||void 0===t||t.emit("SET_USERID",{newUserId:e,oldUserId:i,userKey:this.userKey}),i!==e&&(null===(n=this.growingIO.emitter)||void 0===n||n.emit("USERID_UPDATE",{newUserId:e,oldUserId:i,userKey:this.userKey})),e&&(this.gioId=e),this.prevUserId=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userKey",{get:function(){return this.growingIO.storage.getItem(this.userKeyStorageName)||""},set:function(e){var t,n,r=this.growingIO.storage,i=r.getItem(this.userKeyStorageName)||this.prevUserKey;r.setItem(this.userKeyStorageName,e),null===(t=this.growingIO.emitter)||void 0===t||t.emit("SET_USERKEY",{newUserKey:e,oldUserKey:i,userId:this.userId}),i!==e&&(null===(n=this.growingIO.emitter)||void 0===n||n.emit("USERKEY_UPDATE",{newUserKey:e,oldUserKey:i,userId:this.userId})),this.prevUserKey=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"gioId",{get:function(){return this.growingIO.storage.getItem(this.gioIdStorageName)||""},set:function(e){var t,n=this.growingIO.storage,r=n.getItem(this.gioIdStorageName)||this.prevGioId;n.setItem(this.gioIdStorageName,e),r!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit("GIOID_UPDATE",{newGioId:e,oldGioId:r})),this.prevGioId=e},enumerable:!1,configurable:!0}),e}(),We=function(){var e,n=this;this.trackingId="g0",this.init=function(e,t){var r,i,o,a,s;M("Gio Web SDK 初始化中...","info");var u=n.dataStore,c=u.initOptions,l=u.currentPage,d=u.sendVisit,g=u.sendPage;c(e),n.storage=Te(n.vdsConfig),n.uploader=new ze(n),n.userStore=new Je(n),null===(r=n.emitter)||void 0===r||r.emit(Ne,n),null===(o=null===(i=n.plugins)||void 0===i?void 0:i.gioEventAutoTracking)||void 0===o||o.main(),l.hookHistory(),l.parsePage(),n.vdsConfig.originalSource&&n.dataStore.setOriginalSource(),null===(a=n.emitter)||void 0===a||a.emit("SDK_INITIALIZED",n),n.gioSDKInitialized=!0,n.vdsConfig.gioSDKInitialized=!0,window[n.vds]=n.vdsConfig,M("Gio Web SDK 初始化完成！","success"),n.vdsConfig.forceLogin&&M("forceLogin已开启，请调用 identify 方法设置 openId 以继续上报!","info"),n.useEmbeddedInherit||d(),g(),null===(s=n.emitter)||void 0===s||s.emit(Ce,n),V(t,n.trackingId)},this.sendVisit=function(e,t){n.dataStore.buildVisitEvent(e),V(t)},this.sendPage=function(e,t){n.dataStore.currentPage.buildPageEvent(e),V(t)},this.registerPlugins=function(e,r){I(e)?(e.forEach((function(n,r){var i,o;F(n)||d(n)?M("插件不合法，跳过加载!","warn"):(null===(i=n.js)||void 0===i?void 0:i.default)&&(e[r]=t(t({},null===(o=n.js)||void 0===o?void 0:o.default),{options:n.options}))})),e=_(e),n.plugins.installAll(e)):M("插件注册失败，请检查!","error"),V(r,n.plugins.pluginItems)},this.getPlugins=function(e){V(e,n.plugins.pluginItems)},this.setOption=function(e,t,r){var i;T(U(ue),e)?(i=n.dataStore.setOption(e,t))&&ue[e]&&M("已修改".concat(ue[e],": ").concat(t),"info"):(M("不存在可修改的配置项：".concat(e,"，请检查后重试!"),"warn"),i=!1),V(r,i)},this.getOption=function(e,t){V(t,n.dataStore.getOption(e))},this.setGeneralProps=function(e,r){var i;p(e)&&!F(e)?(n.dataStore.generalProps=t(t({},n.dataStore.generalProps),e),U(n.dataStore.generalProps).forEach((function(e){T([void 0,null],n.dataStore.generalProps[e])&&(n.dataStore.generalProps[e]="")})),i=!0):(X("setGeneralProps"),i=!1),V(r,i)},this.clearGeneralProps=function(e,t){I(e)&&!F(e)?e.forEach((function(e){j(n.dataStore.generalProps,e)})):n.dataStore.generalProps={},V(t)},this.getDeviceId=function(e){V(e,n.userStore.uid)},this.identify=function(e,t){if(n.vdsConfig.forceLogin){if(!re(e))return void X("identify");var r=C(e).slice(0,1e3);n.userStore.uid=r,n.uploader.hoardingQueue.forEach((function(e,t){return n.uploader.hoardingQueue[t].deviceId=r})),n.dataStore.setOption("forceLogin",!1),n.uploader.initiateRequest()}else X("identify",!1,"forceLogin未开启");V(t)},this.setUserId=function(e,t,r){var i;if(re(C(e).trim())){var o=n.userStore.gioId;n.vdsConfig.idMapping&&(n.userStore.userKey=!d(t)&&C(t).length>0?C(t).slice(0,1e3):""),n.userStore.userId=C(e).slice(0,1e3),o&&o!==n.userStore.userId&&(n.userStore.sessionId=""),i=!0}else n.clearUserId(),X("setUserId"),i=!1;V(r,i)},this.clearUserId=function(e){n.userStore.userId="",n.userStore.userKey="",V(e)},this.setUserAttributes=function(e,r,i){var o;if(!F(e)&&p(e)){var a=n.dataStore,s=a.eventContextBuilder,u=a.eventConverter,c=t({eventType:"LOGIN_USER_ATTRIBUTES",attributes:ee(e)},s());F(r)||(c=t(t({},c),r)),u(c),o=!0}else X("setUserAttributes"),o=!1;V(i,o)},this.track=function(e,r,i,o){ie(e,(function(){var o=n.dataStore,a=o.eventContextBuilder,s=o.eventConverter,u=o.generalProps,c=t(t({},u),p(r)&&!F(r)?r:{}),l=t(t({eventType:"CUSTOM",eventName:e,attributes:ee(te(c))},a()),{customEventType:1});F(i)||(l=t(t({},l),i)),s(l)})),V(o)},this.trackTimerStart=function(e,t){var r;n.vdsConfig.dataCollect&&ie(e,(function(){r=H(),n.dataStore.trackTimers[r]={eventName:e,leng:0,start:+Date.now()}})),V(t,r)},this.trackTimerPause=function(e,t){if(e&&n.dataStore.trackTimers[e]){var r=n.dataStore.trackTimers[e];r.start&&(r.leng=r.leng+(+Date.now()-r.start)),r.start=0}V(t)},this.trackTimerResume=function(e,t){if(e&&n.dataStore.trackTimers[e]){var r=n.dataStore.trackTimers[e];0===r.start&&(r.start=+Date.now())}V(t)},this.trackTimerEnd=function(e,r,i){var o;if(n.vdsConfig.dataCollect)if(e&&n.dataStore.trackTimers[e]){var a=n.dataStore.trackTimers[e];if(0!==a.start){var s=+Date.now()-a.start;a.leng=s>0?a.leng+s:0}var u=n.dataStore,c=u.eventContextBuilder;(0,u.eventConverter)(t(t({eventType:"CUSTOM",eventName:a.eventName,attributes:t(t({},r),{event_duration:a.leng>864e5?0:a.leng/1e3})},c()),{customEventType:0})),n.removeTimer(e),o=!0}else M("未查找到对应的计时器，请检查!","error"),o=!1;V(i,o)},this.removeTimer=function(e,t){e&&n.dataStore.trackTimers[e]&&delete n.dataStore.trackTimers[e],V(t)},this.clearTrackTimer=function(e){n.dataStore.trackTimers={},V(e)},this.sdkVersion="4.0.0",this.vds=window._gio_local_vds||"vds",this.utils=Object.assign({},B,ne,Re),this.emitter={all:e=e||new Map,on:function(t,n){var r=e.get(t);r?r.push(n):e.set(t,[n])},off:function(t,n){var r=e.get(t);r&&(n?r.splice(r.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var r=e.get(t);r&&r.slice().map((function(e){e(n)})),(r=e.get("*"))&&r.slice().map((function(e){e(t,n)}))}},this.useEmbeddedInherit=!1,this.useHybridInherit=!1,this.gioSDKInitialized=!1,this.plugins=new Fe(this),this.plugins.innerPluginInit(),this.dataStore=new Ke(this)},Xe=window._gio_local_vds||"vds",Ye=null!==(Ve=null===(Ge=window[Xe])||void 0===Ge?void 0:Ge.namespace)&&void 0!==Ve?Ve:"gdp";!function(){var e,n,r,i,o;if(null===(e=window[Xe])||void 0===e?void 0:e.gioSDKInstalled)return Qe=window[Ye],void M("SDK重复加载，请检查是否重复加载SDK或接入其他平台SDK导致冲突!","warn");window[Xe]=t(t({},null!==(n=window[Xe])&&void 0!==n?n:{}),{gioSDKInstalled:!0});var a=new We;Qe=function(){var e,n=arguments[0];if(g(n)&&T(se,n)&&a[n]){var r=O(N(arguments));if("init"===n){var i=function(e){var t;return e.vdsConfig||e.gioSDKInitialized||(null===(t=window[e.vds])||void 0===t?void 0:t.gioSDKInitialized)?(M("SDK重复初始化，请检查是否重复加载SDK或接入其他平台SDK导致冲突!","warn"),!1):!(T(["","localhost","127.0.0.1"],location.hostname)&&!window._gr_ignore_local_rule&&(M("当前SDK不允许在本地环境初始化!","warn"),1))}(a);if(!i)return;var o=function(e){return!F(_(e))||(M('SDK初始化失败，请使用 gdp("init", "您的GrowingIO项目 accountId", "您项目的 dataSourceId", options); 进行初始化!',"error"),!1)}(r);if(!o)return;var s=function(e){var t=y(e),n=S(e);return re(C(t).trim())?(p(n)&&n||(n={}),{projectId:t,userOptions:n}):(M("SDK初始化失败，accountId 参数不合法!","error"),!1)}(r);if(!s)return;var u=function(e){var t=e[1],n=e[2],r=S(e);return t&&g(t)?{dataSourceId:t,appId:g(n)?n:"",options:r}:(M("SDK初始化失败，dataSourceId 参数不合法!","error"),!1)}(r);if(!u)return;var c=s.projectId,l=u.dataSourceId,d=u.appId,f=u.options;a.init(t(t({},f),{projectId:c,dataSourceId:l,appId:d}),S(r))}else if("registerPlugins"===n)a.registerPlugins.apply(a,r);else{if(a.gioSDKInitialized&&a.vdsConfig)return a[n].apply(a,r);a.emitter.emit("UN_EXECUTE_CALL",arguments),M("SDK未初始化!","error")}}else T(ce,n)?M("方法 ".concat(C(n)," 已被弃用，请移除!"),"warn"):M("不存在名为 ".concat(C(n)," 的方法调用!"),"error");window[Xe]=t(t({},window[Xe]),{_gr_ignore_local_rule:null!==(e=window._gr_ignore_local_rule)&&void 0!==e&&e,gioSDKVersion:a.sdkVersion,gioSDKFull:a.gioSDKFull,canIUse:function(e){return T(se,e)&&a[e]}})};var s=null===(r=window[Ye])||void 0===r?void 0:r.q,u=null===(i=window[Ye])||void 0===i?void 0:i.e,c=null===(o=window[Ye])||void 0===o?void 0:o.ef;window[Ye]=Qe,window[Ye].e=u,window[Ye].ef=c,window.gdp=Qe,window.gdp.e=u,window.gdp.ef=c,I(s)&&!F(s)&&Array.from(Array(s.length)).forEach((function(){Qe.apply(null,s.shift())}))}();var Ze=Qe;export{Ze as default};
