var e,t,n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)({}).hasOwnProperty.call(t,n)&&(e[n]=t[n])},n(e,t)},i=function(){return i=Object.assign||function(e){for(var t,n=1,i=arguments.length;i>n;n++)for(var r in t=arguments[n])({}).hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},i.apply(this,arguments)};function r(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;o>r;r++)!i&&r in t||(i||(i=[].slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||[].slice.call(t))}var o,a,s,u="function"==typeof Array.from?Array.from:(t||(t=1,o=function(e){return"function"==typeof e},a=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),9007199254740991)},s=function(e){var t=e.next();return!t.done&&t},e=function(e){var t,n,i,r=this,u=arguments.length>1?arguments[1]:void 0;if(void 0!==u){if(!o(u))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(t=arguments[2])}var c=function(e,t){if(null!=e&&null!=t){var n=e[t];if(null==n)return;if(!o(n))throw new TypeError(n+" is not a function");return n}}(e,function(e){if(null!=e){if(["string","number","boolean","symbol"].indexOf(typeof e)>-1)return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in e)return Symbol.iterator;if("@@iterator"in e)return"@@iterator"}}(e));if(void 0!==c){n=o(r)?Object(new r):[];var d,l,g=c.call(e);if(null==g)throw new TypeError("Array.from requires an array-like or iterable object");for(i=0;;){if(!(d=s(g)))return n.length=i,n;l=d.value,n[i]=u?u.call(t,l,i):l,i++}}else{var f=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var h,v=a(f.length);for(n=o(r)?Object(new r(v)):Array(v),i=0;v>i;)h=f[i],n[i]=u?u.call(t,h,i):h,i++;n.length=v}return n}),e),c=function(e){return O(["undefined","null"],K(e))},d=function(e){return"string"===K(e)},l=function(e){return"number"===K(e)},g=function(e){return"NaN"===T(Number(e))},f=function(e){return"boolean"===K(e)},h=function(e){return"object"===K(e)&&!c(e)},v=function(e){return"regexp"===K(e)},p=function(e){return O(["function","asyncfunction"],K(e))},m=function(e){return Array.isArray(e)&&"array"===K(e)},w=function(e){return"date"===K(e)},I=function(e){try{return E(e)[0]}catch(e){return}},y=function(e){try{var t=E(e);return t[t.length-1]}catch(e){return}},b=function(e,t){return void 0===t&&(t=1),m(e)&&l(t)?e.slice(t>0?t:1,e.length):e},S=function(e){if(m(e)){for(var t=0,n=[],i=0,r=e;i<r.length;i++){var o=r[i];o&&!H(o)&&(n[t++]=o)}return n}return e},_=function(e,t){return e[N(e,t)]},N=function(e,t){var n=-1;return m(e)&&e.every((function(e,i){return!t(e)||(n=i,!1)})),n},O=function(e,t){return("array"===K(e)||"string"===K(e))&&e.indexOf(t)>=0},E=u,T=function(e){return c(e)?"":"".concat(e)},C=function(e,t){return"string"==typeof e?e.split(t):e},x=function(e){if(d(e)){var t=C(e,"");return"".concat(I(t).toLowerCase()).concat(b(t).join(""))}return e},k=function(e,t){return!!d(e)&&e.slice(0,t.length)===t},L=function(e,t){if(d(e)){var n=e.length,i=n;i>n&&(i=n);var r=i;return(i-=t.length)>=0&&e.slice(i,r)===t}return!1},A={}.hasOwnProperty,P=function(e,t){return!c(e)&&A.call(e,t)},D=function(e){return h(e)?Object.keys(e):[]},U=function(e,t){D(e).forEach((function(n){return t(e[n],n)}))},q=function(e,t){var n=D(e);return!(!h(e)||!h(t)||n.length!==D(t).length||O(n.map((function(n,i){return h(e[n])?q(e[n],t[n]):e[n]===t[n]})),!1))},B=function(e,t){if(!h(e))return!1;try{return"string"===K(t)?delete e[t]:"array"===K(t)?t.map((function(t){return delete e[t]})):(v(t)&&D(e).forEach((function(n){t.test(n)&&B(e,n)})),!0)}catch(e){return!1}},H=function(e){return m(e)?0===e.length:h(e)?0===D(e).length:!e},K=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},j=Object.freeze({__proto__:null,isNil:c,isString:d,isNumber:l,isNaN:g,isBoolean:f,isObject:h,isRegExp:v,isFunction:p,isArray:m,isDate:w,fixed:function(e,t){return l(e)?Number(e.toFixed(l(t)?t:2)):d(e)&&"NaN"!==T(Number(e))?Number(Number(e).toFixed(l(t)?t:2)):e},head:I,last:y,drop:b,dropWhile:function(e,t){return m(e)?e.filter((function(e){return!t(e)})):e},compact:S,find:_,findIndex:N,includes:O,arrayFrom:E,toString:T,split:C,lowerFirst:x,upperFirst:function(e){if(d(e)){var t=C(e,"");return"".concat(I(t).toUpperCase()).concat(b(t).join(""))}return e},startsWith:k,endsWith:L,has:P,keys:D,forEach:U,isEqual:q,get:function(e,t,n){var i=e;return h(e)?(t.split(".").forEach((function(e){i=i?i[e]:n})),i):n},unset:B,isEmpty:H,typeOf:K,formatDate:function(e){if(w(e)){var t=function(e){return 10>e?"0"+e:e};return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+t(e.getMilliseconds())}return e}}),F=function(e,t){console.log("%c [GrowingIO]：".concat(e),{info:"color: #3B82F6;",error:"color: #EF4444;",warn:"color: #F59E0B;",success:"color: #10B981;"}[t]||"")},R=function(e){try{return e()}catch(e){return}},G=function(e,t){if(p(e))try{e(t)}catch(e){F("回调执行失败！".concat(e),"error")}},V=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n="参数不合法"),F("".concat(t?"调用":"设置"," ").concat(e," 失败，").concat(n,"!"),"warn")},M=function(e){var t={};return h(e)&&U(e,(function(e,n){var i=T(n).slice(0,100);h(e)?t[i]=M(e):m(e)?(t[i]=e.slice(0,100),t[i]=t[i].join("||").slice(0,1e3)):t[i]=c(e)?"":T(e).slice(0,1e3)})),t},W=function(e,t,n,r){void 0===r&&(r={}),document.addEventListener?e.addEventListener(t,n,i(i({},{capture:!0}),r)):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},z=function(e,t){return d(e)&&!H(e)&&e.match(/^[a-zA-Z_][0-9a-zA-Z_]{0,100}$/)?t():(F("事件名格式不正确，只能包含数字、字母和下划线，且不能以数字开头，字符总长度不能超过100!","error"),!1)},J=Object.freeze({__proto__:null,consoleText:F,niceTry:R,niceCallback:G,callError:V,limitObject:M,addListener:W,flattenObject:function(e){void 0===e&&(e={});var t=i({},e);return D(t).forEach((function(e){h(t[e])?(D(t[e]).forEach((function(n){t["".concat(e,"_").concat(n)]=T(t[e][n])})),B(t,e)):m(t[e])?(t[e].forEach((function(n,i){h(n)?D(n).forEach((function(r){t["".concat(e,"_").concat(i,"_").concat(r)]=T(n[r])})):t["".concat(e,"_").concat(i)]=T(n)})),B(t,e)):c(t[e])||""===t[e]?B(t,e):t[e]=T(t[e])})),M(t)},eventNameValidate:z,getGioFunction:function(){var e,t,n,i,r=window._gio_local_vds||"vds",o=null!==(t=null===(e=window[r])||void 0===e?void 0:e.namespace)&&void 0!==t?t:"gdp";return p(window[o])?window[o]:null!==(i=null!==(n=window.gdp)&&void 0!==n?n:window.gio)&&void 0!==i?i:function(){}},hashCode:function(e){var t=0;if(H(e)||"boolean"==typeof e)return t;for(var n=0;n<e.length;)t=(t<<5)-t+e.charCodeAt(n),t&=t,n++;return t}}),X=function(e){return d(e)&&e.length>0||l(e)&&e>0},Q=["web","wxwv","Android","iOS","minp","alip","baidup","qq","bytedance","kuaishoup","jdp","xhsp"],Z={autotrack:{type:"boolean",default:!0},compress:{type:"boolean",default:!0},cookieDomain:{type:"string",default:""},dataCollect:{type:"boolean",default:!0},debug:{type:"boolean",default:!1},embeddedIgnore:{type:"array",default:[]},forceLogin:{type:"boolean",default:!1},idMapping:{type:"boolean",default:!1},enableIdMapping:{type:"boolean",default:!1},gtouchHost:{type:"string",default:""},hashtag:{type:"boolean",default:!1},ignoreFields:{type:"array",default:[]},originalSource:{type:"boolean",default:!0},penetrateHybrid:{type:"boolean",default:!0},performance:{type:"object",default:{monitor:!0,exception:!0}},platform:{type:"string",default:"web"},sendType:{type:"string",default:"beacon"},serverUrl:{type:"string",default:"https://napi.growingio.com"},sessionExpires:{type:"number",default:30},storageType:{type:"string",default:"cookie"},touch:{type:"boolean",default:!1},trackBot:{type:"boolean",default:!0},version:{type:"string",default:"1.0.0"}},Y=["clearGeneralProps","clearTrackTimer","clearUserId","getDeviceId","getOption","getPlugins","identify","init","registerPlugins","removeTimer","sendPage","sendVisit","setGeneralProps","setOption","setUserAttributes","setUserId","track","trackTimerEnd","trackTimerPause","trackTimerResume","trackTimerStart","getABTest"],$={autotrack:"无埋点采集",dataCollect:"数据采集",dataSourceId:"数据源ID",debug:"调试模式",forceLogin:"强制登录",hashtag:"哈希解析",serverUrl:"数据上报服务地址"},ee=["collectImp","enableDebug","enableHT","getVisitorId","send","setAutotrack","setConfig","setDataCollect","setPlatformProfile","setTrackerHost","setTrackerScheme"],te=["screenHeight","screenWidth"],ne=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},ie=function(e){return L(e,"_gioenc")?e.slice(0,-7):e},re=function(e){return g(Number(e))&&R((function(){return JSON.parse(e)}))||e};function oe(e){for(var t=1;arguments.length>t;t++){var n=arguments[t];for(var i in n)e[i]=n[i]}return e}var ae,se=function e(t,n){function i(e,i,r){if("undefined"!=typeof document){"number"==typeof(r=oe({},n,r)).expires&&(r.expires=new Date(Date.now()+864e5*r.expires)),r.expires&&(r.expires=r.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var a in r)r[a]&&(o+="; "+a,!0!==r[a]&&(o+="="+r[a].split(";")[0]));return document.cookie=e+"="+t.write(i,e)+o}}return Object.create({set:i,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var n=document.cookie?document.cookie.split("; "):[],i={},r=0;r<n.length;r++){var o=n[r].split("="),a=o.slice(1).join("=");try{var s=decodeURIComponent(o[0]);if(i[s]=t.read(a,s),e===s)break}catch(e){}}return e?i[e]:i}},remove:function(e,t){i(e,"",oe({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,oe({},this.attributes,t))},withConverter:function(t){return e(oe({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"}),ue={A:1,a:1,Z:1,z:1,"@":1,"{":1},ce=function(e){return c(e)?e:R((function(){return"gioenc-".concat(le(e))}))||e},de=function(e){return d(e)&&k(e,"gioenc-")&&R((function(){return le(e.replace("gioenc-",""))}))||e},le=function(e){return(e=e||"").split("").map((function(e){return ue[e]?e:ge(e)})).join("")},ge=function(e){if(/[0-9]/.test(e))return 1^+e;var t=e.charCodeAt(0);return String.fromCharCode(1^t)},fe=function(e){var t=this;this.domain=e,this.getItem=function(e){return re(de(se.get(ie(e),{domain:t.domain,path:"/"})))},this.setItem=function(e,n,i){var r;r=d(n)?n.length?L(e,"_gioenc")?ce(n):n:"":JSON.stringify(n),se.set(ie(e),r,{expires:i?new Date(i):new Date((new Date).getFullYear()+3,(new Date).getMonth(),(new Date).getDay()),domain:t.domain,path:"/"})},this.removeItem=function(e){se.remove(ie(e),{domain:t.domain,path:"/"})},this.hasItem=function(e){return O(D(se.get()),ie(e))},this.getKeys=function(){return D(se.get())},this.type="Cookie"},he=function(){this.getItem=function(e){var t=R((function(){return JSON.parse(localStorage.getItem(ie(e))||"")}))||{};return h(t)&&t.expiredAt>+Date.now()?re(de(t.value)):void 0},this.setItem=function(e,t,n){var i=null!=n?n:+new Date((new Date).getFullYear()+3,(new Date).getMonth(),(new Date).getDay()).getTime();localStorage.setItem(ie(e),JSON.stringify({value:d(t)&&t.length&&L(e,"_gioenc")?ce(t):t,expiredAt:i}))},this.removeItem=function(e){return localStorage.removeItem(ie(e))},this.hasItem=function(e){return!!localStorage.getItem(ie(e))},this.getKeys=function(){return E(Array(localStorage.length)).map((function(e,t){return localStorage.key(t)}))},this.type="localStorage"},ve={},pe=function(){this.getItem=function(e){var t=R((function(){return JSON.parse(ve[ie(e)]||"")}));return h(t)&&t.expiredAt>+Date.now()?re(de(t.value)):void 0},this.setItem=function(e,t,n){var i=null!=n?n:+new Date((new Date).getFullYear()+3,(new Date).getMonth(),(new Date).getDay()).getTime();ve[ie(e)]=JSON.stringify({value:d(t)&&t.length?ce(t):t,expiredAt:i})},this.removeItem=function(e){return B(ve,ie(e))},this.hasItem=function(e){return P(ve,ie(e))},this.getKeys=function(){return D(ve)},this.type="memory"},me=/^(\.ac\.|\.br\.|\.co\.|\.com\.|\.edu\.|\.gov\.|\.org\.|\.net\.)/,we=function(e){var t=[];try{var n=e.split("."),i=y(n);if(n.length>=2&&(isNaN(Number(i))||0>Number(i)||Number(i)>255)){var r=".".concat(n.slice(-2).join("."));me.test(r)?ae=r:t.push(r);var o=".".concat(n.slice(-3).join("."));me.test(o)||O(t,o)||t.push(o);var a=".".concat(n.slice(-4).join("."));me.test(a)||O(t,a)||t.push(a)}}catch(e){}return t},Ie=function(e){var t="";return e.every((function(e){return!ye(e)||(t=e,!1)})),t},ye=function(e){try{se.set("gioCookie","yes",{domain:e});var t=!!se.get("gioCookie",{domain:e});return se.remove("gioCookie",{domain:e}),t}catch(e){return!1}},be=function(e){var t,n,i,o=e.storageType,a=e.cookieDomain,s=e.projectId;if(O(["cookie","localstorage"],o)||(o="cookie"),"cookie"===o&&(n=!!(i=navigator.userAgent.indexOf("Electron")>-1||O(["","localhost","127.0.0.1"],window.location.hostname)||!O(["http:","https:"],window.location.protocol)?"":Ie(r(r([],we(window.location.hostname),!0),[window.location.hostname],!1)))),"cookie"===o&&n){var u=new fe(i);if(a){var c=we(a),d=Ie(H(c)?[]:r([a],we(a),!0));d&&ye(d)?u.domain=d:F("指定Cookie域无效或无权限，使用默认域！","warn")}t=u}else t=function(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(e){return!1}}()?new he:new pe;return"cookie"===o&&ae&&ye(ae)&&function(e,t,n){if(t&&ye(t)){var i=new fe(t);["".concat(n,"_gdp_session_id"),"gdp_user_id_gioenc","".concat(n,"_gdp_cs1_gioenc"),"".concat(n,"_gdp_user_key_gioenc"),"".concat(n,"_gdp_gio_id_gioenc"),"".concat(n,"_gdp_sequence_ids"),"".concat(n,"_gdp_session_id_sent")].forEach((function(t){var n=i.getItem(t);i.hasItem(t)&&(e.setItem(t,n),i.removeItem(t))})),i=void 0}}(t,ae,s),t},Se="OPTION_INITIALIZED",_e="SDK_INITIALIZED",Ne="SDK_INITIALIZED_COMPLATE",Oe="SESSIONID_UPDATE",Ee="SET_USERID",Te="SET_USERKEY",Ce=function(e){var t=this;this.growingIO=e,this.main=function(){var e,n,r=t.growingIO,o=r.sdkVersion,a=r.useEmbeddedInherit,s=r.vdsConfig,u=r.userStore,c=r.dataStore,d=r.trackingId,l=c.currentPage,g=l.path,f=l.query,h={appVersion:s.version,dataSourceId:s.dataSourceId,deviceId:u.uid,domain:a?s.appId:window.location.host,language:navigator.language,path:g,platform:s.platform,query:f,referralPage:(null===(e=c.lastPageEvent)||void 0===e?void 0:e.referralPage)||"",screenHeight:window.screen.height,screenWidth:window.screen.width,sdkVersion:o,sessionId:u.sessionId,timestamp:+Date.now(),timezoneOffset:(new Date).getTimezoneOffset(),title:null!==(n=R((function(){return document.title.slice(0,255)})))&&void 0!==n?n:"",userId:u.userId};if(s.idMapping&&(h.userKey=u.userKey),H(s.ignoreFields)||s.ignoreFields.forEach((function(e){B(h,e)})),a&&!H(t.minpExtraParams)){var v=i({},h);U(i(i({},h),t.minpExtraParams),(function(e,n){var i;O(s.embeddedIgnore,n)?(h[n]=v[n],"domain"===n&&(h[n]=window.location.host)):h[n]=null!==(i=t.minpExtraParams[n])&&void 0!==i?i:h[n]}))}return h.trackingId=d,h},this.minpExtraParams={}},xe=function(e){var t=this;this.growingIO=e,this.parsePage=function(){var e=t.growingIO.vdsConfig.hashtag,n=location.pathname,i=location.search,r=location.hash,o=r.indexOf("?");t.domain=window.location.host,t.title=document.title.slice(0,255),t.time=+Date.now(),t.path=n,t.query=i,e&&(o>-1?(t.path+=r.slice(0,o),t.query=t.query+"&"+r.slice(o+1)):t.path+=r),t.query&&O(["?","&"],t.query.charAt(0))&&(t.query=t.query.slice(1))},this._getNoHashHref=function(){var e=window.location,t=e.protocol,n=e.host,i=e.pathname,r=e.search;return"".concat(t,"://").concat(n).concat(i).concat(r)},this.getReferralPage=function(){var e,n,i=t.growingIO.dataStore.lastPageEvent;return(null==i?void 0:i.path)===t.path&&(null!==(e=null==i?void 0:i.query)&&void 0!==e?e:"")===(null!==(n=t.query)&&void 0!==n?n:"")?null==i?void 0:i.referralPage:(null==i?void 0:i.path)?t.lastHref:document.referrer},this.pageListener=function(){var e=t.growingIO.vdsConfig.hashtag,n=window.location.href,i=t.lastHref;e||(n=t._getNoHashHref(),i=t.lastNoHashHref),i!==n&&(t.parsePage(),t.buildPageEvent())},this.hookHistory=function(){var e=window.history.pushState,n=window.history.replaceState,i=t;e&&R((function(){return window.history.pushState=function(){e.apply(window.history,arguments),setTimeout(i.pageListener)}})),n&&R((function(){return window.history.replaceState=function(){n.apply(window.history,arguments),setTimeout(i.pageListener)}})),W(window,"popstate",t.pageListener),t.growingIO.vdsConfig.hashtag&&W(window,"hashchange",t.pageListener)},this.buildPageEvent=function(e){var n=t.growingIO.dataStore;n.lastPageEvent;var r=n.eventContextBuilder,o=n.eventConverter,a=i(i({eventType:"PAGE"},r()),{protocolType:location.protocol.substring(0,location.protocol.length-1),referralPage:t.getReferralPage()});H(e)||(a=i(i({},a),e)),a.timestamp=t.time,o(a),t.lastHref=window.location.href,t.lastNoHashHref=t._getNoHashHref(),t.lastLocation=i({},window.location)},this.title=document.title.slice(0,255),this.lastLocation=i({},window.location)},ke=function(){function e(e){var t,n=this;this.growingIO=e,this.ALLOW_SETTING=i({},Z),this.allowOptKeys=Object.keys(this.ALLOW_SETTING),this.trackTimers={},this.setSequenceIds=function(e){var t=n.growingIO.storage.getItem(n.seqStorageIdName)||{};t.globalKey=e,n.growingIO.storage.setItem(n.seqStorageIdName,t)},this.initOptions=function(e){var t,r,o,a,s,u,c,d=e.projectId,l=e.dataSourceId,f=e.appId;n.initialDataSourceId=l;var h={};n.allowOptKeys.forEach((function(t){var i=n.ALLOW_SETTING[t].type,r=m(i)?!O(i,K(e[t])):K(e[t])!==i;"platform"!==t||O(Q,e[t])||(r=!0),r?h[t]=n.ALLOW_SETTING[t].default:"ignoreFields"===t?h.ignoreFields=e.ignoreFields.filter((function(e){return O(te,e)})):(h[t]=e[t],O(["dataCollect","autotrack"],t)&&(h[t]||F("已关闭".concat($[t]),"info")))})),h.sessionExpires=Math.round(h.sessionExpires),(g(h.sessionExpires)||1>h.sessionExpires||h.sessionExpires>360)&&(h.sessionExpires=30),h.storageType=h.storageType.toLowerCase(),h.enableIdMapping&&!h.idMapping&&(h.idMapping=!0),h.sendType=h.sendType.toLowerCase(),O(["beacon","xhr"],h.sendType)||(h.sendType="beacon"),!h.trackBot&&/bot|crawler|spider|scrapy|jiankongbao|slurp|transcoder|networkbench/i.test(navigator.userAgent.toLowerCase())&&(h.dataCollect=!1),n.growingIO.vdsConfig=i(i(i({},null!==(t=window[n.growingIO.vds])&&void 0!==t?t:{}),h),{projectId:d,dataSourceId:l,appId:f,performance:{monitor:null===(o=null===(r=h.performance)||void 0===r?void 0:r.monitor)||void 0===o||o,exception:null===(s=null===(a=h.performance)||void 0===a?void 0:a.exception)||void 0===s||s,network:null!==(c=null===(u=h.performance)||void 0===u?void 0:u.network)&&void 0!==c&&c}}),window[n.growingIO.vds]=n.growingIO.vdsConfig,n.seqStorageIdName="".concat(d,"_gdp_sequence_ids"),n.visitStorageName="".concat(d,"_gdp_session_id_sent")},this.setOriginalSource=function(){var e=n.growingIO,t=e.storage,i=e.userStore,r=t.getItem(n.visitStorageName);if(i.sessionId!==r&&c(n.getOriginalSource())){var o=n.currentPage,a=o.path,s=o.query,u=o.getReferralPage,d={path:a,query:s,referralPage:document.referrer||u()};localStorage.setItem(n.originalSourceName,JSON.stringify(d))}},this.getOriginalSource=function(){return R((function(){return JSON.parse(localStorage.getItem(n.originalSourceName))}))},this.setOption=function(e,t){var r,o=n.growingIO,a=o.vdsConfig,s=o.uploader,u=o.emitter,c=o.userStore,l=o.vds,g=d(e)&&O(D($),e),f=g&&typeof t===((null===(r=n.ALLOW_SETTING[e])||void 0===r?void 0:r.type)||"string"),h=i({},a);return g&&f?(a[e]=t,"dataCollect"===e&&h.dataCollect!==t&&(t?c.sessionId=ne():n.growingIO.clearTrackTimer()),"serverUrl"===e&&(null==s||s.generateHost()),null==u||u.emit("OPTION_CHANGE",{optionName:e,optionValue:t}),window[l][e]=t,!0):(V("setOption > ".concat(e)),!1)},this.getOption=function(e){var t=n.growingIO.vdsConfig;return e&&P(t,T(e))?t[T(e)]:c(e)?i({},t):void V("getOption > ".concat(e))},this.sendVisit=function(e){var t=n.growingIO,i=t.userStore.sessionId,r=t.storage.getItem(n.visitStorageName);!e&&i===r||n.buildVisitEvent()},this.buildVisitEvent=function(e){var t=n.growingIO,r=t.dataStore,o=r.eventContextBuilder,a=r.eventConverter,s=r.currentPage,u=t.emitter,d=t.storage,g=t.vdsConfig,f=n.getOriginalSource(),h=i(i({eventType:"VISIT"},o()),{referralPage:document.referrer||n.currentPage.getReferralPage(),timestamp:s.time-1});g.originalSource&&!c(f)&&(h=i(i({},h),f)),H(e)||U(h,(function(t,n){P(e,n)&&(l(e[n])?h[n]=e[n]:H(e[n])||(h[n]=e[n]||h[n]))}));var v=function(e){var t=e.requestData;"VISIT"===t.eventType&&t.trackingId===n.growingIO.trackingId&&(d.setItem(n.visitStorageName,t.sessionId),localStorage.removeItem(n.originalSourceName),u.off("onSendAfter",v))};u.on("onSendAfter",v),a(h)},this.sendPage=function(e){e&&n.currentPage.parsePage(),n.currentPage.buildPageEvent()},this.buildErrorEvent=function(e){var t=n.growingIO.dataStore,r=t.eventContextBuilder;(0,t.eventConverter)(i({eventType:"CUSTOM",eventName:"onError",attributes:e},r()))},this.eventConverter=function(e){var t,r=n.growingIO,o=r.vdsConfig,a=r.dataStore,s=r.uploader;if(o.dataCollect){"LOGIN_USER_ATTRIBUTES"===e.eventType?B(e,"timezoneOffset"):e.trackingId===n.growingIO.trackingId&&(e.eventSequenceId=a.gsid);var u={};U(e,(function(e,t){var n;if("element"===t){var i=null!==(n=I(e))&&void 0!==n?n:{};U(i,(function(e,t){H(e)&&0!==e||(u[t]=e)}))}else(H(e)||c(e))&&0!==e||(u[t]=e)})),e.trackingId===n.growingIO.trackingId&&(n.growingIO.dataStore.gsid+=1),null===(t=n.growingIO.emitter)||void 0===t||t.emit("onComposeAfter",{composedEvent:i({},u)}),e.trackingId===n.growingIO.trackingId&&s.commitRequest(i(i({},u),{requestId:ne()}))}},this.currentPage=new xe(this.growingIO),this.eventContextBuilderInst=new Ce(this.growingIO),this.eventContextBuilder=null===(t=this.eventContextBuilderInst)||void 0===t?void 0:t.main,this.generalProps={},this.lastPageEvent={},this.originalSourceName="gdp_original_source";var r=this.growingIO.emitter;null==r||r.on("onComposeAfter",(function(e){var t=e.composedEvent;"PAGE"!==t.eventType&&"page"!==t.t||t.trackingId!==n.growingIO.trackingId||(n.lastPageEvent=t)})),r.on(Ne,(function(){null==r||r.on(Oe,(function(){n.growingIO.uploader.hoardingQueue=[],n.currentPage.parsePage(),n.sendVisit(!0),n.sendPage(!0)}))}))}return Object.defineProperty(e.prototype,"gsid",{get:function(){var e=this.growingIO.storage.getItem(this.seqStorageIdName)||{},t=Number(e.globalKey);return this._gsid=g(t)||t>=1e9||1>t?1:t,this._gsid},set:function(e){g(Number(e))||e>=1e9||1>e?this._gsid=1:this._gsid=e,this.setSequenceIds(this._gsid)},enumerable:!1,configurable:!0}),e}(),Le={name:"gioCompress",method:function(e){var t=this;this.growingIO=e,this._compress=function(e,t,n){if(null===e)return"";var i,r,o,a={},s={},u="",c="",d="",l=2,g=3,f=2,h=[],v=0,p=0;for(o=0;o<e.length;o+=1)if(u=e.charAt(o),{}.hasOwnProperty.call(a,u)||(a[u]=g++,s[u]=!0),c=d+u,{}.hasOwnProperty.call(a,c))d=c;else{if({}.hasOwnProperty.call(s,d)){if(256>d.charCodeAt(0)){for(i=0;f>i;i++)v<<=1,p===t-1?(p=0,h.push(n(v)),v=0):p++;for(r=d.charCodeAt(0),i=0;8>i;i++)v=v<<1|1&r,p===t-1?(p=0,h.push(n(v)),v=0):p++,r>>=1}else{for(r=1,i=0;f>i;i++)v=v<<1|r,p===t-1?(p=0,h.push(n(v)),v=0):p++,r=0;for(r=d.charCodeAt(0),i=0;16>i;i++)v=v<<1|1&r,p===t-1?(p=0,h.push(n(v)),v=0):p++,r>>=1}0==--l&&(l=Math.pow(2,f),f++),delete s[d]}else for(r=a[d],i=0;f>i;i++)v=v<<1|1&r,p===t-1?(p=0,h.push(n(v)),v=0):p++,r>>=1;0==--l&&(l=Math.pow(2,f),f++),a[c]=g++,d=u+""}if(""!==d){if({}.hasOwnProperty.call(s,d)){if(256>d.charCodeAt(0)){for(i=0;f>i;i++)v<<=1,p===t-1?(p=0,h.push(n(v)),v=0):p++;for(r=d.charCodeAt(0),i=0;8>i;i++)v=v<<1|1&r,p===t-1?(p=0,h.push(n(v)),v=0):p++,r>>=1}else{for(r=1,i=0;f>i;i++)v=v<<1|r,p===t-1?(p=0,h.push(n(v)),v=0):p++,r=0;for(r=d.charCodeAt(0),i=0;16>i;i++)v=v<<1|1&r,p===t-1?(p=0,h.push(n(v)),v=0):p++,r>>=1}0==--l&&(l=Math.pow(2,f),f++),delete s[d]}else for(r=a[d],i=0;f>i;i++)v=v<<1|1&r,p===t-1?(p=0,h.push(n(v)),v=0):p++,r>>=1;0==--l&&(l=Math.pow(2,f),f++)}for(r=2,i=0;f>i;i++)v=v<<1|1&r,p===t-1?(p=0,h.push(n(v)),v=0):p++,r>>=1;for(;;){if(v<<=1,p===t-1){h.push(n(v));break}p++}return h.join("")},this.compress=function(e){var n=t;return t._compress(e,16,(function(e){return n.f(e)}))},this.compressToUTF16=function(e){var n=t;return null===e?"":t._compress(e,15,(function(e){return n.f(e+32)}))+" "},this.compressToUint8Array=function(e){for(var n=t.compress(e),i=new Uint8Array(2*n.length),r=0,o=n.length;o>r;r++){var a=n.charCodeAt(r);i[2*r]=a>>>8,i[2*r+1]=a%256}return i},this.compressToEncodedURIComponent=function(e){if(null===e)return"";var n=t;return t._compress(e,6,(function(e){return n.keyStrUriSafe.charAt(e)}))},this.f=String.fromCharCode,this.keyStrUriSafe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"}},Ae={name:"gioCustomTracking",method:function(e){var t=this;this.growingIO=e,this.getDynamicAttributes=function(e){return c(e)||D(e).forEach((function(t){p(e[t])?e[t]=e[t]():h(e[t])?B(e,t):m(e[t])||(e[t]=T(e[t]))})),e},this.buildCustomEvent=function(e,n,r){z(e,(function(){var o=t.growingIO.dataStore,a=o.eventContextBuilder,s=o.eventConverter,u=i({eventType:"CUSTOM",eventName:e,attributes:M(t.getDynamicAttributes(h(n)&&!H(n)?n:void 0))},a());H(r)||(u=i(i({},u),r)),s(u)}))},this.buildUserAttributesEvent=function(e,n){var r=t.growingIO.dataStore,o=r.eventContextBuilder,a=r.eventConverter,s=i({eventType:"LOGIN_USER_ATTRIBUTES",attributes:M(e)},o());H(n)||(s=i(i({},s),n)),a(s)}}},Pe={},De={}.hasOwnProperty;function Ue(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function qe(e){try{return encodeURIComponent(e)}catch(e){return null}}Pe.stringify=function(e,t){t=t||"";var n,i,r=[];for(i in"string"!=typeof t&&(t="?"),e)if(De.call(e,i)){if((n=e[i])||null!=n&&!isNaN(n)||(n=""),i=qe(i),n=qe(n),null===i||null===n)continue;r.push(i+"="+n)}return r.length?t+r.join("&"):""},Pe.parse=function(e){for(var t,n=/([^=?#&]+)=?([^&]*)/g,i={};t=n.exec(e);){var r=Ue(t[1]),o=Ue(t[2]);null===r||null===o||r in i||(i[r]=o)}return i};var Be={gioprojectid:"projectId",giodatacollect:"dataCollect",gioappid:"domain",giodatasourceid:"dataSourceId",gios:"sessionId",giou:"uid",giocs1:"userId",giouserkey:"userKey",gioappchannel:"appChannel",giodevicebrand:"deviceBrand",giodevicemodel:"deviceModel",giodevicetype:"deviceType",giolanguage:"language",gionetworkstate:"networkState",giooperatingsystem:"operatingSystem",gioplatform:"platform",gioplatformversion:"platformVersion",gioscreenheight:"screenHeight",gioscreenwidth:"screenWidth"},He=["giodatasourceid","gioplatform","gioappchannel","giodevicebrand","giodevicemodel","giodevicetype","giolanguage","gionetworkstate","giooperatingsystem","gioplatformversion","gioscreenheight","gioscreenwidth"],Ke=["giocs1","gios","giou","giouserkey"],je="gio_search_cookie_gioenc",Fe={name:"gioEmbeddedAdapter",method:function(e){var t=this;this.growingIO=e,this.main=function(){var e,n=t.growingIO.vdsConfig,i=n.projectId,r=n.appId,o=t.getGQS(),a=!1;return"none"!==t.qsFrom&&o.gioprojectid===i&&o.gioappid===r&&(H(o)?t.growingIO.storage.removeItem(je):t.growingIO.storage.setItem(je,Pe.stringify(o)),P(o,"giodatacollect")&&(t.growingIO.vdsConfig.dataCollect=O(["true",!0],o.giodatacollect)),null===(e=t.growingIO.emitter)||void 0===e||e.on("SDK_INITIALIZED",(function(){var e=t.growingIO,n=e.userStore,i=e.vdsConfig.sessionExpires,r=e.dataStore.eventContextBuilderInst;Ke.forEach((function(e){var t;n[Be[e]]=null!==(t=o[e])&&void 0!==t?t:""})),window.setInterval((function(){n.sessionId=o.gios}),.8*i*60*1e3),He.forEach((function(e){P(o,e)&&(r.minpExtraParams[Be[e]]=o[e])}))})),t.growingIO.setUserId=function(){},t.growingIO.clearUserId=function(){},P(o,"giodatacollect")&&(t.growingIO.setOption=function(){}),a=!0),t.gioURLRewrite(),a},this.getGQS=function(){var e=t.growingIO.vdsConfig.hashtag,n=t.growingIO.storage.getItem(je),i=window.location.search,o=window.location.hash,a=e?o.substring(o.indexOf("?")+1):"",s=Pe.parse(i),u=Pe.parse(a),c=Pe.parse((n||"").replace("gioenc-","")),d={};if(P(s,"gioprojectid"))d=s,t.qsFrom="search";else if(P(u,"gioprojectid"))d=u,t.qsFrom="hash";else{if(!P(c,"gioprojectid"))return t.qsFrom="none",{};d=c,t.qsFrom="cookie"}var l={},g={},f=r(r(["gioappid","gioprojectid","giodatacollect"],Ke,!0),He,!0);return D(d).forEach((function(e){var t=e.toLowerCase();O(f,t)?O(["","undefined","null",void 0,null],d[e])||(l[t]=d[e],O(["true","TRUE",!0],d[e])&&(l[t]=!0),O(["false","FALSE",!1],d[e])&&(l[t]=!1)):g[e]=d[e]})),t.gqs=l,t.ngqs=g,l},this.gioURLRewrite=function(){var e=t.growingIO.vdsConfig.hashtag,n=window.location.search,i=window.location.hash,r=!1;if("search"===t.qsFrom&&(n=Pe.stringify(t.ngqs,!0),r=!0),e&&"hash"===t.qsFrom&&(i="".concat(i.split("?")[0]).concat(Pe.stringify(t.ngqs,!0)),r=!0),r){var o="".concat(window.location.pathname).concat(n||"").concat(i||"");window.history.replaceState(null,document.title,o)}},this.gqs={},this.ngqs={},this.qsFrom="search",this.growingIO.emitter.on(Se,(function(){t.growingIO.useEmbeddedInherit=t.main()}))}},Re=function(){return Re=Object.assign||function(e){for(var t,n=1,i=arguments.length;i>n;n++)for(var r in t=arguments[n])({}).hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Re.apply(this,arguments)};function Ge(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;o>r;r++)!i&&r in t||(i||(i=[].slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||[].slice.call(t))}var Ve,Me,We,ze,Je=function(e){try{return e()}catch(e){return}},Xe=function(e){return"number"===rt(e)},Qe=function(e){return"object"===rt(e)&&!function(e){return $e(["undefined","null"],rt(e))}(e)},Ze=function(e){return Array.isArray(e)&&"array"===rt(e)},Ye=function(e,t){if(Ze(e))for(var n=0;n<e.length;n++)if(t(e[n]))return n;return-1},$e=function(e,t){return("array"===rt(e)||"string"===rt(e))&&e.indexOf(t)>=0},et=u,tt=function(e){return Qe(e)?Object.keys(e):[]},nt=function(e){return Ze(e)?0===e.length:Qe(e)?0===tt(e).length:!e},it=function(e){if(Ze(e)){for(var t=0,n=[],i=0,r=e;i<r.length;i++){var o=r[i];o&&!nt(o)&&(n[t++]=o)}return n}return e},rt=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},ot=["body","br","canvas","clippath","defs","desc","g","hr","html","iframe","math","param","path","rect","script","style","text","title","tspan","use"],at=["button","reset","submit"],st=Ge(Ge([],at,!0),["file"],!1),ut=["checkbox","color","radio","range"],ct=Ge(Ge([],ut,!0),["date","datetime-local","month","number","password","text","time","week"],!1),dt=["tr","li","dt","dd"],lt=Ge(["a","button","dl"],dt,!0),gt=["i","em","svg","img"],ft=["i","span","em","b","strong","bdo"],ht=/(^| |[^ ]+\-)(clear|clearfix|active|hover|enabled|current|selected|unselected|hidden|display|focus|disabled|undisabled|open|checked|unchecked|undefined|null|ng-|growing-)[^\. ]*/g,vt=/^([a-zA-Z\-\_0-9]+)$/,pt="data-growing-ignore",mt="data-growing-container",wt="data-growing-index",It="data-growing-title",yt=function(e,t){var n;return null!==(n=Je((function(){return e.hasAttribute(t)&&"false"!==e.getAttribute(t)})))&&void 0!==n?n:Je((function(){return e.hasOwnPerporty(t)}))},bt=function(e,t){var n;return null!==(n=Je((function(){return e.getAttribute(t)})))&&void 0!==n?n:Je((function(){return e.attributes[t].value}))},St=function(e){var t,n=!$e(ot,e.tagName.toLowerCase()),i=Et(e);return n&&i&&$e(ft,null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())?St(i):e},_t=function(e,t,n){if(void 0===t&&(t=5),void 0===n&&(n=0),!e.children)return!1;if("svg"===e.tagName.toLocaleLowerCase())return n>t;if(n>t)return!0;for(var i=0;i<e.children.length;i++){var r=e.children[i];if(_t(r,t,n+1))return!0}return!1},Nt=function(e,t){var n=e.tagName.toLowerCase();if(!(e instanceof Element))return!1;if(yt(e,pt))return!1;if($e(ot,n))return!1;if($e(["circleClick","circleHover","click"],t)){if("textarea"===n&&"click"===t)return!1;if("input"===n){if("click"===t&&!$e(st,bt(e,"type")))return!1;if($e(["circleClick","circleHover"],t)&&!$e(Ge(Ge([],st,!0),ct,!0),bt(e,"type")))return!1}if(!Ct(e)&&_t(e,5))return!1}return!0},Ot=function(e,t){return void 0===t&&(t=!1),et((null==e?void 0:e.childNodes)||[]).filter((function(e){return $e(t?[Node.ELEMENT_NODE,Node.TEXT_NODE]:[Node.ELEMENT_NODE],e.nodeType)}))},Et=function(e){return Tt(e.parentElement)?null:e.parentElement},Tt=function(e){return!e||$e(["BODY","HTML","#document"],e.tagName)},Ct=function(e){return yt(e,mt)||$e(lt,e.tagName.toLowerCase())||"input"===e.tagName.toLowerCase()&&$e(at,e.type)},xt=function(e){var t=Ot(e);return!nt(t)&&t.every((function(e){var t=Lt(e),n=$e(e.classList,"icon");return!(!t&&!n||kt(e))}))},kt=function(e){var t=Ot(e,!0);return!nt(t)&&t.every((function(e){var t=e.nodeType===Node.TEXT_NODE,n=At(e);return!(!t||!n)}))},Lt=function(e){return $e(gt,e.tagName.toLocaleLowerCase())},At=function(e){var t=Ot(e,!0).filter((function(e){var t;return e.nodeType===Node.TEXT_NODE||$e(ft,null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())})).map((function(e){return Pt(e.textContent,e.textContent.length)}));return Pt(it(t).join(" "))},Pt=function(e,t){return void 0===t&&(t=50),e&&(null==(e=e.replace(/[\n \t]+/g," ").trim())?void 0:e.length)?e.slice(0,Xe(t)&&t>0?t:void 0):""},Dt=/[^/]*.(bmp|jpg|jpeg|png|gif|svg|psd|webp|apng)/gi,Ut=function(e,t){switch(t){case"a":return function(e){if(yt(e,"href")){var t=bt(e,"href");if(t&&0!==t.indexOf("javascript"))return t.slice(0,320)}return""}(e);case"img":return function(e){var t=e.src;if(t&&-1===t.indexOf("data:image")){var n=t.match(Dt),i=nt(n)?"":n[0];if(i.indexOf("%")>-1){var r=function(e,t){var n=-1;if(Ze(e))for(var i=0;i<e.length;i++)"%"===e[i]&&(n=i);return n}(i.split(""));i=i.substring(r+3,i.length)}return i}return""}(e);default:return""}},qt={a:function(e){return At(e)||Kt(e)||Ut(e,"a")},button:function(e){return bt(e,"name")||At(e)||Kt(e)||jt(e)},img:function(e){return Pt(bt(e,"alt"))||Ut(e,"img")},input:function(e){if("password"===e.type)return"";var t,n,i=e instanceof HTMLInputElement&&$e(st,e.type),r=yt(e,"data-growing-track");if(i||r)return Pt(e.value);if(e instanceof HTMLInputElement&&$e(ut,e.type)){var o=void 0;return e.id&&(n=function(t){return t.htmlFor===e.id},o=(t=et(document.getElementsByTagName("label")))[Ye(t,n)]),o||(o=Ht(e,(function(e){return"label"===e.tagName.toLowerCase()}))),Ft(e,o?At(o):Pt(e.value))}return""},label:function(e){return At(e)||Kt(e)||jt(e)},select:function(e){return Pt(et(e.options).filter((function(e){return e.selected})).map((function(e){return e.label})).join(", ")||e.value)},svg:function(e){var t;return Ot(e).some((function(e){var n;if(e.nodeType===Node.ELEMENT_NODE&&"use"===(null===(n=e.tagName)||void 0===n?void 0:n.toLowerCase())&&e.hasAttribute("xlink:href"))return t=e,!0})),t?t.getAttribute("xlink:href"):""},textarea:function(){return""},form:function(){return""}},Bt=function(e,t){if(yt(e,It)&&bt(e,It))return Pt(bt(e,It));if(yt(e,"title")&&bt(e,"title"))return Pt(bt(e,"title"));var n=qt[t];if(n)return n(e);var i=At(e);return i?Pt(i):function(e){if("svg"===e.tagName)return!1;var t=Ot(e);return t.length>0&&t.every((function(e){return function(e){if("svg"===e.tagName)return!0;var t=Ot(e);if(nt(t))return!0;var n=kt(e);return!(!nt(t)&&!n)}(e)}))}(e)&&!xt(e)?Pt(Kt(e)):xt(e)?Pt(jt(e)):""},Ht=function(e,t){for(var n=e.parentElement;n&&!Tt(n);){if(t(n))return n;n=n.parentElement}},Kt=function(e){var t=Ot(e);return it(t.map((function(e){var t=At(e);if(kt(e)&&t)return t}))).join(" ")},jt=function(e){var t;return Ot(e).some((function(e){var n,i=Bt(e,null===(n=e.tagName)||void 0===n?void 0:n.toLowerCase());return!!i&&(t=i,!0)})),t},Ft=function(e,t){return $e(["checkbox","radio"],e.type)?"".concat(t).concat((n=e.checked,"boolean"===rt(n)?"("+e.checked+")":"")):t;var n},Rt=function e(t,n,i,r,o){void 0===r&&(r=!0),void 0===o&&(o=[]);var a,s=this;this.originNode=t,this.deviceInfo=n,this.actionType=i,this.trackable=r,this.parentNodes=o,this.isLimitViewport=!0,this._getIndex=function(){if(yt(s.originNode,wt)){var e=bt(s.originNode,wt);return/^\d{1,10}$/.test(e)&&e-0>0&&2147483647>e-0?+e:void(0>s.actionType.indexOf("circle")&&(u="".concat(e,"，index标记应为 大于 0 且小于 2147483647 的整数！"),console.log("%c [GrowingIO]：".concat(u),"color: #F59E0B;")))}if($e(["dd","dt"],s.tagName)){var t=Et(s.originNode),n=t?Ot(t):[];if("dl"===t.tagName.toLowerCase()&&n.length>0){if("dd"===s.tagName){var i=Ye(n,(function(e){return e.isSameNode(s.originNode)}));if(i>-1)return(r=n.slice(0,i).filter((function(e){return"dt"===e.tagName.toLowerCase()}))).length-1+1}if("dt"===s.tagName){var r=n.filter((function(e){return"dt"===e.tagName.toLowerCase()}));return Ye(r,(function(e){return e.isSameNode(s.originNode)}))+1}}}if(s.isPureList){var o=Ye(s._pureList,(function(e){return e.isSameNode(s.originNode)}));return o>-1?(s.peerNodes=Ge([],s._pureList,!0),s.peerNodes.splice(o,1),o+1):void 0}if(s.isPseudoList){var a=Ye(s._pseudoList,(function(e){return e.isSameNode(s.originNode)}));return a>-1?(s.peerNodes=Ge([],s._pseudoList,!0),s.peerNodes.splice(a,1),a+1):void 0}var u},this._getSiblingNode=function(e,t){var n,i=Et(e);if(!i)return[];for(var r=null!==(n=Je((function(){return et(i.children)})))&&void 0!==n?n:[],o=[],a=0;a<r.length;a++){var s=r[a],u=r[a+1];if(!u||!t(s,u))break;nt(o)?o.push(s,u):o.push(u)}return o},this._getIsPureList=function(){var e=s._getSiblingNode(s.originNode,(function(e,t){return e.tagName===t.tagName}));return!(1>e.length||!$e(dt,s.tagName)||(s._pureList=e,0))},this._getIsInPseudoList=function(){if($e(["th","td"],s.tagName))return!1;var e=s._getSiblingNode(s.originNode,(function(e,t){var n=e.tagName===t.tagName&&e.className===t.className,i=Ot(e),r=Ot(t),o=i.every((function(e,t){var n,i;return(null==e?void 0:e.tagName)===(null===(n=r[t])||void 0===n?void 0:n.tagName)&&(null==e?void 0:e.className)===(null===(i=r[t])||void 0===i?void 0:i.className)})),a=i.length===r.length&&o;return n&&a}));return e.length>=3&&(s._pseudoList=e,!0)},this._getClassList=function(e){var t;if(yt(e,"name")&&bt(e,"name"))return[bt(e,"name")];var n=(null!==(t=bt(e,"class"))&&void 0!==t?t:"").trim().split(" ");return nt(n)?[]:n.filter((function(e){return e&&!ht.test(e)&&vt.test(e)})).sort()},this._getCurrentXpath=function(){return"/".concat(s.tagName).concat(s.id?"#"+s.id:"").concat(nt(s.classList)?"":"."+s.classList.join("."))},this._getIsContainer=function(){return yt(s.originNode,mt)||$e(lt,s.tagName)||"input"===s.tagName&&$e(at,s.originNode.type)},this._getContent=function(){s.content=Bt(s.originNode,s.tagName)},this._getIsOutFlow=function(){var e=window.getComputedStyle(s.originNode).position;return $e(["fixed","sticky"],e)},this._getRect=function(){var e=s.originNode.getBoundingClientRect(),t=e.top,n=e.bottom,i=e.left,r=e.right-i,o=n-t,a=s.deviceInfo,u=a.winHeight,c=a.winWidth;return t+o>u&&(o=u-t),i+r>c&&(r=c-i),{top:t,left:i,width:r,height:o}},this._getListItemViewStatus=function(){var e=s.parentNodes.find((function(e){var t=e.originNode,n=t.scrollHeight,i=t.scrollWidth,r=t.clientHeight,o=t.clientWidth,a=e.rect,s=a.width,u=a.height;return r!==n&&n>u||o!==i&&i>s}));if(e){var t=e.rect,n=t.top,i=t.left,r=t.width,o=t.height,a=s.rect,u=a.top,c=a.left,d=a.width,l=a.height;return n>u+l||c>i+r||u>n+o||i>c+d?"OUTSIDE":u>=n&&c>=i&&n+o>u+l&&i+r>c+d?"DISPLAYED":"OBSCURED"}return""},this._getViewStatus=function(e){var t=window.getComputedStyle(s.originNode),n=t.opacity,i=t.visibility,r=t.display,o=t.width,a=t.height,u=s.rect,c=u.top,d=u.left,l=u.width,g=u.height,f=s.deviceInfo,h=f.winWidth,v=f.winHeight;if(0===Number(n)||"hidden"===i||"none"===r||"0px"===o||0===s.originNode.clientWidth||"0px"===a||0===s.originNode.clientHeight)return"HIDDEN";var p=Ge([],e,!0).find((function(e){return e.trackable&&$e(["DISPLAYED","OBSCURED"],e.viewStatus)}));if(s.isPureList||s.isPseudoList){var m=s._getListItemViewStatus();if(m)return m}if(p)return p.viewStatus;var w=function(e,t){return document.elementFromPoint(e,t)===s.originNode};return v>c&&h>d&&l>0&&g>0?w(d+l/2,c+g/2)||w(d+1,c+1)||w(d+l-1,c+1)||w(d+1,c+g-1)||w(d+l-1,c+g-1)?"DISPLAYED":s.isLimitViewport&&(0>c+g||0>d+l)?"OUTSIDE":"OBSCURED":"OUTSIDE"},this._getTriggerEvent=function(){return"input"===s.tagName&&$e(ct,s.originNode.type)||$e(["select","textarea"],s.tagName)?"VIEW_CHANGE":"VIEW_CLICK"},this._getXParents=function(t,n){var i=t.parentElement,r=[];if(n.length>0)r.push.apply(r,n);else if(i&&!Tt(i)){var o=new e(i,void 0,s.actionType,Nt(i,s.actionType));r.push(o),o.xParents&&r.push.apply(r,o.xParents)}return r},this.tagName=t.tagName.toLocaleLowerCase(),this.classList=this._getClassList(t),this.id=t.id,this.currentXpath=this._getCurrentXpath(),this.isIgnored=yt(this.originNode,pt),this.isContainer=this._getIsContainer(),this.isPureList=this._getIsPureList(),this.isPseudoList=this._getIsInPseudoList(),this.index=this._getIndex(),this.hyperlink=Ut(t,this.tagName),this.content=Bt(this.originNode,this.tagName),this.triggerEvent=this._getTriggerEvent(),this.isOutFlow=this._getIsOutFlow(),n&&(this.isLimitViewport=null===(a=n.isLimitViewport)||void 0===a||a,this.rect=this._getRect(),this.viewStatus=this._getViewStatus(o)),this.xParents=this._getXParents(t,o)},Gt=function e(t,n,i,r,o){var a=this;this.origin=t,this.action=n,this.lengthThreshold=i,this.deviceInfo=r,this.parentNode=o,this.trackNodes=function(){var e;if(!a.trackable)return[];var t=[a.xNode];if($e(["click","circleClick","change"],a.actionType))for(var n=a._getParent();n;){if(!(null==n?void 0:n.xNode)||(null===(e=n.xNode)||void 0===e?void 0:e.isIgnored))return[];n.trackable&&t.push(n.xNode),n=n._getParent()}var i,r=[];return t.reverse().forEach((function(e,n){if(yt(e.originNode,mt)&&(r=[],i=void 0),Xe(e.index)&&!Xe(i)&&(i=e.index),Xe(i)&&(e.index=i),n===t.length-1)r.push(a.getGioNodeInfo(e));else{var o=e.isPureList||e.isPseudoList;(e.isContainer||o)&&r.push(a.getGioNodeInfo(e))}})),r},this.getGioNodeInfo=function(e){var t=a.computeXpath(e),n=t.skeleton,i=t.fullXpath,r=t.xcontent,o=e.hyperlink,s=e.index,u=e.peerNodes,c=e.content,d=e.triggerEvent,l=e.originNode;return{skeleton:n,xpath:n,fullXpath:i,xcontent:r,hyperlink:o,index:s,peerNodes:null!=u?u:[],content:Pt(c),triggerEvent:d,originNode:l}},this.computeXpath=function(e){var t,n="/"+e.tagName,i=e.currentXpath,r="/"+((e.id?"#"+e.id:"")+(nt(e.classList)?"":"."+e.classList.join("."))||"-");return null===(t=e.xParents)||void 0===t||t.forEach((function(e,t){if(i=e.currentXpath+i,t<a.xpathThreshold-1){n="/"+e.tagName+n;var o=(e.id?"#"+e.id:"")+(nt(e.classList)?"":"."+e.classList.join("."));r="/"+(o||"-")+r}})),{skeleton:n,fullXpath:i,xcontent:r}},this._getParent=function(){var t=Et(a.originElement);if(t&&t.nodeName&&!Tt(t))return new e(t,a.actionType)},this.actionType=$e(["circleClick","circleHover","click","change"],n)?n:"click",this.originElement=St(t),this.xpathThreshold=Xe(i)?i:4,this.trackable=Nt(this.originElement,this.actionType),this.originElement.isSameNode(t)||(o=null);var s=[];o&&o.xNode&&(s.push(o.xNode),o.xNode.xParents&&s.push.apply(s,o.xNode.xParents)),this.xNode=new Rt(this.originElement,this.deviceInfo,this.actionType,this.trackable,s)},Vt=[],Mt=function(e,t){var n,i,r,o,a,s,u,c=this;this.trackNodes=function(e,t,n){return void 0===n&&(n=!1),Vt=[],c._getTrackElements(e,t,null,n),Vt},this._getTrackElements=function(e,t,n,i){void 0===i&&(i=!1),Ot(e).forEach((function(e){var r,o,a,s;if(!(null==e?void 0:e.tagName)||$e(["circle-shape","circle-page","heatmap-page"],null===(r=null==e?void 0:e.tagName)||void 0===r?void 0:r.toLowerCase())||(null===(o=null==e?void 0:e.id)||void 0===o?void 0:o.indexOf("__vconsole"))>-1||(null===(a=null==e?void 0:e.id)||void 0===a?void 0:a.indexOf("__giokit"))>-1)return!1;var u=new Gt(e,"circleClick",c.xpathThreshold,c.deviceInfo,n),d=u.xNode;if(d.zLevel=c._getZLevel(e,t),u.trackable&&($e(["DISPLAYED","OBSCURED"],d.viewStatus)||i)){if(t.index&&(d.index=t.index),Vt.find((function(e){return e.originNode.isSameNode(d.originNode)})))return!1;if("DISPLAYED"===d.viewStatus){var l=c._getGioHybridNodeInfo(u,t);Vt.push(l)}else"OBSCURED"===d.viewStatus&&(d.isContainer||i)&&(l=c._getGioHybridNodeInfo(u,t),Vt.push(l));if(Lt(e)||d.isContainer&&kt(e))return!1}nt(Ot(e))||c._getTrackElements(e,null!==(s=u.xNode)&&void 0!==s?s:t,u,i)}))},this._getZLevel=function(e,t){var n=window.getComputedStyle(e),i=n.position,r=n.zIndex;if("auto"!==r){var o=Number(r||0);return(Number.isNaN(o)?0:o)+t.zLevel}switch(i){case"relative":return t.zLevel+2;case"sticky":return t.zLevel+3;case"absolute":return t.zLevel+4;case"fixed":return t.zLevel+5;default:return t.zLevel+1}},this._getGioHybridNodeInfo=function(e,t){var n=e.xNode,i=n.rect,r=n.zLevel,o=e.getGioNodeInfo(n),a=o.hyperlink,s={};return tt(i).forEach((function(e){return s[e]=i[e]*c.deviceInfo.scale})),s.top+=c.deviceInfo.webviewTop,s.left+=c.deviceInfo.webviewLeft,Re(Re(Re({},s),o),{zLevel:r+c.deviceInfo.webviewZLevel,href:a,parentXPath:t.trackable?e.computeXpath(t).xpath:void 0})},this.xpathThreshold=t,this.deviceInfo=(i=(n=e).webviewLeft,r=n.webviewTop,o=n.webviewWidth,a=n.webviewHeight,s=n.webviewZLevel,u=n.isLimitViewport,{winWidth:o,winHeight:a,scale:o/window.innerWidth,webviewTop:r,webviewLeft:i,webviewWidth:o,webviewHeight:a,webviewZLevel:s,isLimitViewport:u})},Wt=function(){function e(e){this.handler=e;var t=navigator.userAgent,n=/chrome/i.exec(t),i=/android/i.exec(t);this.hasTouch="ontouchstart"in window&&!(n&&!i)}return e.prototype.main=function(){for(var e=this.hasTouch?["touchstart"]:["mousedown"],t=this.hasTouch?["touchend","touchcancel"]:["mouseup","mouseleave"],n=this.hasTouch?["touchmove"]:["mousemove"],i=0,r=e;r.length>i;i++)W(window,r[i],this.touchStartHandler.bind(this));for(var o=0,a=n;a.length>o;o++)W(window,a[o],this.touchMoveHandler.bind(this));for(var s=0,u=t;u.length>s;s++)W(window,u[s],this.touchStopHandler.bind(this))},e.prototype.touchStartHandler=function(e){if(1>=e.which){var t=+Date.now();this.safeguard!==t&&(this.touchTimeout&&clearTimeout(this.touchTimeout),this.safeguard=t,this.touchEvent={time:t,target:e.target,x:this._page("x",e),y:this._page("y",e),isTrusted:!0,type:"click"})}},e.prototype.touchMoveHandler=function(e){var t=Math.abs(this._page("x",e)-(this.touchEvent&&this.touchEvent.x)||0),n=Math.abs(this._page("y",e)-(this.touchEvent&&this.touchEvent.y)||0);(t>10||n>10)&&(this.touchEvent=null)},e.prototype.touchStopHandler=function(e){var t=this,n=+Date.now()-(this.touchEvent&&this.touchEvent.time)||0;this.touchEvent&&200>n?this.touchTimeout=setTimeout((function(){t.handler(t.touchEvent),t.touchEvent=null}),200):this.touchEvent&&n>=200&&700>n&&(this.handler(this.touchEvent),this.touchEvent=null)},e.prototype._page=function(e,t){return(this.hasTouch?t.touches[0]:t)["page".concat(e.toUpperCase())]},e}(),zt={click:"VIEW_CLICK",change:"VIEW_CHANGE"},Jt={name:"gioEventAutoTracking",method:function(e){var t=this;this.growingIO=e,this.main=function(){W(document,"change",t._handleAction),t.growingIO.vdsConfig.touch?new Wt(t._handleAction).main():W(document,"click",t._handleAction)},this._handleAction=function(e,n){var r,o,a,s,u=t.growingIO,c=u.vdsConfig,d=u.emitter,l=e.target;if(!c.autotrack||!l)return!1;if(!(null==l?void 0:l.tagName)||"circle-shape"===(null===(r=null==l?void 0:l.tagName)||void 0===r?void 0:r.toLowerCase())||"heatmap-page"===(null===(o=null==l?void 0:l.tagName)||void 0===o?void 0:o.toLowerCase())||(null===(a=null==l?void 0:l.id)||void 0===a?void 0:a.indexOf("__vconsole"))>-1||(null===(s=null==l?void 0:l.id)||void 0===s?void 0:s.indexOf("__giokit"))>-1)return!1;var g=new Gt(l,e.type).trackNodes();if(H(g))return!1;"click"!==e.type&&(g=[y(g)]),null==d||d.emit("onComposeBefore",{event:n,params:null!=e?e:{}}),g.forEach((function(n){var r=n.fullXpath,o=n.skeleton,a=n.xcontent,s=n.index,u=n.content,d=n.hyperlink;if(0>r.indexOf("#__giokit")&&0>r.indexOf("#__vconsole")&&(c.debug&&console.log("Action：",e.type,Date.now()),r)){var l=t.growingIO.dataStore,g=l.eventContextBuilder;(0,l.eventConverter)(i({eventType:zt[e.type],element:[{xpath:o,xcontent:a,textValue:u,index:s,hyperlink:d}]},g()))}}))}}},Xt=["VIEW_CLICK","VIEW_CHANGE","FORM_SUBMIT","PAGE","CUSTOM","LOGIN_USER_ATTRIBUTES"],Qt=["LOGIN_USER_ATTRIBUTES"],Zt=["DOMContentLoaded","onreadystatechange"],Yt=["scroll","resize","load","beforeunload","popstate","hashchange","pagehide","unload"],$t=function(){function e(e){var t,n=this;this.growingIO=e,this.penetrateHybrid=!0,this.onOptionsInit=function(){var e=n.growingIO,t=e.vdsConfig,i=e.emitter;f(t.penetrateHybrid)&&(n.penetrateHybrid=t.penetrateHybrid),n._initHybridBridge()&&(n.onSendBefore=n.sendBeforeListener,n.hybridConfig.projectId===n.growingIO.vdsConfig.projectId&&(n.growingIO.useHybridInherit=!0)),n.growingIO.useHybridInherit&&(null==i||i.on(Ee,(function(e){var t=e.newUserId,i=e.oldUserId,r=e.userKey;n.penetrateHybrid&&(!t&&i?r?n._clearNativeUserIdAndUserKey():n._clearNativeUserId():r?n._setNativeUserIdAndUserKey(T(t),T(r)):n._setNativeUserId(T(t)))})),null==i||i.on(Te,(function(e){var t=e.newUserKey,i=e.oldUserKey,r=e.userId;n.penetrateHybrid&&(!t&&i?n._clearNativeUserIdAndUserKey():n._setNativeUserIdAndUserKey(T(r),T(t)))})))},this._initHybridBridge=function(){var e,t,i,r=!1;return n.hasHybridBridge=!!window.GrowingWebViewJavascriptBridge,n.hasHybridBridge?((null===(e=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===e?void 0:e.configuration)||(window.GrowingWebViewJavascriptBridge.configuration=JSON.parse(window.GrowingWebViewJavascriptBridge.getConfiguration())),(null===(t=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===t?void 0:t.configuration)&&(n.hybridConfig=null===(i=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===i?void 0:i.configuration),r=!0):Ve.consoleText("gioHybridAdapter：当前不存在 GrowingWebViewJavascriptBridge，Web模式。","info"),r},this.sendBeforeListener=function(e){var t=e.requestData;if(n.hasHybridBridge){var r=n.processAttributes(i({},t));O(Xt,r.eventType)&&(O(Qt,r.eventType)?n.penetrateHybrid&&n._dispatchEvent(r):(n.penetrateHybrid||B(r,["userId","userKey","cs1"]),n._dispatchEvent(r)))}},this.processAttributes=function(e){return U(e,(function(t,n){h(t)||m(t)?U(e[n],(function(t,i){h(t)||m(t)?e[n][i]=JSON.stringify(t):e[n][i]=T(t)})):e[n]=T(t)})),e},this._setNativeUserId=function(e){R((function(){return window.GrowingWebViewJavascriptBridge.setNativeUserId(e)}))},this._clearNativeUserId=function(){R((function(){return window.GrowingWebViewJavascriptBridge.clearNativeUserId()}))},this._setNativeUserIdAndUserKey=function(e,t){R((function(){return window.GrowingWebViewJavascriptBridge.setNativeUserIdAndUserKey(e,t)}))},this._clearNativeUserIdAndUserKey=function(){R((function(){return window.GrowingWebViewJavascriptBridge.clearNativeUserIdAndUserKey()}))},this._dispatchEvent=function(e){R((function(){var t;return null===(t=window.GrowingWebViewJavascriptBridge)||void 0===t?void 0:t.dispatchEvent(JSON.stringify(e))}))},this._getDomTree=function(e,t,i,r,o,a){var s=new Mt({webviewLeft:e,webviewTop:t,webviewWidth:i,webviewHeight:r,webviewZLevel:o}).trackNodes(null!=a?a:document.body,{isContainer:!1,zLevel:0}).map((function(e){return B(e,["originNode","peerNodes"]),e})),u=n.growingIO.dataStore.currentPage;return{page:{domain:u.domain,path:u.path,query:u.query,title:u.title},elements:s}};var r=this.growingIO,o=r.emitter,a=r.utils;Ve=a,o.on(Se,this.onOptionsInit),null===(t=this.growingIO.emitter)||void 0===t||t.on(_e,(function(){if(window.GrowingWebViewJavascriptBridge){var e=n;window.GrowingWebViewJavascriptBridge.getDomTree=function(){if(arguments.length>=4)return e._getDomTree.apply(this,arguments)},n._addDomChangeListener()}}))}return e.prototype._addDomChangeListener=function(){var e,t=function(t){return void 0===t&&(t=""),function(){var n;"beforeunload"===t&&e&&e.disconnect(),null===(n=window.GrowingWebViewJavascriptBridge)||void 0===n||n.onDomChanged()}};(e=new MutationObserver(t("mutation"))).observe(document.body,{attributes:!0,characterData:!0,childList:!0,subtree:!0}),Zt.forEach((function(e){W(document,e,t(e))})),Yt.forEach((function(e){W(window,e,t(e))}))},e}(),en={name:"gioHybridAdapter",method:$t},tn={name:"gioImpressionTracking",method:function(e){var t,n=this;this.growingIO=e,this.documentReady=!1,this.main=function(e){"listener"===e?(n.documentReady=!0,n.growingIO.gioSDKInitialized&&n.initMutationObserver()):"emitter"===e&&n.documentReady&&n.initMutationObserver()},this.initIntersectionObserver=function(){n.intersectionObserver=new IntersectionObserver((function(e){H(e)||e.map((function(e){var t=e.target.dataset;if(e.intersectionRatio>0){var i=n.getImpressionProperties(t),r=i.eventId,o=i.properties,a=t.id;if(a){if("once"===t.gioImpType&&P(n.sentImps,a))return;n.sentImps[a]={eventId:r,properties:o}}r&&n.buildImpEvent({eventId:r,properties:o})}}))}))},this.initMutationObserver=function(){if(n.mutationObserver)return!1;var e=document.querySelectorAll("[data-gio-imp-track]");E(e).map((function(e){var t;null===(t=n.intersectionObserver)||void 0===t||t.observe(e)})),n.mutationObserver=new MutationObserver((function(e){return e.map((function(e){var t;if("attributes"===e.type&&e.target.dataset.gioImpTrack)return null===(t=n.intersectionObserver)||void 0===t?void 0:t.observe(e.target)}))})),n.mutationObserver.observe(document.body,{attributes:!0,childList:!0,subtree:!0,attributeOldValue:!0,attributeFilter:["data-gio-imp-track","data-gio-imp-attrs",/^data-gio-track-[a-z]+$/i]})},this.getImpressionProperties=function(e){var t={eventId:void 0,properties:{}};if(!(null==e?void 0:e.gioImpTrack))return t;if(t.eventId=e.gioImpTrack,P(e,"gioImpAttrs"))t.properties=R((function(){return h(e.gioImpAttrs)?e.gioImpAttrs:JSON.parse(e.gioImpAttrs)}));else{var n=/^gioTrack(.+)/;for(var i in e){var r=void 0,o=i.match(n);o&&"track"!==(r=x(o[1]))&&(t.properties[r]=e[i])}}return t.properties=M(t.properties),/^\w+$/.test(t.eventId)&&!Number.isInteger(Number(I(t.eventId.split(""))))||(t.eventId=null,t={}),t},this.buildImpEvent=function(e){var t=e.eventId,r=e.properties,o=n.growingIO.dataStore,a=o.eventContextBuilder;(0,o.eventConverter)(i(i({eventType:"CUSTOM",eventName:t,attributes:r},a()),{customEventType:0}))},this.sentImps={},window.IntersectionObserver&&window.MutationObserver?(this.initIntersectionObserver(),W(document,"readystatechange",(function(){O(["interactive","complete"],document.readyState)&&n.main("listener")}),{once:!0}),null===(t=this.growingIO.emitter)||void 0===t||t.on(_e,(function(){return n.main("emitter")})),W(window,"unload",(function(){var e,t;null===(e=n.intersectionObserver)||void 0===e||e.disconnect(),null===(t=n.mutationObserver)||void 0===t||t.disconnect()}))):F("当前浏览器不支持半自动埋点，gioImpressionTracking已自动关闭！","warn")}},nn=["gioPerformance"],rn=function(e){function t(t){var n=e.call(this,t)||this;return n.growingIO=t,n.growingIO.gioSDKFull=!0,n.pluginsContext={plugins:{gioCompress:Le,gioCustomTracking:Ae,gioEmbeddedAdapter:Fe,gioEventAutoTracking:Jt,gioHybridAdapter:en,gioImpressionTracking:tn}},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+t+" is not a constructor or null");function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}(t,e),t}((function(e){var t,n,i,r,o=this;this.growingIO=e,this.innerPluginInit=function(){var e;nn.forEach((function(e){var t;return B(null===(t=o.pluginsContext)||void 0===t?void 0:t.plugins,e)})),D(null===(e=o.pluginsContext)||void 0===e?void 0:e.plugins).forEach((function(e){var t,n,i=null!==(n=null===(t=o.pluginsContext)||void 0===t?void 0:t.plugins[e])&&void 0!==n?n:{},r=i.name,a=i.method,s=_(o.pluginItems,(function(e){return e.name===r}));s||o.pluginItems.push({name:x(r||e),method:a||function(e){}})})),H(o.pluginItems)||o.installAll()},this.install=function(e,t,n){var i,r,a=t||_(o.pluginItems,(function(t){return t.name===e}));if((null===(i=o.growingIO)||void 0===i?void 0:i.plugins)[e])return F("重复加载插件 ".concat(e," 或插件重名，已跳过加载!"),"warn"),!1;if(!a)return F("插件加载失败!不存在名为 ".concat(e," 的插件!"),"error"),!1;try{return(null===(r=o.growingIO)||void 0===r?void 0:r.plugins)[e]=new a.method(o.growingIO,n),t&&F("加载插件 ".concat(e),"info"),!0}catch(t){return F("插件【".concat(e,"】加载异常 ").concat(t),"error"),!1}},this.installAll=function(e){(e||o.pluginItems).forEach((function(t){o.install(t.name,e?t:void 0,e?null==t?void 0:t.options:void 0)&&!_(o.pluginItems,(function(e){return e.name===t.name}))&&o.pluginItems.push({name:x(t.name),method:t.method?t.method:function(){}})}))},this.uninstall=function(e){var t;B(o.pluginItems,e);var n=B(null===(t=o.growingIO)||void 0===t?void 0:t.plugins,e);return n||F("卸载插件 ".concat(e," 失败!"),"error"),n},this.uninstallAll=function(){o.pluginItems.forEach((function(e){return o.uninstall(e.name)}))},this.lifeError=function(e,t){return F("插件执行错误 ".concat(e.name," ").concat(t),"error")},this.onComposeBefore=function(e){o.pluginItems.forEach((function(t){var n,i=null===(n=o.growingIO.plugins[t.name])||void 0===n?void 0:n.onComposeBefore;if(i&&p(i))try{i(e)}catch(e){o.lifeError(t,e)}}))},this.onComposeAfter=function(e){o.pluginItems.forEach((function(t){var n,i=null===(n=o.growingIO.plugins[t.name])||void 0===n?void 0:n.onComposeAfter;if(i&&p(i))try{i(e)}catch(e){o.lifeError(t,e)}}))},this.onSendBefore=function(e){o.pluginItems.forEach((function(t){var n,i=null===(n=o.growingIO.plugins[t.name])||void 0===n?void 0:n.onSendBefore;if(i&&p(i))try{i(e)}catch(e){o.lifeError(t,e)}}))},this.onSendAfter=function(e){o.pluginItems.forEach((function(t){var n,i=null===(n=o.growingIO.plugins[t.name])||void 0===n?void 0:n.onSendAfter;if(i&&p(i))try{i(e)}catch(e){o.lifeError(t,e)}}))},this.pluginsContext={plugins:{}},this.pluginItems=[],null===(t=this.growingIO.emitter)||void 0===t||t.on("onComposeBefore",this.onComposeBefore),null===(n=this.growingIO.emitter)||void 0===n||n.on("onComposeAfter",this.onComposeAfter),null===(i=this.growingIO.emitter)||void 0===i||i.on("onSendBefore",this.onSendBefore),null===(r=this.growingIO.emitter)||void 0===r||r.on("onSendAfter",this.onSendAfter)})),on=function(e){var t=this;this.growingIO=e,this.generateHost=function(){var e=t.growingIO.vdsConfig,n=e.serverUrl,i=e.projectId;return k(n,"http")?"".concat(n,"/v3/projects/").concat(i,"/collect"):"https://".concat(n,"/v3/projects/").concat(i,"/collect")},this.getSendType=function(){var e=t.growingIO.vdsConfig.sendType;return"beacon"===e?function(){var e,t,n=!!(null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.sendBeacon),i=window.navigator.userAgent;if(i.match(/(iPad|iPhone|iPod)/g)){var r=!(t=i.toLowerCase().match(/cpu.*os (.*?) like mac os/i))||2>t.length?0:+t[1].split("_").slice(0,2).join(".");return n&&r>13}return n}()?"beacon":"xhr":e},this.commitRequest=function(e,n){var r=t.growingIO.vdsConfig.forceLogin,o=i(i({},e),{requestType:t.getSendType()});r?t.hoardingQueue.push(o):(t.requestQueue.push(o),t.initiateRequest(n))},this.initiateRequest=function(e){var n,o,a;if(r(r([],t.hoardingQueue,!0),t.requestQueue,!0).length>0&&t.requestingNum<t.requestLimit){var s=t.growingIO,u=s.vdsConfig,c=s.emitter,d=s.plugins,l=s.useHybridInherit;if(t.requestQueue=r(r([],t.hoardingQueue,!0),t.requestQueue,!0).filter((function(e){return(t.retryIds[e.requestId]||0)<=t.retryLimit})),t.hoardingQueue=[],H(t.requestQueue))return;var g=t.requestQueue.shift(),f=g.requestType;null==c||c.emit("onSendBefore",{requestData:i({},g)});var h=i({},g);if(B(h,["requestType","trackingId","requestId","customEventType"]),u.debug&&console.log("[GrowingIO Debug]:",JSON.stringify(h,null,2).replace(/\"/g,(a=window.navigator.userAgent,/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(a)&&!/chrome\/(\d+\.\d+)/i.test(a)?"":'"'))),t.requestingNum+=1,l)return t.requestSuccessFn(g),!1;var v=i({},h);u.compress&&(null==d?void 0:d.gioCompress)?(t.compressType="1",v="image"===f?null===(n=null==d?void 0:d.gioCompress)||void 0===n?void 0:n.compressToUTF16(JSON.stringify([v])):null===(o=null==d?void 0:d.gioCompress)||void 0===o?void 0:o.compressToUint8Array(JSON.stringify([v]))):(t.compressType="0",v=JSON.stringify([v]));var p=t.generateURL(null!=e?e:t.requestURL);switch(f){case"beacon":default:t.sendByBeacon(g,v,p);break;case"xhr":t.sendByXHR(g,v,p);break;case"image":t.sendByImage(g,v,p)}}},this.generateURL=function(e){return"".concat(e,"?stm=").concat(+Date.now(),"&compress=").concat(t.compressType)},this.sendByBeacon=function(e,n,i){navigator.sendBeacon(i,n)?t.requestSuccessFn(e):t.requestFailFn(e,"beacon")},this.sendByXHR=function(e,n,i){var r,o=O(["unload","beforeunload","pagehide"],null===(r=null===window||void 0===window?void 0:window.event)||void 0===r?void 0:r.type),a=new XMLHttpRequest;if(a)return a.open("POST",i,o),a.onreadystatechange=function(){4===a.readyState&&204===a.status?t.requestSuccessFn(e):t.requestFailFn(e,"xhr")},a.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),void a.send(n);if(null===window||void 0===window?void 0:window.XDomainRequest){var s=new window.XDomainRequest;s.open("POST",i.replace("https://","http://"),o),s.onload=function(){204===s.status?t.requestSuccessFn(e):t.requestFailFn(e,"xhr")},s.onerror=s.ontimeout=function(){t.requestFailFn(e,"xhr")},s.send(n)}},this.sendByImage=function(e,n,i){var r="".concat(i,"&data=").concat(n),o=document.createElement("img");o.width=1,o.height=1,o.onload=function(){t.requestSuccessFn(e),t.clearImage(o)},o.onerror=o.onabort=function(){t.requestSuccessFn(e),t.clearImage(o)},o.src=r},this.clearImage=function(e){e.src="",e.onload=function(){},e.onerror=e.onerabort=function(){},e=null},this.requestSuccessFn=function(e){var n;t.requestingNum-=1;var r=e.requestId||-1;t.retryIds[r]&&(t.retryIds[r]=0),e.trackingId===t.growingIO.trackingId&&(t.growingIO.userStore.sessionId=e.sessionId),null===(n=t.growingIO.emitter)||void 0===n||n.emit("onSendAfter",{requestData:i({},e)}),t.initiateRequest()},this.requestFailFn=function(e,n){t.requestingNum-=1;var r=e.requestId||-1;t.retryIds[r]||(t.retryIds[r]=0),t.retryIds[r]+=1;var o=t.requestQueue.some((function(t){return t.requestId===e.requestId})),a=n;if(t.retryIds[r]<t.retryLimit+1||(a="beacon"===n?"xhr":"xhr"===n?"image":void 0,t.retryIds[r]=0),!o&&a)var s=window.setTimeout((function(){H(t.requestQueue)?(t.requestQueue.push(i(i({},e),{requestType:a})),t.initiateRequest()):t.requestQueue.push(i(i({},e),{requestType:a})),window.clearTimeout(s),s=null}),800)},this.hoardingQueue=[],this.requestQueue=[],this.requestLimit=10,this.requestTimeout=5e3,this.retryLimit=1,this.retryIds={},this.requestingNum=0,this.requestURL=this.generateHost()},an=function(){function e(e){var t=this;this.growingIO=e,this.transferStorage=function(){var e=t.growingIO,n=e.vdsConfig.projectId,i=e.storage;t.uid=i.getItem("gr_user_id")||t.uid,t.userId=i.getItem("".concat(n,"_gr_cs1"))||t.userId,i.removeItem("gr_user_id"),i.removeItem("".concat(n,"_gr_cs1")),i.removeItem("".concat(n,"_gr_last_sent_cs1")),i.removeItem("".concat(n,"_gr_last_sent_sid_with_cs1")),i.removeItem("".concat(n,"_gr_session_id")),i.removeItem("".concat(n,"_gr_session_id_sent_vst"));var r=i.getKeys().find((function(e){return e.indexOf("gr_imp_")>-1}));r&&i.removeItem(r)};var n=this.growingIO.vdsConfig.projectId,i=this.growingIO.storage,r=i.getItem,o=i.setItem,a=i.getKeys,s=i.removeItem;this.getItem=r,this.setItem=o,this.getKeys=a,this.removeItem=s,this.sIdStorageName="".concat(n,"_gdp_session_id"),this.uidStorageName="gdp_user_id_gioenc",this.userIdStorageName="".concat(n,"_gdp_cs1_gioenc"),this.userKeyStorageName="".concat(n,"_gdp_user_key_gioenc"),this.gioIdStorageName="".concat(n,"_gdp_gio_id_gioenc"),this.growingIO.emitter.on("OPTION_INITIALIZED",(function(){r("gr_user_id")&&t.transferStorage()}))}return Object.defineProperty(e.prototype,"sessionId",{get:function(){return this.getItem(this.sIdStorageName)||(this.sessionId=ne(),this.sessionId)},set:function(e){var t,n=this;e||(e=ne());var i=this.getItem(this.sIdStorageName)||this.prevSessionId,r=this.growingIO.vdsConfig.sessionExpires,o=void 0===r?30:r;if(this.setItem(this.sIdStorageName,e,+Date.now()+60*o*1e3),i!==e){var a=this.getKeys().filter((function(e){return/.+_gdp_session_id_.{36}/.test(e)}));a.forEach((function(e){n.removeItem(e)})),this.setItem(this.growingIO.dataStore.visitStorageName,""),null===(t=this.growingIO.emitter)||void 0===t||t.emit(Oe,{newSessionId:e,oldSessionId:i})}this.prevSessionId=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this.getItem(this.uidStorageName)||(this.uid=ne(),this.uid)},set:function(e){var t,n=this.getItem(this.uidStorageName)||this.prevUId;this.setItem(this.uidStorageName,e),n!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit("UID_UPDATE",{newUId:e,oldUId:n})),this.prevUId=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userId",{get:function(){return this.getItem(this.userIdStorageName)||""},set:function(e){var t,n,i=this.getItem(this.userIdStorageName)||this.prevUserId;this.setItem(this.userIdStorageName,e),null===(t=this.growingIO.emitter)||void 0===t||t.emit(Ee,{newUserId:e,oldUserId:i,userKey:this.userKey}),i!==e&&(null===(n=this.growingIO.emitter)||void 0===n||n.emit("USERID_UPDATE",{newUserId:e,oldUserId:i,userKey:this.userKey})),e&&(this.gioId=e),this.prevUserId=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userKey",{get:function(){return this.getItem(this.userKeyStorageName)||""},set:function(e){var t,n,i=this.getItem(this.userKeyStorageName)||this.prevUserKey;this.setItem(this.userKeyStorageName,e),null===(t=this.growingIO.emitter)||void 0===t||t.emit(Te,{newUserKey:e,oldUserKey:i,userId:this.userId}),i!==e&&(null===(n=this.growingIO.emitter)||void 0===n||n.emit("USERKEY_UPDATE",{newUserKey:e,oldUserKey:i,userId:this.userId})),this.prevUserKey=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"gioId",{get:function(){return this.getItem(this.gioIdStorageName)||""},set:function(e){var t,n=this.getItem(this.gioIdStorageName)||this.prevGioId;this.setItem(this.gioIdStorageName,e),n!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit("GIOID_UPDATE",{newGioId:e,oldGioId:n})),this.prevGioId=e},enumerable:!1,configurable:!0}),e}(),sn=function(){var e=this;this.trackingId="g0",this.init=function(t,n){var i,r,o,a,s;F("Gio Web SDK 初始化中...","info");var u=e.dataStore,c=u.initOptions,d=u.currentPage,l=u.sendVisit,g=u.sendPage;c(t),e.storage=be(e.vdsConfig),e.uploader=new on(e),e.userStore=new an(e),null===(i=e.emitter)||void 0===i||i.emit(Se,e),null===(o=null===(r=e.plugins)||void 0===r?void 0:r.gioEventAutoTracking)||void 0===o||o.main(),d.hookHistory(),d.parsePage(),e.vdsConfig.originalSource&&e.dataStore.setOriginalSource(),null===(a=e.emitter)||void 0===a||a.emit(_e,e),e.gioSDKInitialized=!0,e.vdsConfig.gioSDKInitialized=!0,window[e.vds]=e.vdsConfig,F("Gio Web SDK 初始化完成！","success"),e.vdsConfig.forceLogin&&F("forceLogin已开启，请调用 identify 方法设置 openId 以继续上报!","info"),e.useEmbeddedInherit||l(),g(),null===(s=e.emitter)||void 0===s||s.emit(Ne,e),G(n,e.trackingId)},this.sendVisit=function(t,n){e.dataStore.buildVisitEvent(t),G(n)},this.sendPage=function(t,n){e.dataStore.currentPage.buildPageEvent(t),G(n)},this.registerPlugins=function(t,n){m(t)?(t.forEach((function(e,n){var r,o;H(e)||c(e)?F("插件不合法，跳过加载!","warn"):(null===(r=e.js)||void 0===r?void 0:r.default)&&(t[n]=i(i({},null===(o=e.js)||void 0===o?void 0:o.default),{options:e.options}))})),t=S(t),e.plugins.installAll(t)):F("插件注册失败，请检查!","error"),G(n,e.plugins.pluginItems)},this.getPlugins=function(t){G(t,e.plugins.pluginItems)},this.setOption=function(t,n,i){var r;O(D($),t)?(r=e.dataStore.setOption(t,n))&&$[t]&&F("已修改".concat($[t],": ").concat(n),"info"):(F("不存在可修改的配置项：".concat(t,"，请检查后重试!"),"warn"),r=!1),G(i,r)},this.getOption=function(t,n){G(n,e.dataStore.getOption(t))},this.setGeneralProps=function(t,n){var r;h(t)&&!H(t)?(e.dataStore.generalProps=i(i({},e.dataStore.generalProps),t),D(e.dataStore.generalProps).forEach((function(t){O([void 0,null],e.dataStore.generalProps[t])&&(e.dataStore.generalProps[t]="")})),r=!0):(V("setGeneralProps"),r=!1),G(n,r)},this.clearGeneralProps=function(t,n){m(t)&&!H(t)?t.forEach((function(t){B(e.dataStore.generalProps,t)})):e.dataStore.generalProps={},G(n)},this.getDeviceId=function(t){G(t,e.userStore.uid)},this.identify=function(t,n){if(e.vdsConfig.forceLogin){if(!X(t))return void V("identify");var i=T(t).slice(0,1e3);e.userStore.uid=i,e.uploader.hoardingQueue.forEach((function(t,n){return e.uploader.hoardingQueue[n].deviceId=i})),e.dataStore.setOption("forceLogin",!1),e.uploader.initiateRequest()}else V("identify",!1,"forceLogin未开启");G(n)},this.setUserId=function(t,n,i){var r;if(X(T(t).trim())){var o=e.userStore.gioId;e.vdsConfig.idMapping&&(e.userStore.userKey=!c(n)&&T(n).length>0?T(n).slice(0,1e3):""),e.userStore.userId=T(t).slice(0,1e3),o&&o!==e.userStore.userId&&(e.userStore.sessionId=""),r=!0}else e.clearUserId(),V("setUserId"),r=!1;G(i,r)},this.clearUserId=function(t){e.userStore.userId="",e.userStore.userKey="",G(t)},this.setUserAttributes=function(t,n,i){var r,o,a;!H(t)&&h(t)?(null===(o=null===(r=e.plugins)||void 0===r?void 0:r.gioCustomTracking)||void 0===o||o.buildUserAttributesEvent(t,n),a=!0):(V("setUserAttributes"),a=!1),G(i,a)},this.track=function(t,n,r,o){var a,s;((null===(s=null===(a=e.plugins)||void 0===a?void 0:a.gioCustomTracking)||void 0===s?void 0:s.buildCustomEvent)||function(){})(t,i(i({},e.dataStore.generalProps),h(n)&&!H(n)?n:{}),i(i({},r),{customEventType:1})),G(o)},this.trackTimerStart=function(t,n){var i;e.vdsConfig.dataCollect&&z(t,(function(){i=ne(),e.dataStore.trackTimers[i]={eventName:t,leng:0,start:+Date.now()}})),G(n,i)},this.trackTimerPause=function(t,n){if(t&&e.dataStore.trackTimers[t]){var i=e.dataStore.trackTimers[t];i.start&&(i.leng=i.leng+(+Date.now()-i.start)),i.start=0}G(n)},this.trackTimerResume=function(t,n){if(t&&e.dataStore.trackTimers[t]){var i=e.dataStore.trackTimers[t];0===i.start&&(i.start=+Date.now())}G(n)},this.trackTimerEnd=function(t,n,r){var o;if(e.vdsConfig.dataCollect)if(t&&e.dataStore.trackTimers[t]){var a=e.dataStore.trackTimers[t];if(0!==a.start){var s=+Date.now()-a.start;a.leng=s>0?a.leng+s:0}var u=e.dataStore,c=u.eventContextBuilder;(0,u.eventConverter)(i(i({eventType:"CUSTOM",eventName:a.eventName,attributes:M(i(i({},n),{event_duration:a.leng>864e5?0:a.leng/1e3}))},c()),{customEventType:0})),e.removeTimer(t),o=!0}else F("未查找到对应的计时器，请检查!","error"),o=!1;G(r,o)},this.removeTimer=function(t,n){t&&e.dataStore.trackTimers[t]&&delete e.dataStore.trackTimers[t],G(n)},this.clearTrackTimer=function(t){e.dataStore.trackTimers={},G(t)},this.sdkVersion="4.0.0",this.vds=window._gio_local_vds||"vds",this.utils=i(i({},j),J),this.emitter=function(e){return{all:e=e||new Map,on:function(t,n){var i=e.get(t);i?i.push(n):e.set(t,[n])},off:function(t,n){var i=e.get(t);i&&(n?i.splice(i.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var i=e.get(t);i&&i.slice().map((function(e){e(n)})),(i=e.get("*"))&&i.slice().map((function(e){e(t,n)}))}}}(),this.useEmbeddedInherit=!1,this.useHybridInherit=!1,this.gioSDKInitialized=!1,this.plugins=new rn(this),this.plugins.innerPluginInit(),this.dataStore=new ke(this)},un=window._gio_local_vds||"vds",cn=null!==(We=null===(Me=window[un])||void 0===Me?void 0:Me.namespace)&&void 0!==We?We:"gdp";!function(){var e,t,n,r,o;if(null===(e=window[un])||void 0===e?void 0:e.gioSDKInstalled)return ze=window[cn],void F("SDK重复加载，请检查是否重复加载SDK或接入其他平台SDK导致冲突!","warn");window[un]=i(i({},null!==(t=window[un])&&void 0!==t?t:{}),{gioSDKInstalled:!0});var a=new sn;ze=function(){var e,t=arguments[0];if(d(t)&&O(Y,t)&&a[t]){var n=b(E(arguments));if("init"===t){var r=function(e){var t;return e.vdsConfig||e.gioSDKInitialized||(null===(t=window[e.vds])||void 0===t?void 0:t.gioSDKInitialized)?(F("SDK重复初始化，请检查是否重复加载SDK或接入其他平台SDK导致冲突!","warn"),!1):!(O(["","localhost","127.0.0.1"],location.hostname)&&!window._gr_ignore_local_rule&&(F("当前SDK不允许在本地环境初始化!","warn"),1))}(a);if(!r)return;var o=function(e){return!H(S(e))||(F('SDK初始化失败，请使用 gdp("init", "您的GrowingIO项目 accountId", "您项目的 dataSourceId", options); 进行初始化!',"error"),!1)}(n);if(!o)return;var s=function(e){var t=I(e),n=y(e);return X(T(t).trim())?(h(n)&&n||(n={}),{projectId:t,userOptions:n}):(F("SDK初始化失败，accountId 参数不合法!","error"),!1)}(n);if(!s)return;var u=function(e){var t=e[1],n=e[2],i=y(e);return t&&d(t)?{dataSourceId:t,appId:d(n)?n:"",options:i}:(F("SDK初始化失败，dataSourceId 参数不合法!","error"),!1)}(n);if(!u)return;var c=s.projectId,l=u.dataSourceId,g=u.appId,f=u.options;a.init(i(i({},f),{projectId:c,dataSourceId:l,appId:g}),y(n))}else if("registerPlugins"===t)a.registerPlugins.apply(a,n);else{if(a.gioSDKInitialized&&a.vdsConfig)return a[t].apply(a,n);a.emitter.emit("UNINITIALIZED_CALL",arguments),F("SDK未初始化!","error")}}else O(ee,t)?F("方法 ".concat(T(t)," 已被弃用，请移除!"),"warn"):F("不存在名为 ".concat(T(t)," 的方法调用!"),"error");window[un]=i(i({},window[un]),{_gr_ignore_local_rule:null!==(e=window._gr_ignore_local_rule)&&void 0!==e&&e,gioSDKVersion:a.sdkVersion,gioSDKFull:a.gioSDKFull,canIUse:function(e){return O(Y,e)&&a[e]}})};var s=null===(n=window[cn])||void 0===n?void 0:n.q,u=null===(r=window[cn])||void 0===r?void 0:r.e,c=null===(o=window[cn])||void 0===o?void 0:o.ef;window[cn]=ze,window[cn].e=u,window[cn].ef=c,window.gdp=ze,window.gdp.e=u,window.gdp.ef=c,m(s)&&!H(s)&&E(Array(s.length)).forEach((function(){ze.apply(null,s.shift())}))}();var dn=ze;export{dn as default};
