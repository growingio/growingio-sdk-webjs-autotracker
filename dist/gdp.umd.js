!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).gdp=t()}(this,(function(){"use strict";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)({}).hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)},t=function(){return t=Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++)for(var i in t=arguments[n])({}).hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},t.apply(this,arguments)};function n(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;o>i;i++)!r&&i in t||(r||(r=[].slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||[].slice.call(t))}var r,i,o,a,s,u=/^(\.ac\.|\.br\.|\.co\.|\.com\.|\.edu\.|\.gov\.|\.org\.|\.net\.)/,c=/^[a-zA-Z][a-zA-Z0-9_]{0,99}$/,g=/.+_gdp_session_id_.{36}/,d="function"==typeof Array.from?Array.from:(i||(i=1,o=function(e){return"function"==typeof e},a=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),9007199254740991)},s=function(e){var t=e.next();return!t.done&&t},r=function(e){var t,n,r,i=this,u=arguments.length>1?arguments[1]:void 0;if(void 0!==u){if(!o(u))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(t=arguments[2])}var c=function(e,t){if(null!=e&&null!=t){var n=e[t];if(null==n)return;if(!o(n))throw new TypeError(n+" is not a function");return n}}(e,function(e){if(null!=e){if(["string","number","boolean","symbol"].indexOf(typeof e)>-1)return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in e)return Symbol.iterator;if("@@iterator"in e)return"@@iterator"}}(e));if(void 0!==c){n=o(i)?Object(new i):[];var g,d,l=c.call(e);if(null==l)throw new TypeError("Array.from requires an array-like or iterable object");for(r=0;;){if(!(g=s(l)))return n.length=r,n;d=g.value,n[r]=u?u.call(t,d,r):d,r++}}else{var f=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var v,p=a(f.length);for(n=o(i)?Object(new i(p)):Array(p),r=0;p>r;)v=f[r],n[r]=u?u.call(t,v,r):v,r++;n.length=p}return n}),r),l=function(e){return E(["undefined","null"],R(e))},f=function(e){return"string"===R(e)},v=function(e){return"number"===R(e)},p=function(e){return"NaN"===P(Number(e))},I=function(e){return"object"===R(e)&&!l(e)},m=function(e){return"regexp"===R(e)},h=function(e){return E(["function","asyncfunction"],R(e))},w=function(e){return Array.isArray(e)&&"array"===R(e)},y=function(e){return"date"===R(e)},S=function(e){try{return C(e)[0]}catch(e){return}},O=function(e){try{var t=C(e);return t[t.length-1]}catch(e){return}},_=function(e,t){return void 0===t&&(t=1),w(e)&&v(t)?e.slice(t>0?t:1,e.length):e},k=function(e){if(w(e)){for(var t=0,n=[],r=0,i=e;r<i.length;r++){var o=i[r];o&&!G(o)&&(n[t++]=o)}return n}return e},T=function(e,t){return e[b(e,t)]},b=function(e,t){var n=-1;return w(e)&&e.every((function(e,r){return!t(e)||(n=r,!1)})),n},E=function(e,t){return("array"===R(e)||"string"===R(e))&&e.indexOf(t)>=0},C=d,P=function(e){return l(e)?"":"".concat(e)},U=function(e,t){return"string"==typeof e?e.split(t):e},x=function(e){if(f(e)){var t=U(e,"");return"".concat(S(t).toLowerCase()).concat(_(t).join(""))}return e},N=function(e,t){return!!f(e)&&e.slice(0,t.length)===t},K=function(e,t){if(f(e)){var n=e.length,r=n;r>n&&(r=n);var i=r;return(r-=t.length)>=0&&e.slice(r,i)===t}return!1},q={}.hasOwnProperty,D=function(e,t){return!l(e)&&q.call(e,t)},A=function(e){return I(e)?Object.keys(e):[]},L=function(e,t){A(e).forEach((function(n){return t(e[n],n)}))},F=function(e,t){var n=A(e);return!(!I(e)||!I(t)||n.length!==A(t).length||E(n.map((function(n){return I(e[n])?F(e[n],t[n]):e[n]===t[n]})),!1))},j=function(e,t){if(!I(e))return!1;try{return"string"===R(t)?delete e[t]:"array"===R(t)?t.map((function(t){return delete e[t]})):(m(t)&&A(e).forEach((function(n){t.test(n)&&j(e,n)})),!0)}catch(e){return!1}},G=function(e){return w(e)?0===e.length:I(e)?0===A(e).length:!e},R=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},B=Object.freeze({__proto__:null,isNil:l,isString:f,isNumber:v,isNaN:p,isBoolean:function(e){return"boolean"===R(e)},isObject:I,isRegExp:m,isFunction:h,isArray:w,isDate:y,fixed:function(e,t){return v(e)?Number(e.toFixed(v(t)?t:2)):f(e)&&"NaN"!==P(Number(e))?Number(Number(e).toFixed(v(t)?t:2)):e},head:S,last:O,drop:_,dropWhile:function(e,t){return w(e)?e.filter((function(e){return!t(e)})):e},compact:k,find:T,findIndex:b,includes:E,arrayFrom:C,toString:P,split:U,lowerFirst:x,upperFirst:function(e){if(f(e)){var t=U(e,"");return"".concat(S(t).toUpperCase()).concat(_(t).join(""))}return e},startsWith:N,endsWith:K,has:D,keys:A,forEach:L,isEqual:F,get:function(e,t,n){var r=e;return I(e)?(t.split(".").forEach((function(e){r=r?r[e]:n})),r):n},unset:j,isEmpty:G,typeOf:R,formatDate:function(e){if(y(e)){var t=function(e){return 10>e?"0"+e:e};return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+t(e.getMilliseconds())}return e}}),H=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},M=function(e,t){console.log("%c [GrowingIO]：".concat(e),{info:"color: #3B82F6;",error:"color: #EF4444;",warn:"color: #F59E0B;",success:"color: #10B981;"}[t]||"")},V=function(e){try{return e()}catch(e){return}},z=function(e,t){if(h(e))try{e(t)}catch(e){M("回调执行失败！".concat(e),"error")}},Q=function(){var e,t=!!(null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.sendBeacon),n=window.navigator.userAgent;if(n.match(/(iPad|iPhone|iPod)/g)){var r=J(n);return t&&r>13}return t},J=function(e){var t=e.toLowerCase().match(/cpu.*os (.*?) like mac os/i);return!t||2>t.length?0:+t[1].split("_").slice(0,2).join(".")},W=function(){var e=window.navigator.userAgent;return/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(e)&&!/chrome\/(\d+\.\d+)/i.test(e)},X=function(){return/bot|crawler|spider|scrapy|jiankongbao|slurp|transcoder|networkbench/i.test(navigator.userAgent.toLowerCase())},Y=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n="参数不合法"),M("".concat(t?"调用":"设置"," ").concat(e," 失败，").concat(n,"!"),"warn")},Z=function(e,n,r,i){void 0===i&&(i={}),document.addEventListener?e.addEventListener(n,r,t(t({},{capture:!0}),i)):e.attachEvent?e.attachEvent("on"+n,r):e["on"+n]=r},$=function(e){return K(e,"_gioenc")?e.slice(0,-7):e},ee=function(e){return isNaN(Number(e))&&V((function(){return JSON.parse(e)}))||e},te=function(e){var t={};return I(e)&&L(e,(function(e,n){var r=P(n).slice(0,100);I(e)?t[r]=te(e):w(e)?(t[r]=e.slice(0,100),t[r]=t[r].join("||").slice(0,1e3)):t[r]=l(e)?"":P(e).slice(0,1e3)})),t},ne=function(e){return l(e)||A(e).forEach((function(t){h(e[t])?e[t]=e[t]():I(e[t])?j(e,t):w(e[t])||(e[t]=P(e[t]))})),e},re=function(){var e,t=window._gio_local_vds||"vds";return null!==(e=window[t])&&void 0!==e?e:{}},ie=Object.freeze({__proto__:null,guid:H,consoleText:M,niceTry:V,niceCallback:z,hashCode:function(e,t){void 0===t&&(t=!1);var n=0;if(G(e)||"boolean"==typeof e)return n;for(var r=0;r<e.length;)n=(n<<5)-n+e.charCodeAt(r),n&=n,r++;return t?Math.abs(n):n},supportBeacon:Q,getIOSVersion:J,isSafari:W,isBot:X,callError:Y,addListener:Z,getActualKey:$,parseStorageValue:ee,limitObject:te,flattenObject:function(e){void 0===e&&(e={});var n=t({},e);return A(n).forEach((function(e){I(n[e])?(A(n[e]).forEach((function(t){n["".concat(e,"_").concat(t)]=P(n[e][t])})),j(n,e)):w(n[e])?(n[e].forEach((function(t,r){I(t)?A(t).forEach((function(i){n["".concat(e,"_").concat(r,"_").concat(i)]=P(t[i])})):n["".concat(e,"_").concat(r)]=P(t)})),j(n,e)):l(n[e])||""===n[e]?j(n,e):n[e]=P(n[e])})),te(n)},compareVersion:function(e,t){for(var n=function(e){return e.replace(/\s+/g,"")},r=function(e){return e.replace(/[vV]/g,"")},i=n(r(e)),o=n(r(t)),a=i.split("."),s=o.split("."),u=0;3>u;u++){var c=Number(a[u]),g=Number(s[u]);if(c>g)return 1;if(g>c)return-1;if(!isNaN(c)&&isNaN(g))return 1;if(isNaN(c)&&!isNaN(g))return-1}return 0},getDynamicAttributes:ne,getVds:re,getGioFunction:function(){var e,t,n,r,i=null!==(t=null===(e=re())||void 0===e?void 0:e.namespace)&&void 0!==t?t:"gdp";return h(window[i])?window[i]:null!==(r=null!==(n=window.gdp)&&void 0!==n?n:window.gio)&&void 0!==r?r:function(){}},getMainTrackingId:function(){var e;return null!==(e=re().trackingId)&&void 0!==e?e:"g0"}}),oe=function(e){return f(e)&&e.length>0||v(e)&&e>0},ae=function(e,t){return f(e)&&!G(e)&&e.match(c)?t():(M("事件名格式不正确，只能包含数字、字母和下划线，且不能以数字开头，字符总长度不能超过100!","error"),!1)},se=["web","wxwv","Android","iOS","minp","alip","baidup","qq","bytedance","kuaishoup","jdp"],ue={gsid:"_gdp_sequence_ids",originalSource:"_gdp_original_source",sentSign:"_gdp_session_id_sent",sessionId:"_gdp_session_id",userId:"_gdp_cs1_gioenc",userKey:"_gdp_user_key_gioenc",gioId:"_gdp_gio_id_gioenc"},ce={autotrack:{type:"boolean",default:!0},compress:{type:"boolean",default:!0},cookieDomain:{type:"string",default:""},dataCollect:{type:"boolean",default:!0},debug:{type:"boolean",default:!1},embeddedIgnore:{type:"array",default:[]},forceLogin:{type:"boolean",default:!1},idMapping:{type:"boolean",default:!1},enableIdMapping:{type:"boolean",default:!1},gtouchHost:{type:"string",default:""},hashtag:{type:"boolean",default:!1},ignoreFields:{type:"array",default:[]},originalSource:{type:"boolean",default:!0},penetrateHybrid:{type:"boolean",default:!0},performance:{type:"object",default:{monitor:!0,exception:!0}},platform:{type:"string",default:"web"},requestTimeout:{type:"number",default:5e3},sendType:{type:"string",default:"beacon"},serverUrl:{type:"string",default:"https://napi.growingio.com"},sessionExpires:{type:"number",default:30},storageType:{type:"string",default:"cookie"},touch:{type:"boolean",default:!1},trackBot:{type:"boolean",default:!0},trackPage:{type:"boolean",default:!0},version:{type:"string",default:"1.0.0"}},ge=["clearGeneralProps","clearTrackTimer","clearUserId","getABTest","getOption","identify","removeTimer","sendPage","sendVisit","setGeneralProps","setOption","setUserAttributes","setUserId","track","trackTimerEnd","trackTimerPause","trackTimerResume","trackTimerStart"],de=n(n(["init","registerPlugins"],["getPlugins","getDeviceId","updateImpression"],!0),ge,!0),le={autotrack:"无埋点采集",dataCollect:"数据采集",dataSourceId:"数据源ID",debug:"调试模式",forceLogin:"强制登录",hashtag:"哈希解析",serverUrl:"数据上报服务地址"},fe=["collectImp","enableDebug","enableHT","getVisitorId","send","setAutotrack","setConfig","setDataCollect","setPlatformProfile","setTrackerHost","setTrackerScheme"],ve=["screenHeight","screenWidth"];function pe(e){for(var t=1;arguments.length>t;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}var Ie,me,he,we,ye=function e(t,n){function r(e,r,i){if("undefined"!=typeof document){"number"==typeof(i=pe({},n,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var a in i)i[a]&&(o+="; "+a,!0!==i[a]&&(o+="="+i[a].split(";")[0]));return document.cookie=e+"="+t.write(r,e)+o}}return Object.create({set:r,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var n=document.cookie?document.cookie.split("; "):[],r={},i=0;i<n.length;i++){var o=n[i].split("="),a=o.slice(1).join("=");try{var s=decodeURIComponent(o[0]);if(r[s]=t.read(a,s),e===s)break}catch(e){}}return e?r[e]:r}},remove:function(e,t){r(e,"",pe({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,pe({},this.attributes,t))},withConverter:function(t){return e(pe({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"}),Se={A:1,a:1,Z:1,z:1,"@":1,"{":1},Oe=function(e){return l(e)?e:V((function(){return"gioenc-".concat(ke(e))}))||e},_e=function(e){return f(e)&&N(e,"gioenc-")&&V((function(){return ke(e.replace("gioenc-",""))}))||e},ke=function(e){return(e=e||"").split("").map((function(e){return Se[e]?e:Te(e)})).join("")},Te=function(e){if(/[0-9]/.test(e))return 1^+e;var t=e.charCodeAt(0);return String.fromCharCode(1^t)},be=function(e){var t=this;this.domain=e,this.getItem=function(e){return ee(_e(ye.get($(e),{domain:t.domain,path:"/"})))},this.setItem=function(e,n,r){var i;i=f(n)?n.length?K(e,"_gioenc")?Oe(n):n:"":JSON.stringify(n),ye.set($(e),i,{expires:new Date(r||new Date((new Date).toDateString()).getTime()+3456e7),domain:t.domain,path:"/"})},this.removeItem=function(e){ye.remove($(e),{domain:t.domain,path:"/"})},this.hasItem=function(e){return E(A(ye.get()),$(e))},this.getKeys=function(){return A(ye.get())},this.type="Cookie"},Ee=function(){this.getItem=function(e){var t=V((function(){return JSON.parse(localStorage.getItem($(e))||"")}))||{};return I(t)&&t.expiredAt>+Date.now()?ee(_e(t.value)):void 0},this.setItem=function(e,t,n){var r=null!=n?n:+new Date((new Date).getFullYear()+3,(new Date).getMonth(),(new Date).getDay()).getTime();localStorage.setItem($(e),JSON.stringify({value:f(t)&&t.length&&K(e,"_gioenc")?Oe(t):t,expiredAt:r}))},this.removeItem=function(e){return localStorage.removeItem($(e))},this.hasItem=function(e){return!!localStorage.getItem($(e))},this.getKeys=function(){return C(Array(localStorage.length)).map((function(e,t){return localStorage.key(t)}))},this.type="localStorage"},Ce={},Pe=function(){this.getItem=function(e){var t=V((function(){return JSON.parse(Ce[$(e)]||"")}));return I(t)&&t.expiredAt>+Date.now()?ee(_e(t.value)):void 0},this.setItem=function(e,t,n){var r=null!=n?n:+new Date((new Date).getFullYear()+3,(new Date).getMonth(),(new Date).getDay()).getTime();Ce[$(e)]=JSON.stringify({value:f(t)&&t.length?Oe(t):t,expiredAt:r})},this.removeItem=function(e){return j(Ce,$(e))},this.hasItem=function(e){return D(Ce,$(e))},this.getKeys=function(){return A(Ce)},this.type="memory"},Ue=function(e){var t=[];try{var n=e.split("."),r=O(n);if(n.length>=2&&(isNaN(Number(r))||0>Number(r)||Number(r)>255)){var i=".".concat(n.slice(-2).join("."));u.test(i)?Ie=i:t.push(i);var o=".".concat(n.slice(-3).join("."));u.test(o)||E(t,o)||t.push(o);var a=".".concat(n.slice(-4).join("."));u.test(a)||E(t,a)||t.push(a)}}catch(e){M(e,"error")}return t},xe=function(e){var t="";return e.some((function(e){return!!Ne(e)&&(t=e,!0)})),t},Ne=function(e){try{ye.set("gioCookie","yes",{domain:e});var t=!!ye.get("gioCookie",{domain:e});return ye.remove("gioCookie",{domain:e}),t}catch(e){return!1}},Ke=function(e){var t,r,i,o=e.storageType,a=e.cookieDomain,s=e.projectId;if(E(["cookie","localstorage"],o)||(o="cookie"),"cookie"===o&&(r=!!(i=navigator.userAgent.indexOf("Electron")>-1||E(["","localhost","127.0.0.1"],window.location.hostname)||!E(["http:","https:"],window.location.protocol)?"":xe(n(n([],Ue(window.location.hostname),!0),[window.location.hostname],!1)))),"cookie"===o&&r){var u=new be(i);if(a){var c=Ue(a),g=xe(G(c)?[]:n([a],Ue(a),!0));g&&Ne(g)?u.domain=g:M("指定Cookie域无效或无权限，使用默认域！","warn")}t=u}else t=function(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(e){return!1}}()?new Ee:new Pe;return"cookie"===o&&Ie&&Ne(Ie)&&function(e,t,n){if(t&&Ne(t)){var r=new be(t);["".concat(n,"_gdp_session_id"),"gdp_user_id_gioenc","".concat(n,"_gdp_cs1_gioenc"),"".concat(n,"_gdp_user_key_gioenc"),"".concat(n,"_gdp_gio_id_gioenc"),"".concat(n,"_gdp_sequence_ids"),"".concat(n,"_gdp_session_id_sent")].forEach((function(t){var n=r.getItem(t);r.hasItem(t)&&(e.setItem(t,n),r.removeItem(t))})),r=void 0}}(t,Ie,s),t},qe="OPTION_INITIALIZED",De="SDK_INITIALIZED",Ae="SESSIONID_UPDATE",Le="ON_INSTALL",Fe="ON_ERROR",je="ON_COMPOSE_AFTER",Ge="ON_SEND_BEFORE",Re="ON_SEND_AFTER",Be=function(e){var n=this;this.growingIO=e,this.main=function(e){var r,i;e||(e=n.growingIO.trackingId);var o=n.growingIO,a=o.sdkVersion,s=o.useEmbeddedInherit,u=o.userStore,c=o.dataStore,g=c.currentPage,d=g.path,l=g.query,f=n.growingIO.dataStore.getTracker(e).vdsConfig,v={appVersion:f.version,dataSourceId:f.dataSourceId,deviceId:u.getUid(),domain:e===n.growingIO.trackingId&&s?f.appId:window.location.host,language:navigator.language,path:d,platform:f.platform,query:l,referralPage:(null===(r=c.lastPageEvent)||void 0===r?void 0:r.referralPage)||"",screenHeight:window.screen.height,screenWidth:window.screen.width,sdkVersion:a,sessionId:u.getSessionId(e),timestamp:+Date.now(),timezoneOffset:(new Date).getTimezoneOffset(),title:null!==(i=V((function(){return document.title.slice(0,255)})))&&void 0!==i?i:"",userId:u.getUserId(e)};if(f.idMapping&&(v.userKey=u.getUserKey(e)),G(f.ignoreFields)||f.ignoreFields.forEach((function(e){j(v,e)})),e===n.growingIO.trackingId&&s&&!G(n.minpExtraParams)){var p=t({},v);L(t(t({},v),n.minpExtraParams),(function(e,t){var r;E(f.embeddedIgnore,t)?(v[t]=p[t],"domain"===t&&(v[t]=window.location.host)):v[t]=null!==(r=n.minpExtraParams[t])&&void 0!==r?r:v[t]}))}return v.trackingId=e,v},this.minpExtraParams={}},He=function(e){var n=this;this.growingIO=e,this.parsePage=function(){var e=n.growingIO.vdsConfig.hashtag,t=location.pathname,r=location.search,i=location.hash,o=i.indexOf("?");n.domain=window.location.host,n.title=document.title.slice(0,255),n.time=+Date.now(),n.path=t,n.query=r,e&&(o>-1?(n.path+=i.slice(0,o),n.query=n.query+"&"+i.slice(o+1)):n.path+=i),n.query&&E(["?","&"],n.query.charAt(0))&&(n.query=n.query.slice(1))},this._getNoHashHref=function(){var e=window.location,t=e.protocol,n=e.host,r=e.pathname,i=e.search;return"".concat(t,"://").concat(n).concat(r).concat(i)},this.getReferralPage=function(){var e,t,r=n.growingIO.dataStore.lastPageEvent;return(null==r?void 0:r.path)===n.path&&(null!==(e=null==r?void 0:r.query)&&void 0!==e?e:"")===(null!==(t=n.query)&&void 0!==t?t:"")?null==r?void 0:r.referralPage:(null==r?void 0:r.path)?n.lastHref:document.referrer},this.pageListener=function(){var e=n.growingIO,t=e.vdsConfig.hashtag,r=e.dataStore,i=window.location.href,o=n.lastHref;t||(i=n._getNoHashHref(),o=n.lastNoHashHref),o!==i&&(n.parsePage(),r.initializedTrackingIds.forEach((function(e){var t,i=r.getTracker(e);(null===(t=null==i?void 0:i.vdsConfig)||void 0===t?void 0:t.trackPage)&&n.buildPageEvent(e)})))},this.hookHistory=function(){var e=window.history.pushState,t=window.history.replaceState,r=n;e&&V((function(){return window.history.pushState=function(){e.apply(window.history,arguments),setTimeout(r.pageListener)}})),t&&V((function(){return window.history.replaceState=function(){t.apply(window.history,arguments),setTimeout(r.pageListener)}})),Z(window,"popstate",n.pageListener),n.growingIO.vdsConfig.hashtag&&Z(window,"hashchange",n.pageListener)},this.buildPageEvent=function(e,r){var i=n.growingIO.dataStore,o=i.eventContextBuilder,a=i.eventConverter,s=t(t({eventType:"PAGE"},o(e)),{protocolType:location.protocol.substring(0,location.protocol.length-1),referralPage:n.getReferralPage()});G(r)||(s=t(t({},s),r)),s.timestamp=n.time,a(s),n.lastHref=window.location.href,n.lastNoHashHref=n._getNoHashHref(),n.lastLocation=t({},window.location)},this.title=document.title.slice(0,255),this.lastLocation=t({},window.location)},Me=function(e){var n,r=this;this.growingIO=e,this.ALLOW_SETTING=t({},ce),this.allowOptKeys=Object.keys(this.ALLOW_SETTING),this.trackTimers={},this.getTracker=function(e){return r.growingIO.trackingId===e?r.growingIO:null},this.getKeyPrefix=function(e){return r.growingIO.vdsConfig.projectId},this.getStorageKey=function(e,t){return"".concat(r.getKeyPrefix(e)).concat(ue[t])},this.getGsid=function(e){var t,n=r.growingIO.storage.getItem(r.getStorageKey(e,"gsid"))||{},i=Number(n.globalKey);return p(i)||i>=1e9||1>i?(t=1,r.setGsid(e,t)):t=i,t},this.setGsid=function(e,t){var n=p(Number(t))||t>=1e9||1>t?1:t;r.setSequenceIds(e,n)},this.setSequenceIds=function(e,t){var n=r.getStorageKey(e,"gsid"),i=r.growingIO.storage.getItem(n)||{};i.globalKey=t,r.growingIO.storage.setItem(n,i)},this.initTrackerOptions=function(e){var t=r.initOptions(e);return t.trackingId=e.trackingId,r.growingIO.trackingId=e.trackingId,r.growingIO.vdsConfig=t,window[r.growingIO.vdsName]=t,t},this.initOptions=function(e){var n,i,o,a,s,u,c,g=e.projectId,d=e.dataSourceId,l=e.appId,f={};return r.allowOptKeys.forEach((function(t){var n=r.ALLOW_SETTING[t].type,i=w(n)?!E(n,R(e[t])):R(e[t])!==n;"platform"!==t||E(se,e[t])||(i=!0),i?f[t]=r.ALLOW_SETTING[t].default:"ignoreFields"===t?f.ignoreFields=e.ignoreFields.filter((function(e){return E(ve,e)})):(f[t]=e[t],E(["dataCollect","autotrack"],t)&&(f[t]||M("已关闭".concat(le[t]),"info")))})),f.sessionExpires=Math.round(f.sessionExpires),(p(f.sessionExpires)||1>f.sessionExpires||f.sessionExpires>360)&&(f.sessionExpires=30),f.storageType=f.storageType.toLowerCase(),f.enableIdMapping&&!f.idMapping&&(f.idMapping=!0),j(f,"enableIdMapping"),f.sendType=f.sendType.toLowerCase(),E(["beacon","xhr","image"],f.sendType)||(f.sendType="beacon"),!f.trackBot&&X()&&(f.dataCollect=!1),!p(Number(f.requestTimeout))&&f.requestTimeout>0||(f.requestTimeout=5e3),t(t(t({},null!==(n=window[r.growingIO.vdsName])&&void 0!==n?n:{}),f),{projectId:g,dataSourceId:d,appId:l,performance:{monitor:null===(o=null===(i=f.performance)||void 0===i?void 0:i.monitor)||void 0===o||o,exception:null===(s=null===(a=f.performance)||void 0===a?void 0:a.exception)||void 0===s||s,network:null!==(c=null===(u=f.performance)||void 0===u?void 0:u.network)&&void 0!==c&&c}})},this.setOriginalSource=function(e){var t=r.growingIO,n=t.storage,i=t.userStore,o=n.getItem(r.getStorageKey(e,"sentSign"));if(i.getSessionId(e)!==o&&G(r.getOriginalSource(e))){var a=r.currentPage,s=a.path,u=a.query,c=a.getReferralPage,g={path:s,query:u,referralPage:document.referrer||c()};localStorage.setItem(r.getStorageKey(e,"originalSource"),JSON.stringify(g))}},this.getOriginalSource=function(e){return V((function(){return JSON.parse(localStorage.getItem(r.getStorageKey(e,"originalSource")))}))},this.setOption=function(e,n,i){var o,a=r.growingIO,s=a.emitter,u=a.userStore,c=a.vdsName,g=r.getTracker(e).vdsConfig,d=f(n)&&E(A(le),n),l=d&&typeof i===((null===(o=r.ALLOW_SETTING[n])||void 0===o?void 0:o.type)||"string"),v=t({},g);return d&&l?(g[n]=i,"dataCollect"===n&&v.dataCollect!==i&&(i?u.setSessionId(e,H()):r.growingIO.clearTrackTimer(e)),null==s||s.emit("OPTION_CHANGE",{trackingId:e,optionName:n,optionValue:i}),window[c][n]=i,!0):(Y("setOption > ".concat(n)),!1)},this.getOption=function(e,n){var i=r.getTracker(e).vdsConfig;return n&&D(i,P(n))?i[P(n)]:l(n)?t({},i):void Y("getOption > ".concat(n))},this.sendVerifiedVisit=function(e,t){var n=r.growingIO,i=n.userStore.getSessionId,o=n.storage.getItem(r.getStorageKey(e,"sentSign")),a=i(e)===o;!t&&a||r.buildVisitEvent(e)},this.sendVerifiedPage=function(e,t){t&&r.currentPage.parsePage(),r.getTracker(e).vdsConfig.trackPage&&r.currentPage.buildPageEvent(e)},this.buildVisitEvent=function(e,n){var i=r.growingIO,o=i.dataStore,a=o.eventContextBuilder,s=o.eventConverter,u=o.currentPage,c=i.emitter,g=i.vdsConfig,d=r.getOriginalSource(e),f=t(t({eventType:"VISIT"},a(e)),{referralPage:document.referrer||r.currentPage.getReferralPage(),timestamp:u.time-1});g.originalSource&&!l(d)&&(f=t(t({},f),d)),G(n)||L(f,(function(e,t){D(n,t)&&(v(n[t])?f[t]=n[t]:G(n[t])||(f[t]=n[t]||f[t]))})),c.on(Re,(function(t){var n=t.requestData,i=t.trackingId,o=r.growingIO,a=o.userStore,s=o.storage;if("VISIT"===n.eventType&&e===i){s.setItem(r.getStorageKey(n.trackingId,"sentSign"),n.sessionId),a.setUid(n.deviceId);var u=a.getUserId(i);u&&u===n.userId&&a.setUserId(i,a.getUserId(i));var c=a.getUserKey(i);c&&c===n.userKey&&a.setUserKey(i,a.getUserKey(i));var g=a.getGioId(i);g&&g===n.gioId&&a.setGioId(i,a.getGioId(i)),localStorage.removeItem(r.getStorageKey(i,"originalSource"))}})),s(f)},this.eventConverter=function(e){var n,i=r.growingIO.uploader;if(r.getTracker(e.trackingId).vdsConfig.dataCollect){e.eventSequenceId=r.getGsid(e.trackingId),"LOGIN_USER_ATTRIBUTES"===e.eventType?j(e,["timezoneOffset","eventSequenceId"]):r.setGsid(e.trackingId,r.getGsid(e.trackingId)+1);var o={};L(e,(function(e,t){var n;if("element"===t){var r=null!==(n=S(e))&&void 0!==n?n:{};L(r,(function(e,t){G(e)&&0!==e||(o[t]=e)}))}else(G(e)||l(e))&&0!==e||(o[t]=e)})),null===(n=r.growingIO.emitter)||void 0===n||n.emit(je,{composedEvent:t({},o),trackingId:e.trackingId}),i.commitRequest(t(t({},o),{requestId:H()}))}},this.currentPage=new He(this.growingIO),this.eventContextBuilderInst=new Be(this.growingIO),this.eventContextBuilder=null===(n=this.eventContextBuilderInst)||void 0===n?void 0:n.main,this.generalProps={},this.lastPageEvent={};var i=this.growingIO.emitter;null==i||i.on(je,(function(e){var t=e.composedEvent;"PAGE"!==t.eventType&&"page"!==t.t||t.trackingId!==r.growingIO.trackingId||(r.lastPageEvent=t)})),this.initializedTrackingIds=[],i.on(De,(function(e){var t=e.trackingId;r.initializedTrackingIds.push(t)})),null==i||i.on(Ae,(function(e){var t=e.trackingId;E(r.initializedTrackingIds,t)&&(r.growingIO.uploader.hoardingQueue[t]=[],r.currentPage.parsePage(),r.sendVerifiedVisit(t,!0),r.sendVerifiedPage(t,!0))}))},Ve=["gioPerformance"],ze=function(t){function n(e){var n=t.call(this,e)||this;return n.growingIO=e,n.growingIO.gioSDKFull=!1,n.pluginsContext={plugins:{}},n}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+n+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}(n,t),n}((function(e){var t,n,r,i,o,a,s=this;this.growingIO=e,this.innerPluginInit=function(){var e;Ve.forEach((function(e){var t;return j(null===(t=s.pluginsContext)||void 0===t?void 0:t.plugins,e)})),A(null===(e=s.pluginsContext)||void 0===e?void 0:e.plugins).forEach((function(e){var t,n,r=null!==(n=null===(t=s.pluginsContext)||void 0===t?void 0:t.plugins[e])&&void 0!==n?n:{},i=r.name,o=r.method,a=T(s.pluginItems,(function(e){return e.name===i}));i&&o&&!a&&s.pluginItems.push({name:x(i||e),method:o||function(e){}})})),G(s.pluginItems)||s.installAll()},this.install=function(e,t,n){var r,i,o=s.growingIO.emitter,a=t||T(s.pluginItems,(function(t){return t.name===e}));if((null===(r=s.growingIO)||void 0===r?void 0:r.plugins)[e])return M("重复加载插件 ".concat(e," 或插件重名，已跳过加载!"),"warn"),!1;if(!a)return M("插件加载失败!不存在名为 ".concat(e," 的插件!"),"error"),!1;try{return(null===(i=s.growingIO)||void 0===i?void 0:i.plugins)[e]=new a.method(s.growingIO,n),t&&(o.emit(Le,e),M("加载插件 ".concat(e),"info")),!0}catch(n){return s.lifeError(t,n),M("插件【".concat(e,"】加载异常 ").concat(n),"error"),!1}},this.installAll=function(e){(e||s.pluginItems).forEach((function(t){s.install(t.name,e?t:void 0,e?null==t?void 0:t.options:void 0)&&!T(s.pluginItems,(function(e){return e.name===t.name}))&&s.pluginItems.push({name:x(t.name),method:t.method?t.method:function(){}})}))},this.uninstall=function(e){var t;j(s.pluginItems,e);var n=j(null===(t=s.growingIO)||void 0===t?void 0:t.plugins,e);return n||M("卸载插件 ".concat(e," 失败!"),"error"),n},this.uninstallAll=function(){s.pluginItems.forEach((function(e){return s.uninstall(e.name)}))},this.lifeError=function(e,t){s.growingIO.emitter.emit(Fe,{plugin:e,error:t}),M("插件执行错误 ".concat(e.name," ").concat(t),"error")},this.callLifeCycle=function(e,t){s.pluginItems.forEach((function(n){var r=s.growingIO.plugins[n.name]?s.growingIO.plugins[n.name][e]:void 0;if(r&&h(r))try{r(t)}catch(e){s.lifeError(n,e)}}))},this.pluginsContext={plugins:{}},this.pluginItems=[],null===(t=this.growingIO.emitter)||void 0===t||t.on(Le,(function(e){return s.callLifeCycle("onInstall",e)})),null===(n=this.growingIO.emitter)||void 0===n||n.on(Fe,(function(e){return s.callLifeCycle("onError",e)})),null===(r=this.growingIO.emitter)||void 0===r||r.on("ON_COMPOSE_BEFORE",(function(e){return s.callLifeCycle("onComposeBefore",e)})),null===(i=this.growingIO.emitter)||void 0===i||i.on(je,(function(e){return s.callLifeCycle("onComposeAfter",e)})),null===(o=this.growingIO.emitter)||void 0===o||o.on(Ge,(function(e){return s.callLifeCycle("onSendBefore",e)})),null===(a=this.growingIO.emitter)||void 0===a||a.on(Re,(function(e){return s.callLifeCycle("onSendAfter",e)}))})),Qe=function(e){var r=this;this.growingIO=e,this.generateURL=function(e){var t=r.growingIO.dataStore.getTracker(e).vdsConfig,n=t.serverUrl,i=t.projectId;return N(n,"http")?"".concat(n,"/v3/projects/").concat(i,"/collect"):"https://".concat(n,"/v3/projects/").concat(i,"/collect")},this.getSendType=function(e){var t=r.growingIO.dataStore.getTracker(e).vdsConfig.sendType;return"beacon"===t?Q()?"beacon":"xhr":t},this.getHoardingQueue=function(e){var t;return null!==(t=r.hoardingQueue[e])&&void 0!==t?t:[]},this.commitRequest=function(e){var n,i=t(t({},e),{requestType:r.getSendType(e.trackingId)});r.growingIO.vdsConfig.forceLogin?null===(n=r.getHoardingQueue(e.trackingId))||void 0===n||n.push(i):(r.requestQueue.push(i),r.initiateRequest(e.trackingId))},this.initiateRequest=function(e){var i=r.getHoardingQueue(e);if(n(n([],i,!0),r.requestQueue,!0).length>0&&r.requestingNum<r.requestLimit){var o=r.growingIO.emitter;if(r.requestQueue=n(n([],i,!0),r.requestQueue,!0),r.hoardingQueue[e]=[],G(r.requestQueue))return;var a=r.requestQueue.shift();null==o||o.emit(Ge,{requestData:t({},a),trackingId:a.trackingId})}},this.sendEvent=function(e){var n,i,o=r.growingIO,a=o.vdsConfig,s=o.useHybridInherit,u=o.plugins,c=t({},e),g=r.generateURL(e.trackingId);if(j(c,["requestType","trackingId","requestId","customEventType"]),a.debug&&console.log("[GrowingIO Debug]:",JSON.stringify(c,null,2).replace(/"/g,W()?"":'"')),r.requestingNum+=1,s&&e.trackingId===r.growingIO.trackingId)return r.requestSuccessFn(e),!1;var d,l=t({},c);a.compress&&(null==u?void 0:u.gioCompress)?"image"===e.requestType?(d="11",l=null===(n=null==u?void 0:u.gioCompress)||void 0===n?void 0:n.compressToEncodedURIComponent(JSON.stringify([l]))):(d="1",l=null===(i=null==u?void 0:u.gioCompress)||void 0===i?void 0:i.compressToUint8Array(JSON.stringify([l]))):(d="0",l=JSON.stringify([l]));var f="".concat(g,"?stm=").concat(+Date.now(),"&compress=").concat(d);switch(e.requestType){case"beacon":default:r.sendByBeacon(e,l,f);break;case"xhr":r.sendByXHR(e,l,f);break;case"image":r.sendByImage(e,l,f)}},this.sendByBeacon=function(e,t,n){navigator.sendBeacon(n,t)?r.requestSuccessFn(e):r.requestFailFn(e,"xhr")},this.sendByXHR=function(e,t,n){var i=r.growingIO.dataStore.getTracker(e.trackingId),o=new XMLHttpRequest;if(o)return o.open("POST",n,!0),o.onload=function(){204===o.status?r.requestSuccessFn(e):r.requestFailFn(e,"image")},o.ontimeout=o.onerror=o.onabort=function(){r.requestFailFn(e,"image")},o.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),o.timeout=i.vdsConfig.requestTimeout,void o.send(t);if(null===window||void 0===window?void 0:window.XDomainRequest){var a=new window.XDomainRequest;a.open("POST",n.replace("https://","http://"),!0),a.onload=function(){204===a.status?r.requestSuccessFn(e):r.requestFailFn(e,"image")},a.onerror=a.ontimeout=function(){r.requestFailFn(e,"image")},a.send(t)}},this.sendByImage=function(e,t,n){var i=r.growingIO.dataStore.getTracker(e.trackingId),o="".concat(n,"&data=").concat(t),a=document.createElement("img");a.width=1,a.height=1;var s=window.setTimeout((function(){r.requestingNum-=1,r.clearImage(a),window.clearTimeout(s),s=null,r.initiateRequest(e.trackingId)}),i.vdsConfig.requestTimeout);a.onload=function(){r.requestSuccessFn(e),r.clearImage(a),window.clearTimeout(s),s=null},a.onerror=a.onabort=function(){r.requestSuccessFn(e),r.clearImage(a),window.clearTimeout(s),s=null},a.src=o},this.clearImage=function(e){e.src="",e.onload=function(){},e.onerror=e.onerabort=function(){},e=null},this.requestSuccessFn=function(e){var n;r.requestingNum-=1;var i=r.growingIO.userStore.getSessionId(e.trackingId);i===e.sessionId&&r.growingIO.userStore.setSessionId(e.trackingId,i),null===(n=r.growingIO.emitter)||void 0===n||n.emit(Re,{requestData:t({},e),trackingId:e.trackingId}),r.initiateRequest(e.trackingId)},this.requestFailFn=function(e,n){if(r.requestingNum-=1,!r.requestQueue.some((function(t){return t.requestId===e.requestId}))&&n)var i=window.setTimeout((function(){r.requestQueue.push(t(t({},e),{requestType:n})),r.initiateRequest(e.trackingId),window.clearTimeout(i),i=null}),800)},this.hoardingQueue={},this.requestQueue=[],this.requestLimit=10,this.requestingNum=0,this.growingIO.emitter.on(qe,(function(e){var t=e.trackingId;r.hoardingQueue[t]=[]})),this.growingIO.emitter.on(Ge,(function(e){var t=e.requestData;e.trackingId===r.growingIO.trackingId&&r.sendEvent(t)}))},Je="gdp_user_id_gioenc",We=function(e){var t=this;this.growingIO=e,this.getUid=function(){var e=t.growingIO.storage.getItem(Je);if(e)return e;var n=H();return t.setUid(n),n},this.setUid=function(e){var n,r=t.growingIO.storage,i=r.getItem(Je)||t.prevUId;r.setItem(Je,e),i!==e&&(null===(n=t.growingIO.emitter)||void 0===n||n.emit("UID_UPDATE",{newUId:e,oldUId:i})),t.prevUId=e},this._getSidKey=function(e){return t.growingIO.dataStore.getStorageKey(e,"sessionId")},this.getPrevSessionId=function(e){var n;return null===(n=t.prevIds[e])||void 0===n?void 0:n.sessionId},this.getSessionId=function(e){var n=t.growingIO.storage.getItem(t._getSidKey(e));if(n)return n;var r=H();return t.setSessionId(e,r),r},this.setSessionId=function(e,n){n||(n=H());var r=t.growingIO,i=r.storage,o=r.dataStore,a=r.emitter,s=i.getItem(t._getSidKey(e))||t.getPrevSessionId(e),u=o.getTracker(e).vdsConfig.sessionExpires,c=void 0===u?30:u;i.setItem(t._getSidKey(e),n,+Date.now()+60*c*1e3),s!==n&&(i.getKeys().filter((function(e){return g.test(e)})).forEach((function(e){i.removeItem(e)})),i.setItem(o.getStorageKey(e,"sentSign"),""),null==a||a.emit(Ae,{newSessionId:n,oldSessionId:s,trackingId:e})),t.prevIds[e]||(t.prevIds[e]={}),t.prevIds[e].sessionId=n},this._getUserIdKey=function(e){return t.growingIO.dataStore.getStorageKey(e,"userId")},this.getPrevUserId=function(e){var n;return null===(n=t.prevIds[e])||void 0===n?void 0:n.userId},this.getUserId=function(e){return t.growingIO.storage.getItem(t._getUserIdKey(e))||""},this.setUserId=function(e,n){var r,i,o=t.growingIO.storage,a=o.getItem(t._getUserIdKey(e))||t.getPrevUserId(e);o.setItem(t._getUserIdKey(e),n),null===(r=t.growingIO.emitter)||void 0===r||r.emit("SET_USERID",{newUserId:n,oldUserId:a,userKey:t.getUserKey(e),trackingId:e}),a!==n&&(null===(i=t.growingIO.emitter)||void 0===i||i.emit("USERID_UPDATE",{newUserId:n,oldUserId:a,userKey:t.getUserKey(e),trackingId:e})),n&&t.setGioId(e,n),t.prevIds[e]||(t.prevIds[e]={}),t.prevIds[e].userId=n},this._getUserKeyKey=function(e){return t.growingIO.dataStore.getStorageKey(e,"userKey")},this.getPrevUserKey=function(e){var n;return null===(n=t.prevIds[e])||void 0===n?void 0:n.userKey},this.getUserKey=function(e){return t.growingIO.storage.getItem(t._getUserKeyKey(e))||""},this.setUserKey=function(e,n){var r,i,o=t.growingIO.storage,a=o.getItem(t._getUserKeyKey(e))||t.getPrevUserKey(e);o.setItem(t._getUserKeyKey(e),n),null===(r=t.growingIO.emitter)||void 0===r||r.emit("SET_USERKEY",{newUserKey:n,oldUserKey:a,userId:t.getUserId(e),trackingId:e}),a!==n&&(null===(i=t.growingIO.emitter)||void 0===i||i.emit("USERKEY_UPDATE",{newUserKey:n,oldUserKey:a,userId:t.getUserId(e),trackingId:e})),t.prevIds[e]||(t.prevIds[e]={}),t.prevIds[e].userKey=n},this._getGioIdKey=function(e){return t.growingIO.dataStore.getStorageKey(e,"gioId")},this.getPrevGioId=function(e){var n;return null===(n=t.prevIds[e])||void 0===n?void 0:n.gioId},this.getGioId=function(e){return t.growingIO.storage.getItem(t._getGioIdKey(e))||""},this.setGioId=function(e,n){var r,i=t.growingIO.storage,o=i.getItem(t._getGioIdKey(e))||t.getPrevGioId(e);i.setItem(t._getGioIdKey(e),n),o!==n&&(null===(r=t.growingIO.emitter)||void 0===r||r.emit("GIOID_UPDATE",{newGioId:n,oldGioId:o,trackingId:e})),t.prevIds[e]||(t.prevIds[e]={}),t.prevIds[e].gioId=n},this.transferStorage=function(){var e=t.growingIO,n=e.vdsConfig.projectId,r=e.storage,i=e.trackingId;t.setUid(r.getItem("gr_user_id")||t.getUid()),t.setUserId(i,r.getItem("".concat(n,"_gr_cs1"))||t.getUserId(i)),r.removeItem("gr_user_id"),r.removeItem("".concat(n,"_gr_cs1")),r.removeItem("".concat(n,"_gr_last_sent_cs1")),r.removeItem("".concat(n,"_gr_last_sent_sid_with_cs1")),r.removeItem("".concat(n,"_gr_session_id")),r.removeItem("".concat(n,"_gr_session_id_sent_vst"));var o=T(r.getKeys(),(function(e){return e.indexOf("gr_imp_")>-1}));o&&r.removeItem(o)};var n=this.growingIO.storage;this.prevIds={},this.growingIO.emitter.on(qe,(function(e){e.trackingId===t.growingIO.trackingId&&n.getItem("gr_user_id")&&t.transferStorage()}))},Xe=function(){var e,r=this;this.init=function(e){var t,n;try{if(M("Gio Web SDK 初始化中...","info"),e.trackingId&&E(r.dataStore.initializedTrackingIds,e.trackingId))throw Error("已存在实例 ".concat(e.trackingId,"，请勿重复初始化!"));if(r.trackingId&&!r.plugins.gioMultipleInstances)throw Error("您正在尝试初始化另一个实例，请集成多实例插件后重试!");var i=r.dataStore,o=i.currentPage,a=i.sendVerifiedVisit,s=i.sendVerifiedPage,u=r.dataStore.initTrackerOptions(e),c=!r.trackingId||u.trackingId===r.trackingId;return c&&(r.storage=Ke(r.vdsConfig),r.uploader=new Qe(r),r.userStore=new We(r),o.hookHistory(),r.gioSDKInitialized=!0,r.vdsConfig.gioSDKInitialized=!0,window[r.vdsName]=r.vdsConfig),o.parsePage(),r.vdsConfig.originalSource&&r.dataStore.setOriginalSource(e.trackingId),null===(t=r.emitter)||void 0===t||t.emit(qe,{growingIO:r,trackingId:e.trackingId,vdsConfig:u}),M("Gio Web SDK 初始化完成！","success"),r.vdsConfig.forceLogin&&M("forceLogin已开启，请调用 identify 方法设置 openId 以继续上报!","info"),c&&r.useEmbeddedInherit||a(e.trackingId),s(e.trackingId),null===(n=r.emitter)||void 0===n||n.emit(De,{growingIO:r,trackingId:e.trackingId}),!0}catch(e){return M(e,"error"),!1}},this.handlerDistribute=function(e,t,i){r.dataStore.getTracker(e)?r[t].apply(r,n([e],i,!1)):M("不存在实例：".concat(e,"，请检查!"),"warn")},this.sendVisit=function(e,n,i){r.dataStore.buildVisitEvent(t(t({},n),{trackingId:e})),z(i)},this.sendPage=function(e,n,i){r.dataStore.currentPage.buildPageEvent(t(t({},n),{trackingId:e})),z(i)},this.registerPlugins=function(e,n){w(e)?(e.forEach((function(n,r){var i,o;G(n)||l(n)?M("插件不合法，跳过加载!","warn"):(null===(i=n.js)||void 0===i?void 0:i.default)&&(e[r]=t(t({},null===(o=n.js)||void 0===o?void 0:o.default),{options:n.options}))})),e=k(e),r.plugins.installAll(e)):M("插件注册失败，请检查!","error"),z(n,r.plugins.pluginItems)},this.getPlugins=function(e){z(e,r.plugins.pluginItems)},this.getDeviceId=function(e){z(e,r.userStore.getUid())},this.setOption=function(e,t,n,i){var o;E(A(le),t)?(o=r.dataStore.setOption(e,t,n))&&le[t]&&M("已修改".concat(le[t],": ").concat(n),"info"):(M("不存在可修改的配置项：".concat(t,"，请检查后重试!"),"warn"),o=!1),z(i,o)},this.getOption=function(e,t,n){z(n,r.dataStore.getOption(e,t))},this.setGeneralProps=function(e,n,i){var o,a,s=r.dataStore.getTracker(e);s?I(n)&&!G(n)?(s.generalProps=t(t({},null!==(o=s.generalProps)&&void 0!==o?o:{}),n),A(s.generalProps).forEach((function(e){E([void 0,null],s.generalProps[e])&&(s.generalProps[e]="")})),a=!0):(Y("setGeneralProps"),a=!1):(Y("setGeneralProps",!0,"不存在实例".concat(e,"!")),a=!1),z(i,a)},this.clearGeneralProps=function(e,t,n){var i=r.dataStore.getTracker(e);i?w(t)&&!G(t)?t.forEach((function(e){j(i.generalProps,e)})):i.generalProps={}:Y("setGeneralProps",!0,"不存在实例".concat(e,"!")),z(n)},this.identify=function(e,t,n){if(e===r.trackingId){if(r.vdsConfig.forceLogin){if(!oe(t))return void Y("identify");var i=P(t).slice(0,1e3);r.userStore.setUid(i),r.dataStore.initializedTrackingIds.forEach((function(e){var t=r.uploader.getHoardingQueue(e);t.forEach((function(e,n){return t[n].deviceId=i})),r.uploader.initiateRequest(e)})),r.dataStore.setOption(r.trackingId,"forceLogin",!1)}else Y("identify",!1,"forceLogin未开启");z(n)}else Y("identify",!1,"子实例不允许调用identify")},this.setUserId=function(e,t,n,i){var o;if(oe(P(t).trim())){var a=r.userStore.getGioId(e),s=!l(n)&&P(n).length>0?P(n).slice(0,1e3):"";r.dataStore.getTracker(e).vdsConfig.idMapping?r.userStore.setUserKey(e,s):s&&M("您设置了 userKey ，请初始化开启 idMapping!","warn"),r.userStore.setUserId(e,P(t).slice(0,1e3)),a&&a!==r.userStore.getUserId(e)&&r.userStore.setSessionId(e,""),o=!0}else r.clearUserId(e),Y("setUserId"),o=!1;z(i,o)},this.clearUserId=function(e,t){r.userStore.setUserId(e,""),r.userStore.setUserKey(e,""),z(t)},this.setUserAttributes=function(e,n,i){var o;if(!G(n)&&I(n)){var a=r.dataStore,s=a.eventContextBuilder;(0,a.eventConverter)(t({eventType:"LOGIN_USER_ATTRIBUTES",attributes:te(n)},s(e))),o=!0}else Y("setUserAttributes"),o=!1;z(i,o)},this.track=function(e,n,i,o){ae(n,(function(){var o,a=r.dataStore,s=a.eventContextBuilder,u=a.eventConverter,c=null!==(o=r.dataStore.getTracker(e).generalProps)&&void 0!==o?o:{},g=t(t({},c),I(i)&&!G(i)?i:{});u(t(t({eventType:"CUSTOM",eventName:n,attributes:te(ne(g))},s(e)),{customEventType:1}))})),z(o)},this.trackTimerStart=function(e,t,n){var i,o,a=r.dataStore.getTracker(e);(null===(i=null==a?void 0:a.vdsConfig)||void 0===i?void 0:i.dataCollect)?ae(t,(function(){o=H(),r.dataStore.trackTimers[e]||(r.dataStore.trackTimers[e]={}),r.dataStore.trackTimers[e][o]={eventName:t,leng:0,start:+Date.now()}})):M("指定实例未开启数据采集，请检查!","error"),z(n,o)},this.trackTimerPause=function(e,t,n){var i=r.dataStore.trackTimers[e];if(t&&i&&i[t]){var o=i[t];o.start&&(o.leng=o.leng+(+Date.now()-o.start)),o.start=0}else M("未查询到指定计时器，请检查!","error");z(n)},this.trackTimerResume=function(e,t,n){var i=r.dataStore.trackTimers[e];if(t&&i&&i[t]){var o=i[t];0===o.start&&(o.start=+Date.now())}else M("未查询到指定计时器，请检查!","error");z(n)},this.trackTimerEnd=function(e,n,i,o){var a,s,u=r.dataStore.getTracker(e),c=r.dataStore.trackTimers[e];if(n&&c&&c[n]){if(null===(a=u.vdsConfig)||void 0===a?void 0:a.dataCollect){var g=c[n];if(0!==g.start){var d=+Date.now()-g.start;g.leng=d>0?g.leng+d:0}var l=r.dataStore,f=l.eventContextBuilder;(0,l.eventConverter)(t(t({eventType:"CUSTOM",eventName:g.eventName,attributes:te(t(t({},i),{event_duration:g.leng>864e5?0:g.leng/1e3}))},f(e)),{customEventType:0})),s=!0}else M("指定实例未开启数据采集，计时器已移除，请检查!","error");r.removeTimer(e,n)}else M("未查询到指定计时器，请检查!","error"),s=!1;z(o,s)},this.removeTimer=function(e,t,n){var i=r.dataStore.trackTimers[e];t&&i&&i[t]?delete i[t]:M("未查询到指定计时器，请检查!","error"),z(n)},this.clearTrackTimer=function(e,t){r.dataStore.trackTimers[e]={},z(t)},this.updateImpression=function(e){var t,n,i=null===(n=null===(t=r.plugins)||void 0===t?void 0:t.gioImpressionTracking)||void 0===n?void 0:n.main;i?i("emitter"):M("updateImpression 错误! 请集成半自动埋点浏览插件后重试!","error"),z(e)},this.sdkVersion="4.1.0",this.vdsName=window._gio_local_vds||"vds",this.utils=t(t({},B),ie),this.emitter={all:e=e||new Map,on:function(t,n){var r=e.get(t);r?r.push(n):e.set(t,[n])},off:function(t,n){var r=e.get(t);r&&(n?r.splice(r.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var r=e.get(t);r&&r.slice().map((function(e){e(n)})),(r=e.get("*"))&&r.slice().map((function(e){e(t,n)}))}},this.useEmbeddedInherit=!1,this.useHybridInherit=!1,this.gioSDKInitialized=!1,this.plugins=new ze(this),this.plugins.innerPluginInit(),this.dataStore=new Me(this)},Ye=window._gio_local_vds||"vds",Ze=null!==(he=null===(me=window[Ye])||void 0===me?void 0:me.namespace)&&void 0!==he?he:"gdp";return function(){var e,n,r,i,o;if(null===(e=window[Ye])||void 0===e?void 0:e.gioSDKInstalled)return we=window[Ze],void M("SDK重复加载，请检查是否重复加载SDK或接入其他平台SDK导致冲突!","warn");window[Ye]=t(t({},null!==(n=window[Ye])&&void 0!==n?n:{}),{gioSDKInstalled:!0});var a=new Xe;we=function(){var e,n,r=arguments[0],i="g0",o=r;if(r.indexOf(".")>-1&&(i=null!==(e=r.split(".")[0])&&void 0!==e?e:"g0",o=r.split(".")[1]),f(o)&&E(de,o)&&a[o]){var s=_(C(arguments));if("init"===o){var u=function(e,t){var n=(4===t.length?t[3]:t[2])||{};return t[0]&&t[1]?{projectId:P(t[0]),dataSourceId:P(t[1]),appId:P(4===t.length?t[2]:""),userOptions:n}:(M('SDK初始化失败，请使用 gdp("init", "您的GrowingIO项目 accountId", "您项目的 dataSourceId", "您的小程序 AppId（可选）", options: { host: "您的数据上报地址host" }); 进行初始化!',"error"),!1)}(0,s);if(u){var c=u.projectId,g=u.dataSourceId,d=u.appId,l=u.userOptions;return a.init(t(t({},l),{projectId:c,dataSourceId:g,appId:d,trackingId:i}))}return!1}"registerPlugins"===o?a.registerPlugins.apply(a,s):a.gioSDKInitialized&&a.vdsConfig?E(ge,o)?V((function(){return a.handlerDistribute(i,o,s)})):V((function(){return a[o].apply(a,s)})):(a.emitter.emit("UN_EXECUTE_CALL",arguments),M("SDK未初始化!","error"))}else E(fe,o)?M("方法 ".concat(P(o)," 已被弃用，请移除!"),"warn"):"canIUse"===o?z(arguments[2],E(de,arguments[1])&&!!a[arguments[1]]):M("不存在名为 ".concat(P(o)," 的方法调用!"),"error");window[Ye]=t(t({},window[Ye]),{_gr_ignore_local_rule:null!==(n=window._gr_ignore_local_rule)&&void 0!==n&&n,gioSDKVersion:a.sdkVersion,gioSDKFull:a.gioSDKFull})};var s=null===(r=window[Ze])||void 0===r?void 0:r.q,u=null===(i=window[Ze])||void 0===i?void 0:i.e,c=null===(o=window[Ze])||void 0===o?void 0:o.ef;window[Ze]=we,window[Ze].e=u,window[Ze].ef=c,window.gdp=we,window.gdp.e=u,window.gdp.ef=c,w(s)&&!G(s)&&C(Array(s.length)).forEach((function(){we.apply(null,s.shift())}))}(),we}));
