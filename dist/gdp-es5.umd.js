!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).gdp=t()}(this,(function(){"use strict";var e,t,n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)({}).hasOwnProperty.call(t,n)&&(e[n]=t[n])},n(e,t)},r=function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++)for(var i in t=arguments[n])({}).hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};function i(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;o>i;i++)!r&&i in t||(r||(r=[].slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||[].slice.call(t))}var o,a,s,u="function"==typeof Array.from?Array.from:(t||(t=1,o=function(e){return"function"==typeof e},a=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),9007199254740991)},s=function(e){var t=e.next();return!t.done&&t},e=function(e){var t,n,r,i=this,u=arguments.length>1?arguments[1]:void 0;if(void 0!==u){if(!o(u))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(t=arguments[2])}var c=function(e,t){if(null!=e&&null!=t){var n=e[t];if(null==n)return;if(!o(n))throw new TypeError(n+" is not a function");return n}}(e,function(e){if(null!=e){if(["string","number","boolean","symbol"].indexOf(typeof e)>-1)return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in e)return Symbol.iterator;if("@@iterator"in e)return"@@iterator"}}(e));if(void 0!==c){n=o(i)?Object(new i):[];var d,l,g=c.call(e);if(null==g)throw new TypeError("Array.from requires an array-like or iterable object");for(r=0;;){if(!(d=s(g)))return n.length=r,n;l=d.value,n[r]=u?u.call(t,l,r):l,r++}}else{var f=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var v,h=a(f.length);for(n=o(i)?Object(new i(h)):Array(h),r=0;h>r;)v=f[r],n[r]=u?u.call(t,v,r):v,r++;n.length=h}return n}),e),c=function(e){return b(["undefined","null"],j(e))},d=function(e){return"string"===j(e)},l=function(e){return"number"===j(e)},g=function(e){return"NaN"===E(Number(e))},f=function(e){return"object"===j(e)&&!c(e)},v=function(e){return"regexp"===j(e)},h=function(e){return b(["function","asyncfunction"],j(e))},p=function(e){return Array.isArray(e)&&"array"===j(e)},m=function(e){return"date"===j(e)},I=function(e){try{return T(e)[0]}catch(e){return}},w=function(e){try{var t=T(e);return t[t.length-1]}catch(e){return}},y=function(e,t){return void 0===t&&(t=1),p(e)&&l(t)?e.slice(t>0?t:1,e.length):e},S=function(e){if(p(e)){for(var t=0,n=[],r=0,i=e;r<i.length;r++){var o=i[r];o&&!L(o)&&(n[t++]=o)}return n}return e},O=function(e,t){return e[_(e,t)]},_=function(e,t){var n=-1;return p(e)&&e.every((function(e,r){return!t(e)||(n=r,!1)})),n},b=function(e,t){return("array"===j(e)||"string"===j(e))&&e.indexOf(t)>=0},T=u,E=function(e){return c(e)?"":"".concat(e)},C=function(e,t){return"string"==typeof e?e.split(t):e},N=function(e){if(d(e)){var t=C(e,"");return"".concat(I(t).toLowerCase()).concat(y(t).join(""))}return e},x=function(e,t){return!!d(e)&&e.slice(0,t.length)===t},P=function(e,t){if(d(e)){var n=e.length,r=n;r>n&&(r=n);var i=r;return(r-=t.length)>=0&&e.slice(r,i)===t}return!1},k={}.hasOwnProperty,D=function(e,t){return!c(e)&&k.call(e,t)},q=function(e){return f(e)?Object.keys(e):[]},A=function(e,t){q(e).forEach((function(n){return t(e[n],n)}))},U=function(e,t){var n=q(e);return!(!f(e)||!f(t)||n.length!==q(t).length||b(n.map((function(n,r){return f(e[n])?U(e[n],t[n]):e[n]===t[n]})),!1))},K=function(e,t){if(!f(e))return!1;try{return"string"===j(t)?delete e[t]:"array"===j(t)?t.map((function(t){return delete e[t]})):(v(t)&&q(e).forEach((function(n){t.test(n)&&K(e,n)})),!0)}catch(e){return!1}},L=function(e){return p(e)?0===e.length:f(e)?0===q(e).length:!e},j=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},F=Object.freeze({__proto__:null,isNil:c,isString:d,isNumber:l,isNaN:g,isBoolean:function(e){return"boolean"===j(e)},isObject:f,isRegExp:v,isFunction:h,isArray:p,isDate:m,fixed:function(e,t){return l(e)?Number(e.toFixed(l(t)?t:2)):d(e)&&"NaN"!==E(Number(e))?Number(Number(e).toFixed(l(t)?t:2)):e},head:I,last:w,drop:y,dropWhile:function(e,t){return p(e)?e.filter((function(e){return!t(e)})):e},compact:S,find:O,findIndex:_,includes:b,arrayFrom:T,toString:E,split:C,lowerFirst:N,upperFirst:function(e){if(d(e)){var t=C(e,"");return"".concat(I(t).toUpperCase()).concat(y(t).join(""))}return e},startsWith:x,endsWith:P,has:D,keys:q,forEach:A,isEqual:U,get:function(e,t,n){var r=e;return f(e)?(t.split(".").forEach((function(e){r=r?r[e]:n})),r):n},unset:K,isEmpty:L,typeOf:j,formatDate:function(e){if(m(e)){var t=function(e){return 10>e?"0"+e:e};return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+t(e.getMilliseconds())}return e}}),B=function(e,t){console.log("%c [GrowingIO]：".concat(e),{info:"color: #3B82F6;",error:"color: #EF4444;",warn:"color: #F59E0B;",success:"color: #10B981;"}[t]||"")},R=function(e){try{return e()}catch(e){return}},H=function(e,t){if(h(e))try{e(t)}catch(e){B("回调执行失败！".concat(e),"error")}},G=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n="参数不合法"),B("".concat(t?"调用":"设置"," ").concat(e," 失败，").concat(n,"!"),"warn")},M=function(e){var t={};return f(e)&&A(e,(function(e,n){var r=E(n).slice(0,100);f(e)?t[r]=M(e):p(e)?(t[r]=e.slice(0,100),t[r]=t[r].join("||").slice(0,1e3)):t[r]=c(e)?"":E(e).slice(0,1e3)})),t},Q=function(e,t,n,i){void 0===i&&(i={}),document.addEventListener?e.addEventListener(t,n,r(r({},{capture:!0}),i)):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},V=function(e,t){return d(e)&&!L(e)&&e.match(/^[a-zA-Z_][0-9a-zA-Z_]{0,100}$/)?t():(B("事件名格式不正确，只能包含数字、字母和下划线，且不能以数字开头，字符总长度不能超过100!","error"),!1)},z=Object.freeze({__proto__:null,consoleText:B,niceTry:R,niceCallback:H,callError:G,limitObject:M,addListener:Q,flattenObject:function(e){void 0===e&&(e={});var t=r({},e);return q(t).forEach((function(e){f(t[e])?(q(t[e]).forEach((function(n){t["".concat(e,"_").concat(n)]=E(t[e][n])})),K(t,e)):p(t[e])?(t[e].forEach((function(n,r){f(n)?q(n).forEach((function(i){t["".concat(e,"_").concat(r,"_").concat(i)]=E(n[i])})):t["".concat(e,"_").concat(r)]=E(n)})),K(t,e)):c(t[e])||""===t[e]?K(t,e):t[e]=E(t[e])})),M(t)},eventNameValidate:V,getGioFunction:function(){var e,t,n,r,i=window._gio_local_vds||"vds",o=null!==(t=null===(e=window[i])||void 0===e?void 0:e.namespace)&&void 0!==t?t:"gdp";return h(window[o])?window[o]:null!==(r=null!==(n=window.gdp)&&void 0!==n?n:window.gio)&&void 0!==r?r:function(){}},hashCode:function(e){var t=0;if(L(e)||"boolean"==typeof e)return t;for(var n=0;n<e.length;)t=(t<<5)-t+e.charCodeAt(n),t&=t,n++;return t}}),J=function(e){return d(e)&&e.length>0||l(e)&&e>0},W=["web","wxwv","Android","iOS","minp","alip","baidup","qq","bytedance","kuaishoup","jdp","xhsp"],Z={autotrack:{type:"boolean",default:!0},compress:{type:"boolean",default:!0},cookieDomain:{type:"string",default:""},dataCollect:{type:"boolean",default:!0},debug:{type:"boolean",default:!1},embeddedIgnore:{type:"array",default:[]},forceLogin:{type:"boolean",default:!1},idMapping:{type:"boolean",default:!1},enableIdMapping:{type:"boolean",default:!1},gtouchHost:{type:"string",default:""},hashtag:{type:"boolean",default:!1},ignoreFields:{type:"array",default:[]},originalSource:{type:"boolean",default:!0},penetrateHybrid:{type:"boolean",default:!0},performance:{type:"object",default:{monitor:!0,exception:!0}},platform:{type:"string",default:"web"},sendType:{type:"string",default:"beacon"},serverUrl:{type:"string",default:"https://napi.growingio.com"},sessionExpires:{type:"number",default:30},storageType:{type:"string",default:"cookie"},touch:{type:"boolean",default:!1},trackBot:{type:"boolean",default:!0},version:{type:"string",default:"1.0.0"}},Y=["clearGeneralProps","clearTrackTimer","clearUserId","getDeviceId","getOption","getPlugins","identify","init","registerPlugins","removeTimer","sendPage","sendVisit","setGeneralProps","setOption","setUserAttributes","setUserId","track","trackTimerEnd","trackTimerPause","trackTimerResume","trackTimerStart","getABTest"],X={autotrack:"无埋点采集",dataCollect:"数据采集",dataSourceId:"数据源ID",debug:"调试模式",forceLogin:"强制登录",hashtag:"哈希解析",serverUrl:"数据上报服务地址"},$=["collectImp","enableDebug","enableHT","getVisitorId","send","setAutotrack","setConfig","setDataCollect","setPlatformProfile","setTrackerHost","setTrackerScheme"],ee=["screenHeight","screenWidth"],te=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},ne=function(e){return P(e,"_gioenc")?e.slice(0,-7):e},re=function(e){return g(Number(e))&&R((function(){return JSON.parse(e)}))||e};function ie(e){for(var t=1;arguments.length>t;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}var oe,ae,se,ue,ce=function e(t,n){function r(e,r,i){if("undefined"!=typeof document){"number"==typeof(i=ie({},n,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var a in i)i[a]&&(o+="; "+a,!0!==i[a]&&(o+="="+i[a].split(";")[0]));return document.cookie=e+"="+t.write(r,e)+o}}return Object.create({set:r,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var n=document.cookie?document.cookie.split("; "):[],r={},i=0;i<n.length;i++){var o=n[i].split("="),a=o.slice(1).join("=");try{var s=decodeURIComponent(o[0]);if(r[s]=t.read(a,s),e===s)break}catch(e){}}return e?r[e]:r}},remove:function(e,t){r(e,"",ie({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,ie({},this.attributes,t))},withConverter:function(t){return e(ie({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"}),de={A:1,a:1,Z:1,z:1,"@":1,"{":1},le=function(e){return c(e)?e:R((function(){return"gioenc-".concat(fe(e))}))||e},ge=function(e){return d(e)&&x(e,"gioenc-")&&R((function(){return fe(e.replace("gioenc-",""))}))||e},fe=function(e){return(e=e||"").split("").map((function(e){return de[e]?e:ve(e)})).join("")},ve=function(e){if(/[0-9]/.test(e))return 1^+e;var t=e.charCodeAt(0);return String.fromCharCode(1^t)},he=function(e){var t=this;this.domain=e,this.getItem=function(e){return re(ge(ce.get(ne(e),{domain:t.domain,path:"/"})))},this.setItem=function(e,n,r){var i;i=d(n)?n.length?P(e,"_gioenc")?le(n):n:"":JSON.stringify(n),ce.set(ne(e),i,{expires:r?new Date(r):new Date((new Date).getFullYear()+3,(new Date).getMonth(),(new Date).getDay()),domain:t.domain,path:"/"})},this.removeItem=function(e){ce.remove(ne(e),{domain:t.domain,path:"/"})},this.hasItem=function(e){return b(q(ce.get()),ne(e))},this.getKeys=function(){return q(ce.get())},this.type="Cookie"},pe=function(){this.getItem=function(e){var t=R((function(){return JSON.parse(localStorage.getItem(ne(e))||"")}))||{};return f(t)&&t.expiredAt>+Date.now()?re(ge(t.value)):void 0},this.setItem=function(e,t,n){var r=null!=n?n:+new Date((new Date).getFullYear()+3,(new Date).getMonth(),(new Date).getDay()).getTime();localStorage.setItem(ne(e),JSON.stringify({value:d(t)&&t.length&&P(e,"_gioenc")?le(t):t,expiredAt:r}))},this.removeItem=function(e){return localStorage.removeItem(ne(e))},this.hasItem=function(e){return!!localStorage.getItem(ne(e))},this.getKeys=function(){return T(Array(localStorage.length)).map((function(e,t){return localStorage.key(t)}))},this.type="localStorage"},me={},Ie=function(){this.getItem=function(e){var t=R((function(){return JSON.parse(me[ne(e)]||"")}));return f(t)&&t.expiredAt>+Date.now()?re(ge(t.value)):void 0},this.setItem=function(e,t,n){var r=null!=n?n:+new Date((new Date).getFullYear()+3,(new Date).getMonth(),(new Date).getDay()).getTime();me[ne(e)]=JSON.stringify({value:d(t)&&t.length?le(t):t,expiredAt:r})},this.removeItem=function(e){return K(me,ne(e))},this.hasItem=function(e){return D(me,ne(e))},this.getKeys=function(){return q(me)},this.type="memory"},we=/^(\.ac\.|\.br\.|\.co\.|\.com\.|\.edu\.|\.gov\.|\.org\.|\.net\.)/,ye=function(e){var t=[];try{var n=e.split("."),r=w(n);if(n.length>=2&&(isNaN(Number(r))||0>Number(r)||Number(r)>255)){var i=".".concat(n.slice(-2).join("."));we.test(i)?oe=i:t.push(i);var o=".".concat(n.slice(-3).join("."));we.test(o)||b(t,o)||t.push(o);var a=".".concat(n.slice(-4).join("."));we.test(a)||b(t,a)||t.push(a)}}catch(e){}return t},Se=function(e){var t="";return e.every((function(e){return!Oe(e)||(t=e,!1)})),t},Oe=function(e){try{ce.set("gioCookie","yes",{domain:e});var t=!!ce.get("gioCookie",{domain:e});return ce.remove("gioCookie",{domain:e}),t}catch(e){return!1}},_e=function(e){var t,n,r,o=e.storageType,a=e.cookieDomain,s=e.projectId;if(b(["cookie","localstorage"],o)||(o="cookie"),"cookie"===o&&(n=!!(r=navigator.userAgent.indexOf("Electron")>-1||b(["","localhost","127.0.0.1"],window.location.hostname)||!b(["http:","https:"],window.location.protocol)?"":Se(i(i([],ye(window.location.hostname),!0),[window.location.hostname],!1)))),"cookie"===o&&n){var u=new he(r);if(a){var c=ye(a),d=Se(L(c)?[]:i([a],ye(a),!0));d&&Oe(d)?u.domain=d:B("指定Cookie域无效或无权限，使用默认域！","warn")}t=u}else t=function(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(e){return!1}}()?new pe:new Ie;return"cookie"===o&&oe&&Oe(oe)&&function(e,t,n){if(t&&Oe(t)){var r=new he(t);["".concat(n,"_gdp_session_id"),"gdp_user_id_gioenc","".concat(n,"_gdp_cs1_gioenc"),"".concat(n,"_gdp_user_key_gioenc"),"".concat(n,"_gdp_gio_id_gioenc"),"".concat(n,"_gdp_sequence_ids"),"".concat(n,"_gdp_session_id_sent")].forEach((function(t){var n=r.getItem(t);r.hasItem(t)&&(e.setItem(t,n),r.removeItem(t))})),r=void 0}}(t,oe,s),t},be="SDK_INITIALIZED_COMPLATE",Te="SESSIONID_UPDATE",Ee=function(e){var t=this;this.growingIO=e,this.main=function(){var e,n,i=t.growingIO,o=i.sdkVersion,a=i.useEmbeddedInherit,s=i.vdsConfig,u=i.userStore,c=i.dataStore,d=i.trackingId,l=c.currentPage,g=l.path,f=l.query,v={appVersion:s.version,dataSourceId:s.dataSourceId,deviceId:u.uid,domain:a?s.appId:window.location.host,language:navigator.language,path:g,platform:s.platform,query:f,referralPage:(null===(e=c.lastPageEvent)||void 0===e?void 0:e.referralPage)||"",screenHeight:window.screen.height,screenWidth:window.screen.width,sdkVersion:o,sessionId:u.sessionId,timestamp:+Date.now(),timezoneOffset:(new Date).getTimezoneOffset(),title:null!==(n=R((function(){return document.title.slice(0,255)})))&&void 0!==n?n:"",userId:u.userId};if(s.idMapping&&(v.userKey=u.userKey),L(s.ignoreFields)||s.ignoreFields.forEach((function(e){K(v,e)})),a&&!L(t.minpExtraParams)){var h=r({},v);A(r(r({},v),t.minpExtraParams),(function(e,n){var r;b(s.embeddedIgnore,n)?(v[n]=h[n],"domain"===n&&(v[n]=window.location.host)):v[n]=null!==(r=t.minpExtraParams[n])&&void 0!==r?r:v[n]}))}return v.trackingId=d,v},this.minpExtraParams={}},Ce=function(e){var t=this;this.growingIO=e,this.parsePage=function(){var e=t.growingIO.vdsConfig.hashtag,n=location.pathname,r=location.search,i=location.hash,o=i.indexOf("?");t.domain=window.location.host,t.title=document.title.slice(0,255),t.time=+Date.now(),t.path=n,t.query=r,e&&(o>-1?(t.path+=i.slice(0,o),t.query=t.query+"&"+i.slice(o+1)):t.path+=i),t.query&&b(["?","&"],t.query.charAt(0))&&(t.query=t.query.slice(1))},this._getNoHashHref=function(){var e=window.location,t=e.protocol,n=e.host,r=e.pathname,i=e.search;return"".concat(t,"://").concat(n).concat(r).concat(i)},this.getReferralPage=function(){var e,n,r=t.growingIO.dataStore.lastPageEvent;return(null==r?void 0:r.path)===t.path&&(null!==(e=null==r?void 0:r.query)&&void 0!==e?e:"")===(null!==(n=t.query)&&void 0!==n?n:"")?null==r?void 0:r.referralPage:(null==r?void 0:r.path)?t.lastHref:document.referrer},this.pageListener=function(){var e=t.growingIO.vdsConfig.hashtag,n=window.location.href,r=t.lastHref;e||(n=t._getNoHashHref(),r=t.lastNoHashHref),r!==n&&(t.parsePage(),t.buildPageEvent())},this.hookHistory=function(){var e=window.history.pushState,n=window.history.replaceState,r=t;e&&R((function(){return window.history.pushState=function(){e.apply(window.history,arguments),setTimeout(r.pageListener)}})),n&&R((function(){return window.history.replaceState=function(){n.apply(window.history,arguments),setTimeout(r.pageListener)}})),Q(window,"popstate",t.pageListener),t.growingIO.vdsConfig.hashtag&&Q(window,"hashchange",t.pageListener)},this.buildPageEvent=function(e){var n=t.growingIO.dataStore;n.lastPageEvent;var i=n.eventContextBuilder,o=n.eventConverter,a=r(r({eventType:"PAGE"},i()),{protocolType:location.protocol.substring(0,location.protocol.length-1),referralPage:t.getReferralPage()});L(e)||(a=r(r({},a),e)),a.timestamp=t.time,o(a),t.lastHref=window.location.href,t.lastNoHashHref=t._getNoHashHref(),t.lastLocation=r({},window.location)},this.title=document.title.slice(0,255),this.lastLocation=r({},window.location)},Ne=function(){function e(e){var t,n=this;this.growingIO=e,this.ALLOW_SETTING=r({},Z),this.allowOptKeys=Object.keys(this.ALLOW_SETTING),this.trackTimers={},this.setSequenceIds=function(e){var t=n.growingIO.storage.getItem(n.seqStorageIdName)||{};t.globalKey=e,n.growingIO.storage.setItem(n.seqStorageIdName,t)},this.initOptions=function(e){var t,i,o,a,s,u,c,d=e.projectId,l=e.dataSourceId,f=e.appId;n.initialDataSourceId=l;var v={};n.allowOptKeys.forEach((function(t){var r=n.ALLOW_SETTING[t].type,i=p(r)?!b(r,j(e[t])):j(e[t])!==r;"platform"!==t||b(W,e[t])||(i=!0),i?v[t]=n.ALLOW_SETTING[t].default:"ignoreFields"===t?v.ignoreFields=e.ignoreFields.filter((function(e){return b(ee,e)})):(v[t]=e[t],b(["dataCollect","autotrack"],t)&&(v[t]||B("已关闭".concat(X[t]),"info")))})),v.sessionExpires=Math.round(v.sessionExpires),(g(v.sessionExpires)||1>v.sessionExpires||v.sessionExpires>360)&&(v.sessionExpires=30),v.storageType=v.storageType.toLowerCase(),v.enableIdMapping&&!v.idMapping&&(v.idMapping=!0),v.sendType=v.sendType.toLowerCase(),b(["beacon","xhr"],v.sendType)||(v.sendType="beacon"),!v.trackBot&&/bot|crawler|spider|scrapy|jiankongbao|slurp|transcoder|networkbench/i.test(navigator.userAgent.toLowerCase())&&(v.dataCollect=!1),n.growingIO.vdsConfig=r(r(r({},null!==(t=window[n.growingIO.vds])&&void 0!==t?t:{}),v),{projectId:d,dataSourceId:l,appId:f,performance:{monitor:null===(o=null===(i=v.performance)||void 0===i?void 0:i.monitor)||void 0===o||o,exception:null===(s=null===(a=v.performance)||void 0===a?void 0:a.exception)||void 0===s||s,network:null!==(c=null===(u=v.performance)||void 0===u?void 0:u.network)&&void 0!==c&&c}}),window[n.growingIO.vds]=n.growingIO.vdsConfig,n.seqStorageIdName="".concat(d,"_gdp_sequence_ids"),n.visitStorageName="".concat(d,"_gdp_session_id_sent")},this.setOriginalSource=function(){var e=n.growingIO,t=e.storage,r=e.userStore,i=t.getItem(n.visitStorageName);if(r.sessionId!==i&&c(n.getOriginalSource())){var o=n.currentPage,a=o.path,s=o.query,u=o.getReferralPage,d={path:a,query:s,referralPage:document.referrer||u()};localStorage.setItem(n.originalSourceName,JSON.stringify(d))}},this.getOriginalSource=function(){return R((function(){return JSON.parse(localStorage.getItem(n.originalSourceName))}))},this.setOption=function(e,t){var i,o=n.growingIO,a=o.vdsConfig,s=o.uploader,u=o.emitter,c=o.userStore,l=o.vds,g=d(e)&&b(q(X),e),f=g&&typeof t===((null===(i=n.ALLOW_SETTING[e])||void 0===i?void 0:i.type)||"string"),v=r({},a);return g&&f?(a[e]=t,"dataCollect"===e&&v.dataCollect!==t&&(t?c.sessionId=te():n.growingIO.clearTrackTimer()),"serverUrl"===e&&(null==s||s.generateHost()),null==u||u.emit("OPTION_CHANGE",{optionName:e,optionValue:t}),window[l][e]=t,!0):(G("setOption > ".concat(e)),!1)},this.getOption=function(e){var t=n.growingIO.vdsConfig;return e&&D(t,E(e))?t[E(e)]:c(e)?r({},t):void G("getOption > ".concat(e))},this.sendVisit=function(e){var t=n.growingIO,r=t.userStore.sessionId,i=t.storage.getItem(n.visitStorageName);!e&&r===i||n.buildVisitEvent()},this.buildVisitEvent=function(e){var t=n.growingIO,i=t.dataStore,o=i.eventContextBuilder,a=i.eventConverter,s=i.currentPage,u=t.emitter,d=t.storage,g=t.vdsConfig,f=n.getOriginalSource(),v=r(r({eventType:"VISIT"},o()),{referralPage:document.referrer||n.currentPage.getReferralPage(),timestamp:s.time-1});g.originalSource&&!c(f)&&(v=r(r({},v),f)),L(e)||A(v,(function(t,n){D(e,n)&&(l(e[n])?v[n]=e[n]:L(e[n])||(v[n]=e[n]||v[n]))}));var h=function(e){var t=e.requestData;"VISIT"===t.eventType&&t.trackingId===n.growingIO.trackingId&&(d.setItem(n.visitStorageName,t.sessionId),localStorage.removeItem(n.originalSourceName),u.off("onSendAfter",h))};u.on("onSendAfter",h),a(v)},this.sendPage=function(e){e&&n.currentPage.parsePage(),n.currentPage.buildPageEvent()},this.buildErrorEvent=function(e){var t=n.growingIO.dataStore,i=t.eventContextBuilder;(0,t.eventConverter)(r({eventType:"CUSTOM",eventName:"onError",attributes:e},i()))},this.eventConverter=function(e){var t,i=n.growingIO,o=i.vdsConfig,a=i.dataStore,s=i.uploader;if(o.dataCollect){"LOGIN_USER_ATTRIBUTES"===e.eventType?K(e,"timezoneOffset"):e.trackingId===n.growingIO.trackingId&&(e.eventSequenceId=a.gsid);var u={};A(e,(function(e,t){var n;if("element"===t){var r=null!==(n=I(e))&&void 0!==n?n:{};A(r,(function(e,t){L(e)&&0!==e||(u[t]=e)}))}else(L(e)||c(e))&&0!==e||(u[t]=e)})),e.trackingId===n.growingIO.trackingId&&(n.growingIO.dataStore.gsid+=1),null===(t=n.growingIO.emitter)||void 0===t||t.emit("onComposeAfter",{composedEvent:r({},u)}),e.trackingId===n.growingIO.trackingId&&s.commitRequest(r(r({},u),{requestId:te()}))}},this.currentPage=new Ce(this.growingIO),this.eventContextBuilderInst=new Ee(this.growingIO),this.eventContextBuilder=null===(t=this.eventContextBuilderInst)||void 0===t?void 0:t.main,this.generalProps={},this.lastPageEvent={},this.originalSourceName="gdp_original_source";var i=this.growingIO.emitter;null==i||i.on("onComposeAfter",(function(e){var t=e.composedEvent;"PAGE"!==t.eventType&&"page"!==t.t||t.trackingId!==n.growingIO.trackingId||(n.lastPageEvent=t)})),i.on(be,(function(){null==i||i.on(Te,(function(){n.growingIO.uploader.hoardingQueue=[],n.currentPage.parsePage(),n.sendVisit(!0),n.sendPage(!0)}))}))}return Object.defineProperty(e.prototype,"gsid",{get:function(){var e=this.growingIO.storage.getItem(this.seqStorageIdName)||{},t=Number(e.globalKey);return this._gsid=g(t)||t>=1e9||1>t?1:t,this._gsid},set:function(e){g(Number(e))||e>=1e9||1>e?this._gsid=1:this._gsid=e,this.setSequenceIds(this._gsid)},enumerable:!1,configurable:!0}),e}(),xe={name:"gioCustomTracking",method:function(e){var t=this;this.growingIO=e,this.getDynamicAttributes=function(e){return c(e)||q(e).forEach((function(t){h(e[t])?e[t]=e[t]():f(e[t])?K(e,t):p(e[t])||(e[t]=E(e[t]))})),e},this.buildCustomEvent=function(e,n,i){V(e,(function(){var o=t.growingIO.dataStore,a=o.eventContextBuilder,s=o.eventConverter,u=r({eventType:"CUSTOM",eventName:e,attributes:M(t.getDynamicAttributes(f(n)&&!L(n)?n:void 0))},a());L(i)||(u=r(r({},u),i)),s(u)}))},this.buildUserAttributesEvent=function(e,n){var i=t.growingIO.dataStore,o=i.eventContextBuilder,a=i.eventConverter,s=r({eventType:"LOGIN_USER_ATTRIBUTES",attributes:M(e)},o());L(n)||(s=r(r({},s),n)),a(s)}}},Pe=["gioPerformance"],ke=function(e){function t(t){var n=e.call(this,t)||this;return n.growingIO=t,n.growingIO.gioSDKFull=!1,n.pluginsContext={plugins:{gioCustomTracking:xe}},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+t+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(t,e),t}((function(e){var t,n,r,i,o=this;this.growingIO=e,this.innerPluginInit=function(){var e;Pe.forEach((function(e){var t;return K(null===(t=o.pluginsContext)||void 0===t?void 0:t.plugins,e)})),q(null===(e=o.pluginsContext)||void 0===e?void 0:e.plugins).forEach((function(e){var t,n,r=null!==(n=null===(t=o.pluginsContext)||void 0===t?void 0:t.plugins[e])&&void 0!==n?n:{},i=r.name,a=r.method;O(o.pluginItems,(function(e){return e.name===i}))||o.pluginItems.push({name:N(i||e),method:a||function(e){}})})),L(o.pluginItems)||o.installAll()},this.install=function(e,t,n){var r,i,a=t||O(o.pluginItems,(function(t){return t.name===e}));if((null===(r=o.growingIO)||void 0===r?void 0:r.plugins)[e])return B("重复加载插件 ".concat(e," 或插件重名，已跳过加载!"),"warn"),!1;if(!a)return B("插件加载失败!不存在名为 ".concat(e," 的插件!"),"error"),!1;try{return(null===(i=o.growingIO)||void 0===i?void 0:i.plugins)[e]=new a.method(o.growingIO,n),t&&B("加载插件 ".concat(e),"info"),!0}catch(t){return B("插件【".concat(e,"】加载异常 ").concat(t),"error"),!1}},this.installAll=function(e){(e||o.pluginItems).forEach((function(t){o.install(t.name,e?t:void 0,e?null==t?void 0:t.options:void 0)&&!O(o.pluginItems,(function(e){return e.name===t.name}))&&o.pluginItems.push({name:N(t.name),method:t.method?t.method:function(){}})}))},this.uninstall=function(e){var t;K(o.pluginItems,e);var n=K(null===(t=o.growingIO)||void 0===t?void 0:t.plugins,e);return n||B("卸载插件 ".concat(e," 失败!"),"error"),n},this.uninstallAll=function(){o.pluginItems.forEach((function(e){return o.uninstall(e.name)}))},this.lifeError=function(e,t){return B("插件执行错误 ".concat(e.name," ").concat(t),"error")},this.onComposeBefore=function(e){o.pluginItems.forEach((function(t){var n,r=null===(n=o.growingIO.plugins[t.name])||void 0===n?void 0:n.onComposeBefore;if(r&&h(r))try{r(e)}catch(e){o.lifeError(t,e)}}))},this.onComposeAfter=function(e){o.pluginItems.forEach((function(t){var n,r=null===(n=o.growingIO.plugins[t.name])||void 0===n?void 0:n.onComposeAfter;if(r&&h(r))try{r(e)}catch(e){o.lifeError(t,e)}}))},this.onSendBefore=function(e){o.pluginItems.forEach((function(t){var n,r=null===(n=o.growingIO.plugins[t.name])||void 0===n?void 0:n.onSendBefore;if(r&&h(r))try{r(e)}catch(e){o.lifeError(t,e)}}))},this.onSendAfter=function(e){o.pluginItems.forEach((function(t){var n,r=null===(n=o.growingIO.plugins[t.name])||void 0===n?void 0:n.onSendAfter;if(r&&h(r))try{r(e)}catch(e){o.lifeError(t,e)}}))},this.pluginsContext={plugins:{}},this.pluginItems=[],null===(t=this.growingIO.emitter)||void 0===t||t.on("onComposeBefore",this.onComposeBefore),null===(n=this.growingIO.emitter)||void 0===n||n.on("onComposeAfter",this.onComposeAfter),null===(r=this.growingIO.emitter)||void 0===r||r.on("onSendBefore",this.onSendBefore),null===(i=this.growingIO.emitter)||void 0===i||i.on("onSendAfter",this.onSendAfter)})),De=function(e){var t=this;this.growingIO=e,this.generateHost=function(){var e=t.growingIO.vdsConfig,n=e.serverUrl,r=e.projectId;return x(n,"http")?"".concat(n,"/v3/projects/").concat(r,"/collect"):"https://".concat(n,"/v3/projects/").concat(r,"/collect")},this.getSendType=function(){var e=t.growingIO.vdsConfig.sendType;return"beacon"===e?function(){var e,t,n=!!(null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.sendBeacon),r=window.navigator.userAgent;if(r.match(/(iPad|iPhone|iPod)/g)){var i=!(t=r.toLowerCase().match(/cpu.*os (.*?) like mac os/i))||2>t.length?0:+t[1].split("_").slice(0,2).join(".");return n&&i>13}return n}()?"beacon":"xhr":e},this.commitRequest=function(e,n){var i=t.growingIO.vdsConfig.forceLogin,o=r(r({},e),{requestType:t.getSendType()});i?t.hoardingQueue.push(o):(t.requestQueue.push(o),t.initiateRequest(n))},this.initiateRequest=function(e){var n,o,a;if(i(i([],t.hoardingQueue,!0),t.requestQueue,!0).length>0&&t.requestingNum<t.requestLimit){var s=t.growingIO,u=s.vdsConfig,c=s.emitter,d=s.plugins,l=s.useHybridInherit;if(t.requestQueue=i(i([],t.hoardingQueue,!0),t.requestQueue,!0).filter((function(e){return(t.retryIds[e.requestId]||0)<=t.retryLimit})),t.hoardingQueue=[],L(t.requestQueue))return;var g=t.requestQueue.shift(),f=g.requestType;null==c||c.emit("onSendBefore",{requestData:r({},g)});var v=r({},g);if(K(v,["requestType","trackingId","requestId","customEventType"]),u.debug&&console.log("[GrowingIO Debug]:",JSON.stringify(v,null,2).replace(/\"/g,(a=window.navigator.userAgent,/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(a)&&!/chrome\/(\d+\.\d+)/i.test(a)?"":'"'))),t.requestingNum+=1,l)return t.requestSuccessFn(g),!1;var h=r({},v);u.compress&&(null==d?void 0:d.gioCompress)?(t.compressType="1",h="image"===f?null===(n=null==d?void 0:d.gioCompress)||void 0===n?void 0:n.compressToUTF16(JSON.stringify([h])):null===(o=null==d?void 0:d.gioCompress)||void 0===o?void 0:o.compressToUint8Array(JSON.stringify([h]))):(t.compressType="0",h=JSON.stringify([h]));var p=t.generateURL(null!=e?e:t.requestURL);switch(f){case"beacon":default:t.sendByBeacon(g,h,p);break;case"xhr":t.sendByXHR(g,h,p);break;case"image":t.sendByImage(g,h,p)}}},this.generateURL=function(e){return"".concat(e,"?stm=").concat(+Date.now(),"&compress=").concat(t.compressType)},this.sendByBeacon=function(e,n,r){navigator.sendBeacon(r,n)?t.requestSuccessFn(e):t.requestFailFn(e,"beacon")},this.sendByXHR=function(e,n,r){var i,o=b(["unload","beforeunload","pagehide"],null===(i=null===window||void 0===window?void 0:window.event)||void 0===i?void 0:i.type),a=new XMLHttpRequest;if(a)return a.open("POST",r,o),a.onreadystatechange=function(){4===a.readyState&&204===a.status?t.requestSuccessFn(e):t.requestFailFn(e,"xhr")},a.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),void a.send(n);if(null===window||void 0===window?void 0:window.XDomainRequest){var s=new window.XDomainRequest;s.open("POST",r.replace("https://","http://"),o),s.onload=function(){204===s.status?t.requestSuccessFn(e):t.requestFailFn(e,"xhr")},s.onerror=s.ontimeout=function(){t.requestFailFn(e,"xhr")},s.send(n)}},this.sendByImage=function(e,n,r){var i="".concat(r,"&data=").concat(n),o=document.createElement("img");o.width=1,o.height=1,o.onload=function(){t.requestSuccessFn(e),t.clearImage(o)},o.onerror=o.onabort=function(){t.requestSuccessFn(e),t.clearImage(o)},o.src=i},this.clearImage=function(e){e.src="",e.onload=function(){},e.onerror=e.onerabort=function(){},e=null},this.requestSuccessFn=function(e){var n;t.requestingNum-=1;var i=e.requestId||-1;t.retryIds[i]&&(t.retryIds[i]=0),e.trackingId===t.growingIO.trackingId&&(t.growingIO.userStore.sessionId=e.sessionId),null===(n=t.growingIO.emitter)||void 0===n||n.emit("onSendAfter",{requestData:r({},e)}),t.initiateRequest()},this.requestFailFn=function(e,n){t.requestingNum-=1;var i=e.requestId||-1;t.retryIds[i]||(t.retryIds[i]=0),t.retryIds[i]+=1;var o=t.requestQueue.some((function(t){return t.requestId===e.requestId})),a=n;if(t.retryIds[i]<t.retryLimit+1||(a="beacon"===n?"xhr":"xhr"===n?"image":void 0,t.retryIds[i]=0),!o&&a)var s=window.setTimeout((function(){L(t.requestQueue)?(t.requestQueue.push(r(r({},e),{requestType:a})),t.initiateRequest()):t.requestQueue.push(r(r({},e),{requestType:a})),window.clearTimeout(s),s=null}),800)},this.hoardingQueue=[],this.requestQueue=[],this.requestLimit=10,this.requestTimeout=5e3,this.retryLimit=1,this.retryIds={},this.requestingNum=0,this.requestURL=this.generateHost()},qe=function(){function e(e){var t=this;this.growingIO=e,this.transferStorage=function(){var e=t.growingIO,n=e.vdsConfig.projectId,r=e.storage;t.uid=r.getItem("gr_user_id")||t.uid,t.userId=r.getItem("".concat(n,"_gr_cs1"))||t.userId,r.removeItem("gr_user_id"),r.removeItem("".concat(n,"_gr_cs1")),r.removeItem("".concat(n,"_gr_last_sent_cs1")),r.removeItem("".concat(n,"_gr_last_sent_sid_with_cs1")),r.removeItem("".concat(n,"_gr_session_id")),r.removeItem("".concat(n,"_gr_session_id_sent_vst"));var i=r.getKeys().find((function(e){return e.indexOf("gr_imp_")>-1}));i&&r.removeItem(i)};var n=this.growingIO.vdsConfig.projectId,r=this.growingIO.storage,i=r.getItem,o=r.setItem,a=r.getKeys,s=r.removeItem;this.getItem=i,this.setItem=o,this.getKeys=a,this.removeItem=s,this.sIdStorageName="".concat(n,"_gdp_session_id"),this.uidStorageName="gdp_user_id_gioenc",this.userIdStorageName="".concat(n,"_gdp_cs1_gioenc"),this.userKeyStorageName="".concat(n,"_gdp_user_key_gioenc"),this.gioIdStorageName="".concat(n,"_gdp_gio_id_gioenc"),this.growingIO.emitter.on("OPTION_INITIALIZED",(function(){i("gr_user_id")&&t.transferStorage()}))}return Object.defineProperty(e.prototype,"sessionId",{get:function(){return this.getItem(this.sIdStorageName)||(this.sessionId=te(),this.sessionId)},set:function(e){var t,n=this;e||(e=te());var r=this.getItem(this.sIdStorageName)||this.prevSessionId,i=this.growingIO.vdsConfig.sessionExpires,o=void 0===i?30:i;this.setItem(this.sIdStorageName,e,+Date.now()+60*o*1e3),r!==e&&(this.getKeys().filter((function(e){return/.+_gdp_session_id_.{36}/.test(e)})).forEach((function(e){n.removeItem(e)})),this.setItem(this.growingIO.dataStore.visitStorageName,""),null===(t=this.growingIO.emitter)||void 0===t||t.emit(Te,{newSessionId:e,oldSessionId:r})),this.prevSessionId=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this.getItem(this.uidStorageName)||(this.uid=te(),this.uid)},set:function(e){var t,n=this.getItem(this.uidStorageName)||this.prevUId;this.setItem(this.uidStorageName,e),n!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit("UID_UPDATE",{newUId:e,oldUId:n})),this.prevUId=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userId",{get:function(){return this.getItem(this.userIdStorageName)||""},set:function(e){var t,n,r=this.getItem(this.userIdStorageName)||this.prevUserId;this.setItem(this.userIdStorageName,e),null===(t=this.growingIO.emitter)||void 0===t||t.emit("SET_USERID",{newUserId:e,oldUserId:r,userKey:this.userKey}),r!==e&&(null===(n=this.growingIO.emitter)||void 0===n||n.emit("USERID_UPDATE",{newUserId:e,oldUserId:r,userKey:this.userKey})),e&&(this.gioId=e),this.prevUserId=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userKey",{get:function(){return this.getItem(this.userKeyStorageName)||""},set:function(e){var t,n,r=this.getItem(this.userKeyStorageName)||this.prevUserKey;this.setItem(this.userKeyStorageName,e),null===(t=this.growingIO.emitter)||void 0===t||t.emit("SET_USERKEY",{newUserKey:e,oldUserKey:r,userId:this.userId}),r!==e&&(null===(n=this.growingIO.emitter)||void 0===n||n.emit("USERKEY_UPDATE",{newUserKey:e,oldUserKey:r,userId:this.userId})),this.prevUserKey=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"gioId",{get:function(){return this.getItem(this.gioIdStorageName)||""},set:function(e){var t,n=this.getItem(this.gioIdStorageName)||this.prevGioId;this.setItem(this.gioIdStorageName,e),n!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit("GIOID_UPDATE",{newGioId:e,oldGioId:n})),this.prevGioId=e},enumerable:!1,configurable:!0}),e}(),Ae=function(){var e,t=this;this.trackingId="g0",this.init=function(e,n){var r,i,o,a,s;B("Gio Web SDK 初始化中...","info");var u=t.dataStore,c=u.initOptions,d=u.currentPage,l=u.sendVisit,g=u.sendPage;c(e),t.storage=_e(t.vdsConfig),t.uploader=new De(t),t.userStore=new qe(t),null===(r=t.emitter)||void 0===r||r.emit("OPTION_INITIALIZED",t),null===(o=null===(i=t.plugins)||void 0===i?void 0:i.gioEventAutoTracking)||void 0===o||o.main(),d.hookHistory(),d.parsePage(),t.vdsConfig.originalSource&&t.dataStore.setOriginalSource(),null===(a=t.emitter)||void 0===a||a.emit("SDK_INITIALIZED",t),t.gioSDKInitialized=!0,t.vdsConfig.gioSDKInitialized=!0,window[t.vds]=t.vdsConfig,B("Gio Web SDK 初始化完成！","success"),t.vdsConfig.forceLogin&&B("forceLogin已开启，请调用 identify 方法设置 openId 以继续上报!","info"),t.useEmbeddedInherit||l(),g(),null===(s=t.emitter)||void 0===s||s.emit(be,t),H(n,t.trackingId)},this.sendVisit=function(e,n){t.dataStore.buildVisitEvent(e),H(n)},this.sendPage=function(e,n){t.dataStore.currentPage.buildPageEvent(e),H(n)},this.registerPlugins=function(e,n){p(e)?(e.forEach((function(t,n){var i,o;L(t)||c(t)?B("插件不合法，跳过加载!","warn"):(null===(i=t.js)||void 0===i?void 0:i.default)&&(e[n]=r(r({},null===(o=t.js)||void 0===o?void 0:o.default),{options:t.options}))})),e=S(e),t.plugins.installAll(e)):B("插件注册失败，请检查!","error"),H(n,t.plugins.pluginItems)},this.getPlugins=function(e){H(e,t.plugins.pluginItems)},this.setOption=function(e,n,r){var i;b(q(X),e)?(i=t.dataStore.setOption(e,n))&&X[e]&&B("已修改".concat(X[e],": ").concat(n),"info"):(B("不存在可修改的配置项：".concat(e,"，请检查后重试!"),"warn"),i=!1),H(r,i)},this.getOption=function(e,n){H(n,t.dataStore.getOption(e))},this.setGeneralProps=function(e,n){var i;f(e)&&!L(e)?(t.dataStore.generalProps=r(r({},t.dataStore.generalProps),e),q(t.dataStore.generalProps).forEach((function(e){b([void 0,null],t.dataStore.generalProps[e])&&(t.dataStore.generalProps[e]="")})),i=!0):(G("setGeneralProps"),i=!1),H(n,i)},this.clearGeneralProps=function(e,n){p(e)&&!L(e)?e.forEach((function(e){K(t.dataStore.generalProps,e)})):t.dataStore.generalProps={},H(n)},this.getDeviceId=function(e){H(e,t.userStore.uid)},this.identify=function(e,n){if(t.vdsConfig.forceLogin){if(!J(e))return void G("identify");var r=E(e).slice(0,1e3);t.userStore.uid=r,t.uploader.hoardingQueue.forEach((function(e,n){return t.uploader.hoardingQueue[n].deviceId=r})),t.dataStore.setOption("forceLogin",!1),t.uploader.initiateRequest()}else G("identify",!1,"forceLogin未开启");H(n)},this.setUserId=function(e,n,r){var i;if(J(E(e).trim())){var o=t.userStore.gioId;t.vdsConfig.idMapping&&(t.userStore.userKey=!c(n)&&E(n).length>0?E(n).slice(0,1e3):""),t.userStore.userId=E(e).slice(0,1e3),o&&o!==t.userStore.userId&&(t.userStore.sessionId=""),i=!0}else t.clearUserId(),G("setUserId"),i=!1;H(r,i)},this.clearUserId=function(e){t.userStore.userId="",t.userStore.userKey="",H(e)},this.setUserAttributes=function(e,n,r){var i,o,a;!L(e)&&f(e)?(null===(o=null===(i=t.plugins)||void 0===i?void 0:i.gioCustomTracking)||void 0===o||o.buildUserAttributesEvent(e,n),a=!0):(G("setUserAttributes"),a=!1),H(r,a)},this.track=function(e,n,i,o){var a,s;((null===(s=null===(a=t.plugins)||void 0===a?void 0:a.gioCustomTracking)||void 0===s?void 0:s.buildCustomEvent)||function(){})(e,r(r({},t.dataStore.generalProps),f(n)&&!L(n)?n:{}),r(r({},i),{customEventType:1})),H(o)},this.trackTimerStart=function(e,n){var r;t.vdsConfig.dataCollect&&V(e,(function(){r=te(),t.dataStore.trackTimers[r]={eventName:e,leng:0,start:+Date.now()}})),H(n,r)},this.trackTimerPause=function(e,n){if(e&&t.dataStore.trackTimers[e]){var r=t.dataStore.trackTimers[e];r.start&&(r.leng=r.leng+(+Date.now()-r.start)),r.start=0}H(n)},this.trackTimerResume=function(e,n){if(e&&t.dataStore.trackTimers[e]){var r=t.dataStore.trackTimers[e];0===r.start&&(r.start=+Date.now())}H(n)},this.trackTimerEnd=function(e,n,i){var o;if(t.vdsConfig.dataCollect)if(e&&t.dataStore.trackTimers[e]){var a=t.dataStore.trackTimers[e];if(0!==a.start){var s=+Date.now()-a.start;a.leng=s>0?a.leng+s:0}var u=t.dataStore,c=u.eventContextBuilder;(0,u.eventConverter)(r(r({eventType:"CUSTOM",eventName:a.eventName,attributes:M(r(r({},n),{event_duration:a.leng>864e5?0:a.leng/1e3}))},c()),{customEventType:0})),t.removeTimer(e),o=!0}else B("未查找到对应的计时器，请检查!","error"),o=!1;H(i,o)},this.removeTimer=function(e,n){e&&t.dataStore.trackTimers[e]&&delete t.dataStore.trackTimers[e],H(n)},this.clearTrackTimer=function(e){t.dataStore.trackTimers={},H(e)},this.sdkVersion="4.0.0",this.vds=window._gio_local_vds||"vds",this.utils=r(r({},F),z),this.emitter={all:e=e||new Map,on:function(t,n){var r=e.get(t);r?r.push(n):e.set(t,[n])},off:function(t,n){var r=e.get(t);r&&(n?r.splice(r.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var r=e.get(t);r&&r.slice().map((function(e){e(n)})),(r=e.get("*"))&&r.slice().map((function(e){e(t,n)}))}},this.useEmbeddedInherit=!1,this.useHybridInherit=!1,this.gioSDKInitialized=!1,this.plugins=new ke(this),this.plugins.innerPluginInit(),this.dataStore=new Ne(this)},Ue=window._gio_local_vds||"vds",Ke=null!==(se=null===(ae=window[Ue])||void 0===ae?void 0:ae.namespace)&&void 0!==se?se:"gdp";return function(){var e,t,n,i,o;if(null===(e=window[Ue])||void 0===e?void 0:e.gioSDKInstalled)return ue=window[Ke],void B("SDK重复加载，请检查是否重复加载SDK或接入其他平台SDK导致冲突!","warn");window[Ue]=r(r({},null!==(t=window[Ue])&&void 0!==t?t:{}),{gioSDKInstalled:!0});var a=new Ae;ue=function(){var e,t=arguments[0];if(d(t)&&b(Y,t)&&a[t]){var n=y(T(arguments));if("init"===t){var i=function(e){var t;return e.vdsConfig||e.gioSDKInitialized||(null===(t=window[e.vds])||void 0===t?void 0:t.gioSDKInitialized)?(B("SDK重复初始化，请检查是否重复加载SDK或接入其他平台SDK导致冲突!","warn"),!1):!(b(["","localhost","127.0.0.1"],location.hostname)&&!window._gr_ignore_local_rule&&(B("当前SDK不允许在本地环境初始化!","warn"),1))}(a);if(!i)return;var o=function(e){return!L(S(e))||(B('SDK初始化失败，请使用 gdp("init", "您的GrowingIO项目 accountId", "您项目的 dataSourceId", options); 进行初始化!',"error"),!1)}(n);if(!o)return;var s=function(e){var t=I(e),n=w(e);return J(E(t).trim())?(f(n)&&n||(n={}),{projectId:t,userOptions:n}):(B("SDK初始化失败，accountId 参数不合法!","error"),!1)}(n);if(!s)return;var u=function(e){var t=e[1],n=e[2],r=w(e);return t&&d(t)?{dataSourceId:t,appId:d(n)?n:"",options:r}:(B("SDK初始化失败，dataSourceId 参数不合法!","error"),!1)}(n);if(!u)return;var c=s.projectId,l=u.dataSourceId,g=u.appId,v=u.options;a.init(r(r({},v),{projectId:c,dataSourceId:l,appId:g}),w(n))}else if("registerPlugins"===t)a.registerPlugins.apply(a,n);else{if(a.gioSDKInitialized&&a.vdsConfig)return a[t].apply(a,n);a.emitter.emit("UNINITIALIZED_CALL",arguments),B("SDK未初始化!","error")}}else b($,t)?B("方法 ".concat(E(t)," 已被弃用，请移除!"),"warn"):B("不存在名为 ".concat(E(t)," 的方法调用!"),"error");window[Ue]=r(r({},window[Ue]),{_gr_ignore_local_rule:null!==(e=window._gr_ignore_local_rule)&&void 0!==e&&e,gioSDKVersion:a.sdkVersion,gioSDKFull:a.gioSDKFull,canIUse:function(e){return b(Y,e)&&a[e]}})};var s=null===(n=window[Ke])||void 0===n?void 0:n.q,u=null===(i=window[Ke])||void 0===i?void 0:i.e,c=null===(o=window[Ke])||void 0===o?void 0:o.ef;window[Ke]=ue,window[Ke].e=u,window[Ke].ef=c,window.gdp=ue,window.gdp.e=u,window.gdp.ef=c,p(s)&&!L(s)&&T(Array(s.length)).forEach((function(){ue.apply(null,s.shift())}))}(),ue}));
