var n,e,t,r,i=function(){return i=Object.assign||function(n){for(var e,t=1,r=arguments.length;r>t;t++)for(var i in e=arguments[t])({}).hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n},i.apply(this,arguments)};function o(n){return n&&n.__esModule&&{}.hasOwnProperty.call(n,"default")?n.default:n}var a,u,c,s=r?t:(r=1,t="function"==typeof Array.from?Array.from:(e||(e=1,a=function(n){return"function"==typeof n},u=function(n){var e=function(n){var e=Number(n);return isNaN(e)?0:0!==e&&isFinite(e)?(e>0?1:-1)*Math.floor(Math.abs(e)):e}(n);return Math.min(Math.max(e,0),9007199254740991)},c=function(n){var e=n.next();return!e.done&&e},n=function(n){var e,t,r,i=this,o=arguments.length>1?arguments[1]:void 0;if(void 0!==o){if(!a(o))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(e=arguments[2])}var s=function(n,e){if(null!=n&&null!=e){var t=n[e];if(null==t)return;if(!a(t))throw new TypeError(t+" is not a function");return t}}(n,function(n){if(null!=n){if(["string","number","boolean","symbol"].indexOf(typeof n)>-1)return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in n)return Symbol.iterator;if("@@iterator"in n)return"@@iterator"}}(n));if(void 0!==s){t=a(i)?Object(new i):[];var d,f,l=s.call(n);if(null==l)throw new TypeError("Array.from requires an array-like or iterable object");for(r=0;;){if(!(d=c(l)))return t.length=r,t;f=d.value,t[r]=o?o.call(e,f,r):f,r++}}else{var v=Object(n);if(null==n)throw new TypeError("Array.from requires an array-like object - not null or undefined");var g,h=u(v.length);for(t=a(i)?Object(new i(h)):Array(h),r=0;h>r;)g=v[r],t[r]=o?o.call(e,g,r):g,r++;t.length=h}return t}),n)),d=function(n){return y(["undefined","null"],L(n))},f=function(n){return"string"===L(n)},l=function(n){return"number"===L(n)},v=function(n){return"object"===L(n)&&!d(n)},g=function(n){return"regexp"===L(n)},h=function(n){return y(["function","asyncfunction"],L(n))},p=function(n){return Array.isArray(n)&&"array"===L(n)},m=function(n){return"date"===L(n)},w=function(n,e){if(void 0===e&&(e=!1),p(n)){for(var t=0,r=[],i=0,o=n;i<o.length;i++){var a=o[i];a&&!R(a)&&(r[t++]=a),e&&0===a&&(r[t++]=a)}return r}return n},y=function(n,e){return("array"===L(n)||"string"===L(n))&&("array"===L(e)?e.some((function(e){return n.indexOf(e)>=0})):n.indexOf(e)>=0)},E=o(s),_=function(n){return d(n)?"":"".concat(n)},x={}.hasOwnProperty,b=function(n){return v(n)?Object.keys(n):[]},T=function(n,e){b(n).forEach((function(t){return e(n[t],t)}))},k=function(n,e){var t=b(n);return!(!v(n)||!v(e)||t.length!==b(e).length||y(t.map((function(t){return v(n[t])?k(n[t],e[t]):n[t]===e[t]})),!1))},O=function(n,e){if(!v(n))return!1;try{return"string"===L(e)?delete n[e]:"array"===L(e)?e.map((function(e){return delete n[e]})):(g(e)&&b(n).forEach((function(t){e.test(t)&&O(n,t)})),!0)}catch(n){return!1}},R=function(n){return p(n)?0===n.length:v(n)?0===b(n).length:!n},L=function(n){return{}.toString.call(n).slice(8,-1).toLowerCase()},P=function(n){var e={};return v(n)&&(O(n,"&&sendTo"),T(n,(function(n,t){var r=_(t).slice(0,100);v(n)?e[r]=P(n):p(n)?(e[r]=w(n.slice(0,100),!0),e[r]=e[r].join("||").slice(0,1e3)):m(n)?e[r]=function(n){if(m(n)){var e=function(n){return 10>n?"0"+n:n};return n.getFullYear()+"-"+e(n.getMonth()+1)+"-"+e(n.getDate())+" "+e(n.getHours())+":"+e(n.getMinutes())+":"+e(n.getSeconds())+"."+e(n.getMilliseconds())}return n}(n):e[r]=d(n)?"":_(n).slice(0,1e3)}))),e},I=function(){var n,e,t,r,i=null!==(e=null===(n=function(){var n,e=window._gio_local_vds||"vds";return null!==(n=window[e])&&void 0!==n?n:{}}())||void 0===n?void 0:n.namespace)&&void 0!==e?e:"gdp";return h(window[i])?window[i]:null!==(r=null!==(t=window.gdp)&&void 0!==t?t:window.gio)&&void 0!==r?r:function(){}},N=function(n){var e=this;this.growingIO=n,this.listenerSet=!1,this.setListeners=function(){e.listenerSet||(window.addEventListener("unhandledrejection",e.handleError,!0),window.addEventListener("error",e.handleError,!0)),e.listenerSet=!0},this.handleError=function(n){if(n.reason)e.errorParse(n.reason.stack,n.reason.message,n.eventTime);else if(n.error)e.errorParse(n.error.stack,n.error.message,n.eventTime);else if(n.target){var t=n.target,r=(null==t?void 0:t.href)||(null==t?void 0:t.src)||(null==t?void 0:t.currentSrc)||"Unknown resource";e.buildErrorEvent({error_type:"Resource loading error",error_content:"at ".concat(r)},n.eventTime)}},this.errorParse=function(n,t,r){var i,o,a,u,c=f(n)&&n.length?n.split("\n"):[],s={error_type:t||c[0]||"Unknown error",error_content:(u=window.navigator.userAgent,/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(u)&&!/chrome\/(\d+\.\d+)/i.test(u)?(null!==(i=c[0])&&void 0!==i?i:"").trim()||(null!==(o=c[1])&&void 0!==o?o:"").trim()||"No stack trace":(null!==(a=c[1])&&void 0!==a?a:"").trim()||"No stack trace")};e.buildErrorEvent(s,r)},this.destroy=function(){window.removeEventListener("unhandledrejection",e.handleError),window.removeEventListener("error",e.handleError)},this.buildErrorEvent=function(n,t){var r;null===(r=e.growingIO.plugins.gioPerformance)||void 0===r||r.buildPerfEvent("apm_system_error",n,t)},this.setListeners(),window.gdp.ef&&(window.removeEventListener("unhandledrejection",window.gdp.ef),window.removeEventListener("error",window.gdp.ef),window.gdp.ef=void 0),!R(window.gdp.e)&&p(window.gdp.e)&&(window.gdp.e.forEach(this.handleError),window.gdp.e=void 0)},S=-1,C=function(n){addEventListener("pageshow",(function(e){e.persisted&&(S=e.timeStamp,n(e))}),!0)},H=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},U=function(){var n=H();return n&&n.activationStart||0},F=function(n,e){var t=H(),r="navigate";return 0>S?t&&(document.prerendering||U()>0?r="prerender":document.wasDiscarded?r="restore":t.type&&(r=t.type.replace(/_/g,"-"))):r="back-forward-cache",{name:n,value:void 0===e?-1:e,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:r}},M=function(n,e,t){try{if(PerformanceObserver.supportedEntryTypes.includes(n)){var r=new PerformanceObserver((function(n){Promise.resolve().then((function(){e(n.getEntries())}))}));return r.observe(Object.assign({type:n,buffered:!0},t||{})),r}}catch(n){}},X=function(n,e,t,r){var i,o;return function(a){e.value>=0&&(a||r)&&((o=e.value-(i||0))||void 0===i)&&(i=e.value,e.delta=o,e.rating=function(n,e){return n>e[1]?"poor":n>e[0]?"needs-improvement":"good"}(e.value,t),n(e))}},A=function(n){requestAnimationFrame((function(){return requestAnimationFrame((function(){return n()}))}))},D=-1,q=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},j=function(n){"hidden"===document.visibilityState&&D>-1&&(D="visibilitychange"===n.type?n.timeStamp:0,B())},$=function(){addEventListener("visibilitychange",j,!0),addEventListener("prerenderingchange",j,!0)},B=function(){removeEventListener("visibilitychange",j,!0),removeEventListener("prerenderingchange",j,!0)},Q=function(){return 0>D&&(D=q(),$(),C((function(){setTimeout((function(){D=q(),$()}),0)}))),{get firstHiddenTime(){return D}}},V=function(n){document.prerendering?addEventListener("prerenderingchange",(function(){return n()}),!0):n()},G=[1800,3e3],K=[2500,4e3],z={},Y=[800,1800],Z=function n(e){document.prerendering?V((function(){return n(e)})):"complete"!==document.readyState?addEventListener("load",(function(){return n(e)}),!0):setTimeout(e,0)},J=function(n,e){e=e||{};var t=F("TTFB"),r=X(n,t,Y,e.reportAllChanges);Z((function(){var i=H();if(i){var o=i.responseStart;if(0>=o||o>performance.now())return;t.value=Math.max(o-U(),0),t.entries=[i],r(!0),C((function(){t=F("TTFB",0),(r=X(n,t,Y,e.reportAllChanges))(!0)}))}}))},W={FCP:"first_contentful_paint_duration",LCP:"largest_contentful_paint_duration",TTFB:"first_byte_duration"},nn=function(n,e){void 0===e&&(e={});var t,r,i=this;this.growingIO=n,this.options=e,this.performance={},this.setPerformanceData=function(n){i.vitalsData[n.name].push(n)},this.getLaunchTime=function(){var n,e=null===(n=window.performance)||void 0===n?void 0:n.timing;return e?e.loadEventEnd-e.navigationStart:0},this.getInteractiveTime=function(){var n,e=null===(n=window.performance)||void 0===n?void 0:n.timing;return e?e.domContentLoadedEventEnd-e.navigationStart:0},this.generatePerfData=function(){window.setTimeout((function(){var n={page_launch_duration:i.getLaunchTime(),interactive_duration:i.getInteractiveTime()};T(i.vitalsData,(function(e,t){if(!R(e)){var r=function(n){try{var e=E(n);return e[e.length-1]}catch(n){return}}(e);void 0!==(null==r?void 0:r.value)&&(n[W[t]]=function(n,e){return l(n)?Number(n.toFixed(l(0)?0:2)):f(n)&&"NaN"!==_(Number(n))?Number(Number(n).toFixed(l(0)?0:2)):n}(r.value))}})),k(n,i.performance)||(i.buildMonitorEvent(n),i.performance=n)}),1e3)},this.destroy=function(){window.removeEventListener("load",i.generatePerfData)},this.buildMonitorEvent=function(n){var e;null===(e=i.growingIO.plugins.gioPerformance)||void 0===e||e.buildPerfEvent("apm_web_launch",n)},this.vitalsData={FCP:[],FID:[],INP:[],LCP:[],TTFB:[]},t=this.setPerformanceData,r=r||{},V((function(){var n,e=Q(),i=F("FCP"),o=M("paint",(function(t){t.forEach((function(t){"first-contentful-paint"===t.name&&(o.disconnect(),t.startTime<e.firstHiddenTime&&(i.value=Math.max(t.startTime-U(),0),i.entries.push(t),n(!0)))}))}));o&&(n=X(t,i,G,r.reportAllChanges),C((function(e){i=F("FCP"),n=X(t,i,G,r.reportAllChanges),A((function(){i.value=performance.now()-e.timeStamp,n(!0)}))})))})),function(n,e){e=e||{},V((function(){var t,r=Q(),i=F("LCP"),o=function(n){var e=n[n.length-1];e&&e.startTime<r.firstHiddenTime&&(i.value=Math.max(e.startTime-U(),0),i.entries=[e],t())},a=M("largest-contentful-paint",o);if(a){t=X(n,i,K,e.reportAllChanges);var u=function(n){var e=!1;return function(t){e||(n(),e=!0)}}((function(){z[i.id]||(o(a.takeRecords()),a.disconnect(),z[i.id]=!0,t(!0))}));["keydown","click"].forEach((function(n){addEventListener(n,(function(){return setTimeout(u,0)}),!0)})),function(n){var e=function(e){"pagehide"!==e.type&&"hidden"!==document.visibilityState||n(e)};addEventListener("visibilitychange",e,!0),addEventListener("pagehide",e,!0)}(u),C((function(r){i=F("LCP"),t=X(n,i,K,e.reportAllChanges),A((function(){i.value=performance.now()-r.timeStamp,z[i.id]=!0,t(!0)}))}))}}))}(this.setPerformanceData,{reportAllChanges:!0}),J(this.setPerformanceData),window.addEventListener("load",this.generatePerfData)};function en(n,e,t,r){if(void 0===r&&(r=!1),!d(n)&&(function(n,e){return!d(n)&&x.call(n,e)}(n,e)||r)){var i=t(n[e]);"function"==typeof i&&(n[e]=i)}}var tn,rn=function(n,e){var t=this;this.growingIO=n,this.options=e,this.initOptions=function(){var n;v(t.options.network)&&(null===(n=t.options.network)||void 0===n?void 0:n.exclude)&&(t.excludeRegExp=t.options.network.exclude)},this.verifyUrl=function(n){if(!n||"string"!=typeof n)return!1;if(t.gdpRequestURL&&n.indexOf(t.gdpRequestURL)>-1)return!0;if(p(t.excludeRegExp)){var e=w(t.excludeRegExp.map((function(e){return g(e)?e.test(n):f(e)?n.indexOf(e)>-1:void 0})));return!R(e)}return f(t.excludeRegExp)?n.indexOf(t.excludeRegExp)>-1:!!g(t.excludeRegExp)&&t.excludeRegExp.test(n)},this.getTimestamp=function(){return window.performance?window.performance.now():Date.now()},this.hookXHR=function(){var n=t;t.originXHR=window.XMLHttpRequest;var e=XMLHttpRequest.prototype,r={};en(e,"open",(function(e){return function(){for(var t=[],i=0;arguments.length>i;i++)t[i]=arguments[i];this.gio_XHR_id="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(n){var e=16*Math.random()|0;return("x"===n?e:3&e|8).toString(16)})),n.verifyUrl(t[1])||(r[this.gio_XHR_id]={type:"XHR",method:t[0],url:t[1]}),e.apply(this,t)}})),en(e,"send",(function(e){return function(){for(var t=this,o=[],a=0;arguments.length>a;a++)o[a]=arguments[a];this.addEventListener("loadend",(function(e){t.gio_XHR_id&&r[t.gio_XHR_id]&&(r[t.gio_XHR_id]=i(i({},r[t.gio_XHR_id]),{duration:(e.timeStamp||n.getTimestamp())-r[t.gio_XHR_id].start,status:t.status}),n.buildNetworkEvent(r[t.gio_XHR_id]),O(r,t.gio_XHR_id))})),this.addEventListener("error",(function(){n.buildErrorEvent({error_title:"XMLHttpRequest Error",error_content:t.status||"Unknown error"})})),this.gio_XHR_id&&r[this.gio_XHR_id]&&(r[this.gio_XHR_id].start=n.getTimestamp()),e.apply(this,o)}}))},this.hookFetch=function(){var n=t;window.fetch&&(t.originFetch=window.fetch,en(window,"fetch",(function(e){return function(){for(var t=[],r=0;arguments.length>r;r++)t[r]=arguments[r];var o,a=t[0],u=t[1];o="string"===L(a)?a:(null==a?void 0:a.url)||"";var c,s="GET";return u&&u.method?s=u.method:"string"!==L(a)&&(null==a?void 0:a.method)&&(s=a.method),n.verifyUrl(o)||(c={type:"Fetch",method:s,url:o,start:n.getTimestamp()}),e.apply(this,t).then((function(e){return c&&(c=i(i({},c),{duration:n.getTimestamp()-c.start,status:e.status}),n.buildNetworkEvent(c)),e}),(function(e){var t,r=(null===(t=e.stack)||void 0===t?void 0:t.split("\n"))||[];throw n.buildErrorEvent({error_title:r[0]||_(e)||"Fetch Request Error",error_content:(null==c?void 0:c.url)||o||"Unknown URL"}),e}))}})))},this.buildErrorEvent=function(n){var e;if(t.options.exception){var r=t.growingIO.dataStore,o=r.eventContextBuilder,a=r.eventConverter,u=i({eventType:"CUSTOM",eventName:"Error"},o());u.attributes=P(i(i({},null!==(e=u.attributes)&&void 0!==e?e:{}),n)),a(u)}},this.destroy=function(){t.originXHR&&(window.XMLHttpRequest=t.originXHR),t.originFetch&&window.fetch&&(window.fetch=t.originFetch)},this.buildNetworkEvent=function(n){!1!==e.network&&window.setTimeout((function(){var e,r=n.duration,i=n.url,o=n.method,a=n.status;null===(e=t.growingIO.plugins.gioPerformance)||void 0===e||e.buildPerfEvent("apm_network_request",{response_duration:r,request_address:i,request_method:o,http_code:a})}),0)},this.initOptions(),this.hookXHR(),this.hookFetch(),window.performance||("warn",console.log("%c [GrowingIO]：当前浏览器无法支持性能相关API，网络监测数据可能存在偏差!","color: #F59E0B;"));var r=this,o=this.growingIO.uploader.generateURL;this.growingIO.uploader.generateURL=function(){var n=o.apply(this,arguments);return arguments[0]===r.growingIO.trackingId&&(r.gdpRequestURL=n),n}},on={install:function(n){if(n&&n.config){var e=function(e,t,r){an.call(this,e,t,r,n)};if(h(n.config.errorHandler)){var t=n.config.errorHandler;n.config.errorHandler=function(){for(var n=[],r=0;arguments.length>r;r++)n[r]=arguments[r];var i=t.apply(this,n);return e(n[0],n[1],n[2]),i}}else n.config.errorHandler=e}}},an=function(n,e,t,r){if(n){var o={message:"".concat(n.message||"Unknown error","(").concat(t||"Unknown info",")"),name:n.name||"Error",stack:n.stack||[]};if(null==r?void 0:r.version){var a=Number(function(n){try{return E(n)[0]}catch(n){return}}(function(n,e){return"string"==typeof n?n.split("."):n}(null==r?void 0:r.version)));switch(a){case 2:o=i(i({},o),un(e));break;case 3:o=i(i({},o),cn(e));break;default:return}}o=i(i({},o),sn(o.stack));var u=I();u&&u("track","apm_system_error",{error_type:"".concat(o.name,": ").concat(o.message),error_content:"at ".concat(o.functionName||"Unknown function"," (").concat(o.componentName||"Unknown component",")")})}},un=function(n){var e="";if(n.$root===n)e="root";else{var t=n._isVue?n.$options&&n.$options.name||n.$options&&n.$options._componentTag:n.name;e=(t?"component <"+t+">":"anonymous component")+(n._isVue&&n.$options&&n.$options.__file?" at "+(n.$options&&n.$options.__file):"")}return{componentName:e}},cn=function(n){var e="";if(n.$root===n)e="root";else{var t=n.$options&&n.$options.name;e=t?"component <"+t+">":"anonymous component"}return{componentName:e}},sn=function(n){if(!n||"string"!=typeof n)return{title:"Unknown error",functionName:"Unknown function"};var e=n.split("\n");return function(n,e){n[function(n,e){var t=-1;return p(n)&&n.every((function(n,r){return!e(n)||(t=r,!1)})),t}(n,(function(n){if(n&&"string"==typeof n){var e=n.match(/at (.*?) \((.*):(\d{1,}):(\d{1,})\)/);p(e)}}))]}(e),{title:e[0]||"Unknown error",functionName:"Unknown function"}},dn={name:"gioPerformance",method:function(n){var e,t=this;this.growingIO=n,this.inited=!1,this.cacheQueue=[],this.init=function(){if(!t.inited){var n=t.growingIO.vdsConfig,e=n.performance,r=n.dataCollect;e.monitor&&(t.monitor=new nn(t.growingIO)),e.exception&&(t.exception=new N(t.growingIO)),t.network=new rn(t.growingIO,e),r&&t.sendCacheQuene(),t.inited=!0}},this.sendCacheQuene=function(){tn.isEmpty(t.cacheQueue)||(t.cacheQueue.forEach((function(n){t.buildPerfEvent(n.eventName,n.attributes,n.eventTime)})),t.cacheQueue=[])},this.buildPerfEvent=function(n,e,r){var o;if(n&&e){var a=t.growingIO,u=a.dataStore,c=u.eventContextBuilder,s=u.eventConverter,d=a.vdsConfig;if(a.gioSDKInitialized&&d.dataCollect){tn.forEach(e,(function(n,t){(tn.isNaN(n)||tn.isNil(n))&&(e[t]=0),e[t]=tn.fixed(n,0)}));var f=i({eventType:"CUSTOM",eventName:n},c());f.attributes=P(i(i({},null!==(o=f.attributes)&&void 0!==o?o:{}),e)),r&&(f.timestamp=r),s(f)}else t.cacheQueue.push({eventName:n,attributes:e,eventTime:r||+Date.now()})}},this.pluginVersion="4.3.1",tn=this.growingIO.utils,this.growingIO.gioSDKInitialized?this.init():this.growingIO.emitter.on("SDK_INITIALIZED",(function(){t.init()})),null===(e=this.growingIO.emitter)||void 0===e||e.on("OPTION_CHANGE",(function(n){var e=n.optionName,r=n.optionValue;"dataCollect"===e&&!0===r&&t.sendCacheQuene()}))},GioVue:on,gioReactErrorReport:function(n,e){var t;if(n&&n.stack){var r=n.stack.split("\n")[0]||"Unknown React Error",i=(null===(t=null==e?void 0:e.componentStack)||void 0===t?void 0:t.split("\n"))||[],o=[];i.forEach((function(n){if(n&&"string"==typeof n){var e="".concat(n," ").match(/at (.*?) /);p(e)&&e[1]&&o.push(e[1])}}));var a=o.length>0?"at ".concat(function(n,e){return void 0===e&&(e=1),p(n)&&l(e)?n.slice(e>0?e:1,n.length):n}(o.reverse()).join("/")):"Unknown component path",u=I();u&&u("track","apm_system_error",{error_type:r,error_content:a})}}};export{dn as default};
