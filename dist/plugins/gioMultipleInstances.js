var n=function(){return n=Object.assign||function(n){for(var r,t=1,e=arguments.length;e>t;t++)for(var i in r=arguments[t])({}).hasOwnProperty.call(r,i)&&(n[i]=r[i]);return n},n.apply(this,arguments)},r=function(n){return e(["undefined","null"],o(n))},t=function(n){return"object"===o(n)&&!r(n)},e=function(n,r){return("array"===o(n)||"string"===o(n))&&("array"===o(r)?r.some((function(r){return n.indexOf(r)>=0})):n.indexOf(r)>=0)},i=function(n){return t(n)?Object.keys(n):[]},a=function(n,r){if(!t(n))return!1;try{return"string"===o(r)?delete n[r]:"array"===o(r)?r.map((function(r){return delete n[r]})):(function(n){return"regexp"===o(n)}(r)&&i(n).forEach((function(t){r.test(t)&&a(n,t)})),!0)}catch(n){return!1}},o=function(n){return{}.toString.call(n).slice(8,-1).toLowerCase()},g={name:"gioMultipleInstances",method:function(g){var c=this;this.growingIO=g,this.getTrackerType=function(n,r){return r.trackingId&&r.trackingId!==n?0:1},this.rewriteDataStore=function(){c.growingIO.dataStore.getTrackerVds=function(r){if(c.growingIO.trackingId===r){var t=n({},c.growingIO.vdsConfig);return a(t,"subInstance"),t}return c.growingIO.subInstance[r]},c.growingIO.dataStore.getKeyPrefix=function(n){var e,a=c.growingIO,g=a.vdsConfig,u=a.subInstance;if(c.growingIO.trackingId&&c.growingIO.trackingId!==n){var s=u[n]||{};return e=function(n,r){var e=0;if(function(n){return function(n){return Array.isArray(n)&&"array"===o(n)}(n)?0===n.length:t(n)?0===i(n).length:!n}(n)||"boolean"==typeof n)return e;for(var a=0;a<n.length;)e=(e<<5)-e+n.charCodeAt(a),e&=e,a++;return Math.abs(e)}(""+s.projectId+s.dataSourceId),r(e)?"":"".concat(e)}return g.projectId},c.growingIO.dataStore.initTrackerOptions=function(r){var t,e,i=c.growingIO.dataStore.initOptions(r);return c.getTrackerType(r.trackingId,c.growingIO)?(c.growingIO.trackingId=r.trackingId,c.growingIO.vdsConfig=i,window[c.growingIO.vdsName]=i):(a(i,["cookieDomain","debug","forceLogin","hashtag","originalSource","performance","rewriteQuery","storageType","subInstance","touch"]),c.growingIO.subInstance[r.trackingId]=i,window[c.growingIO.vdsName].subInstance=n(n({},null!==(e=window[c.growingIO.vdsName].subInstance)&&void 0!==e?e:{}),((t={})[r.trackingId]=i,t))),i.trackingId=r.trackingId,i};var g=c.growingIO.dataStore.eventConverter,u=c;c.growingIO.dataStore.eventConverter=function(){for(var r=this,t=[],i=0;arguments.length>i;i++)t[i]=arguments[i];var c=t[0];if("CUSTOM"===c.eventType){var s=[c.trackingId];!function(n){for(var r=[],t=1;arguments.length>t;t++)r[t-1]=arguments[t];try{return n.apply(void 0,r)}catch(n){return}}((function(){c["&&sendTo"].forEach((function(n){"string"===o(n)&&u.growingIO.dataStore.getTrackerVds(n)&&!e(s,n)&&s.push(n)}))})),a(c,"&&sendTo"),s.forEach((function(t){var e=u.growingIO.dataStore.eventContextBuilder,i=n(n({},c),e(t,c.trackingId!==t));i.attributes=n(n({},i.attributes),c.attributes),g.call(r,i)}))}else g.call(this,c)}},this.onSendBefore=function(n){var r=n.requestData;if(r.trackingId!==c.growingIO.trackingId){if(r.trackingId===c.growingIO.useHybridInherit)return!1;c.growingIO.uploader.sendEvent(r)}},this.pluginVersion="4.3.1",this.rewriteDataStore(),this.growingIO.subInstance||(this.growingIO.subInstance={})}};export{g as default};
