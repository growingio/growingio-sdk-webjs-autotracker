var n=function(){return n=Object.assign||function(n){for(var r,t=1,i=arguments.length;i>t;t++)for(var e in r=arguments[t])({}).hasOwnProperty.call(r,e)&&(n[e]=r[e]);return n},n.apply(this,arguments)},r=function(n){return i(["undefined","null"],g(n))},t=function(n){return"object"===g(n)&&!r(n)},i=function(n,r){return("array"===g(n)||"string"===g(n))&&n.indexOf(r)>=0},e=function(n){return t(n)?Object.keys(n):[]},o=function(n,r){if(!t(n))return!1;try{return"string"===g(r)?delete n[r]:"array"===g(r)?r.map((function(r){return delete n[r]})):(function(n){return"regexp"===g(n)}(r)&&e(n).forEach((function(t){r.test(t)&&o(n,t)})),!0)}catch(n){return!1}},g=function(n){return{}.toString.call(n).slice(8,-1).toLowerCase()},a={name:"gioMultipleInstances",method:function(i){var a=this;this.growingIO=i,this.getTrackerType=function(n,r){return r.trackingId&&r.trackingId!==n?0:1},this.rewriteDataStore=function(){a.growingIO.subInstance={},a.growingIO.dataStore.getTracker=function(n){return a.growingIO.trackingId===n?a.growingIO:a.growingIO.subInstance[n]},a.growingIO.dataStore.getKeyPrefix=function(n){var i,o,c=a.growingIO,u=c.vdsConfig,I=c.subInstance;if(a.growingIO.trackingId&&a.growingIO.trackingId!==n){var d=(null===(i=I[n])||void 0===i?void 0:i.vdsConfig)||{};return o=function(n,r){void 0===r&&(r=!1);var i=0;if(function(n){return function(n){return Array.isArray(n)&&"array"===g(n)}(n)?0===n.length:t(n)?0===e(n).length:!n}(n)||"boolean"==typeof n)return i;for(var o=0;o<n.length;)i=(i<<5)-i+n.charCodeAt(o),i&=i,o++;return r?Math.abs(i):i}(""+d.projectId+d.dataSourceId,!0),r(o)?"":"".concat(o)}return u.projectId},a.growingIO.dataStore.initTrackerOptions=function(r){var t,i,e=a.growingIO.dataStore.initOptions(r);return a.getTrackerType(r.trackingId,a.growingIO)?(a.growingIO.trackingId=r.trackingId,a.growingIO.vdsConfig=e,window[a.growingIO.vdsName]=e):(o(e,["cookieDomain","debug","forceLogin","hashtag","performance","storageType"]),a.growingIO.subInstance[r.trackingId]={vdsConfig:e,generalProps:{}},window[a.growingIO.vdsName].subInstance=n(n({},null!==(i=window[a.growingIO.vdsName].subInstance)&&void 0!==i?i:{}),((t={})[r.trackingId]=e,t))),e.trackingId=r.trackingId,e}},this.onSendBefore=function(n){var r=n.requestData;r.trackingId!==a.growingIO.trackingId&&a.growingIO.uploader.sendEvent(r)},this.subTrackingIds=[],this.growingIO.emitter.on("OPTION_INITIALIZED",(function(n){var r=n.trackingId;a.growingIO.trackingId&&r!==a.growingIO.trackingId||a.rewriteDataStore(),a.growingIO.trackingId&&a.growingIO.trackingId!==r&&a.subTrackingIds.push(r)}))}};export{a as default};
