var r=function(){return r=Object.assign||function(r){for(var n,t=1,e=arguments.length;e>t;t++)for(var i in n=arguments[t])({}).hasOwnProperty.call(n,i)&&(r[i]=n[i]);return r},r.apply(this,arguments)},n=function(r){return e(["undefined","null"],o(r))},t=function(r){return"object"===o(r)&&!n(r)},e=function(r,n){return("array"===o(r)||"string"===o(r))&&("array"===o(n)?n.some((function(n){return r.indexOf(n)>=0})):r.indexOf(n)>=0)},i=function(r){return t(r)?Object.keys(r):[]},a=function(r,n){if(!t(r))return!1;try{return"string"===o(n)?delete r[n]:"array"===o(n)?n.map((function(n){return delete r[n]})):(function(r){return"regexp"===o(r)}(n)&&i(r).forEach((function(t){n.test(t)&&a(r,t)})),!0)}catch(r){return!1}},o=function(r){return{}.toString.call(r).slice(8,-1).toLowerCase()},g={name:"gioMultipleInstances",method:function(g){var c=this;this.growingIO=g,this.getTrackerType=function(r,n){return n.trackingId&&n.trackingId!==r?0:1},this.rewriteDataStore=function(){c.growingIO.dataStore.getTrackerVds=function(n){if(c.growingIO.trackingId===n){var t=r({},c.growingIO.vdsConfig);return a(t,"subInstance"),t}return c.growingIO.subInstance[n]},c.growingIO.dataStore.getKeyPrefix=function(r){var e,a=c.growingIO,g=a.vdsConfig,u=a.subInstance;if(c.growingIO.trackingId&&c.growingIO.trackingId!==r){var s=u[r]||{};return e=function(r,n){void 0===n&&(n=!1);var e=0;if(function(r){return function(r){return Array.isArray(r)&&"array"===o(r)}(r)?0===r.length:t(r)?0===i(r).length:!r}(r)||"boolean"==typeof r)return e;for(var a=0;a<r.length;)e=(e<<5)-e+r.charCodeAt(a),e&=e,a++;return n?Math.abs(e):e}(""+s.projectId+s.dataSourceId,!0),n(e)?"":"".concat(e)}return g.projectId},c.growingIO.dataStore.initTrackerOptions=function(n){var t,e,i=c.growingIO.dataStore.initOptions(n);return c.getTrackerType(n.trackingId,c.growingIO)?(c.growingIO.trackingId=n.trackingId,c.growingIO.vdsConfig=i,window[c.growingIO.vdsName]=i):(a(i,["cookieDomain","debug","forceLogin","hashtag","originalSource","performance","rewriteQuery","storageType","subInstance","touch"]),c.growingIO.subInstance[n.trackingId]=i,window[c.growingIO.vdsName].subInstance=r(r({},null!==(e=window[c.growingIO.vdsName].subInstance)&&void 0!==e?e:{}),((t={})[n.trackingId]=i,t))),i.trackingId=n.trackingId,i};var g=c.growingIO.dataStore.eventConverter,u=c;c.growingIO.dataStore.eventConverter=function(){for(var n=this,t=[],i=0;arguments.length>i;i++)t[i]=arguments[i];var c=t[0];if("CUSTOM"===c.eventType){var s=[c.trackingId];!function(r){try{return void c["&&sendTo"].forEach((function(r){"string"===o(r)&&u.growingIO.dataStore.getTrackerVds(r)&&!e(s,r)&&s.push(r)}))}catch(r){return}}(),a(c,"&&sendTo"),s.forEach((function(t){var e=u.growingIO.dataStore.eventContextBuilder,i=r(r({},c),e(t,c.trackingId!==t));i.attributes=r(r({},i.attributes),c.attributes),g.call(n,i)}))}else g.call(this,c)}},this.onSendBefore=function(r){var n=r.requestData;if(n.trackingId!==c.growingIO.trackingId){if(n.trackingId===c.growingIO.useHybridInherit)return!1;c.growingIO.uploader.sendEvent(n)}},this.pluginVersion="4.3.0",this.rewriteDataStore(),this.growingIO.subInstance||(this.growingIO.subInstance={})}};export{g as default};
