var e,t,n,i,r,o=function(){return o=Object.assign||function(e){for(var t,n=1,i=arguments.length;i>n;n++)for(var r in t=arguments[n])({}).hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)},a="function"==typeof Array.from?Array.from:(t||(t=1,n=function(e){return"function"==typeof e},i=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),9007199254740991)},r=function(e){var t=e.next();return!t.done&&t},e=function(e){var t,o,a,u=this,s=arguments.length>1?arguments[1]:void 0;if(void 0!==s){if(!n(s))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(t=arguments[2])}var c=function(e,t){if(null!=e&&null!=t){var i=e[t];if(null==i)return;if(!n(i))throw new TypeError(i+" is not a function");return i}}(e,function(e){if(null!=e){if(["string","number","boolean","symbol"].indexOf(typeof e)>-1)return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in e)return Symbol.iterator;if("@@iterator"in e)return"@@iterator"}}(e));if(void 0!==c){o=n(u)?Object(new u):[];var d,l,f=c.call(e);if(null==f)throw new TypeError("Array.from requires an array-like or iterable object");for(a=0;;){if(!(d=r(f)))return o.length=a,o;l=d.value,o[a]=s?s.call(t,l,a):l,a++}}else{var g=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var v,h=i(g.length);for(o=n(u)?Object(new u(h)):Array(h),a=0;h>a;)v=g[a],o[a]=s?s.call(t,v,a):v,a++;o.length=h}return o}),e),u=function(e){return d(["undefined","null"],h(e))},s=function(e){return"object"===h(e)&&!u(e)},c=function(e){return Array.isArray(e)&&"array"===h(e)},d=function(e,t){return("array"===h(e)||"string"===h(e))&&e.indexOf(t)>=0},l=function(e){return u(e)?"":"".concat(e)},f=function(e){return s(e)?Object.keys(e):[]},g=function(e,t){f(e).forEach((function(n){return t(e[n],n)}))},v=function(e,t){if(!s(e))return!1;try{return"string"===h(t)?delete e[t]:"array"===h(t)?t.map((function(t){return delete e[t]})):(function(e){return"regexp"===h(e)}(t)&&f(e).forEach((function(n){t.test(n)&&v(e,n)})),!0)}catch(e){return!1}},h=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},p=function(){return p=Object.assign||function(e){for(var t,n=1,i=arguments.length;i>n;n++)for(var r in t=arguments[n])({}).hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},p.apply(this,arguments)};function w(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;o>r;r++)!i&&r in t||(i||(i=[].slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||[].slice.call(t))}var N=function(e){try{return e()}catch(e){return}},m=function(e){return"number"===C(e)},b=function(e){return"object"===C(e)&&!function(e){return L(["undefined","null"],C(e))}(e)},y=function(e){return Array.isArray(e)&&"array"===C(e)},I=function(e,t){if(y(e))for(var n=0;n<e.length;n++)if(t(e[n]))return n;return-1},L=function(e,t){return("array"===C(e)||"string"===C(e))&&e.indexOf(t)>=0},E=a,_=function(e){return b(e)?Object.keys(e):[]},x=function(e){return y(e)?0===e.length:b(e)?0===_(e).length:!e},O=function(e){if(y(e)){for(var t=0,n=[],i=0,r=e;i<r.length;i++){var o=r[i];o&&!x(o)&&(n[t++]=o)}return n}return e},C=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},T=["body","br","canvas","clippath","defs","desc","g","hr","html","iframe","math","param","path","rect","script","style","text","title","tspan","use"],k=["button","reset","submit"],S=w(w([],k,!0),["file"],!1),H=["checkbox","color","radio","range"],U=w(w([],H,!0),["date","datetime-local","month","number","password","text","time","week"],!1),A=["tr","li","dt","dd"],D=w(["a","button","dl"],A,!0),P=["i","em","svg","img"],B=["i","span","em","b","strong","bdo"],V=/(^| |[^ ]+\-)(clear|clearfix|active|hover|enabled|current|selected|unselected|hidden|display|focus|disabled|undisabled|open|checked|unchecked|undefined|null|ng-|growing-)[^\. ]*/g,W=/^([a-zA-Z\-\_0-9]+)$/,G="data-growing-ignore",j="data-growing-container",J="data-growing-index",X="data-growing-title",M=function(e,t){var n;return null!==(n=N((function(){return e.hasAttribute(t)&&"false"!==e.getAttribute(t)})))&&void 0!==n?n:N((function(){return e.hasOwnPerporty(t)}))},K=function(e,t){var n;return null!==(n=N((function(){return e.getAttribute(t)})))&&void 0!==n?n:N((function(){return e.attributes[t].value}))},R=function(e){var t,n=!L(T,e.tagName.toLowerCase()),i=Y(e);return n&&i&&L(B,null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())?R(i):e},z=function(e,t,n){if(void 0===t&&(t=5),void 0===n&&(n=0),!e.children)return!1;if("svg"===e.tagName.toLocaleLowerCase())return n>t;if(n>t)return!0;for(var i=0;i<e.children.length;i++){var r=e.children[i];if(z(r,t,n+1))return!0}return!1},Z=function(e,t){var n=e.tagName.toLowerCase();if(!(e instanceof HTMLElement||e instanceof Element))return!1;if(M(e,G))return!1;if(L(T,n))return!1;if(L(["circleClick","circleHover","click"],t)){if("textarea"===n&&"click"===t)return!1;if("input"===n){if("click"===t&&!L(S,K(e,"type")))return!1;if(L(["circleClick","circleHover"],t)&&!L(w(w([],S,!0),U,!0),K(e,"type")))return!1}if(!$(e)&&z(e,5))return!1}return!0},F=function(e,t){return void 0===t&&(t=!1),E((null==e?void 0:e.childNodes)||[]).filter((function(e){return L(t?[Node.ELEMENT_NODE,Node.TEXT_NODE]:[Node.ELEMENT_NODE],e.nodeType)}))},Y=function(e){return q(e.parentElement)?null:e.parentElement},q=function(e){return!e||L(["BODY","HTML","#document"],e.tagName)},$=function(e){return M(e,j)||L(D,e.tagName.toLowerCase())||"input"===e.tagName.toLowerCase()&&L(k,e.type)},Q=function(e){var t=F(e);return!x(t)&&t.every((function(e){var t=te(e),n=L(e.classList,"icon");return!(!t&&!n||ee(e))}))},ee=function(e){var t=F(e,!0);return!x(t)&&t.every((function(e){var t=e.nodeType===Node.TEXT_NODE,n=ne(e);return!(!t||!n)}))},te=function(e){return L(P,e.tagName.toLocaleLowerCase())},ne=function(e){var t=F(e,!0).filter((function(e){var t;return e.nodeType===Node.TEXT_NODE||L(B,null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())})).map((function(e){return ie(e.textContent,e.textContent.length)}));return ie(O(t).join(" "))},ie=function(e,t){return void 0===t&&(t=50),e&&(null==(e=e.replace(/[\n \t]+/g," ").trim())?void 0:e.length)?e.slice(0,m(t)&&t>0?t:void 0):""},re=/[^/]*.(bmp|jpg|jpeg|png|gif|svg|psd|webp|apng)/gi,oe=function(e,t){switch(t){case"a":return function(e){if(M(e,"href")){var t=K(e,"href");if(t&&0!==t.indexOf("javascript"))return t.slice(0,320)}return""}(e);case"img":return function(e){var t=e.src;if(t&&-1===t.indexOf("data:image")){var n=t.match(re),i=x(n)?"":n[0];if(i.indexOf("%")>-1){var r=function(e,t){var n=-1;if(y(e))for(var i=0;i<e.length;i++)"%"===e[i]&&(n=i);return n}(i.split(""));i=i.substring(r+3,i.length)}return i}return""}(e);default:return""}},ae={a:function(e){return ne(e)||ce(e)||oe(e,"a")},button:function(e){return K(e,"name")||ne(e)||ce(e)||de(e)},img:function(e){return ie(K(e,"alt"))||oe(e,"img")},input:function(e){if("password"===e.type)return"";var t,n,i=e instanceof HTMLInputElement&&L(S,e.type),r=M(e,"data-growing-track");if(i||r)return ie(e.value);if(e instanceof HTMLInputElement&&L(H,e.type)){var o=void 0;return e.id&&(n=function(t){return t.htmlFor===e.id},o=(t=E(document.getElementsByTagName("label")))[I(t,n)]),o||(o=se(e,(function(e){return"label"===e.tagName.toLowerCase()}))),le(e,o?ne(o):ie(e.value))}return""},label:function(e){return ne(e)||ce(e)||de(e)},select:function(e){return ie(E(e.options).filter((function(e){return e.selected})).map((function(e){return e.label})).join(", ")||e.value)},svg:function(e){var t;return F(e).some((function(e){var n;if(e.nodeType===Node.ELEMENT_NODE&&"use"===(null===(n=e.tagName)||void 0===n?void 0:n.toLowerCase())&&e.hasAttribute("xlink:href"))return t=e,!0})),t?t.getAttribute("xlink:href"):""},textarea:function(){return""},form:function(){return""}},ue=function(e,t){if(M(e,X)&&K(e,X))return ie(K(e,X));if(M(e,"title")&&K(e,"title"))return ie(K(e,"title"));var n=ae[t];if(n)return n(e);var i=ne(e);return i?ie(i):function(e){if("svg"===e.tagName)return!1;var t=F(e);return t.length>0&&t.every((function(e){return function(e){if("svg"===e.tagName)return!0;var t=F(e);if(x(t))return!0;var n=ee(e);return!(!x(t)&&!n)}(e)}))}(e)&&!Q(e)?ie(ce(e)):Q(e)?ie(de(e)):""},se=function(e,t){for(var n=e.parentElement;n&&!q(n);){if(t(n))return n;n=n.parentElement}},ce=function(e){var t=F(e);return O(t.map((function(e){var t=ne(e);if(ee(e)&&t)return t}))).join(" ")},de=function(e){var t;return F(e).some((function(e){var n,i=ue(e,null===(n=e.tagName)||void 0===n?void 0:n.toLowerCase());return!!i&&(t=i,!0)})),t},le=function(e,t){return L(["checkbox","radio"],e.type)?"".concat(t).concat((n=e.checked,"boolean"===C(n)?"("+e.checked+")":"")):t;var n},fe=function e(t,n,i,r,o){void 0===r&&(r=!0),void 0===o&&(o=[]);var a,u=this;this.originNode=t,this.deviceInfo=n,this.actionType=i,this.trackable=r,this.parentNodes=o,this.isLimitViewport=!0,this._getIndex=function(){if(M(u.originNode,J)){var e=K(u.originNode,J);return/^\d{1,10}$/.test(e)&&e-0>0&&2147483647>e-0?+e:void(0>u.actionType.indexOf("circle")&&(s="".concat(e,"，index标记应为 大于 0 且小于 2147483647 的整数！"),console.log("%c [GrowingIO]：".concat(s),"color: #F59E0B;")))}if(L(["dd","dt"],u.tagName)){var t=Y(u.originNode),n=t?F(t):[];if("dl"===t.tagName.toLowerCase()&&n.length>0){if("dd"===u.tagName){var i=I(n,(function(e){return e.isSameNode(u.originNode)}));if(i>-1)return(r=n.slice(0,i).filter((function(e){return"dt"===e.tagName.toLowerCase()}))).length-1+1}if("dt"===u.tagName){var r=n.filter((function(e){return"dt"===e.tagName.toLowerCase()}));return I(r,(function(e){return e.isSameNode(u.originNode)}))+1}}}if(u.isPureList){var o=I(u._pureList,(function(e){return e.isSameNode(u.originNode)}));return o>-1?(u.peerNodes=w([],u._pureList,!0),u.peerNodes.splice(o,1),o+1):void 0}if(u.isPseudoList){var a=I(u._pseudoList,(function(e){return e.isSameNode(u.originNode)}));return a>-1?(u.peerNodes=w([],u._pseudoList,!0),u.peerNodes.splice(a,1),a+1):void 0}var s},this._getSiblingNode=function(e,t){var n,i=Y(e);if(!i)return[];for(var r=null!==(n=N((function(){return E(i.children)})))&&void 0!==n?n:[],o=[],a=0;a<r.length;a++){var u=r[a],s=r[a+1];if(!s||!t(u,s))break;x(o)?o.push(u,s):o.push(s)}return o},this._getIsPureList=function(){var e=u._getSiblingNode(u.originNode,(function(e,t){return e.tagName===t.tagName}));return!(1>e.length||!L(A,u.tagName)||(u._pureList=e,0))},this._getIsInPseudoList=function(){if(L(["th","td"],u.tagName))return!1;var e=u._getSiblingNode(u.originNode,(function(e,t){var n=e.tagName===t.tagName&&e.className===t.className,i=F(e),r=F(t),o=i.every((function(e,t){var n,i;return(null==e?void 0:e.tagName)===(null===(n=r[t])||void 0===n?void 0:n.tagName)&&(null==e?void 0:e.className)===(null===(i=r[t])||void 0===i?void 0:i.className)})),a=i.length===r.length&&o;return n&&a}));return e.length>=3&&(u._pseudoList=e,!0)},this._getClassList=function(e){var t;if(M(e,"name")&&K(e,"name"))return[K(e,"name")];var n=(null!==(t=K(e,"class"))&&void 0!==t?t:"").trim().split(" ");return x(n)?[]:n.filter((function(e){return e&&!V.test(e)&&W.test(e)})).sort()},this._getCurrentXpath=function(){return"/".concat(u.tagName).concat(u.id?"#"+u.id:"").concat(x(u.classList)?"":"."+u.classList.join("."))},this._getIsContainer=function(){return M(u.originNode,j)||L(D,u.tagName)||"input"===u.tagName&&L(k,u.originNode.type)},this._getContent=function(){u.content=ue(u.originNode,u.tagName)},this._getIsOutFlow=function(){var e=window.getComputedStyle(u.originNode).position;return L(["fixed","sticky"],e)},this._getRect=function(){var e=u.originNode.getBoundingClientRect(),t=e.top,n=e.bottom,i=e.left,r=e.right-i,o=n-t,a=u.deviceInfo,s=a.winHeight,c=a.winWidth;return t+o>s&&(o=s-t),i+r>c&&(r=c-i),{top:t,left:i,width:r,height:o}},this._getListItemViewStatus=function(){var e=u.parentNodes.find((function(e){var t=e.originNode,n=t.scrollHeight,i=t.scrollWidth,r=t.clientHeight,o=t.clientWidth,a=e.rect,u=a.width,s=a.height;return r!==n&&n>s||o!==i&&i>u}));if(e){var t=e.rect,n=t.top,i=t.left,r=t.width,o=t.height,a=u.rect,s=a.top,c=a.left,d=a.width,l=a.height;return n>s+l||c>i+r||s>n+o||i>c+d?"OUTSIDE":s>=n&&c>=i&&n+o>s+l&&i+r>c+d?"DISPLAYED":"OBSCURED"}return""},this._getViewStatus=function(e){var t=window.getComputedStyle(u.originNode),n=t.opacity,i=t.visibility,r=t.display,o=t.width,a=t.height,s=u.rect,c=s.top,d=s.left,l=s.width,f=s.height,g=u.deviceInfo,v=g.winWidth,h=g.winHeight;if(0===Number(n)||"hidden"===i||"none"===r||"0px"===o||0===u.originNode.clientWidth||"0px"===a||0===u.originNode.clientHeight)return"HIDDEN";var p=w([],e,!0).find((function(e){return e.trackable&&L(["DISPLAYED","OBSCURED"],e.viewStatus)}));if(u.isPureList||u.isPseudoList){var N=u._getListItemViewStatus();if(N)return N}if(p)return p.viewStatus;var m=function(e,t){return document.elementFromPoint(e,t)===u.originNode};return h>c&&v>d&&l>0&&f>0?m(d+l/2,c+f/2)||m(d+1,c+1)||m(d+l-1,c+1)||m(d+1,c+f-1)||m(d+l-1,c+f-1)?"DISPLAYED":u.isLimitViewport&&(0>c+f||0>d+l)?"OUTSIDE":"OBSCURED":"OUTSIDE"},this._getTriggerEvent=function(){return"input"===u.tagName&&L(U,u.originNode.type)||L(["select","textarea"],u.tagName)?"VIEW_CHANGE":"VIEW_CLICK"},this._getXParents=function(t,n){var i=t.parentElement,r=[];if(n.length>0)r.push.apply(r,n);else if(i&&!q(i)){var o=new e(i,void 0,u.actionType,Z(i,u.actionType));r.push(o),o.xParents&&r.push.apply(r,o.xParents)}return r},this.tagName=t.tagName.toLocaleLowerCase(),this.classList=this._getClassList(t),this.id=t.id,this.currentXpath=this._getCurrentXpath(),this.isIgnored=M(this.originNode,G),this.isContainer=this._getIsContainer(),this.isPureList=this._getIsPureList(),this.isPseudoList=this._getIsInPseudoList(),this.index=this._getIndex(),this.hyperlink=oe(t,this.tagName),this.content=ue(this.originNode,this.tagName),this.triggerEvent=this._getTriggerEvent(),this.isOutFlow=this._getIsOutFlow(),n&&(this.isLimitViewport=null===(a=n.isLimitViewport)||void 0===a||a,this.rect=this._getRect(),this.viewStatus=this._getViewStatus(o)),this.xParents=this._getXParents(t,o)},ge=function e(t,n,i,r,o){var a=this;this.origin=t,this.action=n,this.lengthThreshold=i,this.deviceInfo=r,this.parentNode=o,this.trackNodes=function(){var e;if(!a.trackable)return[];var t=[a.xNode];if(L(["click","circleClick","change"],a.actionType))for(var n=a._getParent();n;){if(!(null==n?void 0:n.xNode)||(null===(e=n.xNode)||void 0===e?void 0:e.isIgnored))return[];n.trackable&&t.push(n.xNode),n=n._getParent()}var i,r=[];return t.reverse().forEach((function(e,n){if(M(e.originNode,j)&&(r=[],i=void 0),m(e.index)&&!m(i)&&(i=e.index),m(i)&&(e.index=i),n===t.length-1)r.push(a.getGioNodeInfo(e));else{var o=e.isPureList||e.isPseudoList;(e.isContainer||o)&&r.push(a.getGioNodeInfo(e))}})),r},this.getGioNodeInfo=function(e){var t=a.computeXpath(e),n=t.skeleton,i=t.fullXpath,r=t.xcontent,o=e.hyperlink,u=e.index,s=e.peerNodes,c=e.content,d=e.triggerEvent,l=e.originNode;return{skeleton:n,xpath:n,fullXpath:i,xcontent:r,hyperlink:o,index:u,peerNodes:null!=s?s:[],content:ie(c),triggerEvent:d,originNode:l}},this.computeXpath=function(e){var t,n="/"+e.tagName,i=e.currentXpath,r="/"+((e.id?"#"+e.id:"")+(x(e.classList)?"":"."+e.classList.join("."))||"-");return null===(t=e.xParents)||void 0===t||t.forEach((function(e,t){if(i=e.currentXpath+i,t<a.xpathThreshold-1){n="/"+e.tagName+n;var o=(e.id?"#"+e.id:"")+(x(e.classList)?"":"."+e.classList.join("."));r="/"+(o||"-")+r}})),{skeleton:n,fullXpath:i,xcontent:r}},this._getParent=function(){var t=Y(a.originElement);if(t&&t.nodeName&&!q(t))return new e(t,a.actionType)},this.actionType=L(["circleClick","circleHover","click","change"],n)?n:"click",this.originElement=R(t),this.xpathThreshold=m(i)?i:4,this.trackable=Z(this.originElement,this.actionType),this.originElement.isSameNode(t)||(o=null);var u=[];o&&o.xNode&&(u.push(o.xNode),o.xNode.xParents&&u.push.apply(u,o.xNode.xParents)),this.xNode=new fe(this.originElement,this.deviceInfo,this.actionType,this.trackable,u)},ve=[],he=function(e,t){var n,i,r,o,a,u,s,c=this;this.trackNodes=function(e,t,n){return void 0===n&&(n=!1),ve=[],c._getTrackElements(e,t,null,n),ve},this._getTrackElements=function(e,t,n,i){void 0===i&&(i=!1),F(e).forEach((function(e){var r,o,a,u;if(!(null==e?void 0:e.tagName)||L(["circle-shape","circle-page","heatmap-page"],null===(r=null==e?void 0:e.tagName)||void 0===r?void 0:r.toLowerCase())||(null===(o=null==e?void 0:e.id)||void 0===o?void 0:o.indexOf("__vconsole"))>-1||(null===(a=null==e?void 0:e.id)||void 0===a?void 0:a.indexOf("__giokit"))>-1)return!1;var s=new ge(e,"circleClick",c.xpathThreshold,c.deviceInfo,n),d=s.xNode;if(d.zLevel=c._getZLevel(e,t),s.trackable&&(L(["DISPLAYED","OBSCURED"],d.viewStatus)||i)){if(t.index&&(d.index=t.index),ve.find((function(e){return e.originNode.isSameNode(d.originNode)})))return!1;if("DISPLAYED"===d.viewStatus){var l=c._getGioHybridNodeInfo(s,t);ve.push(l)}else"OBSCURED"===d.viewStatus&&(d.isContainer||i)&&(l=c._getGioHybridNodeInfo(s,t),ve.push(l));if(te(e)||d.isContainer&&ee(e))return!1}x(F(e))||c._getTrackElements(e,null!==(u=s.xNode)&&void 0!==u?u:t,s,i)}))},this._getZLevel=function(e,t){var n=window.getComputedStyle(e),i=n.position,r=n.zIndex;if("auto"!==r){var o=Number(r||0);return(Number.isNaN(o)?0:o)+t.zLevel}switch(i){case"relative":return t.zLevel+2;case"sticky":return t.zLevel+3;case"absolute":return t.zLevel+4;case"fixed":return t.zLevel+5;default:return t.zLevel+1}},this._getGioHybridNodeInfo=function(e,t){var n=e.xNode,i=n.rect,r=n.zLevel,o=e.getGioNodeInfo(n),a=o.hyperlink,u={};return _(i).forEach((function(e){return u[e]=i[e]*c.deviceInfo.scale})),u.top+=c.deviceInfo.webviewTop,u.left+=c.deviceInfo.webviewLeft,p(p(p({},u),o),{zLevel:r+c.deviceInfo.webviewZLevel,href:a,parentXPath:t.trackable?e.computeXpath(t).xpath:void 0})},this.xpathThreshold=t,this.deviceInfo=(i=(n=e).webviewLeft,r=n.webviewTop,o=n.webviewWidth,a=n.webviewHeight,u=n.webviewZLevel,s=n.isLimitViewport,{winWidth:o,winHeight:a,scale:o/window.innerWidth,webviewTop:r,webviewLeft:i,webviewWidth:o,webviewHeight:a,webviewZLevel:u,isLimitViewport:s})},pe=function(e){try{return e()}catch(e){return}},we=function(e,t,n,i){void 0===i&&(i={}),document.addEventListener?e.addEventListener(t,n,o(o({},{capture:!0}),i)):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},Ne=["VIEW_CLICK","VIEW_CHANGE","PAGE","CUSTOM","LOGIN_USER_ATTRIBUTES"],me=["LOGIN_USER_ATTRIBUTES"],be=["DOMContentLoaded","onreadystatechange"],ye=["scroll","resize","load","beforeunload","popstate","hashchange","pagehide","unload"],Ie=function(){function e(e){var t=this;this.growingIO=e,this.penetrateHybrid=!0,this.onOptionsInit=function(e,n){var i,r=t.growingIO,o=r.emitter,a=r.plugins;if(function(e){return"boolean"===h(e)}(n.penetrateHybrid)&&(t.penetrateHybrid=n.penetrateHybrid),t._initHybridBridge()&&(t.onSendBefore=t.sendBeforeListener,!t.growingIO.useHybridInherit)){var u=null!==(i=t.hybridConfig.packageName)&&void 0!==i?i:t.hybridConfig.appPackage;a.gioMultipleInstances||n.packageName?t.hybridConfig.projectId===n.projectId&&u===n.packageName&&(t.growingIO.useHybridInherit=e):t.hybridConfig.projectId===n.projectId&&(t.growingIO.useHybridInherit=e)}t.growingIO.useHybridInherit&&(null==o||o.on("SET_USERID",(function(e){var n=e.newUserId,i=e.oldUserId,r=e.userKey;e.trackingId===t.growingIO.useHybridInherit&&t.penetrateHybrid&&(!n&&i?r?t._clearNativeUserIdAndUserKey():t._clearNativeUserId():r?t._setNativeUserIdAndUserKey(l(n),l(r)):t._setNativeUserId(l(n)))})),null==o||o.on("SET_USERKEY",(function(e){var n=e.newUserKey,i=e.oldUserKey,r=e.userId;e.trackingId===t.growingIO.useHybridInherit&&t.penetrateHybrid&&(!n&&i?t._clearNativeUserIdAndUserKey():t._setNativeUserIdAndUserKey(l(r),l(n)))})))},this._initHybridBridge=function(){var e,n,i,r=!1;return t.hasHybridBridge=!!window.GrowingWebViewJavascriptBridge,t.hasHybridBridge&&((null===(e=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===e?void 0:e.configuration)||(window.GrowingWebViewJavascriptBridge.configuration=JSON.parse(window.GrowingWebViewJavascriptBridge.getConfiguration())),(null===(n=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===n?void 0:n.configuration)&&(t.hybridConfig=null===(i=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===i?void 0:i.configuration),r=!0),r},this.sendBeforeListener=function(e){var n=e.requestData,i=e.trackingId;if(t.hasHybridBridge){var r=function(){var e=t.processAttributes(o({},n));d(Ne,e.eventType)&&(d(me,e.eventType)?t.penetrateHybrid&&t._dispatchEvent(e):(t.penetrateHybrid||v(e,["userId","userKey","cs1"]),t._dispatchEvent(e)))};t.growingIO.useHybridInherit?i===t.growingIO.useHybridInherit&&r():i!==t.growingIO.trackingId||t.growingIO.plugins.gioMultipleInstances||r()}},this.processAttributes=function(e){return g(e,(function(t,n){s(t)||c(t)?g(e[n],(function(t,i){s(t)||c(t)?e[n][i]=JSON.stringify(t):e[n][i]=l(t)})):e[n]=l(t)})),e},this._setNativeUserId=function(e){pe((function(){return window.GrowingWebViewJavascriptBridge.setNativeUserId(e)}))},this._clearNativeUserId=function(){pe((function(){return window.GrowingWebViewJavascriptBridge.clearNativeUserId()}))},this._setNativeUserIdAndUserKey=function(e,t){pe((function(){return window.GrowingWebViewJavascriptBridge.setNativeUserIdAndUserKey(e,t)}))},this._clearNativeUserIdAndUserKey=function(){pe((function(){return window.GrowingWebViewJavascriptBridge.clearNativeUserIdAndUserKey()}))},this._dispatchEvent=function(e){pe((function(){var t;return null===(t=window.GrowingWebViewJavascriptBridge)||void 0===t?void 0:t.dispatchEvent(JSON.stringify(e))}))},this._getDomTree=function(e,n,i,r,o,a){var u=new he({webviewLeft:e,webviewTop:n,webviewWidth:i,webviewHeight:r,webviewZLevel:o}).trackNodes(null!=a?a:document.body,{isContainer:!1,zLevel:0},!1).map((function(e){return v(e,["originNode","peerNodes"]),e})),s=t.growingIO.dataStore.currentPage;return{page:{domain:s.domain,path:s.path,query:s.query,title:s.title},elements:u}},this.pluginVersion="4.2.2",this.growingIO.emitter.on("OPTION_INITIALIZED",(function(e){var n=e.trackingId,i=e.vdsConfig;if(t.onOptionsInit(n,i),t.growingIO.useHybridInherit&&window.GrowingWebViewJavascriptBridge){var r=t;window.GrowingWebViewJavascriptBridge.getDomTree=function(){if(arguments.length>=4)return r._getDomTree.apply(this,arguments)},t._addDomChangeListener()}}))}return e.prototype._addDomChangeListener=function(){var e,t=function(t){return void 0===t&&(t=""),function(){var n;"beforeunload"===t&&e&&e.disconnect(),null===(n=window.GrowingWebViewJavascriptBridge)||void 0===n||n.onDomChanged()}};(e=new MutationObserver(t("mutation"))).observe(document.body,{attributes:!0,characterData:!0,childList:!0,subtree:!0}),be.forEach((function(e){we(document,e,t(e))})),ye.forEach((function(e){we(window,e,t(e))}))},e}(),Le={name:"gioHybridAdapter",method:Ie};export{Le as default};
