var e,t,n,i,r,o=function(){return o=Object.assign||function(e){for(var t,n=1,i=arguments.length;i>n;n++)for(var r in t=arguments[n])({}).hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)},a="function"==typeof Array.from?Array.from:(t||(t=1,n=function(e){return"function"==typeof e},i=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),9007199254740991)},r=function(e){var t=e.next();return!t.done&&t},e=function(e){var t,o,a,u=this,s=arguments.length>1?arguments[1]:void 0;if(void 0!==s){if(!n(s))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(t=arguments[2])}var c=function(e,t){if(null!=e&&null!=t){var i=e[t];if(null==i)return;if(!n(i))throw new TypeError(i+" is not a function");return i}}(e,function(e){if(null!=e){if(["string","number","boolean","symbol"].indexOf(typeof e)>-1)return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in e)return Symbol.iterator;if("@@iterator"in e)return"@@iterator"}}(e));if(void 0!==c){o=n(u)?Object(new u):[];var d,l,f=c.call(e);if(null==f)throw new TypeError("Array.from requires an array-like or iterable object");for(a=0;;){if(!(d=r(f)))return o.length=a,o;l=d.value,o[a]=s?s.call(t,l,a):l,a++}}else{var g=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var v,h=i(g.length);for(o=n(u)?Object(new u(h)):Array(h),a=0;h>a;)v=g[a],o[a]=s?s.call(t,v,a):v,a++;o.length=h}return o}),e),u=function(e){return d(["undefined","null"],h(e))},s=function(e){return"object"===h(e)&&!u(e)},c=function(e){return Array.isArray(e)&&"array"===h(e)},d=function(e,t){return("array"===h(e)||"string"===h(e))&&e.indexOf(t)>=0},l=function(e){return u(e)?"":"".concat(e)},f=function(e){return s(e)?Object.keys(e):[]},g=function(e,t){f(e).forEach((function(n){return t(e[n],n)}))},v=function(e,t){if(!s(e))return!1;try{return"string"===h(t)?delete e[t]:"array"===h(t)?t.map((function(t){return delete e[t]})):(function(e){return"regexp"===h(e)}(t)&&f(e).forEach((function(n){t.test(n)&&v(e,n)})),!0)}catch(e){return!1}},h=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},p=function(){return p=Object.assign||function(e){for(var t,n=1,i=arguments.length;i>n;n++)for(var r in t=arguments[n])({}).hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},p.apply(this,arguments)};function w(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;o>r;r++)!i&&r in t||(i||(i=[].slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||[].slice.call(t))}var N,m=function(e){try{return e()}catch(e){return}},b=function(e){return"number"===O(e)},y=function(e){return"object"===O(e)&&!function(e){return E(["undefined","null"],O(e))}(e)},L=function(e){return Array.isArray(e)&&"array"===O(e)},I=function(e,t){if(L(e))for(var n=0;n<e.length;n++)if(t(e[n]))return n;return-1},E=function(e,t){return("array"===O(e)||"string"===O(e))&&e.indexOf(t)>=0},_=a,x=function(e){return y(e)?Object.keys(e):[]},T=function(e){return L(e)?0===e.length:y(e)?0===x(e).length:!e},C=function(e){if(L(e)){for(var t=0,n=[],i=0,r=e;i<r.length;i++){var o=r[i];o&&!T(o)&&(n[t++]=o)}return n}return e},O=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},S=["body","br","canvas","clippath","defs","desc","g","hr","html","iframe","math","param","path","rect","script","style","text","title","tspan","use"],k=["button","reset","submit"],U=w(w([],k,!0),["file"],!1),A=["checkbox","color","radio","range"],D=w(w([],A,!0),["date","datetime-local","month","number","password","text","time","week"],!1),H=["tr","li","dt","dd"],P=w(["a","button","dl"],H,!0),B=["i","em","svg","img"],W=["i","span","em","b","strong","bdo"],V=/(^| |[^ ]+\-)(clear|clearfix|active|hover|enabled|current|selected|unselected|hidden|display|focus|disabled|undisabled|open|checked|unchecked|undefined|null|ng-|growing-)[^\. ]*/g,G=/^([a-zA-Z\-\_0-9]+)$/,j="data-growing-ignore",J="data-growing-container",X="data-growing-index",K="data-growing-title",M=function(e,t){var n;return null!==(n=m((function(){return e.hasAttribute(t)&&"false"!==e.getAttribute(t)})))&&void 0!==n?n:m((function(){return e.hasOwnPerporty(t)}))},R=function(e,t){var n;return null!==(n=m((function(){return e.getAttribute(t)})))&&void 0!==n?n:m((function(){return e.attributes[t].value}))},z=function(e){var t,n=!E(S,e.tagName.toLowerCase()),i=q(e);return n&&i&&E(W,null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())?z(i):e},Z=function(e,t,n){if(void 0===t&&(t=5),void 0===n&&(n=0),!e.children)return!1;if("svg"===e.tagName.toLocaleLowerCase())return n>t;if(n>t)return!0;for(var i=0;i<e.children.length;i++){var r=e.children[i];if(Z(r,t,n+1))return!0}return!1},F=function(e,t){var n=e.tagName.toLowerCase();if(!(e instanceof Element))return!1;if(M(e,j))return!1;if(E(S,n))return!1;if(E(["circleClick","circleHover","click"],t)){if("textarea"===n&&"click"===t)return!1;if("input"===n){if("click"===t&&!E(U,R(e,"type")))return!1;if(E(["circleClick","circleHover"],t)&&!E(w(w([],U,!0),D,!0),R(e,"type")))return!1}if(!Q(e)&&Z(e,5))return!1}return!0},Y=function(e,t){return void 0===t&&(t=!1),_((null==e?void 0:e.childNodes)||[]).filter((function(e){return E(t?[Node.ELEMENT_NODE,Node.TEXT_NODE]:[Node.ELEMENT_NODE],e.nodeType)}))},q=function(e){return $(e.parentElement)?null:e.parentElement},$=function(e){return!e||E(["BODY","HTML","#document"],e.tagName)},Q=function(e){return M(e,J)||E(P,e.tagName.toLowerCase())||"input"===e.tagName.toLowerCase()&&E(k,e.type)},ee=function(e){var t=Y(e);return!T(t)&&t.every((function(e){var t=ne(e),n=E(e.classList,"icon");return!(!t&&!n||te(e))}))},te=function(e){var t=Y(e,!0);return!T(t)&&t.every((function(e){var t=e.nodeType===Node.TEXT_NODE,n=ie(e);return!(!t||!n)}))},ne=function(e){return E(B,e.tagName.toLocaleLowerCase())},ie=function(e){var t=Y(e,!0).filter((function(e){var t;return e.nodeType===Node.TEXT_NODE||E(W,null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())})).map((function(e){return re(e.textContent,e.textContent.length)}));return re(C(t).join(" "))},re=function(e,t){return void 0===t&&(t=50),e&&(null==(e=e.replace(/[\n \t]+/g," ").trim())?void 0:e.length)?e.slice(0,b(t)&&t>0?t:void 0):""},oe=/[^/]*.(bmp|jpg|jpeg|png|gif|svg|psd|webp|apng)/gi,ae=function(e,t){switch(t){case"a":return function(e){if(M(e,"href")){var t=R(e,"href");if(t&&0!==t.indexOf("javascript"))return t.slice(0,320)}return""}(e);case"img":return function(e){var t=e.src;if(t&&-1===t.indexOf("data:image")){var n=t.match(oe),i=T(n)?"":n[0];if(i.indexOf("%")>-1){var r=function(e,t){var n=-1;if(L(e))for(var i=0;i<e.length;i++)"%"===e[i]&&(n=i);return n}(i.split(""));i=i.substring(r+3,i.length)}return i}return""}(e);default:return""}},ue={a:function(e){return ie(e)||de(e)||ae(e,"a")},button:function(e){return R(e,"name")||ie(e)||de(e)||le(e)},img:function(e){return re(R(e,"alt"))||ae(e,"img")},input:function(e){if("password"===e.type)return"";var t,n,i=e instanceof HTMLInputElement&&E(U,e.type),r=M(e,"data-growing-track");if(i||r)return re(e.value);if(e instanceof HTMLInputElement&&E(A,e.type)){var o=void 0;return e.id&&(n=function(t){return t.htmlFor===e.id},o=(t=_(document.getElementsByTagName("label")))[I(t,n)]),o||(o=ce(e,(function(e){return"label"===e.tagName.toLowerCase()}))),fe(e,o?ie(o):re(e.value))}return""},label:function(e){return ie(e)||de(e)||le(e)},select:function(e){return re(_(e.options).filter((function(e){return e.selected})).map((function(e){return e.label})).join(", ")||e.value)},svg:function(e){var t;return Y(e).some((function(e){var n;if(e.nodeType===Node.ELEMENT_NODE&&"use"===(null===(n=e.tagName)||void 0===n?void 0:n.toLowerCase())&&e.hasAttribute("xlink:href"))return t=e,!0})),t?t.getAttribute("xlink:href"):""},textarea:function(){return""},form:function(){return""}},se=function(e,t){if(M(e,K)&&R(e,K))return re(R(e,K));if(M(e,"title")&&R(e,"title"))return re(R(e,"title"));var n=ue[t];if(n)return n(e);var i=ie(e);return i?re(i):function(e){if("svg"===e.tagName)return!1;var t=Y(e);return t.length>0&&t.every((function(e){return function(e){if("svg"===e.tagName)return!0;var t=Y(e);if(T(t))return!0;var n=te(e);return!(!T(t)&&!n)}(e)}))}(e)&&!ee(e)?re(de(e)):ee(e)?re(le(e)):""},ce=function(e,t){for(var n=e.parentElement;n&&!$(n);){if(t(n))return n;n=n.parentElement}},de=function(e){var t=Y(e);return C(t.map((function(e){var t=ie(e);if(te(e)&&t)return t}))).join(" ")},le=function(e){var t;return Y(e).some((function(e){var n,i=se(e,null===(n=e.tagName)||void 0===n?void 0:n.toLowerCase());return!!i&&(t=i,!0)})),t},fe=function(e,t){return E(["checkbox","radio"],e.type)?"".concat(t).concat((n=e.checked,"boolean"===O(n)?"("+e.checked+")":"")):t;var n},ge=function e(t,n,i,r,o){void 0===r&&(r=!0),void 0===o&&(o=[]);var a,u=this;this.originNode=t,this.deviceInfo=n,this.actionType=i,this.trackable=r,this.parentNodes=o,this.isLimitViewport=!0,this._getIndex=function(){if(M(u.originNode,X)){var e=R(u.originNode,X);return/^\d{1,10}$/.test(e)&&e-0>0&&2147483647>e-0?+e:void(0>u.actionType.indexOf("circle")&&(s="".concat(e,"，index标记应为 大于 0 且小于 2147483647 的整数！"),console.log("%c [GrowingIO]：".concat(s),"color: #F59E0B;")))}if(E(["dd","dt"],u.tagName)){var t=q(u.originNode),n=t?Y(t):[];if("dl"===t.tagName.toLowerCase()&&n.length>0){if("dd"===u.tagName){var i=I(n,(function(e){return e.isSameNode(u.originNode)}));if(i>-1)return(r=n.slice(0,i).filter((function(e){return"dt"===e.tagName.toLowerCase()}))).length-1+1}if("dt"===u.tagName){var r=n.filter((function(e){return"dt"===e.tagName.toLowerCase()}));return I(r,(function(e){return e.isSameNode(u.originNode)}))+1}}}if(u.isPureList){var o=I(u._pureList,(function(e){return e.isSameNode(u.originNode)}));return o>-1?(u.peerNodes=w([],u._pureList,!0),u.peerNodes.splice(o,1),o+1):void 0}if(u.isPseudoList){var a=I(u._pseudoList,(function(e){return e.isSameNode(u.originNode)}));return a>-1?(u.peerNodes=w([],u._pseudoList,!0),u.peerNodes.splice(a,1),a+1):void 0}var s},this._getSiblingNode=function(e,t){var n,i=q(e);if(!i)return[];for(var r=null!==(n=m((function(){return _(i.children)})))&&void 0!==n?n:[],o=[],a=0;a<r.length;a++){var u=r[a],s=r[a+1];if(!s||!t(u,s))break;T(o)?o.push(u,s):o.push(s)}return o},this._getIsPureList=function(){var e=u._getSiblingNode(u.originNode,(function(e,t){return e.tagName===t.tagName}));return!(1>e.length||!E(H,u.tagName)||(u._pureList=e,0))},this._getIsInPseudoList=function(){if(E(["th","td"],u.tagName))return!1;var e=u._getSiblingNode(u.originNode,(function(e,t){var n=e.tagName===t.tagName&&e.className===t.className,i=Y(e),r=Y(t),o=i.every((function(e,t){var n,i;return(null==e?void 0:e.tagName)===(null===(n=r[t])||void 0===n?void 0:n.tagName)&&(null==e?void 0:e.className)===(null===(i=r[t])||void 0===i?void 0:i.className)})),a=i.length===r.length&&o;return n&&a}));return e.length>=3&&(u._pseudoList=e,!0)},this._getClassList=function(e){var t;if(M(e,"name")&&R(e,"name"))return[R(e,"name")];var n=(null!==(t=R(e,"class"))&&void 0!==t?t:"").trim().split(" ");return T(n)?[]:n.filter((function(e){return e&&!V.test(e)&&G.test(e)})).sort()},this._getCurrentXpath=function(){return"/".concat(u.tagName).concat(u.id?"#"+u.id:"").concat(T(u.classList)?"":"."+u.classList.join("."))},this._getIsContainer=function(){return M(u.originNode,J)||E(P,u.tagName)||"input"===u.tagName&&E(k,u.originNode.type)},this._getContent=function(){u.content=se(u.originNode,u.tagName)},this._getIsOutFlow=function(){var e=window.getComputedStyle(u.originNode).position;return E(["fixed","sticky"],e)},this._getRect=function(){var e=u.originNode.getBoundingClientRect(),t=e.top,n=e.bottom,i=e.left,r=e.right-i,o=n-t,a=u.deviceInfo,s=a.winHeight,c=a.winWidth;return t+o>s&&(o=s-t),i+r>c&&(r=c-i),{top:t,left:i,width:r,height:o}},this._getListItemViewStatus=function(){var e=u.parentNodes.find((function(e){var t=e.originNode,n=t.scrollHeight,i=t.scrollWidth,r=t.clientHeight,o=t.clientWidth,a=e.rect,u=a.width,s=a.height;return r!==n&&n>s||o!==i&&i>u}));if(e){var t=e.rect,n=t.top,i=t.left,r=t.width,o=t.height,a=u.rect,s=a.top,c=a.left,d=a.width,l=a.height;return n>s+l||c>i+r||s>n+o||i>c+d?"OUTSIDE":s>=n&&c>=i&&n+o>s+l&&i+r>c+d?"DISPLAYED":"OBSCURED"}return""},this._getViewStatus=function(e){var t=window.getComputedStyle(u.originNode),n=t.opacity,i=t.visibility,r=t.display,o=t.width,a=t.height,s=u.rect,c=s.top,d=s.left,l=s.width,f=s.height,g=u.deviceInfo,v=g.winWidth,h=g.winHeight;if(0===Number(n)||"hidden"===i||"none"===r||"0px"===o||0===u.originNode.clientWidth||"0px"===a||0===u.originNode.clientHeight)return"HIDDEN";var p=w([],e,!0).find((function(e){return e.trackable&&E(["DISPLAYED","OBSCURED"],e.viewStatus)}));if(u.isPureList||u.isPseudoList){var N=u._getListItemViewStatus();if(N)return N}if(p)return p.viewStatus;var m=function(e,t){return document.elementFromPoint(e,t)===u.originNode};return h>c&&v>d&&l>0&&f>0?m(d+l/2,c+f/2)||m(d+1,c+1)||m(d+l-1,c+1)||m(d+1,c+f-1)||m(d+l-1,c+f-1)?"DISPLAYED":u.isLimitViewport&&(0>c+f||0>d+l)?"OUTSIDE":"OBSCURED":"OUTSIDE"},this._getTriggerEvent=function(){return"input"===u.tagName&&E(D,u.originNode.type)||E(["select","textarea"],u.tagName)?"VIEW_CHANGE":"VIEW_CLICK"},this._getXParents=function(t,n){var i=t.parentElement,r=[];if(n.length>0)r.push.apply(r,n);else if(i&&!$(i)){var o=new e(i,void 0,u.actionType,F(i,u.actionType));r.push(o),o.xParents&&r.push.apply(r,o.xParents)}return r},this.tagName=t.tagName.toLocaleLowerCase(),this.classList=this._getClassList(t),this.id=t.id,this.currentXpath=this._getCurrentXpath(),this.isIgnored=M(this.originNode,j),this.isContainer=this._getIsContainer(),this.isPureList=this._getIsPureList(),this.isPseudoList=this._getIsInPseudoList(),this.index=this._getIndex(),this.hyperlink=ae(t,this.tagName),this.content=se(this.originNode,this.tagName),this.triggerEvent=this._getTriggerEvent(),this.isOutFlow=this._getIsOutFlow(),n&&(this.isLimitViewport=null===(a=n.isLimitViewport)||void 0===a||a,this.rect=this._getRect(),this.viewStatus=this._getViewStatus(o)),this.xParents=this._getXParents(t,o)},ve=function e(t,n,i,r,o){var a=this;this.origin=t,this.action=n,this.lengthThreshold=i,this.deviceInfo=r,this.parentNode=o,this.trackNodes=function(){var e;if(!a.trackable)return[];var t=[a.xNode];if(E(["click","circleClick","change"],a.actionType))for(var n=a._getParent();n;){if(!(null==n?void 0:n.xNode)||(null===(e=n.xNode)||void 0===e?void 0:e.isIgnored))return[];n.trackable&&t.push(n.xNode),n=n._getParent()}var i,r=[];return t.reverse().forEach((function(e,n){if(M(e.originNode,J)&&(r=[],i=void 0),b(e.index)&&!b(i)&&(i=e.index),b(i)&&(e.index=i),n===t.length-1)r.push(a.getGioNodeInfo(e));else{var o=e.isPureList||e.isPseudoList;(e.isContainer||o)&&r.push(a.getGioNodeInfo(e))}})),r},this.getGioNodeInfo=function(e){var t=a.computeXpath(e),n=t.skeleton,i=t.fullXpath,r=t.xcontent,o=e.hyperlink,u=e.index,s=e.peerNodes,c=e.content,d=e.triggerEvent,l=e.originNode;return{skeleton:n,xpath:n,fullXpath:i,xcontent:r,hyperlink:o,index:u,peerNodes:null!=s?s:[],content:re(c),triggerEvent:d,originNode:l}},this.computeXpath=function(e){var t,n="/"+e.tagName,i=e.currentXpath,r="/"+((e.id?"#"+e.id:"")+(T(e.classList)?"":"."+e.classList.join("."))||"-");return null===(t=e.xParents)||void 0===t||t.forEach((function(e,t){if(i=e.currentXpath+i,t<a.xpathThreshold-1){n="/"+e.tagName+n;var o=(e.id?"#"+e.id:"")+(T(e.classList)?"":"."+e.classList.join("."));r="/"+(o||"-")+r}})),{skeleton:n,fullXpath:i,xcontent:r}},this._getParent=function(){var t=q(a.originElement);if(t&&t.nodeName&&!$(t))return new e(t,a.actionType)},this.actionType=E(["circleClick","circleHover","click","change"],n)?n:"click",this.originElement=z(t),this.xpathThreshold=b(i)?i:4,this.trackable=F(this.originElement,this.actionType),this.originElement.isSameNode(t)||(o=null);var u=[];o&&o.xNode&&(u.push(o.xNode),o.xNode.xParents&&u.push.apply(u,o.xNode.xParents)),this.xNode=new ge(this.originElement,this.deviceInfo,this.actionType,this.trackable,u)},he=[],pe=function(e,t){var n,i,r,o,a,u,s,c=this;this.trackNodes=function(e,t,n){return void 0===n&&(n=!1),he=[],c._getTrackElements(e,t,null,n),he},this._getTrackElements=function(e,t,n,i){void 0===i&&(i=!1),Y(e).forEach((function(e){var r,o,a,u;if(!(null==e?void 0:e.tagName)||E(["circle-shape","circle-page","heatmap-page"],null===(r=null==e?void 0:e.tagName)||void 0===r?void 0:r.toLowerCase())||(null===(o=null==e?void 0:e.id)||void 0===o?void 0:o.indexOf("__vconsole"))>-1||(null===(a=null==e?void 0:e.id)||void 0===a?void 0:a.indexOf("__giokit"))>-1)return!1;var s=new ve(e,"circleClick",c.xpathThreshold,c.deviceInfo,n),d=s.xNode;if(d.zLevel=c._getZLevel(e,t),s.trackable&&(E(["DISPLAYED","OBSCURED"],d.viewStatus)||i)){if(t.index&&(d.index=t.index),he.find((function(e){return e.originNode.isSameNode(d.originNode)})))return!1;if("DISPLAYED"===d.viewStatus){var l=c._getGioHybridNodeInfo(s,t);he.push(l)}else"OBSCURED"===d.viewStatus&&(d.isContainer||i)&&(l=c._getGioHybridNodeInfo(s,t),he.push(l));if(ne(e)||d.isContainer&&te(e))return!1}T(Y(e))||c._getTrackElements(e,null!==(u=s.xNode)&&void 0!==u?u:t,s,i)}))},this._getZLevel=function(e,t){var n=window.getComputedStyle(e),i=n.position,r=n.zIndex;if("auto"!==r){var o=Number(r||0);return(Number.isNaN(o)?0:o)+t.zLevel}switch(i){case"relative":return t.zLevel+2;case"sticky":return t.zLevel+3;case"absolute":return t.zLevel+4;case"fixed":return t.zLevel+5;default:return t.zLevel+1}},this._getGioHybridNodeInfo=function(e,t){var n=e.xNode,i=n.rect,r=n.zLevel,o=e.getGioNodeInfo(n),a=o.hyperlink,u={};return x(i).forEach((function(e){return u[e]=i[e]*c.deviceInfo.scale})),u.top+=c.deviceInfo.webviewTop,u.left+=c.deviceInfo.webviewLeft,p(p(p({},u),o),{zLevel:r+c.deviceInfo.webviewZLevel,href:a,parentXPath:t.trackable?e.computeXpath(t).xpath:void 0})},this.xpathThreshold=t,this.deviceInfo=(i=(n=e).webviewLeft,r=n.webviewTop,o=n.webviewWidth,a=n.webviewHeight,u=n.webviewZLevel,s=n.isLimitViewport,{winWidth:o,winHeight:a,scale:o/window.innerWidth,webviewTop:r,webviewLeft:i,webviewWidth:o,webviewHeight:a,webviewZLevel:u,isLimitViewport:s})},we=function(e){try{return e()}catch(e){return}},Ne=function(e,t,n,i){void 0===i&&(i={}),document.addEventListener?e.addEventListener(t,n,o(o({},{capture:!0}),i)):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},me=["VIEW_CLICK","VIEW_CHANGE","FORM_SUBMIT","PAGE","CUSTOM","LOGIN_USER_ATTRIBUTES"],be=["LOGIN_USER_ATTRIBUTES"],ye=["DOMContentLoaded","onreadystatechange"],Le=["scroll","resize","load","beforeunload","popstate","hashchange","pagehide","unload"],Ie=function(){function e(e){var t,n=this;this.growingIO=e,this.penetrateHybrid=!0,this.onOptionsInit=function(){var e=n.growingIO,t=e.vdsConfig,i=e.emitter;(function(e){return"boolean"===h(e)})(t.penetrateHybrid)&&(n.penetrateHybrid=t.penetrateHybrid),n._initHybridBridge()&&(n.onSendBefore=n.sendBeforeListener,n.hybridConfig.projectId===n.growingIO.vdsConfig.projectId&&(n.growingIO.useHybridInherit=!0)),n.growingIO.useHybridInherit&&(null==i||i.on("SET_USERID",(function(e){var t=e.newUserId,i=e.oldUserId,r=e.userKey;n.penetrateHybrid&&(!t&&i?r?n._clearNativeUserIdAndUserKey():n._clearNativeUserId():r?n._setNativeUserIdAndUserKey(l(t),l(r)):n._setNativeUserId(l(t)))})),null==i||i.on("SET_USERKEY",(function(e){var t=e.newUserKey,i=e.oldUserKey,r=e.userId;n.penetrateHybrid&&(!t&&i?n._clearNativeUserIdAndUserKey():n._setNativeUserIdAndUserKey(l(r),l(t)))})))},this._initHybridBridge=function(){var e,t,i,r=!1;return n.hasHybridBridge=!!window.GrowingWebViewJavascriptBridge,n.hasHybridBridge?((null===(e=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===e?void 0:e.configuration)||(window.GrowingWebViewJavascriptBridge.configuration=JSON.parse(window.GrowingWebViewJavascriptBridge.getConfiguration())),(null===(t=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===t?void 0:t.configuration)&&(n.hybridConfig=null===(i=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===i?void 0:i.configuration),r=!0):N.consoleText("gioHybridAdapter：当前不存在 GrowingWebViewJavascriptBridge，Web模式。","info"),r},this.sendBeforeListener=function(e){var t=e.requestData;if(n.hasHybridBridge){var i=n.processAttributes(o({},t));d(me,i.eventType)&&(d(be,i.eventType)?n.penetrateHybrid&&n._dispatchEvent(i):(n.penetrateHybrid||v(i,["userId","userKey","cs1"]),n._dispatchEvent(i)))}},this.processAttributes=function(e){return g(e,(function(t,n){s(t)||c(t)?g(e[n],(function(t,i){s(t)||c(t)?e[n][i]=JSON.stringify(t):e[n][i]=l(t)})):e[n]=l(t)})),e},this._setNativeUserId=function(e){we((function(){return window.GrowingWebViewJavascriptBridge.setNativeUserId(e)}))},this._clearNativeUserId=function(){we((function(){return window.GrowingWebViewJavascriptBridge.clearNativeUserId()}))},this._setNativeUserIdAndUserKey=function(e,t){we((function(){return window.GrowingWebViewJavascriptBridge.setNativeUserIdAndUserKey(e,t)}))},this._clearNativeUserIdAndUserKey=function(){we((function(){return window.GrowingWebViewJavascriptBridge.clearNativeUserIdAndUserKey()}))},this._dispatchEvent=function(e){we((function(){var t;return null===(t=window.GrowingWebViewJavascriptBridge)||void 0===t?void 0:t.dispatchEvent(JSON.stringify(e))}))},this._getDomTree=function(e,t,i,r,o,a){var u=new pe({webviewLeft:e,webviewTop:t,webviewWidth:i,webviewHeight:r,webviewZLevel:o}).trackNodes(null!=a?a:document.body,{isContainer:!1,zLevel:0}).map((function(e){return v(e,["originNode","peerNodes"]),e})),s=n.growingIO.dataStore.currentPage;return{page:{domain:s.domain,path:s.path,query:s.query,title:s.title},elements:u}};var i=this.growingIO,r=i.emitter,a=i.utils;N=a,r.on("OPTION_INITIALIZED",this.onOptionsInit),null===(t=this.growingIO.emitter)||void 0===t||t.on("SDK_INITIALIZED",(function(){if(window.GrowingWebViewJavascriptBridge){var e=n;window.GrowingWebViewJavascriptBridge.getDomTree=function(){if(arguments.length>=4)return e._getDomTree.apply(this,arguments)},n._addDomChangeListener()}}))}return e.prototype._addDomChangeListener=function(){var e,t=function(t){return void 0===t&&(t=""),function(){var n;"beforeunload"===t&&e&&e.disconnect(),null===(n=window.GrowingWebViewJavascriptBridge)||void 0===n||n.onDomChanged()}};(e=new MutationObserver(t("mutation"))).observe(document.body,{attributes:!0,characterData:!0,childList:!0,subtree:!0}),ye.forEach((function(e){Ne(document,e,t(e))})),Le.forEach((function(e){Ne(window,e,t(e))}))},e}(),Ee={name:"gioHybridAdapter",method:Ie};export{Ee as default};
