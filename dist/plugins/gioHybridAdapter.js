var e,t,n,i,r=function(){return r=Object.assign||function(e){for(var t,n=1,i=arguments.length;i>n;n++)for(var r in t=arguments[n])({}).hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},r.apply(this,arguments)};function o(e){return e&&e.__esModule&&{}.hasOwnProperty.call(e,"default")?e.default:e}var a,u,s,c=i?n:(i=1,n="function"==typeof Array.from?Array.from:(t||(t=1,a=function(e){return"function"==typeof e},u=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),9007199254740991)},s=function(e){var t=e.next();return!t.done&&t},e=function(e){var t,n,i,r=this,o=arguments.length>1?arguments[1]:void 0;if(void 0!==o){if(!a(o))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(t=arguments[2])}var c=function(e,t){if(null!=e&&null!=t){var n=e[t];if(null==n)return;if(!a(n))throw new TypeError(n+" is not a function");return n}}(e,function(e){if(null!=e){if(["string","number","boolean","symbol"].indexOf(typeof e)>-1)return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in e)return Symbol.iterator;if("@@iterator"in e)return"@@iterator"}}(e));if(void 0!==c){n=a(r)?Object(new r):[];var d,l,f=c.call(e);if(null==f)throw new TypeError("Array.from requires an array-like or iterable object");for(i=0;;){if(!(d=s(f)))return n.length=i,n;l=d.value,n[i]=o?o.call(t,l,i):l,i++}}else{var g=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var h,v=u(g.length);for(n=a(r)?Object(new r(v)):Array(v),i=0;v>i;)h=g[i],n[i]=o?o.call(t,h,i):h,i++;n.length=v}return n}),e)),d=function(e){return g(["undefined","null"],N(e))},l=function(e){return"object"===N(e)&&!d(e)},f=function(e){return Array.isArray(e)&&"array"===N(e)},g=function(e,t){return("array"===N(e)||"string"===N(e))&&("array"===N(t)?t.some((function(t){return e.indexOf(t)>=0})):e.indexOf(t)>=0)},h=function(e){return d(e)?"":"".concat(e)},v=function(e){return l(e)?Object.keys(e):[]},p=function(e,t){v(e).forEach((function(n){return t(e[n],n)}))},w=function(e,t){if(!l(e))return!1;try{return"string"===N(t)?delete e[t]:"array"===N(t)?t.map((function(t){return delete e[t]})):(function(e){return"regexp"===N(e)}(t)&&v(e).forEach((function(n){t.test(n)&&w(e,n)})),!0)}catch(e){return!1}},N=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},m=function(){return m=Object.assign||function(e){for(var t,n=1,i=arguments.length;i>n;n++)for(var r in t=arguments[n])({}).hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},m.apply(this,arguments)};function y(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;o>r;r++)!i&&r in t||(i||(i=[].slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||[].slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var b=function(e){try{return e()}catch(e){return}},I=function(e){return"number"===S(e)},L=function(e){return"object"===S(e)&&!function(e){return T(["undefined","null"],S(e))}(e)},E=function(e){return Array.isArray(e)&&"array"===S(e)},_=function(e,t){if(E(e))for(var n=0;n<e.length;n++)if(t(e[n]))return n;return-1},T=function(e,t){return("array"===S(e)||"string"===S(e))&&e.indexOf(t)>=0},x=o(c),O=function(e){return L(e)?Object.keys(e):[]},C=function(e){return E(e)?0===e.length:L(e)?0===O(e).length:!e},k=function(e){if(E(e)){for(var t=0,n=[],i=0,r=e;i<r.length;i++){var o=r[i];o&&!C(o)&&(n[t++]=o)}return n}return e},S=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},H=["body","br","canvas","clippath","defs","desc","g","hr","html","iframe","math","param","path","rect","script","style","text","title","tspan","use"],U=["button","reset","submit"],D=y(y([],U,!0),["file"],!1),A=["checkbox","color","radio","range"],P=y(y([],A,!0),["date","datetime-local","month","number","password","text","time","week"],!1),B=["tr","li","dt","dd"],V=y(["a","button","dl"],B,!0),G=["i","em","svg","img"],W=["i","span","em","b","strong","bdo"],j=/(^| |[^ ]+\-)(clear|clearfix|active|hover|enabled|current|selected|unselected|hidden|display|focus|disabled|undisabled|open|checked|unchecked|undefined|null|ng-|growing-)[^\. ]*/g,M=/^([a-zA-Z\-\_0-9]+)$/,X="data-growing-ignore",J="data-growing-container",K="data-growing-index",R="data-growing-title",z=function(e,t){var n;return null!==(n=b((function(){return e.hasAttribute(t)&&"false"!==e.getAttribute(t)})))&&void 0!==n?n:b((function(){return e.hasOwnPerporty(t)}))},F=function(e,t){var n;return null!==(n=b((function(){return e.getAttribute(t)})))&&void 0!==n?n:b((function(){return e.attributes[t].value}))},Z=function(e){var t,n=!T(H,e.tagName.toLowerCase()),i=Q(e);if(n){if(i&&T(W,null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())&&x(e.childNodes).filter((function(e){return e.nodeType!==Node.COMMENT_NODE})).every((function(e){return e.nodeType===Node.TEXT_NODE}))){var r=Z(i);return[E(r)?r[0]:r,!0]}return[e,!1]}return[e,!1]},Y=function(e,t,n){if(void 0===n&&(n=0),!e.children)return!1;if("svg"===e.tagName.toLocaleLowerCase())return n>t;if(n>t)return!0;for(var i=0;i<e.children.length;i++){var r=e.children[i];if(Y(r,t,n+1))return!0}return!1},q=function(e,t){var n=e.tagName.toLowerCase();if(!(e instanceof HTMLElement||e instanceof Element))return!1;if(z(e,X))return!1;if(T(H,n))return!1;if(T(["circleClick","circleHover","click"],t)){if("textarea"===n&&"click"===t)return!1;if("input"===n){if("click"===t&&!T(D,F(e,"type")))return!1;if(T(["circleClick","circleHover"],t)&&!T(y(y([],D,!0),P,!0),F(e,"type")))return!1}if(!te(e)&&Y(e,5))return!1}return!0},$=function(e,t){return void 0===t&&(t=!1),x((null==e?void 0:e.childNodes)||[]).filter((function(e){return T(t?[Node.ELEMENT_NODE,Node.TEXT_NODE]:[Node.ELEMENT_NODE],e.nodeType)}))},Q=function(e){return ee(e.parentElement)?null:e.parentElement},ee=function(e){return!e||T(["BODY","HTML","#document"],e.tagName)},te=function(e){return z(e,J)||T(V,e.tagName.toLowerCase())||"input"===e.tagName.toLowerCase()&&T(U,e.type)},ne=function(e){var t=$(e);return!C(t)&&t.every((function(e){var t=re(e),n=T(e.classList,"icon");return!(!t&&!n||ie(e))}))},ie=function(e){var t=$(e,!0);return!C(t)&&t.every((function(e){var t=e.nodeType===Node.TEXT_NODE,n=oe(e);return!(!t||!n)}))},re=function(e){return T(G,e.tagName.toLocaleLowerCase())},oe=function(e){var t=$(e,!0).filter((function(e){var t;return e.nodeType===Node.TEXT_NODE||T(W,null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())})).map((function(e){return ae(e.textContent,e.textContent.length)}));return ae(k(t).join(" "))},ae=function(e,t){return void 0===t&&(t=50),e&&(null==(e=e.replace(/[\n \t]+/g," ").trim())?void 0:e.length)?e.slice(0,I(t)&&t>0?t:void 0):""},ue=/[^/]*\.(bmp|jpg|jpeg|png|gif|svg|psd|webp|apng)/gi,se=function(e,t){switch(t){case"a":return function(e){if(z(e,"href")){var t=F(e,"href");if(t&&0!==t.indexOf("javascript"))return[t.slice(0,320),t]}return["",""]}(e);case"img":return function(e){var t=e.src;if(t&&-1===t.indexOf("data:image")){var n=t.match(ue),i=C(n)?"":n[0];if(i.indexOf("%")>-1){var r=function(e){var t=-1;if(E(e))for(var n=0;n<e.length;n++)"%"===e[n]&&(t=n);return t}(i.split(""));i=i.substring(r+3,i.length)}return[t.slice(0,320),i]}return["",""]}(e);default:return["",""]}},ce={a:function(e){return oe(e)||fe(e)||se(e,"a")[0]},button:function(e){return F(e,"name")||oe(e)||fe(e)||ge(e)},img:function(e){return ae(F(e,"alt"))||se(e,"img")[1]},input:function(e){if("password"===e.type)return"";var t,n,i=e instanceof HTMLInputElement&&T(D,e.type),r=z(e,"data-growing-track");if(i||r)return ae(e.value);if(e instanceof HTMLInputElement&&T(A,e.type)){var o=void 0;return e.id&&(n=function(t){return t.htmlFor===e.id},o=(t=x(document.getElementsByTagName("label")))[_(t,n)]),o||(o=le(e,(function(e){return"label"===e.tagName.toLowerCase()}))),he(e,o?oe(o):ae(e.value))}return""},label:function(e){return oe(e)||fe(e)||ge(e)},select:function(e){return ae(x(e.options).filter((function(e){return e.selected})).map((function(e){return e.label})).join(", ")||e.value)},svg:function(e){var t;return $(e).some((function(e){var n;if(e.nodeType===Node.ELEMENT_NODE&&"use"===(null===(n=e.tagName)||void 0===n?void 0:n.toLowerCase())&&e.hasAttribute("xlink:href"))return t=e,!0})),t?t.getAttribute("xlink:href"):""},textarea:function(){return""},form:function(){return""}},de=function(e,t){if(z(e,R)&&F(e,R))return ae(F(e,R));if(z(e,"title")&&F(e,"title"))return ae(F(e,"title"));var n=ce[t];if(n)return n(e);var i=oe(e);return i?ae(i):function(e){if("svg"===e.tagName)return!1;var t=$(e);return t.length>0&&t.every((function(e){return function(e){if("svg"===e.tagName)return!0;var t=$(e);if(C(t))return!0;var n=ie(e);return!(!C(t)&&!n)}(e)}))}(e)&&!ne(e)?ae(fe(e)):ne(e)?ae(ge(e)):""},le=function(e,t){for(var n=e.parentElement;n&&!ee(n);){if(t(n))return n;n=n.parentElement}},fe=function(e){var t=$(e);return k(t.map((function(e){var t=oe(e);if(ie(e)&&t)return t}))).join(" ")},ge=function(e){var t;return $(e).some((function(e){var n,i=de(e,null===(n=e.tagName)||void 0===n?void 0:n.toLowerCase());return!!i&&(t=i,!0)})),t},he=function(e,t){return T(["checkbox","radio"],e.type)?"".concat(t).concat((n=e.checked,"boolean"===S(n)?"("+e.checked+")":"")):t;var n},ve=function e(t,n,i,r,o){void 0===r&&(r=!0),void 0===o&&(o=[]);var a,u=this;this.originNode=t,this.deviceInfo=n,this.actionType=i,this.isTrackable=r,this.parentNodes=o,this.isLimitViewport=!0,this._getIndex=function(){if(z(u.originNode,K)){var e=F(u.originNode,K);return/^\d{1,10}$/.test(e)&&e-0>0&&2147483647>e-0?+e:void(0>u.actionType.indexOf("circle")&&(s="".concat(e,"，index标记应为 大于 0 且小于 2147483647 的整数！"),console.log("%c [GrowingIO]：".concat(s),"color: #F59E0B;")))}if(T(["dd","dt"],u.tagName)){var t=Q(u.originNode),n=t?$(t):[];if("dl"===t.tagName.toLowerCase()&&n.length>0){if("dd"===u.tagName){var i=_(n,(function(e){return e.isSameNode(u.originNode)}));if(i>-1)return(r=n.slice(0,i).filter((function(e){return"dt"===e.tagName.toLowerCase()}))).length-1+1}if("dt"===u.tagName){var r=n.filter((function(e){return"dt"===e.tagName.toLowerCase()}));return _(r,(function(e){return e.isSameNode(u.originNode)}))+1}}}if(u.isPureList){var o=_(u._pureList,(function(e){return e.isSameNode(u.originNode)}));return o>-1?(u.peerNodes=y([],u._pureList,!0),u.peerNodes.splice(o,1),o+1):void 0}if(u.isPseudoList){var a=_(u._pseudoList,(function(e){return e.isSameNode(u.originNode)}));return a>-1?(u.peerNodes=y([],u._pseudoList,!0),u.peerNodes.splice(a,1),a+1):void 0}var s},this._getSiblingNode=function(e,t){var n,i=Q(e);if(!i)return[];for(var r=null!==(n=b((function(){return x(i.children)})))&&void 0!==n?n:[],o=[],a=0;a<r.length;a++){var u=r[a],s=r[a+1];if(!s||!t(u,s))break;C(o)?o.push(u,s):o.push(s)}return o},this._getIsPureList=function(){var e=u._getSiblingNode(u.originNode,(function(e,t){return e.tagName===t.tagName}));return!(1>e.length||!T(B,u.tagName)||(u._pureList=e,0))},this._getIsInPseudoList=function(){if(T(["th","td"],u.tagName))return!1;var e=u._getSiblingNode(u.originNode,(function(e,t){var n=e.tagName===t.tagName&&e.className===t.className,i=$(e),r=$(t),o=i.every((function(e,t){var n,i;return(null==e?void 0:e.tagName)===(null===(n=r[t])||void 0===n?void 0:n.tagName)&&(null==e?void 0:e.className)===(null===(i=r[t])||void 0===i?void 0:i.className)})),a=i.length===r.length&&o;return n&&a}));return e.length>=3&&(u._pseudoList=e,!0)},this._getClassList=function(e){var t;if(z(e,"name")&&F(e,"name"))return[F(e,"name")];var n=(null!==(t=F(e,"class"))&&void 0!==t?t:"").trim().split(" ");return C(n)?[]:n.filter((function(e){return e&&!j.test(e)&&M.test(e)})).sort()},this._getCurrentXpath=function(){return"/".concat(u.tagName).concat(u.id?"#"+u.id:"").concat(C(u.classList)?"":"."+u.classList.join("."))},this._getIsContainer=function(){return z(u.originNode,J)||T(V,u.tagName)||"input"===u.tagName&&T(U,u.originNode.type)},this._getContent=function(){u.content=de(u.originNode,u.tagName)},this._getIsOutFlow=function(){var e=window.getComputedStyle(u.originNode).position;return T(["fixed","sticky"],e)},this._getRect=function(){var e=u.originNode.getBoundingClientRect(),t=e.top,n=e.bottom,i=e.left,r=e.right-i,o=n-t,a=u.deviceInfo,s=a.winHeight,c=a.winWidth;return t+o>s&&(o=s-t),i+r>c&&(r=c-i),{top:t,left:i,width:r,height:o}},this._getListItemViewStatus=function(){var e=u.parentNodes.find((function(e){var t=e.originNode,n=t.scrollHeight,i=t.scrollWidth,r=t.clientHeight,o=t.clientWidth,a=e.rect,u=a.width,s=a.height;return r!==n&&n>s||o!==i&&i>u}));if(e){var t=e.rect,n=t.top,i=t.left,r=t.width,o=t.height,a=u.rect,s=a.top,c=a.left,d=a.width,l=a.height;return n>s+l||c>i+r||s>n+o||i>c+d?"OUTSIDE":s>=n&&c>=i&&n+o>s+l&&i+r>c+d?"DISPLAYED":"OBSCURED"}return""},this._getViewStatus=function(e){var t=window.getComputedStyle(u.originNode),n=t.opacity,i=t.visibility,r=t.display,o=t.width,a=t.height,s=u.rect,c=s.top,d=s.left,l=s.width,f=s.height,g=u.deviceInfo,h=g.winWidth,v=g.winHeight;if(0===Number(n)||"hidden"===i||"none"===r||"0px"===o||0===u.originNode.offsetWidth||"0px"===a||0===u.originNode.offsetHeight)return"HIDDEN";var p=y([],e,!0).find((function(e){return e.isTrackable&&"DISPLAYED"===e.viewStatus}));if(p)return p.viewStatus;if(u.isPureList||u.isPseudoList){var w=u._getListItemViewStatus();if(w)return w}var N=function(e,t){return document.elementFromPoint(e,t)===u.originNode};return v>c&&h>d&&l>0&&f>0?N(d+l/2,c+f/2)||N(d+1,c+1)||N(d+l-1,c+1)||N(d+1,c+f-1)||N(d+l-1,c+f-1)?"DISPLAYED":u.isLimitViewport&&(0>c+f||0>d+l)?"OUTSIDE":"OBSCURED":"OUTSIDE"},this._getTriggerEvent=function(){return"input"===u.tagName&&T(P,u.originNode.type)||T(["select","textarea"],u.tagName)?"VIEW_CHANGE":"VIEW_CLICK"},this._getXParents=function(t,n){var i=t.parentElement,r=[];if(n.length>0)r.push.apply(r,n);else if(i&&!ee(i)){var o=new e(i,void 0,u.actionType,q(i,u.actionType));r.push(o),o.xParents&&r.push.apply(r,o.xParents)}return r},this.tagName=t.tagName.toLocaleLowerCase(),this.classList=this._getClassList(t),this.id=t.id,this.currentXpath=this._getCurrentXpath(),this.isIgnored=z(this.originNode,X),this.isContainer=this._getIsContainer(),this.isPureList=this._getIsPureList(),this.isPseudoList=this._getIsInPseudoList(),this.index=this._getIndex(),this.hyperlink=se(t,this.tagName)[0],this.content=de(this.originNode,this.tagName),this.triggerEvent=this._getTriggerEvent(),this.isOutFlow=this._getIsOutFlow(),n&&(this.isLimitViewport=null===(a=n.isLimitViewport)||void 0===a||a,this.rect=this._getRect(),this.viewStatus=this._getViewStatus(o)),this.xParents=this._getXParents(t,o)},pe=function e(t,n,i,r,o){var a=this;this.origin=t,this.action=n,this.lengthThreshold=i,this.deviceInfo=r,this.parentNode=o,this.trackNodes=function(){var e;if(!a.isTrackable)return[];var t=[a.xNode];if(T(["click","circleClick","change"],a.actionType))for(var n=a._getParent();n;){if(!(null==n?void 0:n.xNode)||(null===(e=n.xNode)||void 0===e?void 0:e.isIgnored))return[];n.isTrackable&&t.push(n.xNode),n=n._getParent()}var i,r=[];return t.reverse().forEach((function(e,n){if(z(e.originNode,J)&&(r=[],i=void 0),I(e.index)&&!I(i)&&(i=e.index),I(i)&&(e.index=i),n===t.length-1)r.push(a.getGioNodeInfo(e));else{var o=e.isPureList||e.isPseudoList;(e.isContainer||o)&&r.push(a.getGioNodeInfo(e))}})),r},this.getGioNodeInfo=function(e){var t=a.computeXpath(e),n=t.skeleton,i=t.fullXpath,r=t.xcontent,o=e.hyperlink,u=e.index,s=e.peerNodes,c=e.content,d=e.triggerEvent,l=e.originNode;return{skeleton:n,xpath:n,fullXpath:i,xcontent:r,hyperlink:o,index:u,peerNodes:null!=s?s:[],content:ae(c),triggerEvent:d,originNode:l}},this.computeXpath=function(e){var t,n="/"+e.tagName,i=e.currentXpath,r="/"+((e.id?"#"+e.id:"")+(C(e.classList)?"":"."+e.classList.join("."))||"-");return null===(t=e.xParents)||void 0===t||t.forEach((function(e,t){if(i=e.currentXpath+i,t<a.xpathThreshold-1){n="/"+e.tagName+n;var o=(e.id?"#"+e.id:"")+(C(e.classList)?"":"."+e.classList.join("."));r="/"+(o||"-")+r}})),{skeleton:n,fullXpath:i,xcontent:r}},this._getParent=function(){var t=Q(a.originElement);if(t&&t.nodeName&&!ee(t))return new e(t,a.actionType)},this.actionType=T(["circleClick","circleHover","click","change"],n)?n:"click";var u=Z(t),s=u[0],c=u[1];this.originElement=s,this.isUpgrade=c,this.xpathThreshold=I(i)?i:4,this.isTrackable=q(this.originElement,this.actionType),this.originElement.isSameNode(t)||(o=null);var d=[];o&&o.xNode&&(d.push(o.xNode),o.xNode.xParents&&d.push.apply(d,o.xNode.xParents)),this.xNode=new ve(this.originElement,this.deviceInfo,this.actionType,this.isTrackable,d)},we=[],Ne=function(e,t){var n,i,r,o,a,u,s,c=this;this.trackNodes=function(e,t,n){return void 0===n&&(n=!1),we=[],c._getTrackElements(e,t,null,n),we},this._getTrackElements=function(e,t,n,i){void 0===i&&(i=!1),$(e).forEach((function(e){var r,o,a,u;if(!(null==e?void 0:e.tagName)||T(["circle-shape","circle-page","heatmap-page"],null===(r=null==e?void 0:e.tagName)||void 0===r?void 0:r.toLowerCase())||(null===(o=null==e?void 0:e.id)||void 0===o?void 0:o.indexOf("__vconsole"))>-1||(null===(a=null==e?void 0:e.id)||void 0===a?void 0:a.indexOf("__giokit"))>-1)return!1;var s=new pe(e,"circleClick",c.xpathThreshold,c.deviceInfo,n),d=s.xNode;if(d.zLevel=c._getZLevel(e,t),console.log(s,"-----\x3ecgNode"),s.isTrackable&&(T(["DISPLAYED","OBSCURED"],d.viewStatus)||i)){if(t.index&&(d.index=t.index),we.find((function(e){return e.originNode.isSameNode(d.originNode)})))return!1;if("DISPLAYED"===d.viewStatus){var l=c._getGioHybridNodeInfo(s,t);we.push(l)}else"OBSCURED"===d.viewStatus&&(d.isContainer||i)&&(l=c._getGioHybridNodeInfo(s,t),we.push(l));if(re(e)||d.isContainer&&ie(e))return!1}C($(e))||c._getTrackElements(e,null!==(u=s.xNode)&&void 0!==u?u:t,s,i)}))},this._getZLevel=function(e,t){var n=window.getComputedStyle(e),i=n.position,r=n.zIndex;if("auto"!==r){var o=Number(r||0);return(Number.isNaN(o)?0:o)+t.zLevel}switch(i){case"relative":return t.zLevel+2;case"sticky":return t.zLevel+3;case"absolute":return t.zLevel+4;case"fixed":return t.zLevel+5;default:return t.zLevel+1}},this._getGioHybridNodeInfo=function(e,t){var n=e.xNode,i=n.rect,r=n.zLevel,o=e.getGioNodeInfo(n),a=o.hyperlink,u={};return O(i).forEach((function(e){return u[e]=i[e]*c.deviceInfo.scale})),u.top+=c.deviceInfo.webviewTop,u.left+=c.deviceInfo.webviewLeft,m(m(m({},u),o),{zLevel:r+c.deviceInfo.webviewZLevel,href:a,parentXPath:t.isTrackable?e.computeXpath(t).xpath:void 0})},this.xpathThreshold=t,this.deviceInfo=(i=(n=e).webviewLeft,r=n.webviewTop,o=n.webviewWidth,a=n.webviewHeight,u=n.webviewZLevel,s=n.isLimitViewport,{winWidth:o,winHeight:a,scale:o/window.innerWidth,webviewTop:r,webviewLeft:i,webviewWidth:o,webviewHeight:a,webviewZLevel:u,isLimitViewport:s})},me=function(e){for(var t=[],n=1;arguments.length>n;n++)t[n-1]=arguments[n];try{return e.apply(void 0,t)}catch(e){return}},ye=function(e,t,n,i){void 0===i&&(i={}),document.addEventListener?e.addEventListener(t,n,r(r({},{capture:!0}),i)):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},be=["VIEW_CLICK","VIEW_CHANGE","PAGE","CUSTOM","LOGIN_USER_ATTRIBUTES"],Ie=["LOGIN_USER_ATTRIBUTES"],Le=["DOMContentLoaded","onreadystatechange"],Ee=["scroll","resize","load","beforeunload","popstate","hashchange","pagehide","unload"],_e=function(){function e(e){var t=this;this.growingIO=e,this.penetrateHybrid=!0,this.onOptionsInit=function(e,n){var i,r=t.growingIO,o=r.emitter,a=r.plugins;if(function(e){return"boolean"===N(e)}(n.penetrateHybrid)&&(t.penetrateHybrid=n.penetrateHybrid),t._initHybridBridge()&&(t.onSendBefore=t.sendBeforeListener,!t.growingIO.useHybridInherit)){var u=null!==(i=t.hybridConfig.packageName)&&void 0!==i?i:t.hybridConfig.appPackage;a.gioMultipleInstances||n.packageName?t.hybridConfig.projectId===n.projectId&&u===n.packageName&&(t.growingIO.useHybridInherit=e,t.growingIO.dataStore.updateVdsConfig(e,{hybridLink:!0})):t.hybridConfig.projectId===n.projectId&&(t.growingIO.useHybridInherit=e,t.growingIO.dataStore.updateVdsConfig(e,{hybridLink:!0}))}t.growingIO.useHybridInherit&&(null==o||o.on("SET_USERID",(function(e){var n=e.newUserId,i=e.oldUserId,r=e.userKey;e.trackingId===t.growingIO.useHybridInherit&&t.penetrateHybrid&&(!n&&i?r?t._clearNativeUserIdAndUserKey():t._clearNativeUserId():r?t._setNativeUserIdAndUserKey(h(n),h(r)):t._setNativeUserId(h(n)))})),null==o||o.on("SET_USERKEY",(function(e){var n=e.newUserKey,i=e.oldUserKey,r=e.userId;e.trackingId===t.growingIO.useHybridInherit&&t.penetrateHybrid&&(!n&&i?t._clearNativeUserIdAndUserKey():t._setNativeUserIdAndUserKey(h(r),h(n)))})))},this._initHybridBridge=function(){var e,n,i;if(t.hasHybridBridge=!!window.GrowingWebViewJavascriptBridge,t.hasHybridBridge)try{(null===(e=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===e?void 0:e.configuration)||(window.GrowingWebViewJavascriptBridge.configuration=JSON.parse(window.GrowingWebViewJavascriptBridge.getConfiguration())),(null===(n=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===n?void 0:n.configuration)&&(t.hybridConfig=null===(i=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===i?void 0:i.configuration);var r=t;return window.GrowingWebViewJavascriptBridge.getDomTree=function(){for(var e=[],t=0;arguments.length>t;t++)e[t]=arguments[t];if(e.length>=4)return r._getDomTree.apply(this,e)},!0}catch(e){return"error",console.log("%c [GrowingIO]：".concat(e),"color: #EF4444;"),!1}return!1},this.sendBeforeListener=function(e){var n=e.requestData,i=e.trackingId;if(t.hasHybridBridge){var o=function(){var e=t.processAttributes(r({},n));g(be,e.eventType)&&(g(Ie,e.eventType)?t.penetrateHybrid&&t._dispatchEvent(e):(t.penetrateHybrid||w(e,["userId","userKey","cs1"]),t._dispatchEvent(e)))};t.growingIO.useHybridInherit?i===t.growingIO.useHybridInherit&&o():i!==t.growingIO.trackingId||t.growingIO.plugins.gioMultipleInstances||o()}},this.processAttributes=function(e){return p(e,(function(t,n){l(t)||f(t)?p(e[n],(function(t,i){l(t)||f(t)?e[n][i]=JSON.stringify(t):e[n][i]=h(t)})):e[n]=h(t)})),e},this._setNativeUserId=function(e){me((function(){return window.GrowingWebViewJavascriptBridge.setNativeUserId(e)}))},this._clearNativeUserId=function(){me((function(){return window.GrowingWebViewJavascriptBridge.clearNativeUserId()}))},this._setNativeUserIdAndUserKey=function(e,t){me((function(){return window.GrowingWebViewJavascriptBridge.setNativeUserIdAndUserKey(e,t)}))},this._clearNativeUserIdAndUserKey=function(){me((function(){return window.GrowingWebViewJavascriptBridge.clearNativeUserIdAndUserKey()}))},this._dispatchEvent=function(e){me((function(){var t;return null===(t=window.GrowingWebViewJavascriptBridge)||void 0===t?void 0:t.dispatchEvent(JSON.stringify(e))}))},this._getDomTree=function(e,n,i,r,o,a){var u=new Ne({webviewLeft:e,webviewTop:n,webviewWidth:i,webviewHeight:r,webviewZLevel:o}).trackNodes(null!=a?a:document.body,[],!1).map((function(e){return w(e,["originNode","peerNodes"]),e})),s=t.growingIO.dataStore.currentPage;return{page:{domain:s.domain,path:s.path,query:s.query,title:s.title},elements:u}},this.pluginVersion="4.3.1",this.growingIO.emitter.on("OPTION_INITIALIZED",(function(e){var n=e.trackingId,i=e.vdsConfig;t.onOptionsInit(n,i),t.growingIO.useHybridInherit&&window.GrowingWebViewJavascriptBridge&&t._addDomChangeListener()}))}return e.prototype._addDomChangeListener=function(){var e,t=function(t){return void 0===t&&(t=""),function(){var n;"beforeunload"===t&&e&&e.disconnect(),null===(n=window.GrowingWebViewJavascriptBridge)||void 0===n||n.onDomChanged()}};(e=new MutationObserver(t("mutation"))).observe(document.body,{attributes:!0,characterData:!0,childList:!0,subtree:!0}),Le.forEach((function(e){ye(document,e,t(e))})),Ee.forEach((function(e){ye(window,e,t(e))}))},e}(),Te={name:"gioHybridAdapter",method:_e};export{Te as default};
