!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e,t,i,n,r,o=function(){return o=Object.assign||function(e){for(var t,i=1,n=arguments.length;n>i;i++)for(var r in t=arguments[i])({}).hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)},a="function"==typeof Array.from?Array.from:(t||(t=1,i=function(e){return"function"==typeof e},n=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),9007199254740991)},r=function(e){var t=e.next();return!t.done&&t},e=function(e){var t,o,a,u=this,s=arguments.length>1?arguments[1]:void 0;if(void 0!==s){if(!i(s))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(t=arguments[2])}var c=function(e,t){if(null!=e&&null!=t){var n=e[t];if(null==n)return;if(!i(n))throw new TypeError(n+" is not a function");return n}}(e,function(e){if(null!=e){if(["string","number","boolean","symbol"].indexOf(typeof e)>-1)return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in e)return Symbol.iterator;if("@@iterator"in e)return"@@iterator"}}(e));if(void 0!==c){o=i(u)?Object(new u):[];var d,l,f=c.call(e);if(null==f)throw new TypeError("Array.from requires an array-like or iterable object");for(a=0;;){if(!(d=r(f)))return o.length=a,o;l=d.value,o[a]=s?s.call(t,l,a):l,a++}}else{var g=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var v,h=n(g.length);for(o=i(u)?Object(new u(h)):Array(h),a=0;h>a;)v=g[a],o[a]=s?s.call(t,v,a):v,a++;o.length=h}return o}),e),u=function(e){return d(["undefined","null"],h(e))},s=function(e){return"object"===h(e)&&!u(e)},c=function(e){return Array.isArray(e)&&"array"===h(e)},d=function(e,t){return("array"===h(e)||"string"===h(e))&&e.indexOf(t)>=0},l=function(e){return u(e)?"":"".concat(e)},f=function(e){return s(e)?Object.keys(e):[]},g=function(e,t){f(e).forEach((function(i){return t(e[i],i)}))},v=function(e,t){if(!s(e))return!1;try{return"string"===h(t)?delete e[t]:"array"===h(t)?t.map((function(t){return delete e[t]})):(function(e){return"regexp"===h(e)}(t)&&f(e).forEach((function(i){t.test(i)&&v(e,i)})),!0)}catch(e){return!1}},h=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},p=function(){return p=Object.assign||function(e){for(var t,i=1,n=arguments.length;n>i;i++)for(var r in t=arguments[i])({}).hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},p.apply(this,arguments)};function w(e,t,i){if(i||2===arguments.length)for(var n,r=0,o=t.length;o>r;r++)!n&&r in t||(n||(n=[].slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||[].slice.call(t))}var m,N=function(e){try{return e()}catch(e){return}},b=function(e){return"number"===C(e)},y=function(e){return"object"===C(e)&&!function(e){return E(["undefined","null"],C(e))}(e)},I=function(e){return Array.isArray(e)&&"array"===C(e)},L=function(e,t){if(I(e))for(var i=0;i<e.length;i++)if(t(e[i]))return i;return-1},E=function(e,t){return("array"===C(e)||"string"===C(e))&&e.indexOf(t)>=0},_=a,x=function(e){return y(e)?Object.keys(e):[]},O=function(e){return I(e)?0===e.length:y(e)?0===x(e).length:!e},T=function(e){if(I(e)){for(var t=0,i=[],n=0,r=e;n<r.length;n++){var o=r[n];o&&!O(o)&&(i[t++]=o)}return i}return e},C=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},k=["body","br","canvas","clippath","defs","desc","g","hr","html","iframe","math","param","path","rect","script","style","text","title","tspan","use"],S=["button","reset","submit"],H=w(w([],S,!0),["file"],!1),U=["checkbox","color","radio","range"],A=w(w([],U,!0),["date","datetime-local","month","number","password","text","time","week"],!1),D=["tr","li","dt","dd"],P=w(["a","button","dl"],D,!0),B=["i","em","svg","img"],W=["i","span","em","b","strong","bdo"],V=/(^| |[^ ]+\-)(clear|clearfix|active|hover|enabled|current|selected|unselected|hidden|display|focus|disabled|undisabled|open|checked|unchecked|undefined|null|ng-|growing-)[^\. ]*/g,G=/^([a-zA-Z\-\_0-9]+)$/,j="data-growing-ignore",J="data-growing-container",X="data-growing-index",M="data-growing-title",K=function(e,t){var i;return null!==(i=N((function(){return e.hasAttribute(t)&&"false"!==e.getAttribute(t)})))&&void 0!==i?i:N((function(){return e.hasOwnPerporty(t)}))},R=function(e,t){var i;return null!==(i=N((function(){return e.getAttribute(t)})))&&void 0!==i?i:N((function(){return e.attributes[t].value}))},z=function(e){var t,i=!E(k,e.tagName.toLowerCase()),n=q(e);return i&&n&&E(W,null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())?z(n):e},Z=function(e,t,i){if(void 0===t&&(t=5),void 0===i&&(i=0),!e.children)return!1;if("svg"===e.tagName.toLocaleLowerCase())return i>t;if(i>t)return!0;for(var n=0;n<e.children.length;n++){var r=e.children[n];if(Z(r,t,i+1))return!0}return!1},F=function(e,t){var i=e.tagName.toLowerCase();if(!(e instanceof HTMLElement||e instanceof Element))return!1;if(K(e,j))return!1;if(E(k,i))return!1;if(E(["circleClick","circleHover","click"],t)){if("textarea"===i&&"click"===t)return!1;if("input"===i){if("click"===t&&!E(H,R(e,"type")))return!1;if(E(["circleClick","circleHover"],t)&&!E(w(w([],H,!0),A,!0),R(e,"type")))return!1}if(!Q(e)&&Z(e,5))return!1}return!0},Y=function(e,t){return void 0===t&&(t=!1),_((null==e?void 0:e.childNodes)||[]).filter((function(e){return E(t?[Node.ELEMENT_NODE,Node.TEXT_NODE]:[Node.ELEMENT_NODE],e.nodeType)}))},q=function(e){return $(e.parentElement)?null:e.parentElement},$=function(e){return!e||E(["BODY","HTML","#document"],e.tagName)},Q=function(e){return K(e,J)||E(P,e.tagName.toLowerCase())||"input"===e.tagName.toLowerCase()&&E(S,e.type)},ee=function(e){var t=Y(e);return!O(t)&&t.every((function(e){var t=ie(e),i=E(e.classList,"icon");return!(!t&&!i||te(e))}))},te=function(e){var t=Y(e,!0);return!O(t)&&t.every((function(e){var t=e.nodeType===Node.TEXT_NODE,i=ne(e);return!(!t||!i)}))},ie=function(e){return E(B,e.tagName.toLocaleLowerCase())},ne=function(e){var t=Y(e,!0).filter((function(e){var t;return e.nodeType===Node.TEXT_NODE||E(W,null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())})).map((function(e){return re(e.textContent,e.textContent.length)}));return re(T(t).join(" "))},re=function(e,t){return void 0===t&&(t=50),e&&(null==(e=e.replace(/[\n \t]+/g," ").trim())?void 0:e.length)?e.slice(0,b(t)&&t>0?t:void 0):""},oe=/[^/]*.(bmp|jpg|jpeg|png|gif|svg|psd|webp|apng)/gi,ae=function(e,t){switch(t){case"a":return function(e){if(K(e,"href")){var t=R(e,"href");if(t&&0!==t.indexOf("javascript"))return t.slice(0,320)}return""}(e);case"img":return function(e){var t=e.src;if(t&&-1===t.indexOf("data:image")){var i=t.match(oe),n=O(i)?"":i[0];if(n.indexOf("%")>-1){var r=function(e,t){var i=-1;if(I(e))for(var n=0;n<e.length;n++)"%"===e[n]&&(i=n);return i}(n.split(""));n=n.substring(r+3,n.length)}return n}return""}(e);default:return""}},ue={a:function(e){return ne(e)||de(e)||ae(e,"a")},button:function(e){return R(e,"name")||ne(e)||de(e)||le(e)},img:function(e){return re(R(e,"alt"))||ae(e,"img")},input:function(e){if("password"===e.type)return"";var t,i,n=e instanceof HTMLInputElement&&E(H,e.type),r=K(e,"data-growing-track");if(n||r)return re(e.value);if(e instanceof HTMLInputElement&&E(U,e.type)){var o=void 0;return e.id&&(i=function(t){return t.htmlFor===e.id},o=(t=_(document.getElementsByTagName("label")))[L(t,i)]),o||(o=ce(e,(function(e){return"label"===e.tagName.toLowerCase()}))),fe(e,o?ne(o):re(e.value))}return""},label:function(e){return ne(e)||de(e)||le(e)},select:function(e){return re(_(e.options).filter((function(e){return e.selected})).map((function(e){return e.label})).join(", ")||e.value)},svg:function(e){var t;return Y(e).some((function(e){var i;if(e.nodeType===Node.ELEMENT_NODE&&"use"===(null===(i=e.tagName)||void 0===i?void 0:i.toLowerCase())&&e.hasAttribute("xlink:href"))return t=e,!0})),t?t.getAttribute("xlink:href"):""},textarea:function(){return""},form:function(){return""}},se=function(e,t){if(K(e,M)&&R(e,M))return re(R(e,M));if(K(e,"title")&&R(e,"title"))return re(R(e,"title"));var i=ue[t];if(i)return i(e);var n=ne(e);return n?re(n):function(e){if("svg"===e.tagName)return!1;var t=Y(e);return t.length>0&&t.every((function(e){return function(e){if("svg"===e.tagName)return!0;var t=Y(e);if(O(t))return!0;var i=te(e);return!(!O(t)&&!i)}(e)}))}(e)&&!ee(e)?re(de(e)):ee(e)?re(le(e)):""},ce=function(e,t){for(var i=e.parentElement;i&&!$(i);){if(t(i))return i;i=i.parentElement}},de=function(e){var t=Y(e);return T(t.map((function(e){var t=ne(e);if(te(e)&&t)return t}))).join(" ")},le=function(e){var t;return Y(e).some((function(e){var i,n=se(e,null===(i=e.tagName)||void 0===i?void 0:i.toLowerCase());return!!n&&(t=n,!0)})),t},fe=function(e,t){return E(["checkbox","radio"],e.type)?"".concat(t).concat((i=e.checked,"boolean"===C(i)?"("+e.checked+")":"")):t;var i},ge=function e(t,i,n,r,o){void 0===r&&(r=!0),void 0===o&&(o=[]);var a,u=this;this.originNode=t,this.deviceInfo=i,this.actionType=n,this.trackable=r,this.parentNodes=o,this.isLimitViewport=!0,this._getIndex=function(){if(K(u.originNode,X)){var e=R(u.originNode,X);return/^\d{1,10}$/.test(e)&&e-0>0&&2147483647>e-0?+e:void(0>u.actionType.indexOf("circle")&&(s="".concat(e,"，index标记应为 大于 0 且小于 2147483647 的整数！"),console.log("%c [GrowingIO]：".concat(s),"color: #F59E0B;")))}if(E(["dd","dt"],u.tagName)){var t=q(u.originNode),i=t?Y(t):[];if("dl"===t.tagName.toLowerCase()&&i.length>0){if("dd"===u.tagName){var n=L(i,(function(e){return e.isSameNode(u.originNode)}));if(n>-1)return(r=i.slice(0,n).filter((function(e){return"dt"===e.tagName.toLowerCase()}))).length-1+1}if("dt"===u.tagName){var r=i.filter((function(e){return"dt"===e.tagName.toLowerCase()}));return L(r,(function(e){return e.isSameNode(u.originNode)}))+1}}}if(u.isPureList){var o=L(u._pureList,(function(e){return e.isSameNode(u.originNode)}));return o>-1?(u.peerNodes=w([],u._pureList,!0),u.peerNodes.splice(o,1),o+1):void 0}if(u.isPseudoList){var a=L(u._pseudoList,(function(e){return e.isSameNode(u.originNode)}));return a>-1?(u.peerNodes=w([],u._pseudoList,!0),u.peerNodes.splice(a,1),a+1):void 0}var s},this._getSiblingNode=function(e,t){var i,n=q(e);if(!n)return[];for(var r=null!==(i=N((function(){return _(n.children)})))&&void 0!==i?i:[],o=[],a=0;a<r.length;a++){var u=r[a],s=r[a+1];if(!s||!t(u,s))break;O(o)?o.push(u,s):o.push(s)}return o},this._getIsPureList=function(){var e=u._getSiblingNode(u.originNode,(function(e,t){return e.tagName===t.tagName}));return!(1>e.length||!E(D,u.tagName)||(u._pureList=e,0))},this._getIsInPseudoList=function(){if(E(["th","td"],u.tagName))return!1;var e=u._getSiblingNode(u.originNode,(function(e,t){var i=e.tagName===t.tagName&&e.className===t.className,n=Y(e),r=Y(t),o=n.every((function(e,t){var i,n;return(null==e?void 0:e.tagName)===(null===(i=r[t])||void 0===i?void 0:i.tagName)&&(null==e?void 0:e.className)===(null===(n=r[t])||void 0===n?void 0:n.className)})),a=n.length===r.length&&o;return i&&a}));return e.length>=3&&(u._pseudoList=e,!0)},this._getClassList=function(e){var t;if(K(e,"name")&&R(e,"name"))return[R(e,"name")];var i=(null!==(t=R(e,"class"))&&void 0!==t?t:"").trim().split(" ");return O(i)?[]:i.filter((function(e){return e&&!V.test(e)&&G.test(e)})).sort()},this._getCurrentXpath=function(){return"/".concat(u.tagName).concat(u.id?"#"+u.id:"").concat(O(u.classList)?"":"."+u.classList.join("."))},this._getIsContainer=function(){return K(u.originNode,J)||E(P,u.tagName)||"input"===u.tagName&&E(S,u.originNode.type)},this._getContent=function(){u.content=se(u.originNode,u.tagName)},this._getIsOutFlow=function(){var e=window.getComputedStyle(u.originNode).position;return E(["fixed","sticky"],e)},this._getRect=function(){var e=u.originNode.getBoundingClientRect(),t=e.top,i=e.bottom,n=e.left,r=e.right-n,o=i-t,a=u.deviceInfo,s=a.winHeight,c=a.winWidth;return t+o>s&&(o=s-t),n+r>c&&(r=c-n),{top:t,left:n,width:r,height:o}},this._getListItemViewStatus=function(){var e=u.parentNodes.find((function(e){var t=e.originNode,i=t.scrollHeight,n=t.scrollWidth,r=t.clientHeight,o=t.clientWidth,a=e.rect,u=a.width,s=a.height;return r!==i&&i>s||o!==n&&n>u}));if(e){var t=e.rect,i=t.top,n=t.left,r=t.width,o=t.height,a=u.rect,s=a.top,c=a.left,d=a.width,l=a.height;return i>s+l||c>n+r||s>i+o||n>c+d?"OUTSIDE":s>=i&&c>=n&&i+o>s+l&&n+r>c+d?"DISPLAYED":"OBSCURED"}return""},this._getViewStatus=function(e){var t=window.getComputedStyle(u.originNode),i=t.opacity,n=t.visibility,r=t.display,o=t.width,a=t.height,s=u.rect,c=s.top,d=s.left,l=s.width,f=s.height,g=u.deviceInfo,v=g.winWidth,h=g.winHeight;if(0===Number(i)||"hidden"===n||"none"===r||"0px"===o||0===u.originNode.clientWidth||"0px"===a||0===u.originNode.clientHeight)return"HIDDEN";var p=w([],e,!0).find((function(e){return e.trackable&&E(["DISPLAYED","OBSCURED"],e.viewStatus)}));if(u.isPureList||u.isPseudoList){var m=u._getListItemViewStatus();if(m)return m}if(p)return p.viewStatus;var N=function(e,t){return document.elementFromPoint(e,t)===u.originNode};return h>c&&v>d&&l>0&&f>0?N(d+l/2,c+f/2)||N(d+1,c+1)||N(d+l-1,c+1)||N(d+1,c+f-1)||N(d+l-1,c+f-1)?"DISPLAYED":u.isLimitViewport&&(0>c+f||0>d+l)?"OUTSIDE":"OBSCURED":"OUTSIDE"},this._getTriggerEvent=function(){return"input"===u.tagName&&E(A,u.originNode.type)||E(["select","textarea"],u.tagName)?"VIEW_CHANGE":"VIEW_CLICK"},this._getXParents=function(t,i){var n=t.parentElement,r=[];if(i.length>0)r.push.apply(r,i);else if(n&&!$(n)){var o=new e(n,void 0,u.actionType,F(n,u.actionType));r.push(o),o.xParents&&r.push.apply(r,o.xParents)}return r},this.tagName=t.tagName.toLocaleLowerCase(),this.classList=this._getClassList(t),this.id=t.id,this.currentXpath=this._getCurrentXpath(),this.isIgnored=K(this.originNode,j),this.isContainer=this._getIsContainer(),this.isPureList=this._getIsPureList(),this.isPseudoList=this._getIsInPseudoList(),this.index=this._getIndex(),this.hyperlink=ae(t,this.tagName),this.content=se(this.originNode,this.tagName),this.triggerEvent=this._getTriggerEvent(),this.isOutFlow=this._getIsOutFlow(),i&&(this.isLimitViewport=null===(a=i.isLimitViewport)||void 0===a||a,this.rect=this._getRect(),this.viewStatus=this._getViewStatus(o)),this.xParents=this._getXParents(t,o)},ve=function e(t,i,n,r,o){var a=this;this.origin=t,this.action=i,this.lengthThreshold=n,this.deviceInfo=r,this.parentNode=o,this.trackNodes=function(){var e;if(!a.trackable)return[];var t=[a.xNode];if(E(["click","circleClick","change"],a.actionType))for(var i=a._getParent();i;){if(!(null==i?void 0:i.xNode)||(null===(e=i.xNode)||void 0===e?void 0:e.isIgnored))return[];i.trackable&&t.push(i.xNode),i=i._getParent()}var n,r=[];return t.reverse().forEach((function(e,i){if(K(e.originNode,J)&&(r=[],n=void 0),b(e.index)&&!b(n)&&(n=e.index),b(n)&&(e.index=n),i===t.length-1)r.push(a.getGioNodeInfo(e));else{var o=e.isPureList||e.isPseudoList;(e.isContainer||o)&&r.push(a.getGioNodeInfo(e))}})),r},this.getGioNodeInfo=function(e){var t=a.computeXpath(e),i=t.skeleton,n=t.fullXpath,r=t.xcontent,o=e.hyperlink,u=e.index,s=e.peerNodes,c=e.content,d=e.triggerEvent,l=e.originNode;return{skeleton:i,xpath:i,fullXpath:n,xcontent:r,hyperlink:o,index:u,peerNodes:null!=s?s:[],content:re(c),triggerEvent:d,originNode:l}},this.computeXpath=function(e){var t,i="/"+e.tagName,n=e.currentXpath,r="/"+((e.id?"#"+e.id:"")+(O(e.classList)?"":"."+e.classList.join("."))||"-");return null===(t=e.xParents)||void 0===t||t.forEach((function(e,t){if(n=e.currentXpath+n,t<a.xpathThreshold-1){i="/"+e.tagName+i;var o=(e.id?"#"+e.id:"")+(O(e.classList)?"":"."+e.classList.join("."));r="/"+(o||"-")+r}})),{skeleton:i,fullXpath:n,xcontent:r}},this._getParent=function(){var t=q(a.originElement);if(t&&t.nodeName&&!$(t))return new e(t,a.actionType)},this.actionType=E(["circleClick","circleHover","click","change"],i)?i:"click",this.originElement=z(t),this.xpathThreshold=b(n)?n:4,this.trackable=F(this.originElement,this.actionType),this.originElement.isSameNode(t)||(o=null);var u=[];o&&o.xNode&&(u.push(o.xNode),o.xNode.xParents&&u.push.apply(u,o.xNode.xParents)),this.xNode=new ge(this.originElement,this.deviceInfo,this.actionType,this.trackable,u)},he=[],pe=function(e,t){var i,n,r,o,a,u,s,c=this;this.trackNodes=function(e,t,i){return void 0===i&&(i=!1),he=[],c._getTrackElements(e,t,null,i),he},this._getTrackElements=function(e,t,i,n){void 0===n&&(n=!1),Y(e).forEach((function(e){var r,o,a,u;if(!(null==e?void 0:e.tagName)||E(["circle-shape","circle-page","heatmap-page"],null===(r=null==e?void 0:e.tagName)||void 0===r?void 0:r.toLowerCase())||(null===(o=null==e?void 0:e.id)||void 0===o?void 0:o.indexOf("__vconsole"))>-1||(null===(a=null==e?void 0:e.id)||void 0===a?void 0:a.indexOf("__giokit"))>-1)return!1;var s=new ve(e,"circleClick",c.xpathThreshold,c.deviceInfo,i),d=s.xNode;if(d.zLevel=c._getZLevel(e,t),s.trackable&&(E(["DISPLAYED","OBSCURED"],d.viewStatus)||n)){if(t.index&&(d.index=t.index),he.find((function(e){return e.originNode.isSameNode(d.originNode)})))return!1;if("DISPLAYED"===d.viewStatus){var l=c._getGioHybridNodeInfo(s,t);he.push(l)}else"OBSCURED"===d.viewStatus&&(d.isContainer||n)&&(l=c._getGioHybridNodeInfo(s,t),he.push(l));if(ie(e)||d.isContainer&&te(e))return!1}O(Y(e))||c._getTrackElements(e,null!==(u=s.xNode)&&void 0!==u?u:t,s,n)}))},this._getZLevel=function(e,t){var i=window.getComputedStyle(e),n=i.position,r=i.zIndex;if("auto"!==r){var o=Number(r||0);return(Number.isNaN(o)?0:o)+t.zLevel}switch(n){case"relative":return t.zLevel+2;case"sticky":return t.zLevel+3;case"absolute":return t.zLevel+4;case"fixed":return t.zLevel+5;default:return t.zLevel+1}},this._getGioHybridNodeInfo=function(e,t){var i=e.xNode,n=i.rect,r=i.zLevel,o=e.getGioNodeInfo(i),a=o.hyperlink,u={};return x(n).forEach((function(e){return u[e]=n[e]*c.deviceInfo.scale})),u.top+=c.deviceInfo.webviewTop,u.left+=c.deviceInfo.webviewLeft,p(p(p({},u),o),{zLevel:r+c.deviceInfo.webviewZLevel,href:a,parentXPath:t.trackable?e.computeXpath(t).xpath:void 0})},this.xpathThreshold=t,this.deviceInfo=(n=(i=e).webviewLeft,r=i.webviewTop,o=i.webviewWidth,a=i.webviewHeight,u=i.webviewZLevel,s=i.isLimitViewport,{winWidth:o,winHeight:a,scale:o/window.innerWidth,webviewTop:r,webviewLeft:n,webviewWidth:o,webviewHeight:a,webviewZLevel:u,isLimitViewport:s})},we=function(e){try{return e()}catch(e){return}},me=function(e,t,i,n){void 0===n&&(n={}),document.addEventListener?e.addEventListener(t,i,o(o({},{capture:!0}),n)):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i},Ne=["VIEW_CLICK","VIEW_CHANGE","PAGE","CUSTOM","LOGIN_USER_ATTRIBUTES"],be=["LOGIN_USER_ATTRIBUTES"],ye=["DOMContentLoaded","onreadystatechange"],Ie=["scroll","resize","load","beforeunload","popstate","hashchange","pagehide","unload"],Le=function(){function e(e){var t=this;this.growingIO=e,this.penetrateHybrid=!0,this.onOptionsInit=function(e,i){var n,r=t.growingIO,o=r.emitter,a=r.plugins;if(function(e){return"boolean"===h(e)}(i.penetrateHybrid)&&(t.penetrateHybrid=i.penetrateHybrid),t._initHybridBridge()&&(t.onSendBefore=t.sendBeforeListener,!t.growingIO.useHybridInherit)){var u=null!==(n=t.hybridConfig.packageName)&&void 0!==n?n:t.hybridConfig.appPackage;a.gioMultipleInstances||i.packageName?t.hybridConfig.projectId===i.projectId&&u===i.packageName&&(t.growingIO.useHybridInherit=e):t.hybridConfig.projectId===i.projectId&&(t.growingIO.useHybridInherit=e)}t.growingIO.useHybridInherit&&(null==o||o.on("SET_USERID",(function(e){var i=e.newUserId,n=e.oldUserId,r=e.userKey;e.trackingId===t.growingIO.useHybridInherit&&t.penetrateHybrid&&(!i&&n?r?t._clearNativeUserIdAndUserKey():t._clearNativeUserId():r?t._setNativeUserIdAndUserKey(l(i),l(r)):t._setNativeUserId(l(i)))})),null==o||o.on("SET_USERKEY",(function(e){var i=e.newUserKey,n=e.oldUserKey,r=e.userId;e.trackingId===t.growingIO.useHybridInherit&&t.penetrateHybrid&&(!i&&n?t._clearNativeUserIdAndUserKey():t._setNativeUserIdAndUserKey(l(r),l(i)))})))},this._initHybridBridge=function(){var e,i,n,r=!1;return t.hasHybridBridge=!!window.GrowingWebViewJavascriptBridge,t.hasHybridBridge?((null===(e=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===e?void 0:e.configuration)||(window.GrowingWebViewJavascriptBridge.configuration=JSON.parse(window.GrowingWebViewJavascriptBridge.getConfiguration())),(null===(i=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===i?void 0:i.configuration)&&(t.hybridConfig=null===(n=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===n?void 0:n.configuration),r=!0):m.consoleText("gioHybridAdapter：当前不存在 GrowingWebViewJavascriptBridge，Web模式。","info"),r},this.sendBeforeListener=function(e){var i=e.requestData,n=e.trackingId;if(t.hasHybridBridge){var r=function(){var e=t.processAttributes(o({},i));d(Ne,e.eventType)&&(d(be,e.eventType)?t.penetrateHybrid&&t._dispatchEvent(e):(t.penetrateHybrid||v(e,["userId","userKey","cs1"]),t._dispatchEvent(e)))};t.growingIO.useHybridInherit?n===t.growingIO.useHybridInherit&&r():n!==t.growingIO.trackingId||t.growingIO.plugins.gioMultipleInstances||r()}},this.processAttributes=function(e){return g(e,(function(t,i){s(t)||c(t)?g(e[i],(function(t,n){s(t)||c(t)?e[i][n]=JSON.stringify(t):e[i][n]=l(t)})):e[i]=l(t)})),e},this._setNativeUserId=function(e){we((function(){return window.GrowingWebViewJavascriptBridge.setNativeUserId(e)}))},this._clearNativeUserId=function(){we((function(){return window.GrowingWebViewJavascriptBridge.clearNativeUserId()}))},this._setNativeUserIdAndUserKey=function(e,t){we((function(){return window.GrowingWebViewJavascriptBridge.setNativeUserIdAndUserKey(e,t)}))},this._clearNativeUserIdAndUserKey=function(){we((function(){return window.GrowingWebViewJavascriptBridge.clearNativeUserIdAndUserKey()}))},this._dispatchEvent=function(e){we((function(){var t;return null===(t=window.GrowingWebViewJavascriptBridge)||void 0===t?void 0:t.dispatchEvent(JSON.stringify(e))}))},this._getDomTree=function(e,i,n,r,o,a){var u=new pe({webviewLeft:e,webviewTop:i,webviewWidth:n,webviewHeight:r,webviewZLevel:o}).trackNodes(null!=a?a:document.body,{isContainer:!1,zLevel:0},!1).map((function(e){return v(e,["originNode","peerNodes"]),e})),s=t.growingIO.dataStore.currentPage;return{page:{domain:s.domain,path:s.path,query:s.query,title:s.title},elements:u}};var i=this.growingIO,n=i.emitter,r=i.utils;m=r,n.on("OPTION_INITIALIZED",(function(e){var i=e.trackingId,n=e.vdsConfig;if(t.onOptionsInit(i,n),t.growingIO.useHybridInherit&&window.GrowingWebViewJavascriptBridge){var r=t;window.GrowingWebViewJavascriptBridge.getDomTree=function(){if(arguments.length>=4)return r._getDomTree.apply(this,arguments)},t._addDomChangeListener()}}))}return e.prototype._addDomChangeListener=function(){var e,t=function(t){return void 0===t&&(t=""),function(){var i;"beforeunload"===t&&e&&e.disconnect(),null===(i=window.GrowingWebViewJavascriptBridge)||void 0===i||i.onDomChanged()}};(e=new MutationObserver(t("mutation"))).observe(document.body,{attributes:!0,characterData:!0,childList:!0,subtree:!0}),ye.forEach((function(e){me(document,e,t(e))})),Ie.forEach((function(e){me(window,e,t(e))}))},e}();window.gioHybridAdapter={name:"gioHybridAdapter",method:Le}}));
