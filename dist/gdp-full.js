var e,t,i,n,r,o="function"==typeof Array.from?Array.from:(t||(t=1,i=function(e){return"function"==typeof e},n=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),9007199254740991)},r=function(e){var t=e.next();return!t.done&&t},e=function(e){var t,o,s,a=this,d=arguments.length>1?arguments[1]:void 0;if(void 0!==d){if(!i(d))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(t=arguments[2])}var c=function(e,t){if(null!=e&&null!=t){var n=e[t];if(null==n)return;if(!i(n))throw new TypeError(n+" is not a function");return n}}(e,function(e){if(null!=e){if(["string","number","boolean","symbol"].indexOf(typeof e)>-1)return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in e)return Symbol.iterator;if("@@iterator"in e)return"@@iterator"}}(e));if(void 0!==c){o=i(a)?Object(new a):[];var u,l,g=c.call(e);if(null==g)throw new TypeError("Array.from requires an array-like or iterable object");for(s=0;;){if(!(u=r(g)))return o.length=s,o;l=u.value,o[s]=d?d.call(t,l,s):l,s++}}else{var h=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var p,v=n(h.length);for(o=i(a)?Object(new a(v)):Array(v),s=0;v>s;)p=h[s],o[s]=d?d.call(t,p,s):p,s++;o.length=v}return o}),e);const s=e=>O(["undefined","null"],U(e)),a=e=>"string"===U(e),d=e=>"number"===U(e),c=e=>"NaN"===N(Number(e)),u=e=>"boolean"===U(e),l=e=>"object"===U(e)&&!s(e),g=e=>"regexp"===U(e),h=e=>O(["function","asyncfunction"],U(e)),p=e=>Array.isArray(e)&&"array"===U(e),v=e=>"date"===U(e),m=e=>{try{return S(e)[0]}catch(e){return}},f=e=>{try{const t=S(e);return t[t.length-1]}catch(e){return}},w=(e,t=1)=>p(e)&&d(t)?e.slice(t>0?t:1,e.length):e,I=e=>{if(p(e)){let t=0;const i=[];for(const n of e)n&&!P(n)&&(i[t++]=n);return i}return e},y=(e,t)=>e[b(e,t)],b=(e,t)=>{let i=-1;return p(e)&&e.every(((e,n)=>!t(e)||(i=n,!1))),i},O=(e,t)=>("array"===U(e)||"string"===U(e))&&e.indexOf(t)>=0,S=o,N=e=>s(e)?"":""+e,_=(e,t)=>"string"==typeof e?e.split(t):e,E=e=>{if(a(e)){const t=_(e,"");return`${m(t).toLowerCase()}${w(t).join("")}`}return e},T=(e,t)=>!!a(e)&&e.slice(0,t.length)===t,C=(e,t)=>{if(a(e)){const{length:i}=e;let n=i;n>i&&(n=i);const r=n;return n-=t.length,n>=0&&e.slice(n,r)===t}return!1},x={}.hasOwnProperty,k=(e,t)=>!s(e)&&x.call(e,t),L=e=>l(e)?Object.keys(e):[],A=(e,t)=>{L(e).forEach((i=>t(e[i],i)))},D=(e,t)=>{const i=L(e);return!(!l(e)||!l(t)||i.length!==L(t).length||O(i.map(((i,n)=>l(e[i])?D(e[i],t[i]):e[i]===t[i])),!1))},j=(e,t)=>{if(!l(e))return!1;try{return"string"===U(t)?delete e[t]:"array"===U(t)?t.map((t=>delete e[t])):(g(t)&&L(e).forEach((i=>{t.test(i)&&j(e,i)})),!0)}catch(e){return!1}},P=e=>p(e)?0===e.length:l(e)?0===L(e).length:!e,U=e=>({}.toString.call(e).slice(8,-1).toLowerCase());var q=Object.freeze({__proto__:null,isNil:s,isString:a,isNumber:d,isNaN:c,isBoolean:u,isObject:l,isRegExp:g,isFunction:h,isArray:p,isDate:v,fixed:(e,t)=>d(e)?Number(e.toFixed(d(t)?t:2)):a(e)&&"NaN"!==N(Number(e))?Number(Number(e).toFixed(d(t)?t:2)):e,head:m,last:f,drop:w,dropWhile:(e,t)=>p(e)?e.filter((e=>!t(e))):e,compact:I,find:y,findIndex:b,includes:O,arrayFrom:S,toString:N,split:_,lowerFirst:E,upperFirst:e=>{if(a(e)){const t=_(e,"");return`${m(t).toUpperCase()}${w(t).join("")}`}return e},startsWith:T,endsWith:C,has:k,keys:L,forEach:A,isEqual:D,get:(e,t,i)=>{let n=e;return l(e)?(t.split(".").forEach((e=>{n=n?n[e]:i})),n):i},unset:j,isEmpty:P,typeOf:U,formatDate:e=>{if(v(e)){const t=e=>10>e?"0"+e:e;return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+t(e.getMilliseconds())}return e}});const B=(e,t)=>{console.log("%c [GrowingIO]："+e,{info:"color: #3B82F6;",error:"color: #EF4444;",warn:"color: #F59E0B;",success:"color: #10B981;"}[t]||"")},H=e=>{try{return e()}catch(e){return}},K=(e,t)=>{if(h(e))try{e(t)}catch(e){B("回调执行失败！"+e,"error")}},F=(e,t=!0,i="参数不合法")=>B(`${t?"调用":"设置"} ${e} 失败，${i}!`,"warn"),R=e=>{const t={};return l(e)&&A(e,((e,i)=>{const n=N(i).slice(0,100);l(e)?t[n]=R(e):p(e)?(t[n]=e.slice(0,100),t[n]=t[n].join("||").slice(0,1e3)):t[n]=s(e)?"":N(e).slice(0,1e3)})),t},G=(e,t,i,n={})=>{document.addEventListener?e.addEventListener(t,i,Object.assign(Object.assign({},{capture:!0}),n)):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i},V=(e,t)=>a(e)&&!P(e)&&e.match(/^[a-zA-Z_][0-9a-zA-Z_]{0,100}$/)?t():(B("事件名格式不正确，只能包含数字、字母和下划线，且不能以数字开头，字符总长度不能超过100!","error"),!1);var M=Object.freeze({__proto__:null,consoleText:B,niceTry:H,niceCallback:K,callError:F,limitObject:R,addListener:G,flattenObject:(e={})=>{const t=Object.assign({},e);return L(t).forEach((e=>{l(t[e])?(L(t[e]).forEach((i=>{t[`${e}_${i}`]=N(t[e][i])})),j(t,e)):p(t[e])?(t[e].forEach(((i,n)=>{l(i)?L(i).forEach((r=>{t[`${e}_${n}_${r}`]=N(i[r])})):t[`${e}_${n}`]=N(i)})),j(t,e)):s(t[e])||""===t[e]?j(t,e):t[e]=N(t[e])})),R(t)},eventNameValidate:V,getGioFunction:()=>{var e,t,i,n;const r=window._gio_local_vds||"vds",o=null!==(t=null===(e=window[r])||void 0===e?void 0:e.namespace)&&void 0!==t?t:"gdp";return h(window[o])?window[o]:null!==(n=null!==(i=window.gdp)&&void 0!==i?i:window.gio)&&void 0!==n?n:function(){}},hashCode:e=>{let t=0;if(P(e)||"boolean"==typeof e)return t;let i=0;for(;i<e.length;)t=(t<<5)-t+e.charCodeAt(i),t&=t,i++;return t}});const $=e=>a(e)&&e.length>0||d(e)&&e>0,W=["web","wxwv","Android","iOS","minp","alip","baidup","qq","bytedance","kuaishoup","jdp","xhsp"],z={autotrack:{type:"boolean",default:!0},compress:{type:"boolean",default:!0},cookieDomain:{type:"string",default:""},dataCollect:{type:"boolean",default:!0},debug:{type:"boolean",default:!1},embeddedIgnore:{type:"array",default:[]},forceLogin:{type:"boolean",default:!1},idMapping:{type:"boolean",default:!1},enableIdMapping:{type:"boolean",default:!1},gtouchHost:{type:"string",default:""},hashtag:{type:"boolean",default:!1},ignoreFields:{type:"array",default:[]},originalSource:{type:"boolean",default:!0},penetrateHybrid:{type:"boolean",default:!0},performance:{type:"object",default:{monitor:!0,exception:!0}},platform:{type:"string",default:"web"},sendType:{type:"string",default:"beacon"},serverUrl:{type:"string",default:"https://napi.growingio.com"},sessionExpires:{type:"number",default:30},storageType:{type:"string",default:"cookie"},touch:{type:"boolean",default:!1},trackBot:{type:"boolean",default:!0},version:{type:"string",default:"1.0.0"}},J=["clearGeneralProps","clearTrackTimer","clearUserId","getDeviceId","getOption","getPlugins","identify","init","registerPlugins","removeTimer","sendPage","sendVisit","setGeneralProps","setOption","setUserAttributes","setUserId","track","trackTimerEnd","trackTimerPause","trackTimerResume","trackTimerStart","getABTest"],X={autotrack:"无埋点采集",dataCollect:"数据采集",dataSourceId:"数据源ID",debug:"调试模式",forceLogin:"强制登录",hashtag:"哈希解析",serverUrl:"数据上报服务地址"},Q=["collectImp","enableDebug","enableHT","getVisitorId","send","setAutotrack","setConfig","setDataCollect","setPlatformProfile","setTrackerHost","setTrackerScheme"],Z=["screenHeight","screenWidth"],Y=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),ee=e=>C(e,"_gioenc")?e.slice(0,-7):e,te=e=>c(Number(e))&&H((()=>JSON.parse(e)))||e;function ie(e){for(var t=1;arguments.length>t;t++){var i=arguments[t];for(var n in i)e[n]=i[n]}return e}var ne=function e(t,i){function n(e,n,r){if("undefined"!=typeof document){"number"==typeof(r=ie({},i,r)).expires&&(r.expires=new Date(Date.now()+864e5*r.expires)),r.expires&&(r.expires=r.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var s in r)r[s]&&(o+="; "+s,!0!==r[s]&&(o+="="+r[s].split(";")[0]));return document.cookie=e+"="+t.write(n,e)+o}}return Object.create({set:n,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var i=document.cookie?document.cookie.split("; "):[],n={},r=0;r<i.length;r++){var o=i[r].split("="),s=o.slice(1).join("=");try{var a=decodeURIComponent(o[0]);if(n[a]=t.read(s,a),e===a)break}catch(e){}}return e?n[e]:n}},remove:function(e,t){n(e,"",ie({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,ie({},this.attributes,t))},withConverter:function(t){return e(ie({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(i)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});const re={A:1,a:1,Z:1,z:1,"@":1,"{":1},oe=e=>s(e)?e:H((()=>"gioenc-"+ae(e)))||e,se=e=>a(e)&&T(e,"gioenc-")&&H((()=>ae(e.replace("gioenc-",""))))||e,ae=e=>(e=e||"").split("").map((e=>re[e]?e:de(e))).join(""),de=e=>{if(/[0-9]/.test(e))return 1^+e;{let t=e.charCodeAt(0);return String.fromCharCode(1^t)}};class ce{constructor(e){this.domain=e,this.getItem=e=>te(se(ne.get(ee(e),{domain:this.domain,path:"/"}))),this.setItem=(e,t,i)=>{let n;n=a(t)?t.length?C(e,"_gioenc")?oe(t):t:"":JSON.stringify(t),ne.set(ee(e),n,{expires:i?new Date(i):new Date((new Date).getFullYear()+3,(new Date).getMonth(),(new Date).getDay()),domain:this.domain,path:"/"})},this.removeItem=e=>{ne.remove(ee(e),{domain:this.domain,path:"/"})},this.hasItem=e=>O(L(ne.get()),ee(e)),this.getKeys=()=>L(ne.get()),this.type="Cookie"}}class ue{constructor(){this.getItem=e=>{const t=H((()=>JSON.parse(localStorage.getItem(ee(e))||"")))||{};return l(t)&&t.expiredAt>+Date.now()?te(se(t.value)):void 0},this.setItem=(e,t,i)=>{const n=null!=i?i:+new Date((new Date).getFullYear()+3,(new Date).getMonth(),(new Date).getDay()).getTime();localStorage.setItem(ee(e),JSON.stringify({value:a(t)&&t.length&&C(e,"_gioenc")?oe(t):t,expiredAt:n}))},this.removeItem=e=>localStorage.removeItem(ee(e)),this.hasItem=e=>!!localStorage.getItem(ee(e)),this.getKeys=()=>S(Array(localStorage.length)).map(((e,t)=>localStorage.key(t))),this.type="localStorage"}}const le={};class ge{constructor(){this.getItem=e=>{const t=H((()=>JSON.parse(le[ee(e)]||"")));return l(t)&&t.expiredAt>+Date.now()?te(se(t.value)):void 0},this.setItem=(e,t,i)=>{const n=null!=i?i:+new Date((new Date).getFullYear()+3,(new Date).getMonth(),(new Date).getDay()).getTime();le[ee(e)]=JSON.stringify({value:a(t)&&t.length?oe(t):t,expiredAt:n})},this.removeItem=e=>j(le,ee(e)),this.hasItem=e=>k(le,ee(e)),this.getKeys=()=>L(le),this.type="memory"}}let he;const pe=/^(\.ac\.|\.br\.|\.co\.|\.com\.|\.edu\.|\.gov\.|\.org\.|\.net\.)/,ve=e=>{const t=[];try{const i=e.split("."),n=f(i);if(i.length>=2&&(isNaN(Number(n))||0>Number(n)||Number(n)>255)){const e="."+i.slice(-2).join(".");pe.test(e)?he=e:t.push(e);const n="."+i.slice(-3).join(".");pe.test(n)||O(t,n)||t.push(n);const r="."+i.slice(-4).join(".");pe.test(r)||O(t,r)||t.push(r)}}catch(e){}return t},me=e=>{let t="";return e.every((e=>!fe(e)||(t=e,!1))),t},fe=e=>{try{ne.set("gioCookie","yes",{domain:e});const t=!!ne.get("gioCookie",{domain:e});return ne.remove("gioCookie",{domain:e}),t}catch(e){return!1}},we=e=>{let t,i,n,{storageType:r,cookieDomain:o,projectId:s}=e;if(O(["cookie","localstorage"],r)||(r="cookie"),"cookie"===r&&(n=navigator.userAgent.indexOf("Electron")>-1||O(["","localhost","127.0.0.1"],window.location.hostname)||!O(["http:","https:"],window.location.protocol)?"":me([...ve(window.location.hostname),window.location.hostname]),i=!!n),"cookie"===r&&i){const e=new ce(n);if(o){let t=ve(o);const i=me(P(t)?[]:[o,...ve(o)]);i&&fe(i)?e.domain=i:B("指定Cookie域无效或无权限，使用默认域！","warn")}t=e}else t=(()=>{try{const e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(e){return!1}})()?new ue:new ge;return"cookie"===r&&he&&fe(he)&&((e,t,i)=>{if(t&&fe(t)){let n=new ce(t);[i+"_gdp_session_id","gdp_user_id_gioenc",i+"_gdp_cs1_gioenc",i+"_gdp_user_key_gioenc",i+"_gdp_gio_id_gioenc",i+"_gdp_sequence_ids",i+"_gdp_session_id_sent"].forEach((t=>{const i=n.getItem(t);n.hasItem(t)&&(e.setItem(t,i),n.removeItem(t))})),n=void 0}})(t,he,s),t};var Ie="OPTION_INITIALIZED",ye="SDK_INITIALIZED",be="SDK_INITIALIZED_COMPLATE",Oe="SESSIONID_UPDATE",Se="SET_USERID",Ne="SET_USERKEY";class _e{constructor(e){this.growingIO=e,this.main=()=>{var e,t;const{sdkVersion:i,useEmbeddedInherit:n,vdsConfig:r,userStore:o,dataStore:s,trackingId:a}=this.growingIO,{path:d,query:c}=s.currentPage;let u={appVersion:r.version,dataSourceId:r.dataSourceId,deviceId:o.uid,domain:n?r.appId:window.location.host,language:navigator.language,path:d,platform:r.platform,query:c,referralPage:(null===(e=s.lastPageEvent)||void 0===e?void 0:e.referralPage)||"",screenHeight:window.screen.height,screenWidth:window.screen.width,sdkVersion:i,sessionId:o.sessionId,timestamp:+Date.now(),timezoneOffset:(new Date).getTimezoneOffset(),title:null!==(t=H((()=>document.title.slice(0,255))))&&void 0!==t?t:"",userId:o.userId};if(r.idMapping&&(u.userKey=o.userKey),P(r.ignoreFields)||r.ignoreFields.forEach((e=>{j(u,e)})),n&&!P(this.minpExtraParams)){const e=Object.assign({},u);A(Object.assign(Object.assign({},u),this.minpExtraParams),((t,i)=>{var n;O(r.embeddedIgnore,i)?(u[i]=e[i],"domain"===i&&(u[i]=window.location.host)):u[i]=null!==(n=this.minpExtraParams[i])&&void 0!==n?n:u[i]}))}return u.trackingId=a,u},this.minpExtraParams={}}}class Ee{constructor(e){this.growingIO=e,this.parsePage=()=>{const{hashtag:e}=this.growingIO.vdsConfig,t=location.pathname,i=location.search,n=location.hash,r=n.indexOf("?");this.domain=window.location.host,this.title=document.title.slice(0,255),this.time=+Date.now(),this.path=t,this.query=i,e&&(r>-1?(this.path+=n.slice(0,r),this.query=this.query+"&"+n.slice(r+1)):this.path+=n),this.query&&O(["?","&"],this.query.charAt(0))&&(this.query=this.query.slice(1))},this._getNoHashHref=()=>{const{protocol:e,host:t,pathname:i,search:n}=window.location;return`${e}://${t}${i}${n}`},this.getReferralPage=()=>{var e,t;const{dataStore:{lastPageEvent:i}}=this.growingIO;return(null==i?void 0:i.path)===this.path&&(null!==(e=null==i?void 0:i.query)&&void 0!==e?e:"")===(null!==(t=this.query)&&void 0!==t?t:"")?null==i?void 0:i.referralPage:(null==i?void 0:i.path)?this.lastHref:document.referrer},this.pageListener=()=>{const{hashtag:e}=this.growingIO.vdsConfig;let t=window.location.href,i=this.lastHref;e||(t=this._getNoHashHref(),i=this.lastNoHashHref),i!==t&&(this.parsePage(),this.buildPageEvent())},this.hookHistory=()=>{const e=window.history.pushState,t=window.history.replaceState,i=this;e&&H((()=>window.history.pushState=function(){e.apply(window.history,arguments),setTimeout(i.pageListener)})),t&&H((()=>window.history.replaceState=function(){t.apply(window.history,arguments),setTimeout(i.pageListener)})),G(window,"popstate",this.pageListener);const{hashtag:n}=this.growingIO.vdsConfig;n&&G(window,"hashchange",this.pageListener)},this.buildPageEvent=e=>{const{dataStore:{lastPageEvent:t,eventContextBuilder:i,eventConverter:n}}=this.growingIO;let r=Object.assign(Object.assign({eventType:"PAGE"},i()),{protocolType:location.protocol.substring(0,location.protocol.length-1),referralPage:this.getReferralPage()});P(e)||(r=Object.assign(Object.assign({},r),e)),r.timestamp=this.time,n(r),this.lastHref=window.location.href,this.lastNoHashHref=this._getNoHashHref(),this.lastLocation=Object.assign({},window.location)},this.title=document.title.slice(0,255),this.lastLocation=Object.assign({},window.location)}}class Te{constructor(e){var t;this.growingIO=e,this.ALLOW_SETTING=Object.assign({},z),this.allowOptKeys=Object.keys(this.ALLOW_SETTING),this.trackTimers={},this.setSequenceIds=e=>{let t=this.growingIO.storage.getItem(this.seqStorageIdName)||{};t.globalKey=e,this.growingIO.storage.setItem(this.seqStorageIdName,t)},this.initOptions=e=>{var t,i,n,r,o,s,a;const{projectId:d,dataSourceId:u,appId:l}=e;this.initialDataSourceId=u;const g={};this.allowOptKeys.forEach((t=>{const i=this.ALLOW_SETTING[t].type;let n=p(i)?!O(i,U(e[t])):U(e[t])!==i;"platform"!==t||O(W,e[t])||(n=!0),n?g[t]=this.ALLOW_SETTING[t].default:"ignoreFields"===t?g.ignoreFields=e.ignoreFields.filter((e=>O(Z,e))):(g[t]=e[t],O(["dataCollect","autotrack"],t)&&(g[t]||B("已关闭"+X[t],"info")))})),g.sessionExpires=Math.round(g.sessionExpires),(c(g.sessionExpires)||1>g.sessionExpires||g.sessionExpires>360)&&(g.sessionExpires=30),g.storageType=g.storageType.toLowerCase(),g.enableIdMapping&&!g.idMapping&&(g.idMapping=!0),g.sendType=g.sendType.toLowerCase(),O(["beacon","xhr"],g.sendType)||(g.sendType="beacon"),!g.trackBot&&/bot|crawler|spider|scrapy|jiankongbao|slurp|transcoder|networkbench/i.test(navigator.userAgent.toLowerCase())&&(g.dataCollect=!1),this.growingIO.vdsConfig=Object.assign(Object.assign(Object.assign({},null!==(t=window[this.growingIO.vds])&&void 0!==t?t:{}),g),{projectId:d,dataSourceId:u,appId:l,performance:{monitor:null===(n=null===(i=g.performance)||void 0===i?void 0:i.monitor)||void 0===n||n,exception:null===(o=null===(r=g.performance)||void 0===r?void 0:r.exception)||void 0===o||o,network:null!==(a=null===(s=g.performance)||void 0===s?void 0:s.network)&&void 0!==a&&a}}),window[this.growingIO.vds]=this.growingIO.vdsConfig,this.seqStorageIdName=d+"_gdp_sequence_ids",this.visitStorageName=d+"_gdp_session_id_sent"},this.setOriginalSource=()=>{const{storage:e,userStore:t}=this.growingIO,i=e.getItem(this.visitStorageName);if(t.sessionId!==i&&s(this.getOriginalSource())){const{path:e,query:t,getReferralPage:i}=this.currentPage,n={path:e,query:t,referralPage:document.referrer||i()};localStorage.setItem(this.originalSourceName,JSON.stringify(n))}},this.getOriginalSource=()=>H((()=>JSON.parse(localStorage.getItem(this.originalSourceName)))),this.setOption=(e,t)=>{var i;const{vdsConfig:n,uploader:r,emitter:o,userStore:s,vds:d}=this.growingIO,c=a(e)&&O(L(X),e),u=c&&typeof t===((null===(i=this.ALLOW_SETTING[e])||void 0===i?void 0:i.type)||"string"),l=Object.assign({},n);return c&&u?(n[e]=t,"dataCollect"===e&&l.dataCollect!==t&&(t?s.sessionId=Y():this.growingIO.clearTrackTimer()),"serverUrl"===e&&(null==r||r.generateHost()),null==o||o.emit("OPTION_CHANGE",{optionName:e,optionValue:t}),window[d][e]=t,!0):(F("setOption > "+e),!1)},this.getOption=e=>{const{vdsConfig:t}=this.growingIO;return e&&k(t,N(e))?t[N(e)]:s(e)?Object.assign({},t):void F("getOption > "+e)},this.sendVisit=e=>{const{userStore:{sessionId:t},storage:i}=this.growingIO,n=i.getItem(this.visitStorageName);!e&&t===n||this.buildVisitEvent()},this.buildVisitEvent=e=>{const{dataStore:{eventContextBuilder:t,eventConverter:i,currentPage:n},emitter:r,storage:o,vdsConfig:a}=this.growingIO,c=this.getOriginalSource();let u=Object.assign(Object.assign({eventType:"VISIT"},t()),{referralPage:document.referrer||this.currentPage.getReferralPage(),timestamp:n.time-1});a.originalSource&&!s(c)&&(u=Object.assign(Object.assign({},u),c)),P(e)||A(u,((t,i)=>{k(e,i)&&(d(e[i])?u[i]=e[i]:P(e[i])||(u[i]=e[i]||u[i]))}));const l=({requestData:e})=>{"VISIT"===e.eventType&&e.trackingId===this.growingIO.trackingId&&(o.setItem(this.visitStorageName,e.sessionId),localStorage.removeItem(this.originalSourceName),r.off("onSendAfter",l))};r.on("onSendAfter",l),i(u)},this.sendPage=e=>{e&&this.currentPage.parsePage(),this.currentPage.buildPageEvent()},this.buildErrorEvent=e=>{const{dataStore:{eventContextBuilder:t,eventConverter:i}}=this.growingIO;i(Object.assign({eventType:"CUSTOM",eventName:"onError",attributes:e},t()))},this.eventConverter=e=>{var t;const{vdsConfig:i,dataStore:n,uploader:r}=this.growingIO;if(i.dataCollect){"LOGIN_USER_ATTRIBUTES"===e.eventType?j(e,"timezoneOffset"):e.trackingId===this.growingIO.trackingId&&(e.eventSequenceId=n.gsid);const i={};A(e,((e,t)=>{var n;if("element"===t){const t=null!==(n=m(e))&&void 0!==n?n:{};A(t,((e,t)=>{P(e)&&0!==e||(i[t]=e)}))}else(P(e)||s(e))&&0!==e||(i[t]=e)})),e.trackingId===this.growingIO.trackingId&&(this.growingIO.dataStore.gsid+=1),null===(t=this.growingIO.emitter)||void 0===t||t.emit("onComposeAfter",{composedEvent:Object.assign({},i)}),e.trackingId===this.growingIO.trackingId&&r.commitRequest(Object.assign(Object.assign({},i),{requestId:Y()}))}},this.currentPage=new Ee(this.growingIO),this.eventContextBuilderInst=new _e(this.growingIO),this.eventContextBuilder=null===(t=this.eventContextBuilderInst)||void 0===t?void 0:t.main,this.generalProps={},this.lastPageEvent={},this.originalSourceName="gdp_original_source";const{emitter:i}=this.growingIO;null==i||i.on("onComposeAfter",(({composedEvent:e})=>{"PAGE"!==e.eventType&&"page"!==e.t||e.trackingId!==this.growingIO.trackingId||(this.lastPageEvent=e)})),i.on(be,(()=>{null==i||i.on(Oe,(()=>{this.growingIO.uploader.hoardingQueue=[],this.currentPage.parsePage(),this.sendVisit(!0),this.sendPage(!0)}))}))}get gsid(){const e=this.growingIO.storage.getItem(this.seqStorageIdName)||{},t=Number(e.globalKey);return this._gsid=c(t)||t>=1e9||1>t?1:t,this._gsid}set gsid(e){c(Number(e))||e>=1e9||1>e?this._gsid=1:this._gsid=e,this.setSequenceIds(this._gsid)}}var Ce={name:"gioCompress",method:class{constructor(e){this.growingIO=e,this._compress=(e,t,i)=>{if(null===e)return"";let n,r,o,s={},a={},d="",c="",u="",l=2,g=3,h=2,p=[],v=0,m=0;for(o=0;o<e.length;o+=1)if(d=e.charAt(o),{}.hasOwnProperty.call(s,d)||(s[d]=g++,a[d]=!0),c=u+d,{}.hasOwnProperty.call(s,c))u=c;else{if({}.hasOwnProperty.call(a,u)){if(256>u.charCodeAt(0)){for(n=0;h>n;n++)v<<=1,m===t-1?(m=0,p.push(i(v)),v=0):m++;for(r=u.charCodeAt(0),n=0;8>n;n++)v=v<<1|1&r,m===t-1?(m=0,p.push(i(v)),v=0):m++,r>>=1}else{for(r=1,n=0;h>n;n++)v=v<<1|r,m===t-1?(m=0,p.push(i(v)),v=0):m++,r=0;for(r=u.charCodeAt(0),n=0;16>n;n++)v=v<<1|1&r,m===t-1?(m=0,p.push(i(v)),v=0):m++,r>>=1}l--,0===l&&(l=Math.pow(2,h),h++),delete a[u]}else for(r=s[u],n=0;h>n;n++)v=v<<1|1&r,m===t-1?(m=0,p.push(i(v)),v=0):m++,r>>=1;l--,0===l&&(l=Math.pow(2,h),h++),s[c]=g++,u=d+""}if(""!==u){if({}.hasOwnProperty.call(a,u)){if(256>u.charCodeAt(0)){for(n=0;h>n;n++)v<<=1,m===t-1?(m=0,p.push(i(v)),v=0):m++;for(r=u.charCodeAt(0),n=0;8>n;n++)v=v<<1|1&r,m===t-1?(m=0,p.push(i(v)),v=0):m++,r>>=1}else{for(r=1,n=0;h>n;n++)v=v<<1|r,m===t-1?(m=0,p.push(i(v)),v=0):m++,r=0;for(r=u.charCodeAt(0),n=0;16>n;n++)v=v<<1|1&r,m===t-1?(m=0,p.push(i(v)),v=0):m++,r>>=1}l--,0===l&&(l=Math.pow(2,h),h++),delete a[u]}else for(r=s[u],n=0;h>n;n++)v=v<<1|1&r,m===t-1?(m=0,p.push(i(v)),v=0):m++,r>>=1;l--,0===l&&(l=Math.pow(2,h),h++)}for(r=2,n=0;h>n;n++)v=v<<1|1&r,m===t-1?(m=0,p.push(i(v)),v=0):m++,r>>=1;for(;;){if(v<<=1,m===t-1){p.push(i(v));break}m++}return p.join("")},this.compress=e=>{const t=this;return this._compress(e,16,(function(e){return t.f(e)}))},this.compressToUTF16=e=>{const t=this;return null===e?"":this._compress(e,15,(function(e){return t.f(e+32)}))+" "},this.compressToUint8Array=e=>{const t=this.compress(e),i=new Uint8Array(2*t.length);for(let e=0,n=t.length;n>e;e++){const n=t.charCodeAt(e);i[2*e]=n>>>8,i[2*e+1]=n%256}return i},this.compressToEncodedURIComponent=e=>{if(null===e)return"";const t=this;return this._compress(e,6,(function(e){return t.keyStrUriSafe.charAt(e)}))},this.f=String.fromCharCode,this.keyStrUriSafe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"}}},xe={name:"gioCustomTracking",method:class{constructor(e){this.growingIO=e,this.getDynamicAttributes=e=>(s(e)||L(e).forEach((t=>{h(e[t])?e[t]=e[t]():l(e[t])?j(e,t):p(e[t])||(e[t]=N(e[t]))})),e),this.buildCustomEvent=(e,t,i)=>{V(e,(()=>{const{dataStore:{eventContextBuilder:n,eventConverter:r}}=this.growingIO;let o=Object.assign({eventType:"CUSTOM",eventName:e,attributes:R(this.getDynamicAttributes(l(t)&&!P(t)?t:void 0))},n());P(i)||(o=Object.assign(Object.assign({},o),i)),r(o)}))},this.buildUserAttributesEvent=(e,t)=>{const{dataStore:{eventContextBuilder:i,eventConverter:n}}=this.growingIO;let r=Object.assign({eventType:"LOGIN_USER_ATTRIBUTES",attributes:R(e)},i());P(t)||(r=Object.assign(Object.assign({},r),t)),n(r)}}}},ke={},Le={}.hasOwnProperty;function Ae(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function De(e){try{return encodeURIComponent(e)}catch(e){return null}}ke.stringify=function(e,t){t=t||"";var i,n,r=[];for(n in"string"!=typeof t&&(t="?"),e)if(Le.call(e,n)){if((i=e[n])||null!=i&&!isNaN(i)||(i=""),n=De(n),i=De(i),null===n||null===i)continue;r.push(n+"="+i)}return r.length?t+r.join("&"):""},ke.parse=function(e){for(var t,i=/([^=?#&]+)=?([^&]*)/g,n={};t=i.exec(e);){var r=Ae(t[1]),o=Ae(t[2]);null===r||null===o||r in n||(n[r]=o)}return n};const je={gioprojectid:"projectId",giodatacollect:"dataCollect",gioappid:"domain",giodatasourceid:"dataSourceId",gios:"sessionId",giou:"uid",giocs1:"userId",giouserkey:"userKey",gioappchannel:"appChannel",giodevicebrand:"deviceBrand",giodevicemodel:"deviceModel",giodevicetype:"deviceType",giolanguage:"language",gionetworkstate:"networkState",giooperatingsystem:"operatingSystem",gioplatform:"platform",gioplatformversion:"platformVersion",gioscreenheight:"screenHeight",gioscreenwidth:"screenWidth"},Pe=["giodatasourceid","gioplatform","gioappchannel","giodevicebrand","giodevicemodel","giodevicetype","giolanguage","gionetworkstate","giooperatingsystem","gioplatformversion","gioscreenheight","gioscreenwidth"],Ue=["giocs1","gios","giou","giouserkey"],qe="gio_search_cookie_gioenc";var Be={name:"gioEmbeddedAdapter",method:class{constructor(e){this.growingIO=e,this.main=()=>{var e;const{projectId:t,appId:i}=this.growingIO.vdsConfig,n=this.getGQS();let r=!1;return"none"!==this.qsFrom&&n.gioprojectid===t&&n.gioappid===i&&(P(n)?this.growingIO.storage.removeItem(qe):this.growingIO.storage.setItem(qe,ke.stringify(n)),k(n,"giodatacollect")&&(this.growingIO.vdsConfig.dataCollect=O(["true",!0],n.giodatacollect)),null===(e=this.growingIO.emitter)||void 0===e||e.on("SDK_INITIALIZED",(()=>{const{userStore:e,vdsConfig:{sessionExpires:t},dataStore:{eventContextBuilderInst:i}}=this.growingIO;Ue.forEach((t=>{var i;e[je[t]]=null!==(i=n[t])&&void 0!==i?i:""})),window.setInterval((()=>{e.sessionId=n.gios}),.8*t*60*1e3),Pe.forEach((e=>{k(n,e)&&(i.minpExtraParams[je[e]]=n[e])}))})),this.growingIO.setUserId=()=>{},this.growingIO.clearUserId=()=>{},k(n,"giodatacollect")&&(this.growingIO.setOption=()=>{}),r=!0),this.gioURLRewrite(),r},this.getGQS=()=>{const{hashtag:e}=this.growingIO.vdsConfig,t=this.growingIO.storage.getItem(qe),i=window.location.search,n=window.location.hash,r=e?n.substring(n.indexOf("?")+1):"",o=ke.parse(i),s=ke.parse(r),a=ke.parse((t||"").replace("gioenc-",""));let d={};if(k(o,"gioprojectid"))d=o,this.qsFrom="search";else if(k(s,"gioprojectid"))d=s,this.qsFrom="hash";else{if(!k(a,"gioprojectid"))return this.qsFrom="none",{};d=a,this.qsFrom="cookie"}const c={},u={},l=["gioappid","gioprojectid","giodatacollect",...Ue,...Pe];return L(d).forEach((e=>{const t=e.toLowerCase();O(l,t)?O(["","undefined","null",void 0,null],d[e])||(c[t]=d[e],O(["true","TRUE",!0],d[e])&&(c[t]=!0),O(["false","FALSE",!1],d[e])&&(c[t]=!1)):u[e]=d[e]})),this.gqs=c,this.ngqs=u,c},this.gioURLRewrite=()=>{const{hashtag:e}=this.growingIO.vdsConfig;let t=window.location.search,i=window.location.hash,n=!1;if("search"===this.qsFrom&&(t=ke.stringify(this.ngqs,!0),n=!0),e&&"hash"===this.qsFrom&&(i=`${i.split("?")[0]}${ke.stringify(this.ngqs,!0)}`,n=!0),n){const e=`${window.location.pathname}${t||""}${i||""}`;window.history.replaceState(null,document.title,e)}},this.gqs={},this.ngqs={},this.qsFrom="search",this.growingIO.emitter.on(Ie,(()=>{this.growingIO.useEmbeddedInherit=this.main()}))}}},He=function(){return He=Object.assign||function(e){for(var t,i=1,n=arguments.length;n>i;i++)for(var r in t=arguments[i])({}).hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},He.apply(this,arguments)};function Ke(e,t,i){if(i||2===arguments.length)for(var n,r=0,o=t.length;o>r;r++)!n&&r in t||(n||(n=[].slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||[].slice.call(t))}var Fe=function(e){try{return e()}catch(e){return}},Re=function(e){return"number"===Qe(e)},Ge=function(e){return"object"===Qe(e)&&!function(e){return $e(["undefined","null"],Qe(e))}(e)},Ve=function(e){return Array.isArray(e)&&"array"===Qe(e)},Me=function(e,t){if(Ve(e))for(var i=0;i<e.length;i++)if(t(e[i]))return i;return-1},$e=function(e,t){return("array"===Qe(e)||"string"===Qe(e))&&e.indexOf(t)>=0},We=o,ze=function(e){return Ge(e)?Object.keys(e):[]},Je=function(e){return Ve(e)?0===e.length:Ge(e)?0===ze(e).length:!e},Xe=function(e){if(Ve(e)){for(var t=0,i=[],n=0,r=e;n<r.length;n++){var o=r[n];o&&!Je(o)&&(i[t++]=o)}return i}return e},Qe=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},Ze=["body","br","canvas","clippath","defs","desc","g","hr","html","iframe","math","param","path","rect","script","style","text","title","tspan","use"],Ye=["button","reset","submit"],et=Ke(Ke([],Ye,!0),["file"],!1),tt=["checkbox","color","radio","range"],it=Ke(Ke([],tt,!0),["date","datetime-local","month","number","password","text","time","week"],!1),nt=["tr","li","dt","dd"],rt=Ke(["a","button","dl"],nt,!0),ot=["i","em","svg","img"],st=["i","span","em","b","strong","bdo"],at=/(^| |[^ ]+\-)(clear|clearfix|active|hover|enabled|current|selected|unselected|hidden|display|focus|disabled|undisabled|open|checked|unchecked|undefined|null|ng-|growing-)[^\. ]*/g,dt=/^([a-zA-Z\-\_0-9]+)$/,ct="data-growing-ignore",ut="data-growing-container",lt="data-growing-index",gt="data-growing-title",ht=function(e,t){var i;return null!==(i=Fe((function(){return e.hasAttribute(t)&&"false"!==e.getAttribute(t)})))&&void 0!==i?i:Fe((function(){return e.hasOwnPerporty(t)}))},pt=function(e,t){var i;return null!==(i=Fe((function(){return e.getAttribute(t)})))&&void 0!==i?i:Fe((function(){return e.attributes[t].value}))},vt=function(e){var t,i=!$e(Ze,e.tagName.toLowerCase()),n=It(e);return i&&n&&$e(st,null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())?vt(n):e},mt=function(e,t,i){if(void 0===t&&(t=5),void 0===i&&(i=0),!e.children)return!1;if("svg"===e.tagName.toLocaleLowerCase())return i>t;if(i>t)return!0;for(var n=0;n<e.children.length;n++){var r=e.children[n];if(mt(r,t,i+1))return!0}return!1},ft=function(e,t){var i=e.tagName.toLowerCase();if(!(e instanceof Element))return!1;if(ht(e,ct))return!1;if($e(Ze,i))return!1;if($e(["circleClick","circleHover","click"],t)){if("textarea"===i&&"click"===t)return!1;if("input"===i){if("click"===t&&!$e(et,pt(e,"type")))return!1;if($e(["circleClick","circleHover"],t)&&!$e(Ke(Ke([],et,!0),it,!0),pt(e,"type")))return!1}if(!bt(e)&&mt(e,5))return!1}return!0},wt=function(e,t){return void 0===t&&(t=!1),We((null==e?void 0:e.childNodes)||[]).filter((function(e){return $e(t?[Node.ELEMENT_NODE,Node.TEXT_NODE]:[Node.ELEMENT_NODE],e.nodeType)}))},It=function(e){return yt(e.parentElement)?null:e.parentElement},yt=function(e){return!e||$e(["BODY","HTML","#document"],e.tagName)},bt=function(e){return ht(e,ut)||$e(rt,e.tagName.toLowerCase())||"input"===e.tagName.toLowerCase()&&$e(Ye,e.type)},Ot=function(e){var t=wt(e);return!Je(t)&&t.every((function(e){var t=Nt(e),i=$e(e.classList,"icon");return!(!t&&!i||St(e))}))},St=function(e){var t=wt(e,!0);return!Je(t)&&t.every((function(e){var t=e.nodeType===Node.TEXT_NODE,i=_t(e);return!(!t||!i)}))},Nt=function(e){return $e(ot,e.tagName.toLocaleLowerCase())},_t=function(e){var t=wt(e,!0).filter((function(e){var t;return e.nodeType===Node.TEXT_NODE||$e(st,null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase())})).map((function(e){return Et(e.textContent,e.textContent.length)}));return Et(Xe(t).join(" "))},Et=function(e,t){return void 0===t&&(t=50),e&&(null==(e=e.replace(/[\n \t]+/g," ").trim())?void 0:e.length)?e.slice(0,Re(t)&&t>0?t:void 0):""},Tt=/[^/]*.(bmp|jpg|jpeg|png|gif|svg|psd|webp|apng)/gi,Ct=function(e,t){switch(t){case"a":return function(e){if(ht(e,"href")){var t=pt(e,"href");if(t&&0!==t.indexOf("javascript"))return t.slice(0,320)}return""}(e);case"img":return function(e){var t=e.src;if(t&&-1===t.indexOf("data:image")){var i=t.match(Tt),n=Je(i)?"":i[0];if(n.indexOf("%")>-1){var r=function(e,t){var i=-1;if(Ve(e))for(var n=0;n<e.length;n++)"%"===e[n]&&(i=n);return i}(n.split(""));n=n.substring(r+3,n.length)}return n}return""}(e);default:return""}},xt={a:function(e){return _t(e)||At(e)||Ct(e,"a")},button:function(e){return pt(e,"name")||_t(e)||At(e)||Dt(e)},img:function(e){return Et(pt(e,"alt"))||Ct(e,"img")},input:function(e){if("password"===e.type)return"";var t,i,n=e instanceof HTMLInputElement&&$e(et,e.type),r=ht(e,"data-growing-track");if(n||r)return Et(e.value);if(e instanceof HTMLInputElement&&$e(tt,e.type)){var o=void 0;return e.id&&(i=function(t){return t.htmlFor===e.id},o=(t=We(document.getElementsByTagName("label")))[Me(t,i)]),o||(o=Lt(e,(function(e){return"label"===e.tagName.toLowerCase()}))),jt(e,o?_t(o):Et(e.value))}return""},label:function(e){return _t(e)||At(e)||Dt(e)},select:function(e){return Et(We(e.options).filter((function(e){return e.selected})).map((function(e){return e.label})).join(", ")||e.value)},svg:function(e){var t;return wt(e).some((function(e){var i;if(e.nodeType===Node.ELEMENT_NODE&&"use"===(null===(i=e.tagName)||void 0===i?void 0:i.toLowerCase())&&e.hasAttribute("xlink:href"))return t=e,!0})),t?t.getAttribute("xlink:href"):""},textarea:function(){return""},form:function(){return""}},kt=function(e,t){if(ht(e,gt)&&pt(e,gt))return Et(pt(e,gt));if(ht(e,"title")&&pt(e,"title"))return Et(pt(e,"title"));var i=xt[t];if(i)return i(e);var n=_t(e);return n?Et(n):function(e){if("svg"===e.tagName)return!1;var t=wt(e);return t.length>0&&t.every((function(e){return function(e){if("svg"===e.tagName)return!0;var t=wt(e);if(Je(t))return!0;var i=St(e);return!(!Je(t)&&!i)}(e)}))}(e)&&!Ot(e)?Et(At(e)):Ot(e)?Et(Dt(e)):""},Lt=function(e,t){for(var i=e.parentElement;i&&!yt(i);){if(t(i))return i;i=i.parentElement}},At=function(e){var t=wt(e);return Xe(t.map((function(e){var t=_t(e);if(St(e)&&t)return t}))).join(" ")},Dt=function(e){var t;return wt(e).some((function(e){var i,n=kt(e,null===(i=e.tagName)||void 0===i?void 0:i.toLowerCase());return!!n&&(t=n,!0)})),t},jt=function(e,t){return $e(["checkbox","radio"],e.type)?"".concat(t).concat((i=e.checked,"boolean"===Qe(i)?"("+e.checked+")":"")):t;var i},Pt=function e(t,i,n,r,o){void 0===r&&(r=!0),void 0===o&&(o=[]);var s,a=this;this.originNode=t,this.deviceInfo=i,this.actionType=n,this.trackable=r,this.parentNodes=o,this.isLimitViewport=!0,this._getIndex=function(){if(ht(a.originNode,lt)){var e=pt(a.originNode,lt);return/^\d{1,10}$/.test(e)&&e-0>0&&2147483647>e-0?+e:void(0>a.actionType.indexOf("circle")&&(d="".concat(e,"，index标记应为 大于 0 且小于 2147483647 的整数！"),console.log("%c [GrowingIO]：".concat(d),"color: #F59E0B;")))}if($e(["dd","dt"],a.tagName)){var t=It(a.originNode),i=t?wt(t):[];if("dl"===t.tagName.toLowerCase()&&i.length>0){if("dd"===a.tagName){var n=Me(i,(function(e){return e.isSameNode(a.originNode)}));if(n>-1)return(r=i.slice(0,n).filter((function(e){return"dt"===e.tagName.toLowerCase()}))).length-1+1}if("dt"===a.tagName){var r=i.filter((function(e){return"dt"===e.tagName.toLowerCase()}));return Me(r,(function(e){return e.isSameNode(a.originNode)}))+1}}}if(a.isPureList){var o=Me(a._pureList,(function(e){return e.isSameNode(a.originNode)}));return o>-1?(a.peerNodes=Ke([],a._pureList,!0),a.peerNodes.splice(o,1),o+1):void 0}if(a.isPseudoList){var s=Me(a._pseudoList,(function(e){return e.isSameNode(a.originNode)}));return s>-1?(a.peerNodes=Ke([],a._pseudoList,!0),a.peerNodes.splice(s,1),s+1):void 0}var d},this._getSiblingNode=function(e,t){var i,n=It(e);if(!n)return[];for(var r=null!==(i=Fe((function(){return We(n.children)})))&&void 0!==i?i:[],o=[],s=0;s<r.length;s++){var a=r[s],d=r[s+1];if(!d||!t(a,d))break;Je(o)?o.push(a,d):o.push(d)}return o},this._getIsPureList=function(){var e=a._getSiblingNode(a.originNode,(function(e,t){return e.tagName===t.tagName}));return!(1>e.length||!$e(nt,a.tagName)||(a._pureList=e,0))},this._getIsInPseudoList=function(){if($e(["th","td"],a.tagName))return!1;var e=a._getSiblingNode(a.originNode,(function(e,t){var i=e.tagName===t.tagName&&e.className===t.className,n=wt(e),r=wt(t),o=n.every((function(e,t){var i,n;return(null==e?void 0:e.tagName)===(null===(i=r[t])||void 0===i?void 0:i.tagName)&&(null==e?void 0:e.className)===(null===(n=r[t])||void 0===n?void 0:n.className)})),s=n.length===r.length&&o;return i&&s}));return e.length>=3&&(a._pseudoList=e,!0)},this._getClassList=function(e){var t;if(ht(e,"name")&&pt(e,"name"))return[pt(e,"name")];var i=(null!==(t=pt(e,"class"))&&void 0!==t?t:"").trim().split(" ");return Je(i)?[]:i.filter((function(e){return e&&!at.test(e)&&dt.test(e)})).sort()},this._getCurrentXpath=function(){return"/".concat(a.tagName).concat(a.id?"#"+a.id:"").concat(Je(a.classList)?"":"."+a.classList.join("."))},this._getIsContainer=function(){return ht(a.originNode,ut)||$e(rt,a.tagName)||"input"===a.tagName&&$e(Ye,a.originNode.type)},this._getContent=function(){a.content=kt(a.originNode,a.tagName)},this._getIsOutFlow=function(){var e=window.getComputedStyle(a.originNode).position;return $e(["fixed","sticky"],e)},this._getRect=function(){var e=a.originNode.getBoundingClientRect(),t=e.top,i=e.bottom,n=e.left,r=e.right-n,o=i-t,s=a.deviceInfo,d=s.winHeight,c=s.winWidth;return t+o>d&&(o=d-t),n+r>c&&(r=c-n),{top:t,left:n,width:r,height:o}},this._getListItemViewStatus=function(){var e=a.parentNodes.find((function(e){var t=e.originNode,i=t.scrollHeight,n=t.scrollWidth,r=t.clientHeight,o=t.clientWidth,s=e.rect,a=s.width,d=s.height;return r!==i&&i>d||o!==n&&n>a}));if(e){var t=e.rect,i=t.top,n=t.left,r=t.width,o=t.height,s=a.rect,d=s.top,c=s.left,u=s.width,l=s.height;return i>d+l||c>n+r||d>i+o||n>c+u?"OUTSIDE":d>=i&&c>=n&&i+o>d+l&&n+r>c+u?"DISPLAYED":"OBSCURED"}return""},this._getViewStatus=function(e){var t=window.getComputedStyle(a.originNode),i=t.opacity,n=t.visibility,r=t.display,o=t.width,s=t.height,d=a.rect,c=d.top,u=d.left,l=d.width,g=d.height,h=a.deviceInfo,p=h.winWidth,v=h.winHeight;if(0===Number(i)||"hidden"===n||"none"===r||"0px"===o||0===a.originNode.clientWidth||"0px"===s||0===a.originNode.clientHeight)return"HIDDEN";var m=Ke([],e,!0).find((function(e){return e.trackable&&$e(["DISPLAYED","OBSCURED"],e.viewStatus)}));if(a.isPureList||a.isPseudoList){var f=a._getListItemViewStatus();if(f)return f}if(m)return m.viewStatus;var w=function(e,t){return document.elementFromPoint(e,t)===a.originNode};return v>c&&p>u&&l>0&&g>0?w(u+l/2,c+g/2)||w(u+1,c+1)||w(u+l-1,c+1)||w(u+1,c+g-1)||w(u+l-1,c+g-1)?"DISPLAYED":a.isLimitViewport&&(0>c+g||0>u+l)?"OUTSIDE":"OBSCURED":"OUTSIDE"},this._getTriggerEvent=function(){return"input"===a.tagName&&$e(it,a.originNode.type)||$e(["select","textarea"],a.tagName)?"VIEW_CHANGE":"VIEW_CLICK"},this._getXParents=function(t,i){var n=t.parentElement,r=[];if(i.length>0)r.push.apply(r,i);else if(n&&!yt(n)){var o=new e(n,void 0,a.actionType,ft(n,a.actionType));r.push(o),o.xParents&&r.push.apply(r,o.xParents)}return r},this.tagName=t.tagName.toLocaleLowerCase(),this.classList=this._getClassList(t),this.id=t.id,this.currentXpath=this._getCurrentXpath(),this.isIgnored=ht(this.originNode,ct),this.isContainer=this._getIsContainer(),this.isPureList=this._getIsPureList(),this.isPseudoList=this._getIsInPseudoList(),this.index=this._getIndex(),this.hyperlink=Ct(t,this.tagName),this.content=kt(this.originNode,this.tagName),this.triggerEvent=this._getTriggerEvent(),this.isOutFlow=this._getIsOutFlow(),i&&(this.isLimitViewport=null===(s=i.isLimitViewport)||void 0===s||s,this.rect=this._getRect(),this.viewStatus=this._getViewStatus(o)),this.xParents=this._getXParents(t,o)},Ut=function e(t,i,n,r,o){var s=this;this.origin=t,this.action=i,this.lengthThreshold=n,this.deviceInfo=r,this.parentNode=o,this.trackNodes=function(){var e;if(!s.trackable)return[];var t=[s.xNode];if($e(["click","circleClick","change"],s.actionType))for(var i=s._getParent();i;){if(!(null==i?void 0:i.xNode)||(null===(e=i.xNode)||void 0===e?void 0:e.isIgnored))return[];i.trackable&&t.push(i.xNode),i=i._getParent()}var n,r=[];return t.reverse().forEach((function(e,i){if(ht(e.originNode,ut)&&(r=[],n=void 0),Re(e.index)&&!Re(n)&&(n=e.index),Re(n)&&(e.index=n),i===t.length-1)r.push(s.getGioNodeInfo(e));else{var o=e.isPureList||e.isPseudoList;(e.isContainer||o)&&r.push(s.getGioNodeInfo(e))}})),r},this.getGioNodeInfo=function(e){var t=s.computeXpath(e),i=t.skeleton,n=t.fullXpath,r=t.xcontent,o=e.hyperlink,a=e.index,d=e.peerNodes,c=e.content,u=e.triggerEvent,l=e.originNode;return{skeleton:i,xpath:i,fullXpath:n,xcontent:r,hyperlink:o,index:a,peerNodes:null!=d?d:[],content:Et(c),triggerEvent:u,originNode:l}},this.computeXpath=function(e){var t,i="/"+e.tagName,n=e.currentXpath,r="/"+((e.id?"#"+e.id:"")+(Je(e.classList)?"":"."+e.classList.join("."))||"-");return null===(t=e.xParents)||void 0===t||t.forEach((function(e,t){if(n=e.currentXpath+n,t<s.xpathThreshold-1){i="/"+e.tagName+i;var o=(e.id?"#"+e.id:"")+(Je(e.classList)?"":"."+e.classList.join("."));r="/"+(o||"-")+r}})),{skeleton:i,fullXpath:n,xcontent:r}},this._getParent=function(){var t=It(s.originElement);if(t&&t.nodeName&&!yt(t))return new e(t,s.actionType)},this.actionType=$e(["circleClick","circleHover","click","change"],i)?i:"click",this.originElement=vt(t),this.xpathThreshold=Re(n)?n:4,this.trackable=ft(this.originElement,this.actionType),this.originElement.isSameNode(t)||(o=null);var a=[];o&&o.xNode&&(a.push(o.xNode),o.xNode.xParents&&a.push.apply(a,o.xNode.xParents)),this.xNode=new Pt(this.originElement,this.deviceInfo,this.actionType,this.trackable,a)},qt=[],Bt=function(e,t){var i,n,r,o,s,a,d,c=this;this.trackNodes=function(e,t,i){return void 0===i&&(i=!1),qt=[],c._getTrackElements(e,t,null,i),qt},this._getTrackElements=function(e,t,i,n){void 0===n&&(n=!1),wt(e).forEach((function(e){var r,o,s,a;if(!(null==e?void 0:e.tagName)||$e(["circle-shape","circle-page","heatmap-page"],null===(r=null==e?void 0:e.tagName)||void 0===r?void 0:r.toLowerCase())||(null===(o=null==e?void 0:e.id)||void 0===o?void 0:o.indexOf("__vconsole"))>-1||(null===(s=null==e?void 0:e.id)||void 0===s?void 0:s.indexOf("__giokit"))>-1)return!1;var d=new Ut(e,"circleClick",c.xpathThreshold,c.deviceInfo,i),u=d.xNode;if(u.zLevel=c._getZLevel(e,t),d.trackable&&($e(["DISPLAYED","OBSCURED"],u.viewStatus)||n)){if(t.index&&(u.index=t.index),qt.find((function(e){return e.originNode.isSameNode(u.originNode)})))return!1;if("DISPLAYED"===u.viewStatus){var l=c._getGioHybridNodeInfo(d,t);qt.push(l)}else"OBSCURED"===u.viewStatus&&(u.isContainer||n)&&(l=c._getGioHybridNodeInfo(d,t),qt.push(l));if(Nt(e)||u.isContainer&&St(e))return!1}Je(wt(e))||c._getTrackElements(e,null!==(a=d.xNode)&&void 0!==a?a:t,d,n)}))},this._getZLevel=function(e,t){var i=window.getComputedStyle(e),n=i.position,r=i.zIndex;if("auto"!==r){var o=Number(r||0);return(Number.isNaN(o)?0:o)+t.zLevel}switch(n){case"relative":return t.zLevel+2;case"sticky":return t.zLevel+3;case"absolute":return t.zLevel+4;case"fixed":return t.zLevel+5;default:return t.zLevel+1}},this._getGioHybridNodeInfo=function(e,t){var i=e.xNode,n=i.rect,r=i.zLevel,o=e.getGioNodeInfo(i),s=o.hyperlink,a={};return ze(n).forEach((function(e){return a[e]=n[e]*c.deviceInfo.scale})),a.top+=c.deviceInfo.webviewTop,a.left+=c.deviceInfo.webviewLeft,He(He(He({},a),o),{zLevel:r+c.deviceInfo.webviewZLevel,href:s,parentXPath:t.trackable?e.computeXpath(t).xpath:void 0})},this.xpathThreshold=t,this.deviceInfo=(n=(i=e).webviewLeft,r=i.webviewTop,o=i.webviewWidth,s=i.webviewHeight,a=i.webviewZLevel,d=i.isLimitViewport,{winWidth:o,winHeight:s,scale:o/window.innerWidth,webviewTop:r,webviewLeft:n,webviewWidth:o,webviewHeight:s,webviewZLevel:a,isLimitViewport:d})};class Ht{constructor(e){this.handler=e;const t=navigator.userAgent,i=/chrome/i.exec(t),n=/android/i.exec(t);this.hasTouch="ontouchstart"in window&&!(i&&!n)}main(){const e=this.hasTouch?["touchstart"]:["mousedown"],t=this.hasTouch?["touchend","touchcancel"]:["mouseup","mouseleave"],i=this.hasTouch?["touchmove"]:["mousemove"];for(const t of e)G(window,t,this.touchStartHandler.bind(this));for(const e of i)G(window,e,this.touchMoveHandler.bind(this));for(const e of t)G(window,e,this.touchStopHandler.bind(this))}touchStartHandler(e){if(e.which>1)return;const t=+Date.now();this.safeguard!==t&&(this.touchTimeout&&clearTimeout(this.touchTimeout),this.safeguard=t,this.touchEvent={time:t,target:e.target,x:this._page("x",e),y:this._page("y",e),isTrusted:!0,type:"click"})}touchMoveHandler(e){const t=Math.abs(this._page("x",e)-(this.touchEvent&&this.touchEvent.x)||0),i=Math.abs(this._page("y",e)-(this.touchEvent&&this.touchEvent.y)||0);(t>10||i>10)&&(this.touchEvent=null)}touchStopHandler(e){const t=+Date.now()-(this.touchEvent&&this.touchEvent.time)||0;this.touchEvent&&200>t?this.touchTimeout=setTimeout((()=>{this.handler(this.touchEvent),this.touchEvent=null}),200):this.touchEvent&&t>=200&&700>t&&(this.handler(this.touchEvent),this.touchEvent=null)}_page(e,t){return(this.hasTouch?t.touches[0]:t)["page"+e.toUpperCase()]}}const Kt={click:"VIEW_CLICK",change:"VIEW_CHANGE"};var Ft={name:"gioEventAutoTracking",method:class{constructor(e){this.growingIO=e,this.main=()=>{G(document,"change",this._handleAction);const{vdsConfig:e}=this.growingIO;e.touch?new Ht(this._handleAction).main():G(document,"click",this._handleAction)},this._handleAction=(e,t)=>{var i,n,r,o;const{vdsConfig:s,emitter:a}=this.growingIO,d=e.target;if(!s.autotrack||!d)return!1;if(!(null==d?void 0:d.tagName)||"circle-shape"===(null===(i=null==d?void 0:d.tagName)||void 0===i?void 0:i.toLowerCase())||"heatmap-page"===(null===(n=null==d?void 0:d.tagName)||void 0===n?void 0:n.toLowerCase())||(null===(r=null==d?void 0:d.id)||void 0===r?void 0:r.indexOf("__vconsole"))>-1||(null===(o=null==d?void 0:d.id)||void 0===o?void 0:o.indexOf("__giokit"))>-1)return!1;let c=new Ut(d,e.type).trackNodes();if(P(c))return!1;"click"!==e.type&&(c=[f(c)]),null==a||a.emit("onComposeBefore",{event:t,params:null!=e?e:{}}),c.forEach((t=>{const{fullXpath:i,skeleton:n,xcontent:r,index:o,content:a,hyperlink:d}=t;if(0>i.indexOf("#__giokit")&&0>i.indexOf("#__vconsole")&&(s.debug&&console.log("Action：",e.type,Date.now()),i)){const{dataStore:{eventContextBuilder:t,eventConverter:i}}=this.growingIO;i(Object.assign({eventType:Kt[e.type],element:[{xpath:n,xcontent:r,textValue:a,index:o,hyperlink:d}]},t()))}}))}}}};let Rt;const Gt=["VIEW_CLICK","VIEW_CHANGE","FORM_SUBMIT","PAGE","CUSTOM","LOGIN_USER_ATTRIBUTES"],Vt=["LOGIN_USER_ATTRIBUTES"],Mt=["DOMContentLoaded","onreadystatechange"],$t=["scroll","resize","load","beforeunload","popstate","hashchange","pagehide","unload"];var Wt={name:"gioHybridAdapter",method:class{constructor(e){var t;this.growingIO=e,this.penetrateHybrid=!0,this.onOptionsInit=()=>{const{vdsConfig:e,emitter:t}=this.growingIO;u(e.penetrateHybrid)&&(this.penetrateHybrid=e.penetrateHybrid),this._initHybridBridge()&&(this.onSendBefore=this.sendBeforeListener,this.hybridConfig.projectId===this.growingIO.vdsConfig.projectId&&(this.growingIO.useHybridInherit=!0)),this.growingIO.useHybridInherit&&(null==t||t.on(Se,(({newUserId:e,oldUserId:t,userKey:i})=>{this.penetrateHybrid&&(!e&&t?i?this._clearNativeUserIdAndUserKey():this._clearNativeUserId():i?this._setNativeUserIdAndUserKey(N(e),N(i)):this._setNativeUserId(N(e)))})),null==t||t.on(Ne,(({newUserKey:e,oldUserKey:t,userId:i})=>{this.penetrateHybrid&&(!e&&t?this._clearNativeUserIdAndUserKey():this._setNativeUserIdAndUserKey(N(i),N(e)))})))},this._initHybridBridge=()=>{var e,t,i;let n=!1;return this.hasHybridBridge=!!window.GrowingWebViewJavascriptBridge,this.hasHybridBridge?((null===(e=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===e?void 0:e.configuration)||(window.GrowingWebViewJavascriptBridge.configuration=JSON.parse(window.GrowingWebViewJavascriptBridge.getConfiguration())),(null===(t=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===t?void 0:t.configuration)&&(this.hybridConfig=null===(i=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===i?void 0:i.configuration),n=!0):Rt.consoleText("gioHybridAdapter：当前不存在 GrowingWebViewJavascriptBridge，Web模式。","info"),n},this.sendBeforeListener=({requestData:e})=>{if(this.hasHybridBridge){const t=this.processAttributes(Object.assign({},e));O(Gt,t.eventType)&&(O(Vt,t.eventType)?this.penetrateHybrid&&this._dispatchEvent(t):(this.penetrateHybrid||j(t,["userId","userKey","cs1"]),this._dispatchEvent(t)))}},this.processAttributes=e=>(A(e,((t,i)=>{l(t)||p(t)?A(e[i],((t,n)=>{l(t)||p(t)?e[i][n]=JSON.stringify(t):e[i][n]=N(t)})):e[i]=N(t)})),e),this._setNativeUserId=e=>{H((()=>window.GrowingWebViewJavascriptBridge.setNativeUserId(e)))},this._clearNativeUserId=()=>{H((()=>window.GrowingWebViewJavascriptBridge.clearNativeUserId()))},this._setNativeUserIdAndUserKey=(e,t)=>{H((()=>window.GrowingWebViewJavascriptBridge.setNativeUserIdAndUserKey(e,t)))},this._clearNativeUserIdAndUserKey=()=>{H((()=>window.GrowingWebViewJavascriptBridge.clearNativeUserIdAndUserKey()))},this._dispatchEvent=e=>{H((()=>{var t;return null===(t=window.GrowingWebViewJavascriptBridge)||void 0===t?void 0:t.dispatchEvent(JSON.stringify(e))}))},this._getDomTree=(e,t,i,n,r,o)=>{const s=new Bt({webviewLeft:e,webviewTop:t,webviewWidth:i,webviewHeight:n,webviewZLevel:r}).trackNodes(null!=o?o:document.body,{isContainer:!1,zLevel:0}).map((e=>(j(e,["originNode","peerNodes"]),e))),{domain:a,path:d,query:c,title:u}=this.growingIO.dataStore.currentPage;return{page:{domain:a,path:d,query:c,title:u},elements:s}};const{emitter:i,utils:n}=this.growingIO;Rt=n,i.on(Ie,this.onOptionsInit),null===(t=this.growingIO.emitter)||void 0===t||t.on(ye,(()=>{if(window.GrowingWebViewJavascriptBridge){const e=this;window.GrowingWebViewJavascriptBridge.getDomTree=function(){if(arguments.length>=4)return e._getDomTree.apply(this,arguments)},this._addDomChangeListener()}}))}_addDomChangeListener(){let e;const t=(t="")=>()=>{var i;"beforeunload"===t&&e&&e.disconnect(),null===(i=window.GrowingWebViewJavascriptBridge)||void 0===i||i.onDomChanged()};e=new MutationObserver(t("mutation")),e.observe(document.body,{attributes:!0,characterData:!0,childList:!0,subtree:!0}),Mt.forEach((e=>{G(document,e,t(e))})),$t.forEach((e=>{G(window,e,t(e))}))}}},zt={name:"gioImpressionTracking",method:class{constructor(e){var t;this.growingIO=e,this.documentReady=!1,this.main=e=>{"listener"===e?(this.documentReady=!0,this.growingIO.gioSDKInitialized&&this.initMutationObserver()):"emitter"===e&&this.documentReady&&this.initMutationObserver()},this.initIntersectionObserver=()=>{this.intersectionObserver=new IntersectionObserver((e=>{P(e)||e.map((e=>{const{dataset:t}=e.target;if(e.intersectionRatio>0){const{eventId:e,properties:i}=this.getImpressionProperties(t),n=t.id;if(n){if("once"===t.gioImpType&&k(this.sentImps,n))return;this.sentImps[n]={eventId:e,properties:i}}e&&this.buildImpEvent({eventId:e,properties:i})}}))}))},this.initMutationObserver=()=>{if(this.mutationObserver)return!1;const e=document.querySelectorAll("[data-gio-imp-track]");S(e).map((e=>{var t;null===(t=this.intersectionObserver)||void 0===t||t.observe(e)})),this.mutationObserver=new MutationObserver((e=>e.map((e=>{var t;if("attributes"===e.type){const{dataset:i}=e.target;if(i.gioImpTrack)return null===(t=this.intersectionObserver)||void 0===t?void 0:t.observe(e.target)}})))),this.mutationObserver.observe(document.body,{attributes:!0,childList:!0,subtree:!0,attributeOldValue:!0,attributeFilter:["data-gio-imp-track","data-gio-imp-attrs",/^data-gio-track-[a-z]+$/i]})},this.getImpressionProperties=e=>{let t={eventId:void 0,properties:{}};if(!(null==e?void 0:e.gioImpTrack))return t;if(t.eventId=e.gioImpTrack,k(e,"gioImpAttrs"))t.properties=H((()=>l(e.gioImpAttrs)?e.gioImpAttrs:JSON.parse(e.gioImpAttrs)));else{const i=/^gioTrack(.+)/;for(const n in e){let r;const o=n.match(i);o&&(r=E(o[1]),"track"!==r&&(t.properties[r]=e[n]))}}return t.properties=R(t.properties),/^\w+$/.test(t.eventId)&&!Number.isInteger(Number(m(t.eventId.split(""))))||(t.eventId=null,t={}),t},this.buildImpEvent=e=>{const{eventId:t,properties:i}=e,{dataStore:{eventContextBuilder:n,eventConverter:r}}=this.growingIO;r(Object.assign(Object.assign({eventType:"CUSTOM",eventName:t,attributes:i},n()),{customEventType:0}))},this.sentImps={},window.IntersectionObserver&&window.MutationObserver?(this.initIntersectionObserver(),G(document,"readystatechange",(()=>{O(["interactive","complete"],document.readyState)&&this.main("listener")}),{once:!0}),null===(t=this.growingIO.emitter)||void 0===t||t.on(ye,(()=>this.main("emitter"))),G(window,"unload",(()=>{var e,t;null===(e=this.intersectionObserver)||void 0===e||e.disconnect(),null===(t=this.mutationObserver)||void 0===t||t.disconnect()}))):B("当前浏览器不支持半自动埋点，gioImpressionTracking已自动关闭！","warn")}}};const Jt=["gioPerformance"];class Xt{constructor(e){var t,i,n,r;this.growingIO=e,this.innerPluginInit=()=>{var e;Jt.forEach((e=>{var t;return j(null===(t=this.pluginsContext)||void 0===t?void 0:t.plugins,e)})),L(null===(e=this.pluginsContext)||void 0===e?void 0:e.plugins).forEach((e=>{var t,i;const{name:n,method:r}=null!==(i=null===(t=this.pluginsContext)||void 0===t?void 0:t.plugins[e])&&void 0!==i?i:{},o=y(this.pluginItems,(e=>e.name===n));o||this.pluginItems.push({name:E(n||e),method:r||(e=>{})})})),P(this.pluginItems)||this.installAll()},this.install=(e,t,i)=>{var n,r;const o=t||y(this.pluginItems,(t=>t.name===e));if((null===(n=this.growingIO)||void 0===n?void 0:n.plugins)[e])return B(`重复加载插件 ${e} 或插件重名，已跳过加载!`,"warn"),!1;if(!o)return B(`插件加载失败!不存在名为 ${e} 的插件!`,"error"),!1;try{return(null===(r=this.growingIO)||void 0===r?void 0:r.plugins)[e]=new o.method(this.growingIO,i),t&&B("加载插件 "+e,"info"),!0}catch(t){return B(`插件【${e}】加载异常 ${t}`,"error"),!1}},this.installAll=e=>{(e||this.pluginItems).forEach((t=>{this.install(t.name,e?t:void 0,e?null==t?void 0:t.options:void 0)&&!y(this.pluginItems,(e=>e.name===t.name))&&this.pluginItems.push({name:E(t.name),method:t.method?t.method:()=>{}})}))},this.uninstall=e=>{var t;j(this.pluginItems,e);const i=j(null===(t=this.growingIO)||void 0===t?void 0:t.plugins,e);return i||B(`卸载插件 ${e} 失败!`,"error"),i},this.uninstallAll=()=>{this.pluginItems.forEach((e=>this.uninstall(e.name)))},this.lifeError=(e,t)=>B(`插件执行错误 ${e.name} ${t}`,"error"),this.onComposeBefore=e=>{this.pluginItems.forEach((t=>{var i;const n=null===(i=this.growingIO.plugins[t.name])||void 0===i?void 0:i.onComposeBefore;if(n&&h(n))try{n(e)}catch(e){this.lifeError(t,e)}}))},this.onComposeAfter=e=>{this.pluginItems.forEach((t=>{var i;const n=null===(i=this.growingIO.plugins[t.name])||void 0===i?void 0:i.onComposeAfter;if(n&&h(n))try{n(e)}catch(e){this.lifeError(t,e)}}))},this.onSendBefore=e=>{this.pluginItems.forEach((t=>{var i;const n=null===(i=this.growingIO.plugins[t.name])||void 0===i?void 0:i.onSendBefore;if(n&&h(n))try{n(e)}catch(e){this.lifeError(t,e)}}))},this.onSendAfter=e=>{this.pluginItems.forEach((t=>{var i;const n=null===(i=this.growingIO.plugins[t.name])||void 0===i?void 0:i.onSendAfter;if(n&&h(n))try{n(e)}catch(e){this.lifeError(t,e)}}))},this.pluginsContext={plugins:{}},this.pluginItems=[],null===(t=this.growingIO.emitter)||void 0===t||t.on("onComposeBefore",this.onComposeBefore),null===(i=this.growingIO.emitter)||void 0===i||i.on("onComposeAfter",this.onComposeAfter),null===(n=this.growingIO.emitter)||void 0===n||n.on("onSendBefore",this.onSendBefore),null===(r=this.growingIO.emitter)||void 0===r||r.on("onSendAfter",this.onSendAfter)}}class Qt extends Xt{constructor(e){super(e),this.growingIO=e,this.growingIO.gioSDKFull=!0,this.pluginsContext={plugins:{gioCompress:Ce,gioCustomTracking:xe,gioEmbeddedAdapter:Be,gioEventAutoTracking:Ft,gioHybridAdapter:Wt,gioImpressionTracking:zt}}}}class Zt{constructor(e){this.growingIO=e,this.generateHost=()=>{const{serverUrl:e,projectId:t}=this.growingIO.vdsConfig;return T(e,"http")?`${e}/v3/projects/${t}/collect`:`https://${e}/v3/projects/${t}/collect`},this.getSendType=()=>{const{sendType:e}=this.growingIO.vdsConfig;return"beacon"===e?(()=>{var e;const t=!!(null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.sendBeacon),i=window.navigator.userAgent;if(i.match(/(iPad|iPhone|iPod)/g)){const e=(e=>{const t=e.toLowerCase().match(/cpu.*os (.*?) like mac os/i);return!t||2>t.length?0:+t[1].split("_").slice(0,2).join(".")})(i);return t&&e>13}return t})()?"beacon":"xhr":e},this.commitRequest=(e,t)=>{const{forceLogin:i}=this.growingIO.vdsConfig,n=Object.assign(Object.assign({},e),{requestType:this.getSendType()});i?this.hoardingQueue.push(n):(this.requestQueue.push(n),this.initiateRequest(t))},this.initiateRequest=e=>{var t,i;if([...this.hoardingQueue,...this.requestQueue].length>0&&this.requestingNum<this.requestLimit){const{vdsConfig:n,emitter:r,plugins:o,useHybridInherit:s}=this.growingIO;if(this.requestQueue=[...this.hoardingQueue,...this.requestQueue].filter((e=>(this.retryIds[e.requestId]||0)<=this.retryLimit)),this.hoardingQueue=[],P(this.requestQueue))return;const a=this.requestQueue.shift(),{requestType:d}=a;null==r||r.emit("onSendBefore",{requestData:Object.assign({},a)});const c=Object.assign({},a);if(j(c,["requestType","trackingId","requestId","customEventType"]),n.debug&&console.log("[GrowingIO Debug]:",JSON.stringify(c,null,2).replace(/\"/g,(()=>{const e=window.navigator.userAgent;return/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(e)&&!/chrome\/(\d+\.\d+)/i.test(e)})()?"":'"')),this.requestingNum+=1,s)return this.requestSuccessFn(a),!1;let u=Object.assign({},c);n.compress&&(null==o?void 0:o.gioCompress)?(this.compressType="1",u="image"===d?null===(t=null==o?void 0:o.gioCompress)||void 0===t?void 0:t.compressToUTF16(JSON.stringify([u])):null===(i=null==o?void 0:o.gioCompress)||void 0===i?void 0:i.compressToUint8Array(JSON.stringify([u]))):(this.compressType="0",u=JSON.stringify([u]));const l=this.generateURL(null!=e?e:this.requestURL);switch(d){case"beacon":default:this.sendByBeacon(a,u,l);break;case"xhr":this.sendByXHR(a,u,l);break;case"image":this.sendByImage(a,u,l)}}},this.generateURL=e=>`${e}?stm=${+Date.now()}&compress=${this.compressType}`,this.sendByBeacon=(e,t,i)=>{navigator.sendBeacon(i,t)?this.requestSuccessFn(e):this.requestFailFn(e,"beacon")},this.sendByXHR=(e,t,i)=>{var n;const r=O(["unload","beforeunload","pagehide"],null===(n=null===window||void 0===window?void 0:window.event)||void 0===n?void 0:n.type),o=new XMLHttpRequest;if(o)return o.open("POST",i,r),o.onreadystatechange=()=>{4===o.readyState&&204===o.status?this.requestSuccessFn(e):this.requestFailFn(e,"xhr")},o.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),void o.send(t);if(null===window||void 0===window?void 0:window.XDomainRequest){const n=new window.XDomainRequest;n.open("POST",i.replace("https://","http://"),r),n.onload=()=>{204===n.status?this.requestSuccessFn(e):this.requestFailFn(e,"xhr")},n.onerror=n.ontimeout=()=>{this.requestFailFn(e,"xhr")},n.send(t)}},this.sendByImage=(e,t,i)=>{const n=`${i}&data=${t}`;let r=document.createElement("img");r.width=1,r.height=1,r.onload=()=>{this.requestSuccessFn(e),this.clearImage(r)},r.onerror=r.onabort=()=>{this.requestSuccessFn(e),this.clearImage(r)},r.src=n},this.clearImage=e=>{e.src="",e.onload=()=>{},e.onerror=e.onerabort=()=>{},e=null},this.requestSuccessFn=e=>{var t;this.requestingNum-=1;const i=e.requestId||-1;this.retryIds[i]&&(this.retryIds[i]=0),e.trackingId===this.growingIO.trackingId&&(this.growingIO.userStore.sessionId=e.sessionId),null===(t=this.growingIO.emitter)||void 0===t||t.emit("onSendAfter",{requestData:Object.assign({},e)}),this.initiateRequest()},this.requestFailFn=(e,t)=>{this.requestingNum-=1;const i=e.requestId||-1;this.retryIds[i]||(this.retryIds[i]=0),this.retryIds[i]+=1;const n=this.requestQueue.some((t=>t.requestId===e.requestId));let r=t;if(this.retryIds[i]<this.retryLimit+1||(r="beacon"===t?"xhr":"xhr"===t?"image":void 0,this.retryIds[i]=0),!n&&r){let t=window.setTimeout((()=>{P(this.requestQueue)?(this.requestQueue.push(Object.assign(Object.assign({},e),{requestType:r})),this.initiateRequest()):this.requestQueue.push(Object.assign(Object.assign({},e),{requestType:r})),window.clearTimeout(t),t=null}),800)}},this.hoardingQueue=[],this.requestQueue=[],this.requestLimit=10,this.requestTimeout=5e3,this.retryLimit=1,this.retryIds={},this.requestingNum=0,this.requestURL=this.generateHost()}}class Yt{constructor(e){this.growingIO=e,this.transferStorage=()=>{const{vdsConfig:{projectId:e},storage:t}=this.growingIO;this.uid=t.getItem("gr_user_id")||this.uid,this.userId=t.getItem(e+"_gr_cs1")||this.userId,t.removeItem("gr_user_id"),t.removeItem(e+"_gr_cs1"),t.removeItem(e+"_gr_last_sent_cs1"),t.removeItem(e+"_gr_last_sent_sid_with_cs1"),t.removeItem(e+"_gr_session_id"),t.removeItem(e+"_gr_session_id_sent_vst");const i=t.getKeys().find((e=>e.indexOf("gr_imp_")>-1));i&&t.removeItem(i)};const{projectId:t}=this.growingIO.vdsConfig,{getItem:i,setItem:n,getKeys:r,removeItem:o}=this.growingIO.storage;this.getItem=i,this.setItem=n,this.getKeys=r,this.removeItem=o,this.sIdStorageName=t+"_gdp_session_id",this.uidStorageName="gdp_user_id_gioenc",this.userIdStorageName=t+"_gdp_cs1_gioenc",this.userKeyStorageName=t+"_gdp_user_key_gioenc",this.gioIdStorageName=t+"_gdp_gio_id_gioenc",this.growingIO.emitter.on("OPTION_INITIALIZED",(()=>{i("gr_user_id")&&this.transferStorage()}))}get sessionId(){return this.getItem(this.sIdStorageName)||(this.sessionId=Y(),this.sessionId)}set sessionId(e){var t;e||(e=Y());const i=this.getItem(this.sIdStorageName)||this.prevSessionId,{sessionExpires:n=30}=this.growingIO.vdsConfig;if(this.setItem(this.sIdStorageName,e,+Date.now()+60*n*1e3),i!==e){const n=this.getKeys().filter((e=>/.+_gdp_session_id_.{36}/.test(e)));n.forEach((e=>{this.removeItem(e)})),this.setItem(this.growingIO.dataStore.visitStorageName,""),null===(t=this.growingIO.emitter)||void 0===t||t.emit(Oe,{newSessionId:e,oldSessionId:i})}this.prevSessionId=e}get uid(){return this.getItem(this.uidStorageName)||(this.uid=Y(),this.uid)}set uid(e){var t;const i=this.getItem(this.uidStorageName)||this.prevUId;this.setItem(this.uidStorageName,e),i!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit("UID_UPDATE",{newUId:e,oldUId:i})),this.prevUId=e}get userId(){return this.getItem(this.userIdStorageName)||""}set userId(e){var t,i;const n=this.getItem(this.userIdStorageName)||this.prevUserId;this.setItem(this.userIdStorageName,e),null===(t=this.growingIO.emitter)||void 0===t||t.emit(Se,{newUserId:e,oldUserId:n,userKey:this.userKey}),n!==e&&(null===(i=this.growingIO.emitter)||void 0===i||i.emit("USERID_UPDATE",{newUserId:e,oldUserId:n,userKey:this.userKey})),e&&(this.gioId=e),this.prevUserId=e}get userKey(){return this.getItem(this.userKeyStorageName)||""}set userKey(e){var t,i;const n=this.getItem(this.userKeyStorageName)||this.prevUserKey;this.setItem(this.userKeyStorageName,e),null===(t=this.growingIO.emitter)||void 0===t||t.emit(Ne,{newUserKey:e,oldUserKey:n,userId:this.userId}),n!==e&&(null===(i=this.growingIO.emitter)||void 0===i||i.emit("USERKEY_UPDATE",{newUserKey:e,oldUserKey:n,userId:this.userId})),this.prevUserKey=e}get gioId(){return this.getItem(this.gioIdStorageName)||""}set gioId(e){var t;const i=this.getItem(this.gioIdStorageName)||this.prevGioId;this.setItem(this.gioIdStorageName,e),i!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit("GIOID_UPDATE",{newGioId:e,oldGioId:i})),this.prevGioId=e}}class ei{constructor(){this.trackingId="g0",this.init=(e,t)=>{var i,n,r,o,s;B("Gio Web SDK 初始化中...","info");const{initOptions:a,currentPage:d,sendVisit:c,sendPage:u}=this.dataStore;a(e),this.storage=we(this.vdsConfig),this.uploader=new Zt(this),this.userStore=new Yt(this),null===(i=this.emitter)||void 0===i||i.emit(Ie,this),null===(r=null===(n=this.plugins)||void 0===n?void 0:n.gioEventAutoTracking)||void 0===r||r.main(),d.hookHistory(),d.parsePage(),this.vdsConfig.originalSource&&this.dataStore.setOriginalSource(),null===(o=this.emitter)||void 0===o||o.emit(ye,this),this.gioSDKInitialized=!0,this.vdsConfig.gioSDKInitialized=!0,window[this.vds]=this.vdsConfig,B("Gio Web SDK 初始化完成！","success"),this.vdsConfig.forceLogin&&B("forceLogin已开启，请调用 identify 方法设置 openId 以继续上报!","info"),this.useEmbeddedInherit||c(),u(),null===(s=this.emitter)||void 0===s||s.emit(be,this),K(t,this.trackingId)},this.sendVisit=(e,t)=>{this.dataStore.buildVisitEvent(e),K(t)},this.sendPage=(e,t)=>{this.dataStore.currentPage.buildPageEvent(e),K(t)},this.registerPlugins=(e,t)=>{p(e)?(e.forEach(((t,i)=>{var n,r;P(t)||s(t)?B("插件不合法，跳过加载!","warn"):(null===(n=t.js)||void 0===n?void 0:n.default)&&(e[i]=Object.assign(Object.assign({},null===(r=t.js)||void 0===r?void 0:r.default),{options:t.options}))})),e=I(e),this.plugins.installAll(e)):B("插件注册失败，请检查!","error"),K(t,this.plugins.pluginItems)},this.getPlugins=e=>{K(e,this.plugins.pluginItems)},this.setOption=(e,t,i)=>{let n;O(L(X),e)?(n=this.dataStore.setOption(e,t),n&&X[e]&&B(`已修改${X[e]}: ${t}`,"info")):(B(`不存在可修改的配置项：${e}，请检查后重试!`,"warn"),n=!1),K(i,n)},this.getOption=(e,t)=>{K(t,this.dataStore.getOption(e))},this.setGeneralProps=(e,t)=>{let i;l(e)&&!P(e)?(this.dataStore.generalProps=Object.assign(Object.assign({},this.dataStore.generalProps),e),L(this.dataStore.generalProps).forEach((e=>{O([void 0,null],this.dataStore.generalProps[e])&&(this.dataStore.generalProps[e]="")})),i=!0):(F("setGeneralProps"),i=!1),K(t,i)},this.clearGeneralProps=(e,t)=>{p(e)&&!P(e)?e.forEach((e=>{j(this.dataStore.generalProps,e)})):this.dataStore.generalProps={},K(t)},this.getDeviceId=e=>{K(e,this.userStore.uid)},this.identify=(e,t)=>{if(this.vdsConfig.forceLogin){if(!$(e))return void F("identify");const t=N(e).slice(0,1e3);this.userStore.uid=t,this.uploader.hoardingQueue.forEach(((e,i)=>this.uploader.hoardingQueue[i].deviceId=t)),this.dataStore.setOption("forceLogin",!1),this.uploader.initiateRequest()}else F("identify",!1,"forceLogin未开启");K(t)},this.setUserId=(e,t,i)=>{let n;if($(N(e).trim())){const i=this.userStore.gioId;this.vdsConfig.idMapping&&(this.userStore.userKey=!s(t)&&N(t).length>0?N(t).slice(0,1e3):""),this.userStore.userId=N(e).slice(0,1e3),i&&i!==this.userStore.userId&&(this.userStore.sessionId=""),n=!0}else this.clearUserId(),F("setUserId"),n=!1;K(i,n)},this.clearUserId=e=>{this.userStore.userId="",this.userStore.userKey="",K(e)},this.setUserAttributes=(e,t,i)=>{var n,r;let o;!P(e)&&l(e)?(null===(r=null===(n=this.plugins)||void 0===n?void 0:n.gioCustomTracking)||void 0===r||r.buildUserAttributesEvent(e,t),o=!0):(F("setUserAttributes"),o=!1),K(i,o)},this.track=(e,t,i,n)=>{var r,o;((null===(o=null===(r=this.plugins)||void 0===r?void 0:r.gioCustomTracking)||void 0===o?void 0:o.buildCustomEvent)||function(){})(e,Object.assign(Object.assign({},this.dataStore.generalProps),l(t)&&!P(t)?t:{}),Object.assign(Object.assign({},i),{customEventType:1})),K(n)},this.trackTimerStart=(e,t)=>{let i;this.vdsConfig.dataCollect&&V(e,(()=>{i=Y(),this.dataStore.trackTimers[i]={eventName:e,leng:0,start:+Date.now()}})),K(t,i)},this.trackTimerPause=(e,t)=>{if(e&&this.dataStore.trackTimers[e]){const t=this.dataStore.trackTimers[e];t.start&&(t.leng=t.leng+(+Date.now()-t.start)),t.start=0}K(t)},this.trackTimerResume=(e,t)=>{if(e&&this.dataStore.trackTimers[e]){const t=this.dataStore.trackTimers[e];0===t.start&&(t.start=+Date.now())}K(t)},this.trackTimerEnd=(e,t,i)=>{let n;if(this.vdsConfig.dataCollect){const i=864e5;if(e&&this.dataStore.trackTimers[e]){const r=this.dataStore.trackTimers[e];if(0!==r.start){const e=+Date.now()-r.start;r.leng=e>0?r.leng+e:0}const{eventContextBuilder:o,eventConverter:s}=this.dataStore;s(Object.assign(Object.assign({eventType:"CUSTOM",eventName:r.eventName,attributes:R(Object.assign(Object.assign({},t),{event_duration:r.leng>i?0:r.leng/1e3}))},o()),{customEventType:0})),this.removeTimer(e),n=!0}else B("未查找到对应的计时器，请检查!","error"),n=!1}K(i,n)},this.removeTimer=(e,t)=>{e&&this.dataStore.trackTimers[e]&&delete this.dataStore.trackTimers[e],K(t)},this.clearTrackTimer=e=>{this.dataStore.trackTimers={},K(e)},this.sdkVersion="4.0.0",this.vds=window._gio_local_vds||"vds",this.utils=Object.assign(Object.assign({},q),M),this.emitter=function(e){return{all:e=e||new Map,on:function(t,i){var n=e.get(t);n?n.push(i):e.set(t,[i])},off:function(t,i){var n=e.get(t);n&&(i?n.splice(n.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var n=e.get(t);n&&n.slice().map((function(e){e(i)})),(n=e.get("*"))&&n.slice().map((function(e){e(t,i)}))}}}(),this.useEmbeddedInherit=!1,this.useHybridInherit=!1,this.gioSDKInitialized=!1,this.plugins=new Qt(this),this.plugins.innerPluginInit(),this.dataStore=new Te(this)}}var ti,ii;let ni;const ri=window._gio_local_vds||"vds",oi=null!==(ii=null===(ti=window[ri])||void 0===ti?void 0:ti.namespace)&&void 0!==ii?ii:"gdp";!function(){var e,t,i,n,r;if(null===(e=window[ri])||void 0===e?void 0:e.gioSDKInstalled)return ni=window[oi],void B("SDK重复加载，请检查是否重复加载SDK或接入其他平台SDK导致冲突!","warn");window[ri]=Object.assign(Object.assign({},null!==(t=window[ri])&&void 0!==t?t:{}),{gioSDKInstalled:!0});const o=new ei;ni=function(){var e;const t=arguments[0];if(a(t)&&O(J,t)&&o[t]){const e=w(S(arguments));if("init"===t){const t=(e=>{var t;return e.vdsConfig||e.gioSDKInitialized||(null===(t=window[e.vds])||void 0===t?void 0:t.gioSDKInitialized)?(B("SDK重复初始化，请检查是否重复加载SDK或接入其他平台SDK导致冲突!","warn"),!1):!(O(["","localhost","127.0.0.1"],location.hostname)&&!window._gr_ignore_local_rule&&(B("当前SDK不允许在本地环境初始化!","warn"),1))})(o);if(!t)return;const i=(e=>!P(I(e))||(B('SDK初始化失败，请使用 gdp("init", "您的GrowingIO项目 accountId", "您项目的 dataSourceId", options); 进行初始化!',"error"),!1))(e);if(!i)return;const n=(e=>{const t=m(e);let i=f(e);return $(N(t).trim())?(l(i)&&i||(i={}),{projectId:t,userOptions:i}):(B("SDK初始化失败，accountId 参数不合法!","error"),!1)})(e);if(!n)return;const r=(e=>{const t=e[1],i=e[2],n=f(e);return t&&a(t)?{dataSourceId:t,appId:a(i)?i:"",options:n}:(B("SDK初始化失败，dataSourceId 参数不合法!","error"),!1)})(e);if(!r)return;const{projectId:s}=n,{dataSourceId:d,appId:c,options:u}=r;o.init(Object.assign(Object.assign({},u),{projectId:s,dataSourceId:d,appId:c}),f(e))}else if("registerPlugins"===t)o.registerPlugins(...e);else{if(o.gioSDKInitialized&&o.vdsConfig)return o[t](...e);o.emitter.emit("UNINITIALIZED_CALL",arguments),B("SDK未初始化!","error")}}else O(Q,t)?B(`方法 ${N(t)} 已被弃用，请移除!`,"warn"):B(`不存在名为 ${N(t)} 的方法调用!`,"error");window[ri]=Object.assign(Object.assign({},window[ri]),{_gr_ignore_local_rule:null!==(e=window._gr_ignore_local_rule)&&void 0!==e&&e,gioSDKVersion:o.sdkVersion,gioSDKFull:o.gioSDKFull,canIUse:e=>O(J,e)&&o[e]})};const s=null===(i=window[oi])||void 0===i?void 0:i.q,d=null===(n=window[oi])||void 0===n?void 0:n.e,c=null===(r=window[oi])||void 0===r?void 0:r.ef;window[oi]=ni,window[oi].e=d,window[oi].ef=c,window.gdp=ni,window.gdp.e=d,window.gdp.ef=c,p(s)&&!P(s)&&S(Array(s.length)).forEach((()=>{ni.apply(null,s.shift())}))}();var si=ni;export{si as default};
