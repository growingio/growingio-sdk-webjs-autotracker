!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).gdp=t()}(this,(function(){"use strict";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)({}).hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+n+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++)for(var i in t=arguments[n])({}).hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};function r(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;o>i;i++)!r&&i in t||(r||(r=[].slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||[].slice.call(t))}var i=function(e){return null==e||void 0===e},o=function(e){return"string"==typeof e},a=function(e){return"number"==typeof e},s=function(e){return"boolean"==typeof e},u=function(e){return"[object Object]"==={}.toString.call(e)&&!i(e)},c=function(e){return"function"==typeof e},d=function(e){return Array.isArray(e)&&"[object Array]"==={}.toString.call(e)},l=function(e){return"[object Date]"==={}.toString.call(e)},g=function(e){try{return Array.from(e)[0]}catch(e){return}},f=function(e){try{var t=Array.from(e);return t[t.length-1]}catch(e){return}},h=function(e,t){return void 0===t&&(t=1),d(e)&&a(t)?e.slice(t>0?t:1,e.length):e},p=function(e){if(d(e)){for(var t=0,n=[],r=0,i=e;r<i.length;r++){var o=i[r];o&&!C(o)&&(n[t++]=o)}return n}return e},v=function(e){return i(e)?"":"".concat(e)},m=function(e,t){return"string"==typeof e?e.split(t):e},w=function(e){if(o(e)){var t=m(e,"");return"".concat(g(t).toLowerCase()).concat(h(t).join(""))}return e},I=function(e,t){return!!o(e)&&e.slice(0,t.length)===t},y=function(e,t){if(o(e)){var n=e.length,r=n;r>n&&(r=n);var i=r;return(r-=t.length)>=0&&e.slice(r,i)===t}return!1},b={}.hasOwnProperty,O=function(e,t){return!i(e)&&b.call(e,t)},S=function(e){return"object"===x(e)?Object.keys(e):[]},E=function(e,t){S(e).forEach((function(n){return t(e[n],n)}))},N=function(e,t){var n=S(e);return!(!u(e)||!u(t)||n.length!==S(t).length||n.map((function(n,r){return u(e[n])?N(e[n],t[n]):e[n]===t[n]})).includes(!1))},T=function(e,t){if(!u(e))return!1;try{if("string"===x(t))return delete e[t];if("array"===x(t))return t.map((function(t){return delete e[t]}));"object"===x(t)&&t.constructor===RegExp&&S(e).forEach((function(n){t.test(n)&&T(e,n)}))}catch(e){return!1}},C=function(e){return d(e)?0===e.length:u(e)?0===S(e).length:!e},x=function(e){var t=typeof e;return"object"===t?null===e?"null":d(e)?"array":t:t},A=Object.freeze({__proto__:null,isNil:i,isString:o,isNumber:a,isBoolean:s,isObject:u,isFunction:c,isArray:d,isDate:l,fixed:function(e,t){return a(e)?Number(e.toFixed(a(t)?t:2)):o(e)&&"NaN"!==v(Number(e))?Number(Number(e).toFixed(a(t)?t:2)):e},head:g,last:f,drop:h,dropWhile:function(e,t){return d(e)?e.filter((function(e){return!t(e)})):e},compact:p,find:function(e,t){if(d(e)){var n=e.findIndex(t);return 0>n?void 0:e[n]}},toString:v,split:m,lowerFirst:w,upperFirst:function(e){if(o(e)){var t=m(e,"");return"".concat(g(t).toUpperCase()).concat(h(t).join(""))}return e},startsWith:I,endsWith:y,hasOwnProperty:b,has:O,keys:S,forEach:E,isEqual:N,get:function(e,t,n){var r=e;return u(e)?(t.split(".").forEach((function(e){r=r?r[e]:n})),r):n},unset:T,isEmpty:C,typeOf:x,formatDate:function(e){if(l(e)){var t=function(e){return 10>e?"0"+e:e};return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+t(e.getMilliseconds())}return e}}),_=function(e,t){console.log("%c[GrowingIO]：".concat(e),{info:"color: #3B82F6;",error:"color: #EF4444",warn:"color: #F59E0B",success:"color: #10B981"}[t]||"")},k=function(e){try{return e()}catch(e){return}},P=function(e){var t={};return u(e)&&E(e,(function(e,n){var r=v(n).slice(0,50);u(e)?t[r]=P(e):d(e)?(t[r]=e.slice(0,100),"cdp"===window.gioEnvironment&&(t[r]=t[r].join("||"))):t[r]=i(e)?"":v(e).slice(0,1e3)})),t},D=function(e,t,r,i){void 0===i&&(i={}),document.addEventListener?e.addEventListener(t,r,n(n({},{capture:!0}),i)):e.attachEvent?e.attachEvent("on"+t,r):e["on"+t]=r},U=Object.freeze({__proto__:null,consoleText:_,niceTry:k,limitObject:P,addListener:D,flattenObject:function(e){void 0===e&&(e={});var t=n({},e);return S(t).forEach((function(e){u(t[e])?(S(t[e]).forEach((function(n){t["".concat(e,"_").concat(n)]=v(t[e][n])})),T(t,e)):d(t[e])?(t[e].forEach((function(n,r){u(n)?S(n).forEach((function(i){t["".concat(e,"_").concat(r,"_").concat(i)]=v(n[i])})):t["".concat(e,"_").concat(r)]=v(n)})),T(t,e)):i(t[e])||""===t[e]?T(t,e):t[e]=v(t[e])})),t}}),L=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},q=function(){var e,t=!!(null===(e=null===window||void 0===window?void 0:window.navigator)||void 0===e?void 0:e.sendBeacon),n=window.navigator.userAgent;if(n.match(/(iPad|iPhone|iPod)/g)){var r=R(n);return t&&r>13}return t},R=function(e){var t=e.toLowerCase().match(/cpu.*os (.*?) like mac os/i);return!t||2>t.length?0:+t[1].split("_").slice(0,2).join(".")},B=function(){var e=window.location.hostname;return k((function(){var t=e.split("."),n=f(t);if("localhost"!==e&&(!a(Number(n))||0>Number(n)||Number(n)>255))return[".".concat(t.slice(-2).join(".")),".".concat(t.slice(-3).join("."))]}))||[e]},j=function(e){return e.endsWith("_gioenc")?e.slice(0,-7):e},H=function(){return!!window.ActiveXObject||"ActiveXObject"in window||navigator.userAgent.indexOf("compatible")>-1&&navigator.userAgent.indexOf("MSIE")>-1||navigator.userAgent.indexOf("Trident")>-1&&navigator.userAgent.indexOf("rv:11.0")>-1},K=function(e){return Number.isNaN(Number(e))&&k((function(){return JSON.parse(e)}))||e};H()&&(Array.prototype.includes=function(){return this.indexOf(arguments[0])>=0},Array.prototype.find=function(){var e=arguments[0],t=void 0;return this.forEach((function(n){e(n)&&void 0===t&&(t=n)})),t},Array.prototype.findIndex=function(){var e=arguments[0],t=-1;return this.forEach((function(n,r){e(n)&&-1===t&&(t=r)})),t},Array.from=function(){var e=arguments[0];if(null==e)throw Error("Array.from requires an array-like object not null or undefined");var t=arguments.length>1?arguments[1]:void 0;if(t&&"function"!=typeof t)throw Error("Array.from: when provided,the second argument must be a function");for(var n,r=arguments.length>2?arguments[2]:void 0,i=e.length,o=0,a=Array(i);i>o;)n=e[o],a[o]=t?r?t.call(r,n,o):t(n,o):n,o++;return a},Number.isNaN=function(){return"NaN"==="".concat(Number(arguments[0]))},String.prototype.startsWith=function(){var e=arguments[0],t=this.slice(0,e.length);return t===e},String.prototype.endsWith=function(){var e=arguments[0],t=this.slice(-e.length);return t===e});var V=["web","wxwv","minp","alip","baidup","qq","bytedance"],W={autotrack:{type:"boolean",default:!0},compress:{type:"boolean",default:!0},dataCollect:{type:"boolean",default:!0},debug:{type:"boolean",default:!1},hashtag:{type:"boolean",default:!1},touch:{type:"boolean",default:!1},version:{type:"string",default:"1.0.0"},platform:{type:"string",default:"web"}},F={enableIdMapping:{type:"boolean",default:!1},gtouchHost:{type:"string",default:""},host:{type:"string",default:""},ignoreFields:{type:"array",default:[]},penetrateHybrid:{type:"boolean",default:!0},scheme:{type:"string",default:location.protocol.indexOf("http")>-1?location.protocol.replace(":",""):"https"},sessionExpires:{type:"number",default:30}},G={},M=["clearUserId","getGioInfo","getLocation","getOption","init","setDataCollect","setOption","setUserId","track","setGeneralProps","clearGeneralProps"];r(r([],M,!0),["setEvar","setPage","setUser","setVisitor"],!1);var z=r(r([],M,!0),["enableDebug","enableHT","setAutotrack","setTrackerHost","setTrackerScheme","setUserAttributes","getVisitorId","getDeviceId","registerPlugins","sendPage","sendVisit","trackTimerStart","trackTimerPause","trackTimerResume","trackTimerEnd","removeTimer","clearTrackTimer"],!1),J=["autotrack","dataCollect","dataSourceId","debug","host","hashtag","scheme"],X={autotrack:"无埋点采集",dataCollect:"数据采集",debug:"调试模式"},Z=["send","setConfig","collectImp","setPlatformProfile"],Q=["screenHeight","screenWidth"],Y={click:"VIEW_CLICK",change:"VIEW_CHANGE",submit:"FORM_SUBMIT"},$=function(e){return o(e)&&e.length>0||a(e)&&e>0},ee=function(e){return e.vdsConfig||e.gioSDKInitialized||window.vds||window.gioSDKInitialized?(_("SDK重复初始化，请检查是否重复加载SDK或接入其他平台SDK导致冲突!","warn"),!1):!(["","localhost","127.0.0.1"].includes(location.hostname)&&!window._gr_ignore_local_rule&&(_("当前SDK不允许在本地环境初始化!","warn"),1))},te=function(e){return!C(p(e))||(_('SDK初始化失败，请使用 gdp("init", "您的GrowingIO项目 accountId", "您项目的 dataSourceId", options); 进行初始化!',"error"),!1)},ne=function(e){var t=g(e),n=f(e);return $(v(t).trim())?(u(n)&&n||(n={}),{projectId:t,userOptions:n}):(_("SDK初始化失败，accountId 参数不合法!","error"),!1)},re=function(e){var t=e[1],n=e[2],r=f(e);return t&&o(t)?u(r)&&r.host?{dataSourceId:t,appId:o(n)?n:"",cdpOptions:r}:(_("SDK初始化失败，未在配置中指定 host!","error"),!1):(_("SDK初始化失败，dataSourceId 参数不合法!","error"),!1)},ie=/^((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})(\.((2(5[0-5]|[0-4]\d))|[0-1]?\d{1,2})){3}/i,oe=/^(https?:\/\/)|(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i,ae="SDK_INITIALIZED",se="USERID_UPDATE",ue="USERKEY_UPDATE",ce="SESSIONID_UPDATE",de={},le={}.hasOwnProperty;function ge(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function fe(e){try{return encodeURIComponent(e)}catch(e){return null}}de.stringify=function(e,t){t=t||"";var n,r,i=[];for(r in"string"!=typeof t&&(t="?"),e)if(le.call(e,r)){if((n=e[r])||null!=n&&!isNaN(n)||(n=""),r=fe(r),n=fe(n),null===r||null===n)continue;i.push(r+"="+n)}return i.length?t+i.join("&"):""},de.parse=function(e){for(var t,n=/([^=?#&]+)=?([^&]*)/g,r={};t=n.exec(e);){var i=ge(t[1]),o=ge(t[2]);null===i||null===o||i in r||(r[i]=o)}return r};var he=function(e){var t=this;this.growingIO=e,this._compress=function(e,t,n){if(null===e)return"";var r,i,o,a={},s={},u="",c="",d="",l=2,g=3,f=2,h=[],p=0,v=0;for(o=0;o<e.length;o+=1)if(u=e.charAt(o),{}.hasOwnProperty.call(a,u)||(a[u]=g++,s[u]=!0),c=d+u,{}.hasOwnProperty.call(a,c))d=c;else{if({}.hasOwnProperty.call(s,d)){if(256>d.charCodeAt(0)){for(r=0;f>r;r++)p<<=1,v===t-1?(v=0,h.push(n(p)),p=0):v++;for(i=d.charCodeAt(0),r=0;8>r;r++)p=p<<1|1&i,v===t-1?(v=0,h.push(n(p)),p=0):v++,i>>=1}else{for(i=1,r=0;f>r;r++)p=p<<1|i,v===t-1?(v=0,h.push(n(p)),p=0):v++,i=0;for(i=d.charCodeAt(0),r=0;16>r;r++)p=p<<1|1&i,v===t-1?(v=0,h.push(n(p)),p=0):v++,i>>=1}0==--l&&(l=Math.pow(2,f),f++),delete s[d]}else for(i=a[d],r=0;f>r;r++)p=p<<1|1&i,v===t-1?(v=0,h.push(n(p)),p=0):v++,i>>=1;0==--l&&(l=Math.pow(2,f),f++),a[c]=g++,d=u+""}if(""!==d){if({}.hasOwnProperty.call(s,d)){if(256>d.charCodeAt(0)){for(r=0;f>r;r++)p<<=1,v===t-1?(v=0,h.push(n(p)),p=0):v++;for(i=d.charCodeAt(0),r=0;8>r;r++)p=p<<1|1&i,v===t-1?(v=0,h.push(n(p)),p=0):v++,i>>=1}else{for(i=1,r=0;f>r;r++)p=p<<1|i,v===t-1?(v=0,h.push(n(p)),p=0):v++,i=0;for(i=d.charCodeAt(0),r=0;16>r;r++)p=p<<1|1&i,v===t-1?(v=0,h.push(n(p)),p=0):v++,i>>=1}0==--l&&(l=Math.pow(2,f),f++),delete s[d]}else for(i=a[d],r=0;f>r;r++)p=p<<1|1&i,v===t-1?(v=0,h.push(n(p)),p=0):v++,i>>=1;0==--l&&(l=Math.pow(2,f),f++)}for(i=2,r=0;f>r;r++)p=p<<1|1&i,v===t-1?(v=0,h.push(n(p)),p=0):v++,i>>=1;for(;;){if(p<<=1,v===t-1){h.push(n(p));break}v++}return h.join("")},this.compress=function(e){var n=t;return t._compress(e,16,(function(e){return n.f(e)}))},this.compressToUTF16=function(e){var n=t;return null===e?"":t._compress(e,15,(function(e){return n.f(e+32)}))+" "},this.compressToUint8Array=function(e){for(var n=t.compress(e),r=new Uint8Array(2*n.length),i=0,o=n.length;o>i;i++){var a=n.charCodeAt(i);r[2*i]=a>>>8,r[2*i+1]=a%256}return r},this.compressToEncodedURIComponent=function(e){return null==e?"":t._compress(e,6,(function(e){return this.keyStrUriSafe.charAt(e)}))},this.f=String.fromCharCode,this.keyStrUriSafe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$"};window.gioCompress={name:"gioCompress",method:he};var pe={name:"gioCompress",method:he},ve=function(e){var t=this;this.growingIO=e,this.getValidResourceItem=function(e){if(e&&u(e)&&e.id&&e.key){var t={id:o(e.id)?e.id:v(e.id),key:o(e.key)?e.key:v(e.key)};return e.attributes&&(t.attributes=e.attributes),t}},this.getDynamicAttributes=function(e){return i(e)||S(e).forEach((function(t){c(e[t])?e[t]=e[t]():u(e[t])?T(e,t):d(e[t])||(e[t]=v(e[t]))})),e},this.buildCustomEvent=function(e,r,i,a){if(o(e)&&e.match(/^[a-zA-Z_][0-9a-zA-Z_]{0,50}$/)){var s=t.growingIO.dataStore,c=s.eventContextBuilder,d=s.eventConverter,l=s.currentPage,g=n({eventType:"CUSTOM",eventName:e,pageShowTimestamp:null==l?void 0:l.time,attributes:P(t.getDynamicAttributes(u(r)&&!C(r)?r:void 0)),resourceItem:P(t.getValidResourceItem(i))},c());C(a)||(g=n(n({},g),a)),d(g)}else _("埋点事件格式不正确，事件名只能包含数字、字母和下划线，且不能以数字开头!","warn")},this.buildUserAttributesEvent=function(e,r){var i=t.growingIO.dataStore,o=i.eventContextBuilder,a=i.eventConverter,s=n({eventType:"LOGIN_USER_ATTRIBUTES",attributes:P(e)},o());C(r)||(s=n(n({},s),r)),a(s)}};window.gioCustomTracking={name:"gioCustomTracking",method:ve};var me,we={name:"gioCustomTracking",method:ve},Ie=r(["gioappid","giocs1","giodatacollect","gioprojectid","gios","giou"],["gioappchannel","giodevicebrand","giodevicemodel","giodevicetype","giolanguage","gionetworkstate","giooperatingsystem","gioplatform","gioplatformversion","gioscreenheight","gioscreenwidth"],!0),ye=r(["giodatasourceid","gioid"],["giouserkey"],!0),be={gioappchannel:"appChannel",giodevicebrand:"deviceBrand",giodevicemodel:"deviceModel",giodevicetype:"deviceType",giolanguage:"language",gionetworkstate:"networkState",giooperatingsystem:"operatingSystem",gioplatform:"platform",gioplatformversion:"platformVersion",gioscreenheight:"screenHeight",gioscreenwidth:"screenWidth"},Oe="gio_search_cookie_gioenc",Se=function(e){var t=this;this.growingIO=e,this.main=function(e){var n,r=e.projectId,i=e.appId,o=t.getGQS(),a=!1;return"none"!==t.qsFrom&&o.gioprojectid===r&&o.gioappid===i&&(C(o)?t.growingIO.storage.removeItem(Oe):t.growingIO.storage.setItem(Oe,de.stringify(o)),t.growingIO.setUserId=function(){},t.growingIO.clearUserId=function(){},"cdp"===me&&(t.growingIO.vdsConfig.dataSourceId=o.giodatasourceid,t.growingIO.vdsConfig.ignoreFields=t.growingIO.vdsConfig.ignoreFields.filter((function(e){return O(o,e)})),O(o,"giodatacollect")&&(t.growingIO.vdsConfig.dataCollect=["true",!0].includes(o.giodatacollect),t.growingIO.setDataCollect=function(){},t.growingIO.setOption=function(){})),null===(n=t.growingIO.emitter)||void 0===n||n.on("SDK_INITIALIZED",(function(){t.growingIO.userStore.sessionId=o.gios,t.growingIO.userStore.uid=o.giou,o.gioid&&(t.growingIO.userStore.gioId=o.gioid),o.giocs1&&(t.growingIO.userStore.userId=o.giocs1),"cdp"===me&&O(o,"giouserkey")&&(t.growingIO.userStore.userKey=o.giouserkey),window.setInterval((function(){t.growingIO.userStore.sessionId=o.gios}),.8*t.growingIO.vdsConfig.sessionExpires*60*1e3)})),S(be).forEach((function(e){O(o,e)&&(t.growingIO.dataStore.eventContextBuilderInst.minpExtraParams[be[e]]=o[e])})),a=!0),t.gioURLRewrite(),a},this.getGQS=function(){var e=t.growingIO.vdsConfig.hashtag,n=t.growingIO.storage.getItem(Oe),i=window.location.search,o=window.location.hash,a=e?o.substring(o.indexOf("?")+1):"",s=de.parse(i),u=de.parse(a),c=de.parse((n||"").replace("gioenc-","")),d="";if(O(s,"gioprojectid"))d=s,t.qsFrom="search";else if(O(u,"gioprojectid"))d=u,t.qsFrom="hash";else{if(!O(c,"gioprojectid"))return t.qsFrom="none",{};d=c,t.qsFrom="cookie"}var l={},g={},f="cdp"===me?r(r([],Ie,!0),ye,!0):Ie;return S(d).forEach((function(e){var t=e.toLowerCase();f.includes(t)?["","undefined","null",void 0,null].includes(d[e])||(l[t]=d[e],"true"===d[e]&&(l[t]=!0),"false"===d[e]&&(l[t]=!1)):g[e]=d[e]})),t.gqs=l,t.ngqs=g,l},this.gioURLRewrite=function(){var e=t.growingIO.vdsConfig.hashtag,n=window.location.search,r=window.location.hash,i=!1;if("search"===t.qsFrom&&(n=de.stringify(t.ngqs,!0),i=!0),e&&"hash"===t.qsFrom&&(r="".concat(r.split("?")[0]).concat(de.stringify(t.ngqs,!0)),i=!0),i){var o="".concat(window.location.pathname).concat(n||"").concat(r||"");window.history.replaceState(null,document.title,o)}},me=this.growingIO.gioEnvironment,this.gqs={},this.ngqs={},this.qsFrom="search"};window.gioEmbeddedAdapter={name:"gioEmbeddedAdapter",method:Se};var Ee={name:"gioEmbeddedAdapter",method:Se},Ne=["TR","LI","DL"],Te=function(e,t){for(var n=0,r=t.length,i=e.length;r>n;n++,i++)e[i]=t[n];return e}(["A","BUTTON"],function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}(Ne)),Ce=["button","submit","reset"],xe=["radio","checkbox","search"],Ae=["I","EM","svg","IMG"],_e=["TEXTAREA","HTML","BODY"],ke=["I","SPAN","EM","B","STRONG"],Pe=["tspan","text","g","rect","path","defs","clippath","desc","title","math","use"],De=/(^| |[^ ]+\-)(clear|clearfix|active|hover|enabled|current|selected|unselected|hidden|display|focus|disabled|undisabled|open|checked|unchecked|undefined|null|ng-|growing-)[^\. ]*/g,Ue=/^[a-zA-Z-\_][a-zA-Z\-\_0-9]+$/,Le=/^([a-zA-Z\-\_0-9]+)$/,qe="data-growing-ignore",Re=function(e,t){if(void 0===t&&(t=!0),e&&(null==(e=e.replace(/[\n \t]+/g," ").trim())?void 0:e.length))return e.slice(0,t?50:void 0)},Be=function(e,t){if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var n=0,r=e.length;r>n;n++)if(e[n]!==t[n])return!1;return!0},je=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},He=function(e,t){for(var n=0,r=t.length,i=e.length;r>n;n++,i++)e[i]=t[n];return e},Ke=function(e,t){return e instanceof Element&&e.hasAttribute(t)&&"false"!==e.getAttribute(t)},Ve=function(e){return!e||-1!==["BODY","HTML","#document"].indexOf(e.nodeName)},We=function(e,t){for(var n=e.parentNode;n&&!Ve(n);){if(t(n))return n;n=n.parentNode}},Fe=function(e){return Array.from((null==e?void 0:e.childNodes)||[]).reduce((function(e,t){return t instanceof Element?He(He(He([],je(e)),[t]),je(Fe(t))):e}),[])},Ge=function(e){return Array.from((null==e?void 0:e.childNodes)||[]).filter((function(e){return e instanceof Element}))},Me=function(e){return!e.hasChildNodes()||"svg"===e.nodeName||0===Ge(e).length},ze=function(e){return!(!e.hasChildNodes()||"svg"===e.nodeName)&&0===Array.from(e.childNodes).filter((function(e){return!Me(e)})).length},Je=function(e){return Ke(e,"data-growing-container")||-1!==Te.indexOf(e.nodeName)},Xe=function(e){var t=e.nodeName;return-1!==Ae.indexOf(t)},Ze=function(e){var t,n;if(e.textContent)return!1;var r=Ge(e);if(0===r.length)return!1;try{for(var i=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(r),o=i.next();!o.done;o=i.next()){var a=o.value;if(!Xe(a)&&"SPAN"!==a.nodeName)return!1}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return!0},Qe=function(e){return e instanceof HTMLInputElement&&"INPUT"===e.tagName&&-1!==Ce.indexOf(e.type)},Ye=function(e){return e instanceof HTMLInputElement&&"INPUT"===e.tagName&&-1!==xe.indexOf(e.type)},$e=function(e,t,n){if(void 0===t&&(t=4),void 0===n&&(n=1),n>t)return!1;for(var r="svg"===e.tagName?[]:Ge(e),i=0;i<r.length;i++){var o=r[i];if(!$e(o,t,n+1))return!1}return t>=n},et=function(e){if(!(e instanceof Element)||Ke(e,qe))return!0;for(var t=e.parentNode;t&&!Ve(t);){if(Ke(t,qe))return!0;t=t.parentNode}return!1};function tt(e){var t;if(e instanceof Element){var n=e.getAttribute("name");if(n)return[n];if(e.hasAttribute("class")){var r=null===(t=e.getAttribute("class"))||void 0===t?void 0:t.replace(De,"").trim();if(null==r?void 0:r.length)return r.split(/\s+/).filter((function(e){return Le.test(e)&&!e.match(/[a-z][A-Z][a-z][A-Z]/)&&!e.match(/[0-9][0-9][0-9][0-9]/)})).sort()}}return[]}var nt=function(){function e(e){var t;this.node=e,this.tagName=this.node.nodeName,this.name=this.tagName.toLowerCase(),this.id=(t=this.node).id&&Ue.test(t.id)?t.id:null,this.classList=tt(this.node),this.guessListAndIndex()}return e.prototype.guessListAndIndex=function(){var e,t,n=this;this._tagList=(t=this.node,-1!==Ne.indexOf(t.nodeName));var r,i,o,a,s,u=(r=Ge(this.node.parentNode),i=this.node,a=function(e,t){if(null==e||"function"!=typeof t)return-1;for(var n=0;n<e.length;n++){var r=e[n];if(t.call(void 0,r))return n}return-1}(r,o=function(e){return e.nodeName===i.nodeName}),s=function(e,t){if(null==e||"function"!=typeof t)return-1;for(var n=e.length-1;n>=0;n--){var r=e[n];if(t.call(void 0,r))return n}return-1}(r,o),-1===a||-1===s?[]:r.slice(a,s+1));if(this._tagList&&-1!==(l=u.filter((function(e){return e.tagName===n.tagName})).indexOf(this.node))&&(this._index=l+1),u.length>=3&&(null===(e=this.classList)||void 0===e?void 0:e.length)){for(var c=0,d=0,l=1;l<=u.length;l++){var g=u[l-1];if(g.tagName!==this.tagName){d=0;break}Be(this.classList,tt(g))&&(d+=1),this.node===g&&(c=l)}3>d||(this._pseudoList=!0,this._index=this._index||c)}},Object.defineProperty(e.prototype,"path",{get:function(){var e;return this._path||(this._path="/"+this.name,this.id&&(this._path+="#"+this.id),(null===(e=this.classList)||void 0===e?void 0:e.length)&&(this._path+="."+this.classList.join("."))),this._path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pseudoList",{get:function(){return!!this._pseudoList},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"list",{get:function(){return!!this._tagList||!!this._pseudoList},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return function(e){if(e instanceof Element){var t=e.getAttribute("data-growing-index")||e.getAttribute("data-growing-idx")||e.getAttribute("data-index");if(t){if(/^\d{1,10}$/.test(t)&&+t>0&&2147483647>+t)return+t;window.console.error("[GioNode]：标记的index不符合规范（index必须是大于0且小于2147483647的整数字）。",t)}}}(this.node)||this._index},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"container",{get:function(){return Je(this.node)||this.list},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.node.parentNode?new e(this.node.parentNode):null},enumerable:!1,configurable:!0}),e.prototype.parentPaths=function(e){void 0===e&&(e=!1);for(var t=e?[this]:[],n=this.parent;n&&!Ve(n.node);)t.push(n),n=n.parent;return t},e}();function rt(e){if(e.hasAttribute("href")){var t=e.getAttribute("href");if(t&&0!==t.indexOf("javascript"))return(r=(n=t.slice(0,320)).length)>1&&"/"===n.charAt(r-1)?n.slice(0,r-1):n}var n,r}function it(e){if(e.src&&-1===e.src.indexOf("data:image"))return e.src}var ot=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},at=function(e){return e.htmlFor||e.getAttribute("for")};function st(e){var t=e.node;return e.list?ut(t):Re(t.textContent)||void 0}function ut(e){var t,n,r=void 0,i=!1;try{for(var o=ot(Array.from(e.childNodes)),a=o.next();!a.done;a=o.next()){var s=a.value;if(s.nodeType===Node.TEXT_NODE){var u=Re(s.textContent);if(u)return u}if(s.nodeType===Node.ELEMENT_NODE&&-1===["INPUT","SELECT"].indexOf(s.nodeName)){if(new nt(s).pseudoList)return;i=Ze(s)||Xe(s);var c=ct(s);if(i)r=c,i=!1;else if(c||(c=ut(s)),c)return c}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}function ct(e){return function(e){var t=e;if(t){var n=function(e){var t=e.getAttribute("data-growing-title")||e.getAttribute("data-title")||e.getAttribute("growing-title")||e.getAttribute("title");return(null==t?void 0:t.trim())||void 0}(t);if(n)return n;var r,i=new nt(e);switch(e.nodeName.toLowerCase()){case"a":return function(e){if((Me(e)||Ze(e))&&e.textContent){var t=Re(e.textContent);if(t)return t}var n=rt(e);if(n){var r=n.indexOf("?");return r>-1?n.slice(0,r):n}}(t);case"svg":return function(e){var t,n;try{for(var r=ot(Array.from(e.childNodes)),i=r.next();!i.done;i=r.next()){var o=i.value;if(o.nodeType===Node.ELEMENT_NODE&&"use"===o.tagName.toLowerCase()&&o.hasAttribute("xlink:href"))return o.getAttribute("xlink:href")}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}(t);case"button":return function(e){var t;return(null===(t=e.name)||void 0===t?void 0:t.length)?e.name:Re(e.textContent)||ut(e)}(t);case"img":return function(e){if(e.alt)return e.alt;var t=it(e);if(t){var n=t.split("?")[0].split("/");if(n.length>0)return n[n.length-1]}}(t);case"label":return st(i);case"input":return function(e){if(Qe(e))return e.value;if("password"!==e.type&&Ke(e,"data-growing-track"))return e.value;if(Ye(e)){var t=We(e,(function(e){return"LABEL"===e.nodeName}));if(!t&&e.id)for(var n=document.body.getElementsByTagName("label"),r=0;r<n.length;r++){var i=n[r];if(at(i)===e.id){t=i;break}}if(t){var o=st(new nt(t));if(o&&o.length>0)return o+" ("+e.checked+")"}return e.value}}(t);case"select":return Array.from((r=t).options).filter((function(e){return e.selected})).map((function(e){return e.label})).join(", ")||r.value;case"form":return function(e){var t,n,r=e.getElementsByTagName("input");try{for(var i=ot(Array.from(r)),o=i.next();!o.done;o=i.next()){var a=o.value;if(("search"===a.type||"text"===a.type&&("q"===a.id||-1!==a.id.indexOf("search")||"q"===a.name||-1!==a.name.indexOf("search")))&&!et(a)){var s=ct(a);if(s)return s}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}(t)}return Me(t)?function(e){var t=Re(e.textContent);if(t)return t}(t):ze(t)&&!Ze(t)?function(e){var t,n,r="";try{for(var i=ot(Array.from(e.childNodes)),o=i.next();!o.done;o=i.next()){var a=o.value;r+=(a.nodeType===Node.TEXT_NODE&&a.textContent?a.textContent.trim():"")+" "}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return Re(r,!1)}(t):i.container||Ze(e)?ut(t):void 0}}(e)||void 0}var dt=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)({}).hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+n+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),lt=function(e){function t(t){var n=e.call(this,t)||this;n.node=t;var r=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}(function(e){for(var t=e.parentPaths(!0),n=Math.min(t.length,+(t.length>=10)+4),r=["","",""],i=0;i<t.length;i++){var o=t[i].path,a=t[i].name;r[0]=o+r[0],r[2]="/"+a+r[2],n>i&&(r[1]=o+r[1])}return r}(n),3),i=r[0],o=r[1],a=r[2];return n.fullXpath=i,n.xpath=o,n.skeleton=a,n}return dt(t,e),Object.defineProperty(t.prototype,"href",{get:function(){return function(e){var t=e;if(t)switch(e.nodeName.toLowerCase()){case"a":return rt(t);case"img":return it(t)}}(this.node)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return ct(this.node)},enumerable:!1,configurable:!0}),t}(nt),gt=function(){return gt=Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++)for(var i in t=arguments[n])({}).hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},gt.apply(this,arguments)},ft=function(){function e(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!0),this.origin=e,this.action=t,this.direct=n,this.target="self"===t?e:function(e){for(var t;e&&!((t=e)instanceof Element&&-1===Pe.indexOf(function(e){var t;return null===(t=e.tagName)||void 0===t?void 0:t.toLowerCase()}(t)))&&e.parentNode;)e=e.parentNode;var n,r=e.parentNode;return!Ve(r)&&(Ze(r)||"BUTTON"===(n=r).tagName&&function(e){return 0!==Ge(e).length&&!Fe(e).map((function(e){return e.tagName})).some((function(e){return-1===ke.indexOf(e)}))}(n))?r:e}(e),this.ignore=et(this.target),this.vnode=new lt(this.target),this.tagName=this.vnode.tagName}return Object.defineProperty(e.prototype,"content",{get:function(){return this.vnode.content},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"href",{get:function(){return this.vnode.href},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this.vnode.index},enumerable:!1,configurable:!0}),e.prototype.inferParentIndex=function(){var t=this;return this.parentIndex||We(this.target,(function(n){var r=new e(n,t.action,!1);r.traceable()&&r.index&&(t.parentIndex=r.index)})),this.parentIndex},Object.defineProperty(e.prototype,"xpath",{get:function(){return this.vnode.xpath},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fullXpath",{get:function(){return this.vnode.fullXpath},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skeleton",{get:function(){return this.vnode.skeleton},enumerable:!1,configurable:!0}),e.prototype.info=function(e){return void 0===e&&(e=!0),e&&this.inferParentIndex(),{skeleton:this.skeleton,fullXpath:this.fullXpath,xpath:this.xpath,content:this.content,href:this.href,index:this.parentIndex||this.index}},e.prototype.traceable=function(){if(this.ignore)return!1;if(this.direct){if("click"===this.action||"hover"===this.action){if(-1!==_e.indexOf(this.target.tagName))return!1;if("INPUT"===this.target.tagName&&!Qe(this.target))return!1;if(!Je(this.target)&&!$e(this.target,5))return!1}return!0}return this.vnode.container},e.prototype.trackNodes=function(){if(!this.traceable())return[];var e=[this];if("submit"!==this.action)for(var t=this.parentElement;t;){if(t.ignore)return[];t.traceable()&&e.unshift(t),t=t.parentElement}var n=void 0;return e.map((function(e){var t=e.info(!1),r=t.index;return!n&&r&&(n=r),gt(gt({},t),{index:n||r})}))},Object.defineProperty(e.prototype,"parentElement",{get:function(){var t=this.target.parentNode;if(t&&t.nodeName&&!Ve(t))return new e(t,this.action,!1)},enumerable:!1,configurable:!0}),e}(),ht=function(){function e(e){this.handler=e;var t=navigator.userAgent,n=/chrome/i.exec(t),r=/android/i.exec(t);this.hasTouch="ontouchstart"in window&&!(n&&!r)}return e.prototype.main=function(){for(var e=this.hasTouch?["touchstart"]:["mousedown"],t=this.hasTouch?["touchend","touchcancel"]:["mouseup","mouseleave"],n=this.hasTouch?["touchmove"]:["mousemove"],r=0,i=e;i.length>r;r++)D(window,i[r],this.touchStartHandler.bind(this));for(var o=0,a=n;a.length>o;o++)D(window,a[o],this.touchMoveHandler.bind(this));for(var s=0,u=t;u.length>s;s++)D(window,u[s],this.touchStopHandler.bind(this))},e.prototype.touchStartHandler=function(e){if(1>=e.which){var t=+Date.now();this.safeguard!==t&&(this.touchTimeout&&clearTimeout(this.touchTimeout),this.safeguard=t,this.touchEvent={time:t,target:e.target,x:this._page("x",e),y:this._page("y",e),isTrusted:!0,type:"click"})}},e.prototype.touchMoveHandler=function(e){var t=Math.abs(this._page("x",e)-(this.touchEvent&&this.touchEvent.x)||0),n=Math.abs(this._page("y",e)-(this.touchEvent&&this.touchEvent.y)||0);(t>10||n>10)&&(this.touchEvent=null)},e.prototype.touchStopHandler=function(e){var t=this,n=+Date.now()-(this.touchEvent&&this.touchEvent.time)||0;this.touchEvent&&200>n?this.touchTimeout=setTimeout((function(){t.handler(t.touchEvent),t.touchEvent=null}),200):this.touchEvent&&n>=200&&700>n&&(this.handler(this.touchEvent),this.touchEvent=null)},e.prototype._page=function(e,t){return(this.hasTouch?t.touches[0]:t)["page".concat(e.toUpperCase())]},e}(),pt=function(e){var t=this;this.growingIO=e,this.main=function(){D(document,"submit",t._handleAction),D(document,"change",t._handleAction),t.growingIO.vdsConfig.touch?new ht(t._handleAction).main():D(document,"click",t._handleAction)},this._handleAction=function(e,r){var i=t.growingIO,o=i.vdsConfig,a=i.emitter;if(!o.autotrack)return!1;var s=e.target;if(!s)return!1;var u=new ft(s,e.type,!0).trackNodes();if("click"!==e.type&&(u=C(f(u))?[]:[f(u)]),C(u))return!1;o.debug&&console.log("Action：",e.type,Date.now()),null==a||a.emit("onComposeBefore",{event:r,params:null!=e?e:{}}),u.forEach((function(r){var i=r.fullXpath,o=r.index,a=r.content,s=r.href;if(i){var u=t.growingIO.dataStore,c=u.eventContextBuilder,d=u.eventConverter,l=u.currentPage;d(n(n({eventType:Y[e.type],element:[{xpath:i,index:o,textValue:a,hyperlink:s}]},c()),{pageShowTimestamp:l.time}))}}))}};window.gioEventAutoTracking={name:"gioEventAutoTracking",method:pt};var vt={name:"gioEventAutoTracking",method:pt},mt=["VIEW_CLICK","VIEW_CHANGE","FORM_SUBMIT","PAGE","CUSTOM","LOGIN_USER_ATTRIBUTES"],wt=["LOGIN_USER_ATTRIBUTES"],It=function(e){var t=this;this.growingIO=e,this.penetrateHybrid=!0,this.main=function(e){var n;t.projectId=e.projectId,s(e.penetrateHybrid)&&(t.penetrateHybrid=e.penetrateHybrid),t._initHybridBridge();var r=t.projectId===(null===(n=t.hybridConfig)||void 0===n?void 0:n.projectId);if(r){var i=t.growingIO.emitter;null==i||i.on(se,(function(e){var n=e.newUserId,r=e.oldUserId,i=e.userKey;t.penetrateHybrid&&(!n&&r?i?t._clearNativeUserIdAndUserKey():t._clearNativeUserId():i?t._setNativeUserIdAndUserKey(v(n),v(i)):t._setNativeUserId(v(n)))})),null==i||i.on(ue,(function(e){var n=e.newUserKey,r=e.oldUserKey,i=e.userId;t.penetrateHybrid&&(!n&&r?t._clearNativeUserIdAndUserKey():t._setNativeUserIdAndUserKey(v(i),v(n)))}))}return r},this._initHybridBridge=function(){var e,n,r;t.hasHybridBridge=!!window.GrowingWebViewJavascriptBridge,t.hasHybridBridge&&((null===(e=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===e?void 0:e.configuration)||(window.GrowingWebViewJavascriptBridge.configuration=JSON.parse(window.GrowingWebViewJavascriptBridge.getConfiguration())),(null===(n=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===n?void 0:n.configuration)&&(t.hybridConfig=null===(r=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===r?void 0:r.configuration))},this.onSendBefore=function(e){var n,r,i=e.requestData;t.hasHybridBridge&&mt.includes(i.eventType)&&(wt.includes(i.eventType)?t.penetrateHybrid&&(null===(n=window.GrowingWebViewJavascriptBridge)||void 0===n||n.dispatchEvent(JSON.stringify(i))):(t.penetrateHybrid||(T(i,"userId"),T(i,"userKey"),T(i,"cs1")),null===(r=window.GrowingWebViewJavascriptBridge)||void 0===r||r.dispatchEvent(JSON.stringify(i))))},this._setNativeUserId=function(e){k((function(){return window.GrowingWebViewJavascriptBridge.setNativeUserId(e)}))},this._clearNativeUserId=function(){k((function(){return window.GrowingWebViewJavascriptBridge.clearNativeUserId()}))},this._setNativeUserIdAndUserKey=function(e,t){k((function(){return window.GrowingWebViewJavascriptBridge.setNativeUserIdAndUserKey(e,t)}))},this._clearNativeUserIdAndUserKey=function(){k((function(){return window.GrowingWebViewJavascriptBridge.clearNativeUserIdAndUserKey()}))}};window.gioHybridAdapter={name:"gioHybridAdapter",method:It};var yt,bt={name:"gioHybridAdapter",method:It},Ot=["i","span","em","b","strong","svg"];!function(e){e[e.OUTER=0]="OUTER",e[e.INNER_COVERED=1]="INNER_COVERED",e[e.INNER_SHOW=2]="INNER_SHOW"}(yt||(yt={}));var St=r(["HR","BR","SCRIPT","NOSCRIPT","STYLE","HEAD","BASE","LINK","META","TITLE","BODY","HTML","TEMPLATE","CODE"],_e,!0),Et=["SELECT","A","BUTTON","INPUT","IMG","FORM"],Nt=function(e,t,n){return document.elementFromPoint(t,n)===e},Tt=function(){function e(e,t,n){this.node=e,this.parentNodeDesc=t,this.devicesInfo=n,this.proxy=new ft(e),this.tagName=this.node.tagName,this.name=this.tagName.toLowerCase(),this.isIgnore=!!this.node.dataset.growingIgnore,this.isUnSupported=-1!==St.indexOf(this.tagName),this.rect=this.computeWindowRect()}return e.prototype.info=function(){var e=this.desc();e.zLevel+=this.devicesInfo.webviewZLevel;var t=this.getDeviceRect(this.rect);return T(e,"isContainer"),n(n(n({},e),t),{parentXPath:this.parentNodeDesc.isContainer?this.parentNodeDesc.xpath:void 0,href:this.proxy.href,content:this.proxy.content,nodeType:this.nodeType()})},e.prototype.nodeType=function(){return"input"!==this.name||Ye(this.node)?this.node.tagName:"INPUT_BTN"},e.prototype.desc=function(){return{index:this.parentNodeDesc.index||this.proxy.index,zLevel:this.zLevel(),xpath:this.proxy.xpath,isContainer:this.isDefinedContainer()}},e.prototype.cssVisible=function(){var e=this.computedStyle();return Number(e.opacity)>0&&"visible"===e.visibility&&"none"!==e.display},e.prototype.viewportStatus=function(){var e=this.rect,t=e.top,n=e.left,r=e.width,i=e.height,o=this.devicesInfo,a=o.winWidth,s=o.winHeight;if(0>=r||0>=i)return yt.OUTER;var u=this.node;return s>t&&a>n&&r>0&&i>0?Nt(u,n+r/2,t+i/2)||Nt(u,n+1,t+1)||Nt(u,n+r-1,t+1)||Nt(u,n+1,t+i-1)||Nt(u,n+r-1,t+i-1)?yt.INNER_SHOW:yt.INNER_COVERED:yt.OUTER},e.prototype.isCircleable=function(){return this.proxy.target===this.proxy.origin&&(!!this.isDefinedContainer()||!("input"===this.name&&this.node instanceof HTMLInputElement&&"password"===this.node.type)&&(-1!==Et.indexOf(this.name)||(Me(this.node)?!this.isBigBlank():this.hasBackgroundImage()&&$e(this.node,4))))},e.prototype.isSimpleContainer=function(){return"select"===this.name||this.isDefaultContainer()&&(function(e,t){if(0===e.children.length)return!1;for(var n=0,r=Array.from(e.children);n<r.length;n++){var i=r[n];if(-1===t.indexOf(i.tagName.toLowerCase()))return!1}return!0}(this.node,Ot)||!this.node.childElementCount)},e.prototype.isDefinedContainer=function(){var e;return i(this.isContainer)?this.isDefaultContainer()||this.isMarkContainer()||ze(this.node)&&(!!(null===(e=this.node.innerText)||void 0===e?void 0:e.trim().length)||function(e){var t=e.attributes;if(t.length>0)for(var n=0;n<t.length;n++){var r=t[n].value;if(r&&"false"!==r)return!0}return!1}(this.node))||"select"===this.name:!!this.isContainer},e.prototype.isDefaultContainer=function(){return-1!==Te.indexOf(this.tagName)||Qe(this.node)},e.prototype.isMarkContainer=function(){return this.node.hasAttribute("data-growing-container")||this.node.hasAttribute("growing-container")},e.prototype.isBigBlank=function(){var e=this.node.innerText.trim().length,t=this.rect,n=t.width,r=t.height,i=this.devicesInfo,o=i.winWidth,a=i.winHeight;return!e&&(n>o>>1||r>a>>1)},e.prototype.hasBackgroundImage=function(){var e=this.computedStyle().backgroundImage;return!!e&&"none"!==e&&e.length>0},e.prototype.zLevel=function(){var e=this.computedStyle(),t=e.zIndex;if("auto"!==t)return Number(t||"0")+this.parentNodeDesc.zLevel;switch(e.position){case"relative":return this.parentNodeDesc.zLevel+2;case"sticky":return this.parentNodeDesc.zLevel+3;case"absolute":return this.parentNodeDesc.zLevel+4;case"fixed":return this.parentNodeDesc.zLevel+5;default:return this.parentNodeDesc.zLevel+1}},e.prototype.computeWindowRect=function(){if(this.rect)return this.rect;var e=this.node.getBoundingClientRect(),t=e.top,n=e.bottom,r=e.left,i=e.right-r,o=n-t;return 0>t?o=t+o:t+o>this.devicesInfo.winHeight&&(o=this.devicesInfo.winHeight-t),0>r?i=r+i:r+i>this.devicesInfo.winWidth&&(i=this.devicesInfo.winWidth-r),this.rect={top:t,left:r,width:i,height:o},this.rect},e.prototype.computedStyle=function(){return window.getComputedStyle(this.node)},e.prototype.getDeviceRect=function(e){var t=this.devicesInfo,n=t.scale,r=t.webviewTop,i=t.webviewLeft;return{top:e.top*n+r,left:e.left*n+i,width:e.width*n,height:e.height*n}},e}(),Ct=["DOMContentLoaded","onreadystatechange"],xt=["scroll","resize","load","beforeunload","popstate","hashchange","pagehide","unload"];function At(e,t,n,r,i){var o=document.documentElement.clientWidth;return{winWidth:o,winHeight:document.documentElement.clientHeight,scale:n/o,webviewTop:t,webviewLeft:e,webviewWidth:n,webviewHeight:r,webviewZLevel:i}}var _t,kt=function(){function e(e){this.growingIO=e,this.addDomChangeListener()}return e.prototype.getDomTree=function(e,t,n,r,i,o){console.info("HYBRID: 调用getDomTre方法，参数",arguments);var a=At(e,t,n,r,i),s={isContainer:!1,zLevel:0},u=this.getElementsByParent(o||document.body,s,a),c={page:this.growingIO.dataStore.currentPage,elements:u};return console.log("HYBRID: 元素节点信息",c),c},e.prototype.getElementsByParent=function(e,t,n){var r=this,i=[];return[].slice.call(e.childNodes,0).filter((function(e){return 1===e.nodeType})).forEach((function(e){var o=new Tt(e,t,n);if(o.cssVisible()&&!o.isIgnore){switch(o.viewportStatus()){case yt.INNER_SHOW:o.isCircleable()&&i.push(o.info());break;case yt.INNER_COVERED:o.isDefaultContainer()&&i.push(o.info())}o.isSimpleContainer()||[].push.apply(i,r.getElementsByParent(e,o.desc(),n))}})),i},e.prototype.addDomChangeListener=function(){var e,t=function(t){return void 0===t&&(t=""),function(){var n;"beforeunload"===t&&e&&e.disconnect(),console.log("HYBRID: 调用桥onDomChanged方法，事件类型:",t),null===(n=window.GrowingWebViewJavascriptBridge)||void 0===n||n.onDomChanged()}};(e=new MutationObserver(t("mutation"))).observe(document.body,{attributes:!0,characterData:!0,childList:!0,subtree:!0}),Ct.forEach((function(e){D(document,e,t(e))})),xt.forEach((function(e){D(window,e,t(e))}))},e}(),Pt=function(e){var t,n=this;this.growingIO=e,null===(t=this.growingIO.emitter)||void 0===t||t.on(ae,(function(){window.GrowingWebViewJavascriptBridge&&(_t=new kt(n.growingIO),window.GrowingWebViewJavascriptBridge.getDomTree=_t.getDomTree.bind(_t))}))};window.gioHybridCircle={name:"gioHybridCircle",method:Pt};var Dt={name:"gioHybridCircle",method:Pt},Ut=function(e){var t,n=this;this.growingIO=e,this.documentReady=!1,this.main=function(e){"listener"===e?(n.documentReady=!0,n.growingIO.gioSDKInitialized&&n.initMutationObserver()):"emitter"===e&&n.documentReady&&n.initMutationObserver()},this.initIntersectionObserver=function(){n.intersectionObserver=new IntersectionObserver((function(e){C(e)||e.map((function(e){var t=e.target.dataset;if(e.intersectionRatio>0){var r=n.getImpressionProperties(t),i=r.eventId,o=r.properties,a=r.items,s=t.id;if(s){if("once"===t.gioImpType&&O(n.sentImps,s))return;n.sentImps[s]={eventId:i,properties:o,items:a}}i&&n.growingIO.track(i,o,a)}}))}))},this.initMutationObserver=function(){var e=document.querySelectorAll("[data-gio-imp-track]");Array.from(e).map((function(e){var t;null===(t=n.intersectionObserver)||void 0===t||t.observe(e)})),n.mutationObserver=new MutationObserver((function(e){return e.map((function(e){var t;if("attributes"===e.type&&e.target.dataset.gioImpTrack)return null===(t=n.intersectionObserver)||void 0===t?void 0:t.observe(e.target)}))})),n.mutationObserver.observe(document.body,{attributes:!0,childList:!0,subtree:!0,attributeOldValue:!0,attributeFilter:["data-gio-imp-track","data-gio-imp-attrs","data-gio-imp-items",/^data-gio-track-[a-z]+$/i]})},this.getImpressionProperties=function(e){var t={eventId:void 0,properties:{}};if(!(null==e?void 0:e.gioImpTrack))return t;if(t.eventId=e.gioImpTrack,O(e,"gioImpAttrs"))t.properties=k((function(){return u(e.gioImpAttrs)?e.gioImpAttrs:JSON.parse(e.gioImpAttrs)})),t.items=k((function(){return u(e.gioImpItems)?e.gioImpItems:JSON.parse(e.gioImpItems)}));else{var n=/^gioTrack(.+)/;for(var r in e){var i=void 0,o=r.match(n);o&&"track"!==(i=w(o[1]))&&(t.properties[i]=e[r])}}return t.properties=P(t.properties),t.items=P(t.items),/^\w+$/.test(t.eventId)&&!Number.isInteger(Number(g(t.eventId.split(""))))||(t.eventId=null,t={}),t},this.sentImps={},H()?_("IE浏览器不支持半自动埋点，gioImpressionTracking已自动关闭！","warn"):(this.initIntersectionObserver(),D(document,"readystatechange",(function(){"complete"===document.readyState&&n.main("listener")}),{once:!0}),null===(t=this.growingIO.emitter)||void 0===t||t.on(ae,(function(){return n.main("emitter")})),D(window,"unload",(function(){n.intersectionObserver.disconnect(),n.mutationObserver.disconnect()})))};window.gioImpressionTracking={name:"gioImpressionTracking",method:Ut};var Lt={name:"gioImpressionTracking",method:Ut},qt=function(e){var t,n=this;this.growingIO=e,this.injectCircle=function(e,t){var n=document.createElement("link"),r=document.createElement("script");n.rel="stylesheet",n.href=e,r.src=t,document.head.appendChild(n),document.head.appendChild(r)},null===(t=this.growingIO.emitter)||void 0===t||t.on(ae,(function(){window.addEventListener("message",(function(e){var t=e.data,r=e.source,i=window.vds;if(t&&r){var o=r.vds,a=t.cssURL,s=t.jsURL;o&&"SDK_INJECT_CIRCLE_SCRIPT"===t.type&&i.projectId===o.projectId&&i.dataSourceId===o.dataSourceId&&n.injectCircle(a,s)}}))}))};window.gioWebCircle={name:"gioWebCircle",method:qt};var Rt={name:"gioWebCircle",method:qt},Bt=function(e){function n(t){var n=e.call(this,t)||this;return n.growingIO=t,n.pluginsContext={plugins:[pe,we,Ee,vt,bt,Dt,Lt,Rt]},n}return t(n,e),n}((function(e){var t,n,r,i,o=this;this.growingIO=e,this.innerPluginInit=function(){var e;S(null===(e=o.pluginsContext)||void 0===e?void 0:e.plugins).forEach((function(e){var t,n=null===(t=o.pluginsContext)||void 0===t?void 0:t.plugins[e],r=n.name,i=n.method;o.pluginItems.find((function(e){return e.name===r}))||o.pluginItems.push({name:w(r||e),method:i||function(e){}})})),C(o.pluginItems)||o.installAll()},this.install=function(e,t,n){var r,i,a=t||o.pluginItems.find((function(t){return t.name===e}));if((null===(r=o.growingIO)||void 0===r?void 0:r.plugins)[e])return _("重复加载插件 ".concat(e," 或插件重名，已跳过加载!"),"warn"),!1;if(!a)return _("插件加载失败!不存在名为 ".concat(e," 的插件!"),"error"),!1;try{return(null===(i=o.growingIO)||void 0===i?void 0:i.plugins)[e]=new a.method(o.growingIO,n),"cdp"===o.growingIO.gioEnvironment&&t&&_("加载插件：".concat(e),"info"),!0}catch(e){return _("插件加载异常：".concat(e),"error"),!1}},this.installAll=function(e){(e||o.pluginItems).forEach((function(t){return o.install(t.name,e?t:void 0,e?null==t?void 0:t.options:void 0)}))},this.uninstall=function(e){var t;T(o.pluginItems,e);var n=T(null===(t=o.growingIO)||void 0===t?void 0:t.plugins,e);return n||_("卸载插件 ".concat(e," 失败!"),"error"),n},this.uninstallAll=function(){o.pluginItems.forEach((function(e){return o.uninstall(e.name)}))},this.lifeError=function(e,t){return _("插件执行错误 ".concat(e.name," ").concat(t),"error")},this.onComposeBefore=function(e){o.pluginItems.forEach((function(t){var n,r=null===(n=o.growingIO.plugins[t.name])||void 0===n?void 0:n.onComposeBefore;if(r&&c(r))try{r(e)}catch(e){o.lifeError(t,e)}}))},this.onComposeAfter=function(e){o.pluginItems.forEach((function(t){var n,r=null===(n=o.growingIO.plugins[t.name])||void 0===n?void 0:n.onComposeAfter;if(r&&c(r))try{r(e)}catch(e){o.lifeError(t,e)}}))},this.onSendBefore=function(e){o.pluginItems.forEach((function(t){var n,r=null===(n=o.growingIO.plugins[t.name])||void 0===n?void 0:n.onSendBefore;if(r&&c(r))try{r(e)}catch(e){o.lifeError(t,e)}}))},this.onSendAfter=function(e){o.pluginItems.forEach((function(t){var n,r=null===(n=o.growingIO.plugins[t.name])||void 0===n?void 0:n.onSendAfter;if(r&&c(r))try{r(e)}catch(e){o.lifeError(t,e)}}))},this.pluginsContext={plugins:[]},this.pluginItems=[],null===(t=this.growingIO.emitter)||void 0===t||t.on("onComposeBefore",this.onComposeBefore),null===(n=this.growingIO.emitter)||void 0===n||n.on("onComposeAfter",this.onComposeAfter),null===(r=this.growingIO.emitter)||void 0===r||r.on("onSendBefore",this.onSendBefore),null===(i=this.growingIO.emitter)||void 0===i||i.on("onSendAfter",this.onSendAfter)}));function jt(e){for(var t=1;arguments.length>t;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}var Ht,Kt,Vt=function e(t,n){function r(e,r,i){if("undefined"!=typeof document){"number"==typeof(i=jt({},n,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var a in i)i[a]&&(o+="; "+a,!0!==i[a]&&(o+="="+i[a].split(";")[0]));return document.cookie=e+"="+t.write(r,e)+o}}return Object.create({set:r,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var n=document.cookie?document.cookie.split("; "):[],r={},i=0;i<n.length;i++){var o=n[i].split("="),a=o.slice(1).join("=");try{var s=decodeURIComponent(o[0]);if(r[s]=t.read(a,s),e===s)break}catch(e){}}return e?r[e]:r}},remove:function(e,t){r(e,"",jt({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,jt({},this.attributes,t))},withConverter:function(t){return e(jt({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"}),Wt={A:1,a:1,Z:1,z:1,"@":1},Ft=function(e){return i(e)?e:k((function(){return"gioenc-".concat(Mt(e))}))||e},Gt=function(e){return o(e)&&e.startsWith("gioenc-")&&k((function(){return Mt(e.replace("gioenc-",""))}))||e},Mt=function(e){return(e=e||"").split("").map((function(e){return Wt[e]?e:zt(e)})).join("")},zt=function(e){if(/[0-9]/.test(e))return 1^+e;var t=e.charCodeAt(0);return String.fromCharCode(1^t)},Jt={},Xt=window.self===window.top&&!["","localhost","127.0.0.1"].includes(window.location.hostname)&&["http:","https:"].includes(window.location.protocol)||!function(e){try{var t=window.localStorage,n="__storage_test__";return t.setItem(n,n),t.removeItem(n),!0}catch(e){return!1}}()?function(){var e=!1;if(navigator.cookieEnabled)return!0;var t=document.cookie;return document.cookie="gioCookie=yes;",document.cookie.indexOf("gioCookie=yes")>-1&&(e=!0),document.cookie=t,e}()?function(){this.getItem=function(e){return K(Gt(Vt.get(j(e))))},this.setItem=function(e,t,n){return B().forEach((function(r){var i;i=o(t)?t.length?e.endsWith("_gioenc")?Ft(t):t:"":JSON.stringify(t),Vt.set(j(e),i,{expires:n?new Date(n):3650,domain:r})}))},this.removeItem=function(e){return B().forEach((function(t){return Vt.remove(j(e),{domain:t})}))},this.hasItem=function(e){return S(Vt.get()).includes(j(e))},this.getKeys=function(){return S(Vt.get())}}:function(){this.getItem=function(e){var t=k((function(){return JSON.parse(Jt[j(e)]||"")}));return u(t)&&t.expiredAt>+Date.now()?K(Gt(t.value)):void 0},this.setItem=function(e,t,n){var r=null!=n?n:+new Date(9999,12);Jt[j(e)]=JSON.stringify({value:o(t)&&t.length?Ft(t):t,expiredAt:r})},this.removeItem=function(e){return T(Jt,j(e))},this.hasItem=function(e){return O(Jt,j(e))},this.getKeys=function(){return S(Jt)}}:function(){this.getItem=function(e){var t=k((function(){return JSON.parse(localStorage.getItem(j(e))||"")}))||{};return u(t)&&t.expiredAt>+Date.now()?K(Gt(t.value)):void 0},this.setItem=function(e,t,n){var r=null!=n?n:+new Date(9999,12);localStorage.setItem(j(e),JSON.stringify({value:o(t)&&t.length&&e.endsWith("_gioenc")?Ft(t):t,expiredAt:r}))},this.removeItem=function(e){return localStorage.removeItem(j(e))},this.hasItem=function(e){return!!localStorage.getItem(j(e))},this.getKeys=function(){return Array.from(Array(localStorage.length)).map((function(e,t){return localStorage.key(t)}))}},Zt=function(){function e(e){var t,n=this;this.growingIO=e;var r=this.growingIO.vdsConfig.projectId,i=this.growingIO.storage,o=i.getItem,a=i.setItem;this.getItem=o,this.setItem=a,this.sIdStorageName="".concat(r,"_gdp_session_id"),this.uidStorageName="gdp_user_id_gioenc",this.userIdStorageName="".concat(r,"_gdp_cs1_gioenc"),this.userKeyStorageName="".concat(r,"_gdp_user_key_gioenc"),this.gioIdStorageName="".concat(r,"_gdp_gio_id_gioenc"),null===(t=this.growingIO.emitter)||void 0===t||t.on(ce,(function(){n.growingIO.gioSDKInitialized&&(n.growingIO.dataStore.sendVisit(!0),n.growingIO.dataStore.sendPage(!0))}))}return Object.defineProperty(e.prototype,"sessionId",{get:function(){return this.getItem(this.sIdStorageName)||(this.sessionId=L(),this.sessionId)},set:function(e){var t;e||(e=L());var n=this.getItem(this.sIdStorageName)||this.prevSessionId,r=this.growingIO.vdsConfig.sessionExpires,i=void 0===r?30:r;this.setItem(this.sIdStorageName,e,+Date.now()+60*i*1e3),n!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit(ce,{newSessionId:e,oldSessionId:n})),this.prevSessionId=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uid",{get:function(){return this.getItem(this.uidStorageName)||(this.uid=L(),this.uid)},set:function(e){var t,n=this.getItem(this.uidStorageName)||this.prevUId;this.setItem(this.uidStorageName,e),n!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit("UID_UPDATE",{newUId:e,oldUId:n})),this.prevUId=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userId",{get:function(){return this.getItem(this.userIdStorageName)||""},set:function(e){var t,n=this.getItem(this.userIdStorageName)||this.prevUserId;this.setItem(this.userIdStorageName,e),n!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit(se,{newUserId:e,oldUserId:n,userKey:this.userKey})),e&&(this.gioId=e),this.prevUserId=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userKey",{get:function(){return this.getItem(this.userKeyStorageName)||""},set:function(e){var t,n=this.getItem(this.userKeyStorageName)||this.prevUserKey;this.setItem(this.userKeyStorageName,e),n!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit(ue,{newUserKey:e,oldUserKey:n,userId:this.userId})),this.prevUserKey=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"gioId",{get:function(){return this.getItem(this.gioIdStorageName)||""},set:function(e){var t,n=this.getItem(this.gioIdStorageName)||this.prevGioId;this.setItem(this.gioIdStorageName,e),n!==e&&(null===(t=this.growingIO.emitter)||void 0===t||t.emit("GIOID_UPDATE",{newGioId:e,oldGioId:n})),this.prevGioId=e},enumerable:!1,configurable:!0}),e}(),Qt=function(e){var t=this;this.growingIO=e,this.main=function(){var e,r=t.growingIO,i=r.sdkVersion,o=r.useEmbeddedInherit,a=r.vdsConfig,s=r.userStore,u=r.dataStore,c=r.trackingId,d=u.currentPage,l=d.path,g=d.query,f={appVersion:a.version,dataSourceId:a.dataSourceId,deviceId:s.uid,domain:o?a.appId:window.location.host,gioId:s.gioId,language:navigator.language,path:l,platform:a.platform,query:g,referralPage:(null===(e=u.lastPageEvent)||void 0===e?void 0:e.referralPage)||"",screenHeight:window.screen.height,screenWidth:window.screen.width,sdkVersion:i,sessionId:s.sessionId,timestamp:+Date.now(),title:document.title.slice(0,255),userId:s.userId};return a.enableIdMapping&&(f.userKey=s.userKey),C(t.minpExtraParams)||(f=n(n({},f),t.minpExtraParams)),C(a.ignoreFields)||a.ignoreFields.forEach((function(e){T(f,e)})),f.trackingId=c,f},this.minpExtraParams={}},Yt=function(e){var t=this;this.growingIO=e,this.parsePage=function(){var e=t.growingIO.vdsConfig.hashtag,n=location.pathname,r=location.search,i=location.hash,o=i.indexOf("?");t.domain=window.location.host,t.path=n,e&&(t.path+=o>-1?i.slice(0,o):i),t.query=r,e&&o>-1&&(t.query=t.query+"&"+i.slice(o+1)),t.query&&["?","&"].includes(t.query.charAt(0))&&(t.query=t.query.slice(1)),t.time=+Date.now()},this.pageListener=function(){t.lastHref!==window.location.href&&(t.parsePage(),t.buildPageEvent(),t.lastHref=window.location.href,t.lastLocation=window.location)},this.hookHistory=function(){var e=window.history.pushState,n=window.history.replaceState;e&&(k((function(){return window.history.pushState=function(n,r,i){e.call(window.history,n,r,i),setTimeout(t.pageListener)}})),D(window,"popstate",(function(){location.pathname===t.lastLocation.pathname&&location.search===t.lastLocation.search||t.pageListener}))),n&&k((function(){return window.history.replaceState=function(e,r,i){n.call(window.history,e,r,i),setTimeout(t.pageListener)}})),t.growingIO.vdsConfig.hashtag&&D(window,"hashchange",t.pageListener)},this.buildPageEvent=function(e){var r=t.growingIO.dataStore,i=r.lastPageEvent,o=r.eventContextBuilder,a=r.eventConverter,s=n(n({eventType:"PAGE"},o()),{protocolType:location.protocol.substring(0,location.protocol.length-1),referralPage:(null==i?void 0:i.path)===t.path&&(null==i?void 0:i.query)===t.query?null==i?void 0:i.referralPage:(null==i?void 0:i.path)?t.lastHref:document.referrer});C(e)||(s=n(n({},s),e)),s.timestamp=t.time,a(s)},this.lastHref=window.location.href,this.lastLocation=window.location},$t=function(){function e(e){var t,r,a=this;this.growingIO=e,this.ALLOW_SETTING=n(n({},W),"saas"===this.growingIO.gioEnvironment?G:F),this.allowOptKeys=Object.keys(this.ALLOW_SETTING),this.trackTimers={},this.initStorageId=function(){var e=a.growingIO.storage.getItem(a.seqStorageIdName)||{},t=n({},e);T(t,"globalKey"),t=u(t)&&!i(t)?t:{},a._esid={},S(t).forEach((function(e){a._esid[e]=Number.isNaN(Number(t[e]))||t[e]>=1e9||1>t[e]?1:t[e]})),N(t,a._esid)||a.setSequenceIds("esid",a._esid);var r=Number(e.globalKey);a._gsid=Number.isNaN(r)||r>=1e9||1>r?1:r,r!==a._gsid&&a.setSequenceIds("gsid",a._gsid)},this.setSequenceIds=function(e,t){var r=a.growingIO.storage.getItem(a.seqStorageIdName)||{};"gsid"===e?r.globalKey=t:r=n(n({},r),t),a.growingIO.storage.setItem(a.seqStorageIdName,r)},this.initOptions=function(e){var t=e.projectId,r=e.dataSourceId,i=e.appId;a.initialDataSourceId=r;var o={};a.allowOptKeys.forEach((function(t){var n=a.ALLOW_SETTING[t].type,r=d(n)?!n.includes(x(e[t])):x(e[t])!==a.ALLOW_SETTING[t].type;"platform"!==t||V.includes(e[t])||(r=!0),r?o[t]=a.ALLOW_SETTING[t].default:"ignoreFields"===t?o.ignoreFields=e.ignoreFields.filter((function(e){return Q.includes(e)})):(o[t]=e[t],["dataCollect","autotrack"].includes(t)&&(o[t]||_("已关闭".concat(X[t]),"info")))})),o.sessionExpires=Math.round(o.sessionExpires),(Number.isNaN(o.sessionExpires)||1>o.sessionExpires||o.sessionExpires>360)&&(o.sessionExpires=30),a.growingIO.vdsConfig=n(n({},o),{projectId:t,dataSourceId:r,appId:i,sdkVer:a.growingIO.sdkVersion}),window.vds=a.growingIO.vdsConfig,a.seqStorageIdName="".concat(t,"_gdp_sequence_ids")},this.setOption=function(e,t){var r,i=a.growingIO,s=i.vdsConfig,u=i.callError,c=i.uploader,d=i.emitter,l=o(e)&&J.includes(e),g=l&&typeof t===((null===(r=a.ALLOW_SETTING[e])||void 0===r?void 0:r.type)||"string"),f=n({},s);return l&&g?(s[e]=t,"dataCollect"===e&&f.dataCollect!==t&&(t?(a.sendVisit(!0),a.sendPage()):a.growingIO.clearTrackTimer()),["host","scheme"].includes(e)&&(null==c||c.generateHost()),null==d||d.emit("OPTION_CHANGE",{optionName:e,optionValue:t}),!0):(u("setOption > ".concat(e)),!1)},this.getOption=function(e){var t=a.growingIO,r=t.vdsConfig,o=t.callError;return e&&O(r,v(e))?r[v(e)]:i(e)?n({},r):void o("getOption > ".concat(e))},this.sendVisit=function(e){var t=a.growingIO,n=t.userStore.sessionId,r=t.vdsConfig.projectId,i=t.storage,o="".concat(r,"_gdp_session_id_").concat(n),s=i.getItem(o);!e&&[!0,"true"].includes(s)||(a.buildVisitEvent(),i.setItem(o,!0))},this.buildVisitEvent=function(e){var t=a.growingIO.dataStore,r=t.eventContextBuilder,i=t.eventConverter,o=n(n({eventType:"VISIT"},r()),{referral:a.lastVisitEvent.referral,referralPage:a.lastPageEvent.referralPage});C(e)||(o.session=(null==e?void 0:e.session)||o.session,o.trackingId=null==e?void 0:e.trackingId,o=n(n({},o),e)),i(o)},this.sendPage=function(e){e&&a.currentPage.parsePage(),a.currentPage.buildPageEvent()},this.buildErrorEvent=function(e){var t=a.growingIO.dataStore,r=t.eventContextBuilder;(0,t.eventConverter)(n({eventType:"CUSTOM",pageShowTimestamp:a.currentPage.time,eventName:"onError",attributes:e},r()))},this.currentPage=new Yt(this.growingIO),this.eventContextBuilderInst=new Qt(this.growingIO),this.eventContextBuilder=this.eventContextBuilderInst.main,this.generalProps={},this.lastVisitEvent={referralPage:document.referrer},null===(t=this.growingIO.emitter)||void 0===t||t.on("onComposeAfter",(function(e){var t=e.composedEvent;"VISIT"!==t.eventType&&"vst"!==t.t||t.trackingId!==a.growingIO.trackingId||(a.lastVisitEvent=t)})),this.lastPageEvent={},null===(r=this.growingIO.emitter)||void 0===r||r.on("onComposeAfter",(function(e){var t=e.composedEvent;"PAGE"!==t.eventType&&"page"!==t.t||t.trackingId!==a.growingIO.trackingId||(a.lastPageEvent=t)}))}return Object.defineProperty(e.prototype,"esid",{get:function(){var e=this,t=this.growingIO.storage.getItem(this.seqStorageIdName)||{},r=n({},t);return T(r,"globalKey"),r=u(r)&&!i(r)?r:{},this._esid={},S(r).forEach((function(t){e._esid[t]=Number.isNaN(Number(r[t]))||r[t]>=1e9||1>r[t]?1:r[t]})),this._esid},set:function(e){var t={};S(e).forEach((function(n){t[n]=Number.isNaN(e[n])||e[n]>=1e9||1>e[n]?1:e[n]})),N(this._esid,t)||(this._esid=t,this.setSequenceIds("esid",this._esid))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"gsid",{get:function(){var e=this.growingIO.storage.getItem(this.seqStorageIdName)||{},t=Number(e.globalKey);return this._gsid=Number.isNaN(t)||t>=1e9||1>t?1:t,this._gsid},set:function(e){var t=Number(e);this._gsid=Number.isNaN(t)||e>=1e9||1>e?1:e,this.setSequenceIds("gsid",this._gsid)},enumerable:!1,configurable:!0}),e}(),en=function(e){function r(t){var r=e.call(this,t)||this;return r.growingIO=t,r.eventConverter=function(e){var t,o,a=r.growingIO,s=a.vdsConfig,u=a.dataStore,c=a.uploader;if(s.dataCollect){e.trackingId===r.growingIO.trackingId&&(e.globalSequenceId=u.gsid,e.eventSequenceId=u.esid[e.eventType]||1);var d={};E(e,(function(e,t){var n;if("element"===t){var r=null!==(n=g(e))&&void 0!==n?n:{};E(r,(function(e,t){C(e)&&0!==e||(d[t]=e)}))}else(C(e)||i(e))&&0!==e||(d[t]=e)})),e.trackingId===r.growingIO.trackingId&&(r.growingIO.dataStore.gsid+=1,r.growingIO.dataStore.esid=n(n({},r.growingIO.dataStore.esid),((t={})[d.eventType]=(r.growingIO.dataStore.esid[d.eventType]||1)+1,t))),null===(o=r.growingIO.emitter)||void 0===o||o.emit("onComposeAfter",{composedEvent:n({},d)}),e.trackingId===r.growingIO.trackingId&&c.commitRequest(d)}},r}return t(r,e),r}($t),tn=function(e){function n(t){var n=e.call(this,t)||this;return n.growingIO=t,n.generateHost=function(){var e=n.growingIO.vdsConfig,t=e.scheme,r=e.host,i=void 0===r?"":r,o=e.projectId;t?y(v(t),"://")||(t="".concat(t,"://")):t="".concat(location.protocol.indexOf("http")>-1?location.protocol.replace(":",""):"https","//"),I(i,"http")&&(i=i.substring(i.indexOf("://")+(y(v(t),"://")?4:1))),n.requestURL="".concat(t).concat(i,"/v3/projects/").concat(o,"/collect")},n.requestURL="",n.generateHost(),n}return t(n,e),n}((function(e){var t=this;this.growingIO=e,this.commitRequest=function(e){var r=n({},e);t.requestQueue.push(n(n({},r),{requestType:q()?"Beacon":"XHR"})),t.initiateRequest()},this.initiateRequest=function(){var e,i,o;if(r([],t.requestQueue,!0).length>0&&t.requestingNum<t.requestLimit){var a=t.growingIO,s=a.vdsConfig,u=a.emitter,c=a.plugins,d=a.useHybridInherit;if(t.requestQueue=r([],t.requestQueue,!0).filter((function(e){return(t.retryIds[e.globalSequenceId||e.esid]||0)<=t.retryLimit})),C(t.requestQueue))return;var l=t.requestQueue.shift(),g=l.requestType;if(null==u||u.emit("onSendBefore",{requestData:l}),T(l,["requestType","trackingId"]),s.debug&&console.log("[GrowingIO Debug]:",JSON.stringify(l,null,2).replace(/\"/g,(o=window.navigator.userAgent,/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(o)&&!/chrome\/(\d+\.\d+)/i.test(o)?"":'"'))),t.requestingNum+=1,d)return t.requestSuccessFn(l),!1;var f=n({},l);switch(s.compress&&(null===(e=null==c?void 0:c.gioCompress)||void 0===e?void 0:e.compressToUint8Array)?(t.compressType="1",f=null===(i=null==c?void 0:c.gioCompress)||void 0===i?void 0:i.compressToUint8Array(JSON.stringify([f]))):(t.compressType="0",f=JSON.stringify([f])),g){case"Beacon":default:t.sendByBeacon(l,f);break;case"XHR":t.sendByXHR(l,f);break;case"Image":t.sendByImage(l,f)}}},this.generateURL=function(){return"".concat(t.requestURL,"?stm=").concat(+Date.now(),"&compress=").concat(t.compressType)},this.sendByBeacon=function(e,n){navigator.sendBeacon(t.generateURL(),n)?t.requestSuccessFn(e):t.requestFailFn(e,"Beacon")},this.sendByXHR=function(e,n){var r,i=["unload","beforeunload","pagehide"].includes(null===(r=null===window||void 0===window?void 0:window.event)||void 0===r?void 0:r.type),o=new XMLHttpRequest;if(o)return o.open("POST",t.generateURL(),i),o.onreadystatechange=function(){4===o.readyState&&204===o.status?t.requestSuccessFn(e):t.requestFailFn(e,"XHR")},o.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),void o.send(n);if(null===window||void 0===window?void 0:window.XDomainRequest){var a=new window.XDomainRequest;a.open("POST",t.generateURL().replace("https://","http://"),i),a.onload=function(){204===a.status?t.requestSuccessFn(e):t.requestFailFn(e,"XHR")},a.onerror=a.ontimeout=function(){t.requestFailFn(e,"XHR")},a.send(n)}},this.sendByImage=function(e,n){var r="".concat(t.generateURL(),"&data=").concat(n),i=document.createElement("img");i.width=1,i.height=1,i.onload=function(){t.requestSuccessFn(e),t.clearImage(i)},i.onerror=i.onabort=function(){t.requestFailFn(e,"Image"),t.clearImage(i)},i.src=r},this.clearImage=function(e){e.src="",e.onload=function(){},e.onerror=e.onerabort=function(){},e=null},this.requestSuccessFn=function(e){var n;t.requestingNum-=1;var r=e.globalSequenceId||e.esid||-1;t.retryIds[r]&&(t.retryIds[r]=0),t.growingIO.userStore.sessionId=t.growingIO.userStore.sessionId,null===(n=t.growingIO.emitter)||void 0===n||n.emit("onSendAfter",{requestData:e}),t.initiateRequest()},this.requestFailFn=function(e,r){t.requestingNum-=1;var i=e.globalSequenceId||e.esid||-1;t.retryIds[i]||(t.retryIds[i]=0),t.retryIds[i]+=1;var o=t.requestQueue.some((function(t){return t.globalSequenceId===e.globalSequenceId&&t.esid===e.esid})),a=r;t.retryIds[i]<t.retryLimit+1||(a="Beacon"===r?"XHR":"XHR"===r?"Image":void 0,t.retryIds[i]=0),!o&&a&&t.requestQueue.push(n(n({},e),{requestType:a}))},this.requestQueue=[],this.requestLimit=10,this.requestTimeout=5e3,this.retryLimit=1,this.retryIds={},this.requestingNum=0,this.requestURL=""})),nn=function(e){function a(){var t=e.call(this)||this;return t.registerPlugins=function(e){e.forEach((function(t,r){var o;C(t)||i(t)?_("插件不合法，跳过加载!","warn"):t.js&&(e[r]=n(n({},null===(o=t.js)||void 0===o?void 0:o.default),{options:t.options}))})),e=p(e),t.plugins.pluginItems=r(r([],t.plugins.pluginItems,!0),e,!0),t.plugins.installAll(e)},t.initCallback=function(){var e,n;t.userStore=new Zt(t),t.uploader=new tn(t),null===(n=null===(e=t.plugins)||void 0===e?void 0:e.gioEventAutoTracking)||void 0===n||n.main(),t.vdsConfig.enableIdMapping||(t.userStore.userKey="")},t.setTrackerScheme=function(e){["http","https"].includes(e)?(t.dataStore.setOption("scheme",e),t.notRecommended()):t.callError("scheme",!1)},t.setTrackerHost=function(e){ie.test(e)||oe.test(e)?(t.dataStore.setOption("host",e),t.notRecommended()):t.callError("host",!1)},t.setDataCollect=function(e){t.setOption("dataCollect",!!e),t.notRecommended()},t.setAutotrack=function(e){t.setOption("autotrack",!!e),t.notRecommended()},t.enableDebug=function(e){t.setOption("debug",!!e),t.notRecommended()},t.enableHT=function(e){t.setOption("hashtag",!!e),t.notRecommended()},t.getVisitorId=function(){return t.userStore.uid},t.getDeviceId=function(){return t.userStore.uid},t.setUserAttributes=function(e,n){var r,i;!C(e)&&u(e)?null===(i=null===(r=t.plugins)||void 0===r?void 0:r.gioCustomTracking)||void 0===i||i.buildUserAttributesEvent(e,n):t.callError("setUserAttributes")},t.setUserId=function(e,n){if($(v(e).trim())){var r=t.userStore.gioId;t.vdsConfig.enableIdMapping&&(t.userStore.userKey=!i(n)&&v(n).length>0?v(n).slice(0,1e3):""),e=v(e).slice(0,1e3),t.userStore.userId=e,r&&r!==e&&(t.userStore.sessionId=""),r||r===e||t.dataStore.sendVisit(!0)}else t.clearUserId(),t.callError("setUserId")},t.clearUserId=function(){t.userStore.userId="",t.userStore.userKey=""},t.track=function(e,r,i,o){var a,s;((null===(s=null===(a=t.plugins)||void 0===a?void 0:a.gioCustomTracking)||void 0===s?void 0:s.buildCustomEvent)||function(){})(e,n(n({},t.dataStore.generalProps),u(r)&&!C(r)?r:{}),i,o)},t.sendPage=function(e){return t.dataStore.currentPage.buildPageEvent(e)},t.sendVisit=function(e){return t.dataStore.buildVisitEvent(e)},t.trackTimerStart=function(e,n){if(t.vdsConfig.dataCollect)if(o(e)&&!C(e)&&e.match(/^[a-zA-Z_][0-9a-zA-Z_]{0,50}$/)){var r=L();c(n)?(t.dataStore.trackTimers[r]={eventName:e,leng:0,start:+Date.now()},n(r)):_("回调方法不合法，返回timerId失败!")}else _("事件名格式不正确，只能包含数字、字母和下划线，且不能以数字开头!","error")},t.trackTimerPause=function(e){if(e&&t.dataStore.trackTimers[e]){var n=t.dataStore.trackTimers[e];n.start&&(n.leng=n.leng+(+Date.now()-n.start)),n.start=0}},t.trackTimerResume=function(e){if(e&&t.dataStore.trackTimers[e]){var n=t.dataStore.trackTimers[e];0===n.start&&(n.start=+Date.now())}},t.trackTimerEnd=function(e,r){if(t.vdsConfig.dataCollect)if(e&&t.dataStore.trackTimers[e]){var i=t.dataStore.trackTimers[e];if(0!==i.start){var o=+Date.now()-i.start;i.leng=o>0?i.leng+o:0}t.track(i.eventName,n(n({},r),{eventDuration:i.leng>864e5?0:i.leng/1e3})),t.removeTimer(e)}else _("未查找到对应的计时器，请检查!","error")},t.removeTimer=function(e){e&&t.dataStore.trackTimers[e]&&delete t.dataStore.trackTimers[e]},t.clearTrackTimer=function(){t.dataStore.trackTimers={}},t.dataStore=new en(t),t}return t(a,e),a}((function(){var e,t=this;this.trackingId="g0",this.init=function(e){var n,r,i,o,a;_("Gio Web SDK 初始化中...","info");var s=t.dataStore,u=s.initOptions,c=s.currentPage,d=s.sendVisit,l=s.sendPage;u(e),t.useEmbeddedInherit=null===(r=null===(n=t.plugins)||void 0===n?void 0:n.gioEmbeddedAdapter)||void 0===r?void 0:r.main(e),t.useHybridInherit=null===(o=null===(i=t.plugins)||void 0===i?void 0:i.gioHybridAdapter)||void 0===o?void 0:o.main(e),null==t||t.initCallback(),c.hookHistory(),c.parsePage(),null===(a=t.emitter)||void 0===a||a.emit(ae,t),_("Gio Web SDK 初始化完成！","success"),t.useEmbeddedInherit||d(),l(),t.gioSDKInitialized=!0},this.setOption=function(e,n){if(J.includes(e)){var r=t.dataStore.setOption(e,n);return r&&X[e]&&_("已".concat(n?"开启":"关闭").concat(X[e]),"info"),r}return _("不存在可修改的配置项：".concat(e,"，请检查后重试!"),"warn"),!1},this.getOption=function(e){return t.dataStore.getOption(e)},this.setGeneralProps=function(e){u(e)&&!C(e)?(t.dataStore.generalProps=n(n({},t.dataStore.generalProps),e),S(t.dataStore.generalProps).forEach((function(e){[void 0,null].includes(t.dataStore.generalProps[e])&&(t.dataStore.generalProps[e]="")}))):t.callError("setGeneralProps")},this.clearGeneralProps=function(e){d(e)&&!C(e)?e.forEach((function(e){T(t.dataStore.generalProps,e)})):t.dataStore.generalProps={}},this.reissuePage=function(){t.dataStore.sendPage()},this.notRecommended=function(){return _("不推荐的方法使用，建议使用 gio('setOption', [optionName], [value])!","info")},this.callError=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n="参数不合法"),_("".concat(t?"调用":"设置"," ").concat(e," 失败，").concat(n,"!"),"warn")},this.gioEnvironment="cdp",this.sdkVersion="3.8.0-rc.5",this.utils=n(n(n({},A),U),{qs:de}),this.emitter={all:e=e||new Map,on:function(t,n){var r=e.get(t);r?r.push(n):e.set(t,[n])},off:function(t,n){var r=e.get(t);r&&(n?r.splice(r.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var r=e.get(t);r&&r.slice().map((function(e){e(n)})),(r=e.get("*"))&&r.slice().map((function(e){e(t,n)}))}},this.gioSDKInitialized=!1,this.storage=new Xt,this.plugins=new Bt(this),this.plugins.innerPluginInit()})),rn=new nn,on=function(){var e=arguments[0];if(o(e)&&z.includes(e)&&rn[e]){var t=h(Array.from(arguments));if("init"===e){var r=ee(rn);if(!r)return;var i=te(t);if(!i)return;var a=ne(t);if(!a)return;var s=re(t);if(!s)return;var u=a.projectId,c=s.dataSourceId,d=s.appId,l=s.cdpOptions;rn.init(n(n({},l),{projectId:u,dataSourceId:c,appId:d}))}else if("registerPlugins"===e)rn.registerPlugins(t[0]);else{if(rn.gioSDKInitialized&&rn.vdsConfig)return rn[e].apply(rn,t);_("SDK未初始化!","error")}}else Z.includes(e)?_("方法 ".concat(v(e)," 已被弃用，请移除!"),"warn"):_("不存在名为 ".concat(v(e)," 的方法调用!"),"error");window.gioEnvironment="cdp",window.gioSDKVersion=rn.sdkVersion};return d(null===(Ht=null===window||void 0===window?void 0:window.gdp)||void 0===Ht?void 0:Ht.q)&&!C(null===(Kt=null===window||void 0===window?void 0:window.gdp)||void 0===Kt?void 0:Kt.q)&&window.gdp.q.forEach((function(e){on.apply(null,e)})),window.gdp=on,on}));
