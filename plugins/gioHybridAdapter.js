var e,i=function(){return i=Object.assign||function(e){for(var i,r=1,n=arguments.length;n>r;r++)for(var t in i=arguments[r])({}).hasOwnProperty.call(i,t)&&(e[t]=i[t]);return e},i.apply(this,arguments)},r=function(e){return o(["undefined","null"],c(e))},n=function(e){return"object"===c(e)&&!r(e)},t=function(e){return Array.isArray(e)&&"array"===c(e)},o=function(e,i){return("array"===c(e)||"string"===c(e))&&e.indexOf(i)>=0},d=function(e){return r(e)?"":"".concat(e)},a=function(e){return n(e)?Object.keys(e):[]},s=function(e,i){a(e).forEach((function(r){return i(e[r],r)}))},u=function(e,i){if(!n(e))return!1;try{return"string"===c(i)?delete e[i]:"array"===c(i)?i.map((function(i){return delete e[i]})):(function(e){return"regexp"===c(e)}(i)&&a(e).forEach((function(r){i.test(r)&&u(e,r)})),!0)}catch(e){return!1}},c=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},w=function(e){try{return e()}catch(e){return}},g=["VIEW_CLICK","VIEW_CHANGE","FORM_SUBMIT","PAGE","CUSTOM","LOGIN_USER_ATTRIBUTES"],v=["LOGIN_USER_ATTRIBUTES"],f={name:"gioHybridAdapter",method:function(r){var a=this;this.growingIO=r,this.penetrateHybrid=!0,this.onOptionsInit=function(){var e,i=a.growingIO,r=i.vdsConfig,n=i.emitter;e=r.penetrateHybrid,"boolean"===c(e)&&(a.penetrateHybrid=r.penetrateHybrid),a._initHybridBridge()&&(a.onSendBefore=a.sendBeforeListener,a.hybridConfig.projectId===a.growingIO.vdsConfig.projectId&&(a.growingIO.useHybridInherit=!0)),a.growingIO.useHybridInherit&&(null==n||n.on("SET_USERID",(function(e){var i=e.newUserId,r=e.oldUserId,n=e.userKey;a.penetrateHybrid&&(!i&&r?n?a._clearNativeUserIdAndUserKey():a._clearNativeUserId():n?a._setNativeUserIdAndUserKey(d(i),d(n)):a._setNativeUserId(d(i)))})),null==n||n.on("SET_USERKEY",(function(e){var i=e.newUserKey,r=e.oldUserKey,n=e.userId;a.penetrateHybrid&&(!i&&r?a._clearNativeUserIdAndUserKey():a._setNativeUserIdAndUserKey(d(n),d(i)))})))},this._initHybridBridge=function(){var i,r,n,t=!1;return a.hasHybridBridge=!!window.GrowingWebViewJavascriptBridge,a.hasHybridBridge?((null===(i=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===i?void 0:i.configuration)||(window.GrowingWebViewJavascriptBridge.configuration=JSON.parse(window.GrowingWebViewJavascriptBridge.getConfiguration())),(null===(r=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===r?void 0:r.configuration)&&(a.hybridConfig=null===(n=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===n?void 0:n.configuration),t=!0):e.consoleText("gioHybridAdapter：当前不存在 GrowingWebViewJavascriptBridge，Web模式。","info"),t},this.sendBeforeListener=function(e){var r=e.requestData;if(a.hasHybridBridge){var n=a.processAttributes(i({},r));o(g,n.eventType)&&(o(v,n.eventType)?a.penetrateHybrid&&a._dispatchEvent(n):(a.penetrateHybrid||u(n,["userId","userKey","cs1"]),a._dispatchEvent(n)))}},this.processAttributes=function(e){return s(e,(function(i,r){n(i)||t(i)?s(e[r],(function(i,o){n(i)||t(i)?e[r][o]=JSON.stringify(i):e[r][o]=d(i)})):e[r]=d(i)})),e},this._setNativeUserId=function(e){w((function(){return window.GrowingWebViewJavascriptBridge.setNativeUserId(e)}))},this._clearNativeUserId=function(){w((function(){return window.GrowingWebViewJavascriptBridge.clearNativeUserId()}))},this._setNativeUserIdAndUserKey=function(e,i){w((function(){return window.GrowingWebViewJavascriptBridge.setNativeUserIdAndUserKey(e,i)}))},this._clearNativeUserIdAndUserKey=function(){w((function(){return window.GrowingWebViewJavascriptBridge.clearNativeUserIdAndUserKey()}))},this._dispatchEvent=function(e){w((function(){var i;return null===(i=window.GrowingWebViewJavascriptBridge)||void 0===i?void 0:i.dispatchEvent(JSON.stringify(e))}))};var f=this.growingIO,y=f.emitter,I=f.utils;e=I,y.on("OPTION_INITIALIZED",this.onOptionsInit)}};export{f as default};
