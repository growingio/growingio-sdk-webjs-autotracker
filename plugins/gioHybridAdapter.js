var e=function(){return e=Object.assign||function(e){for(var r,i=1,n=arguments.length;n>i;i++)for(var t in r=arguments[i])({}).hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e},e.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var r,i=function(e){return o(["undefined","null"],c(e))},n=function(e){return"object"===c(e)&&!i(e)},t=function(e){return Array.isArray(e)&&"array"===c(e)},o=function(e,r){return("array"===c(e)||"string"===c(e))&&e.indexOf(r)>=0},d=function(e){return i(e)?"":"".concat(e)},s=function(e){return n(e)?Object.keys(e):[]},a=function(e,r){s(e).forEach((function(i){return r(e[i],i)}))},u=function(e,r){if(!n(e))return!1;try{return"string"===c(r)?delete e[r]:"array"===c(r)?r.map((function(r){return delete e[r]})):(function(e){return"regexp"===c(e)}(r)&&s(e).forEach((function(i){r.test(i)&&u(e,i)})),!0)}catch(e){return!1}},c=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},w=function(e){try{return e()}catch(e){return}},g=["VIEW_CLICK","VIEW_CHANGE","FORM_SUBMIT","PAGE","CUSTOM","LOGIN_USER_ATTRIBUTES"],f=["LOGIN_USER_ATTRIBUTES"],v={name:"gioHybridAdapter",method:function(i){var s=this;this.growingIO=i,this.penetrateHybrid=!0,this.onOptionsInit=function(){var e,r=s.growingIO,i=r.vdsConfig,n=r.emitter;e=i.penetrateHybrid,"boolean"===c(e)&&(s.penetrateHybrid=i.penetrateHybrid),s._initHybridBridge()&&(s.onSendBefore=s.sendBeforeListener,s.hybridConfig.projectId===s.growingIO.vdsConfig.projectId&&(s.growingIO.useHybridInherit=!0)),s.growingIO.useHybridInherit&&(null==n||n.on("SET_USERID",(function(e){var r=e.newUserId,i=e.oldUserId,n=e.userKey;s.penetrateHybrid&&(!r&&i?n?s._clearNativeUserIdAndUserKey():s._clearNativeUserId():n?s._setNativeUserIdAndUserKey(d(r),d(n)):s._setNativeUserId(d(r)))})),null==n||n.on("SET_USERKEY",(function(e){var r=e.newUserKey,i=e.oldUserKey,n=e.userId;s.penetrateHybrid&&(!r&&i?s._clearNativeUserIdAndUserKey():s._setNativeUserIdAndUserKey(d(n),d(r)))})))},this._initHybridBridge=function(){var e,i,n,t=!1;return s.hasHybridBridge=!!window.GrowingWebViewJavascriptBridge,s.hasHybridBridge?((null===(e=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===e?void 0:e.configuration)||(window.GrowingWebViewJavascriptBridge.configuration=JSON.parse(window.GrowingWebViewJavascriptBridge.getConfiguration())),(null===(i=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===i?void 0:i.configuration)&&(s.hybridConfig=null===(n=null===window||void 0===window?void 0:window.GrowingWebViewJavascriptBridge)||void 0===n?void 0:n.configuration),t=!0):r.consoleText("gioHybridAdapter：当前不存在 GrowingWebViewJavascriptBridge，Web模式。","info"),t},this.sendBeforeListener=function(r){var i=r.requestData;if(s.hasHybridBridge){var n=s.processAttributes(e({},i));u(n,"trackingId"),o(g,n.eventType)&&(o(f,n.eventType)?s.penetrateHybrid&&s._dispatchEvent(n):(s.penetrateHybrid||u(n,["userId","userKey","cs1"]),s._dispatchEvent(n)))}},this.processAttributes=function(e){return a(e,(function(r,i){n(r)||t(r)?a(e[i],(function(r,o){n(r)||t(r)?e[i][o]=JSON.stringify(r):e[i][o]=d(r)})):e[i]=d(r)})),e},this._setNativeUserId=function(e){w((function(){return window.GrowingWebViewJavascriptBridge.setNativeUserId(e)}))},this._clearNativeUserId=function(){w((function(){return window.GrowingWebViewJavascriptBridge.clearNativeUserId()}))},this._setNativeUserIdAndUserKey=function(e,r){w((function(){return window.GrowingWebViewJavascriptBridge.setNativeUserIdAndUserKey(e,r)}))},this._clearNativeUserIdAndUserKey=function(){w((function(){return window.GrowingWebViewJavascriptBridge.clearNativeUserIdAndUserKey()}))},this._dispatchEvent=function(e){w((function(){var r;return null===(r=window.GrowingWebViewJavascriptBridge)||void 0===r?void 0:r.dispatchEvent(JSON.stringify(e))}))};var v=this.growingIO,p=v.emitter,y=v.utils;r=y,p.on("OPTION_INITIALIZED",this.onOptionsInit)}};export{v as default};
