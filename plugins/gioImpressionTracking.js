!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";var t=function(t){return["undefined","null"].includes(u(t))},e=function(e){return"object"===u(e)&&!t(e)},n=function(t){return Array.isArray(t)&&"array"===u(t)},r=function(t){try{return Array.from(t)[0]}catch(t){return}},i=function(e){return t(e)?"":"".concat(e)},o=function(t){if("string"===u(t)){var e=function(t,e){return"string"==typeof t?t.split(""):t}(t);return"".concat(r(e).toLowerCase()).concat((i=e,void 0===o&&(o=1),n(i)&&function(t){return"number"===u(t)}(o)?i.slice(o>0?o:1,i.length):i).join(""))}var i,o;return t},a={}.hasOwnProperty,s=function(e,n){return!t(e)&&a.call(e,n)},c=function(t){return e(t)?Object.keys(t):[]},u=function(t){return{}.toString.call(t).slice(8,-1).toLowerCase()},d=function(){return d=Object.assign||function(t){for(var e,n=1,r=arguments.length;r>n;n++)for(var i in e=arguments[n])({}).hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},d.apply(this,arguments)},m=function(t){try{return t()}catch(t){return}},v=function(r){var o={};return e(r)&&function(r,a){c(r).forEach((function(a){return function(r,a){var s=i(a).slice(0,100);e(r)?o[s]=v(r):n(r)?(o[s]=r.slice(0,100),"cdp"===window.gioEnvironment&&(o[s]=o[s].join("||"))):o[s]=t(r)?"":i(r).slice(0,1e3)}(r[a],a)}))}(r),o},f=function(t,e,n,r){void 0===r&&(r={}),document.addEventListener?t.addEventListener(e,n,d(d({},{capture:!0}),r)):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n};window.gioImpressionTracking={name:"gioImpressionTracking",method:function(t){var i,a=this;this.growingIO=t,this.documentReady=!1,this.main=function(t){"listener"===t?(a.documentReady=!0,a.growingIO.gioSDKInitialized&&a.initMutationObserver()):"emitter"===t&&a.documentReady&&a.initMutationObserver()},this.initIntersectionObserver=function(){a.intersectionObserver=new IntersectionObserver((function(t){var r;(n(r=t)?0===r.length:e(r)?0===c(r).length:!r)||t.map((function(t){var e=t.target.dataset;if(t.intersectionRatio>0){var n=a.getImpressionProperties(e),r=n.eventId,i=n.properties,o=n.items,c=e.id;if(c){if("once"===e.gioImpType&&s(a.sentImps,c))return;a.sentImps[c]={eventId:r,properties:i,items:o}}r&&a.growingIO.track(r,i,o)}}))}))},this.initMutationObserver=function(){if(a.mutationObserver)return!1;var t=document.querySelectorAll("[data-gio-imp-track]");Array.from(t).map((function(t){var e;null===(e=a.intersectionObserver)||void 0===e||e.observe(t)})),a.mutationObserver=new MutationObserver((function(t){return t.map((function(t){var e;if("attributes"===t.type&&t.target.dataset.gioImpTrack)return null===(e=a.intersectionObserver)||void 0===e?void 0:e.observe(t.target)}))})),a.mutationObserver.observe(document.body,{attributes:!0,childList:!0,subtree:!0,attributeOldValue:!0,attributeFilter:["data-gio-imp-track","data-gio-imp-attrs","data-gio-imp-items",/^data-gio-track-[a-z]+$/i]})},this.getImpressionProperties=function(t){var n={eventId:void 0,properties:{}};if(!(null==t?void 0:t.gioImpTrack))return n;if(n.eventId=t.gioImpTrack,s(t,"gioImpAttrs"))n.properties=m((function(){return e(t.gioImpAttrs)?t.gioImpAttrs:JSON.parse(t.gioImpAttrs)})),n.items=m((function(){return e(t.gioImpItems)?t.gioImpItems:JSON.parse(t.gioImpItems)}));else{var i=/^gioTrack(.+)/;for(var a in t){var c=void 0,u=a.match(i);u&&"track"!==(c=o(u[1]))&&(n.properties[c]=t[a])}}return n.properties=v(n.properties),n.items=v(n.items),/^\w+$/.test(n.eventId)&&!Number.isInteger(Number(r(n.eventId.split(""))))||(n.eventId=null,n={}),n},this.sentImps={},window.ActiveXObject||"ActiveXObject"in window||navigator.userAgent.indexOf("compatible")>-1&&navigator.userAgent.indexOf("MSIE")>-1||navigator.userAgent.indexOf("Trident")>-1&&navigator.userAgent.indexOf("rv:11.0")>-1?("warn",console.log("%c [GrowingIO]：IE浏览器不支持半自动埋点，gioImpressionTracking已自动关闭！","color: #F59E0B")):(this.initIntersectionObserver(),f(document,"readystatechange",(function(){["interactive","complete"].includes(document.readyState)&&a.main("listener")}),{once:!0}),null===(i=this.growingIO.emitter)||void 0===i||i.on("SDK_INITIALIZED",(function(){return a.main("emitter")})),f(window,"unload",(function(){a.intersectionObserver.disconnect(),a.mutationObserver.disconnect()})))}}}));
