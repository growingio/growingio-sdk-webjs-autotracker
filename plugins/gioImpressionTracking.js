var t,r,e,n,i,o="function"==typeof Array.from?Array.from:(r||(r=1,e=function(t){return"function"==typeof t},n=function(t){var r=function(t){var r=Number(t);return isNaN(r)?0:0!==r&&isFinite(r)?(r>0?1:-1)*Math.floor(Math.abs(r)):r}(t);return Math.min(Math.max(r,0),9007199254740991)},i=function(t){var r=t.next();return!r.done&&r},t=function(t){var r,o,a,u=this,s=arguments.length>1?arguments[1]:void 0;if(void 0!==s){if(!e(s))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(r=arguments[2])}var c=function(t,r){if(null!=t&&null!=r){var n=t[r];if(null==n)return;if(!e(n))throw new TypeError(n+" is not a function");return n}}(t,function(t){if(null!=t){if(["string","number","boolean","symbol"].indexOf(typeof t)>-1)return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in t)return Symbol.iterator;if("@@iterator"in t)return"@@iterator"}}(t));if(void 0!==c){o=e(u)?Object(new u):[];var l,f,v=c.call(t);if(null==v)throw new TypeError("Array.from requires an array-like or iterable object");for(a=0;;){if(!(l=i(v)))return o.length=a,o;f=l.value,o[a]=s?s.call(r,f,a):f,a++}}else{var d=Object(t);if(null==t)throw new TypeError("Array.from requires an array-like object - not null or undefined");var m,p=n(d.length);for(o=e(u)?Object(new u(p)):Array(p),a=0;p>a;)m=d[a],o[a]=s?s.call(r,m,a):m,a++;o.length=p}return o}),t),a=function(t){return l(["undefined","null"],b(t))},u=function(t){return"object"===b(t)&&!a(t)},s=function(t){return Array.isArray(t)&&"array"===b(t)},c=function(t){try{return f(t)[0]}catch(t){return}},l=function(t,r){return("array"===b(t)||"string"===b(t))&&t.indexOf(r)>=0},f=o,v=function(t){return a(t)?"":"".concat(t)},d=function(t){if("string"===b(t)){var r=function(t,r){return"string"==typeof t?t.split(""):t}(t);return"".concat(c(r).toLowerCase()).concat((e=r,void 0===n&&(n=1),s(e)&&function(t){return"number"===b(t)}(n)?e.slice(n>0?n:1,e.length):e).join(""))}var e,n;return t},m={}.hasOwnProperty,p=function(t,r){return!a(t)&&m.call(t,r)},g=function(t){return u(t)?Object.keys(t):[]},b=function(t){return{}.toString.call(t).slice(8,-1).toLowerCase()},I=function(){return I=Object.assign||function(t){for(var r,e=1,n=arguments.length;n>e;e++)for(var i in r=arguments[e])({}).hasOwnProperty.call(r,i)&&(t[i]=r[i]);return t},I.apply(this,arguments)},h=function(t){try{return t()}catch(t){return}},y=function(t){var r={};return u(t)&&function(t,e){g(t).forEach((function(e){return function(t,e){var n,i=v(e).slice(0,100);u(t)?r[i]=y(t):s(t)?(r[i]=t.slice(0,100),"cdp"===(null===(n=window.vds)||void 0===n?void 0:n.gioEnvironment)&&(r[i]=r[i].join("||").slice(0,1e3))):r[i]=a(t)?"":v(t).slice(0,1e3)}(t[e],e)}))}(t),r},O=function(t,r,e,n){void 0===n&&(n={}),document.addEventListener?t.addEventListener(r,e,I(I({},{capture:!0}),n)):t.attachEvent?t.attachEvent("on"+r,e):t["on"+r]=e},w={name:"gioImpressionTracking",method:function(t){var r,e=this;this.growingIO=t,this.documentReady=!1,this.main=function(t){"listener"===t?(e.documentReady=!0,e.growingIO.gioSDKInitialized&&e.initMutationObserver()):"emitter"===t&&e.documentReady&&e.initMutationObserver()},this.initIntersectionObserver=function(){e.intersectionObserver=new IntersectionObserver((function(t){var r;(s(r=t)?0===r.length:u(r)?0===g(r).length:!r)||t.map((function(t){var r=t.target,n=r.dataset,i=r.id;if(t.intersectionRatio>0){var o=e.getImpressionProperties(n),a=o.eventId,u=o.properties,s=o.items;if(i){if("once"===n.gioImpType&&p(e.sentImps,i))return;e.sentImps[i]={eventId:a,properties:u,items:s}}a&&e.growingIO.track(a,u,s)}}))}))},this.initMutationObserver=function(){var t;e.mutationObserver&&(null===(t=e.mutationObserver)||void 0===t||t.disconnect());var r=document.querySelectorAll("[data-gio-imp-track]");f(r).map((function(t){var r;null===(r=e.intersectionObserver)||void 0===r||r.observe(t)})),e.mutationObserver=new MutationObserver((function(t){t.map((function(t){var r,n;"attributes"===t.type&&(null===(r=t.target.dataset)||void 0===r?void 0:r.gioImpTrack)&&(null===(n=e.intersectionObserver)||void 0===n||n.observe(t.target))}))})),e.mutationObserver.observe(document.body,{attributes:!0,childList:!0,subtree:!0,attributeOldValue:!0,attributeFilter:["data-gio-imp-track","data-gio-imp-attrs","data-gio-imp-items",/^data-gio-track-[a-z]+$/i]})},this.getImpressionProperties=function(t){var r={eventId:void 0,properties:{}};if(!(null==t?void 0:t.gioImpTrack))return r;if(r.eventId=t.gioImpTrack,p(t,"gioImpAttrs"))r.properties=h((function(){return u(t.gioImpAttrs)?t.gioImpAttrs:JSON.parse(t.gioImpAttrs)})),r.items=h((function(){return u(t.gioImpItems)?t.gioImpItems:JSON.parse(t.gioImpItems)}));else{var e=/^gioTrack(.+)/;for(var n in t){var i=void 0,o=n.match(e);o&&"track"!==(i=d(o[1]))&&(r.properties[i]=t[n])}}return r.properties=y(r.properties),r.items=y(r.items),/^\w+$/.test(r.eventId)&&!Number.isInteger(Number(c(r.eventId.split(""))))||(r.eventId=null,r={}),r},this.sentImps={},window.IntersectionObserver&&window.MutationObserver?(this.initIntersectionObserver(),O(document,"readystatechange",(function(){l(["interactive","complete"],document.readyState)&&e.main("listener")}),{once:!0}),null===(r=this.growingIO.emitter)||void 0===r||r.on("SDK_INITIALIZED",(function(){return e.main("emitter")})),O(window,"unload",(function(){var t,r;null===(t=e.intersectionObserver)||void 0===t||t.disconnect(),null===(r=e.mutationObserver)||void 0===r||r.disconnect()}))):("warn",console.log("%c [GrowingIO]：当前浏览器不支持半自动埋点，gioImpressionTracking已自动关闭！","color: #F59E0B;"))}};export{w as default};
