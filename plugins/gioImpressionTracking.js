var t=function(t){return null==t||void 0===t},e=function(e){return"[object Object]"==={}.toString.call(e)&&!t(e)},n=function(t){return Array.isArray(t)&&"[object Array]"==={}.toString.call(t)},r=function(t){return n(t)?t[0]:void 0},i=function(e){return t(e)?"":"".concat(e)},o=function(t){if("string"==typeof t){var e=function(t,e){return"string"==typeof t?t.split(""):t}(t);return"".concat(r(e).toLowerCase()).concat((i=e,void 0===o&&(o=1),n(i)&&function(t){return"number"==typeof t}(o)?i.slice(o>0&&o<i.length?o:1,i.length):i).join(""))}var i,o;return t},a={}.hasOwnProperty,c=function(t){return"object"==typeof t?Object.keys(t):[]},s=function(t,n){if(!e(t))return!1;try{if("string"===u(n))return delete t[n];if("array"===u(n))return n.map((function(e){return delete t[e]}));"object"===u(n)&&n.constructor===RegExp&&c(t).forEach((function(e){n.test(e)&&s(t,e)}))}catch(t){return!1}},u=function(t){var e=typeof t;return"object"===e&&n(t)?"array":e},v=function(){return v=Object.assign||function(t){for(var e,n=1,r=arguments.length;r>n;n++)for(var i in e=arguments[n])({}).hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},v.apply(this,arguments)},d=function(t){try{return t()}catch(t){return}},g=function(r){var o={};return e(r)&&function(r,a){c(r).forEach((function(a){return function(r,a){var c=i(a).slice(0,50);e(r)?o[c]=g(r):n(r)?(o[c]=r.slice(0,100),"cdp"===window.gioEnvironment&&(o[c]=o[c].join("||"))):o[c]=t(r)?"":i(r).slice(0,1e3),""===o[c]&&s(o,c)}(r[a],a)}))}(r),o},m=function(t,e,n,r){void 0===r&&(r={}),document.addEventListener?t.addEventListener(e,n,v(v({},{capture:!0}),r)):t.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n},f=function(i){var s=this;this.growingIO=i,this.documentReady=!1,this.main=function(t){"listener"===t?(s.documentReady=!0,s.growingIO.gioSDKInitialized&&s.initMutationObserver()):"emitter"===t&&s.documentReady&&s.initMutationObserver()},this.initIntersectionObserver=function(){s.intersectionObserver=new IntersectionObserver((function(t){var r;(n(r=t)?0===r.length:e(r)?0===c(r).length:!r)||t.map((function(t){if(t.intersectionRatio>0){var e=s.getImpressionProperties(t.target.dataset),n=e.eventId,r=e.properties,i=e.items;n&&s.growingIO.track(n,r,i)}}))}))},this.initMutationObserver=function(){var t=document.querySelectorAll("[data-gio-imp-track]");Array.from(t).map((function(t){var e;null===(e=s.intersectionObserver)||void 0===e||e.observe(t)})),s.mutationObserver=new MutationObserver((function(t){return t.map((function(t){var e;if("attributes"===t.type&&t.target.dataset.gioImpTrack)return null===(e=s.intersectionObserver)||void 0===e?void 0:e.observe(t.target)}))})),s.mutationObserver.observe(document.body,{attributes:!0,childList:!0,subtree:!0,attributeOldValue:!0,attributeFilter:["data-gio-imp-track","data-gio-imp-attrs","data-gio-imp-items",/^data-gio-track-[a-z]+$/i]})},this.getImpressionProperties=function(n){var i,c={eventId:void 0,properties:{}};if(!(null==n?void 0:n.gioImpTrack))return c;if(c.eventId=n.gioImpTrack,!t(i=n)&&a.call(i,"gioImpAttrs"))c.properties=d((function(){return e(n.gioImpAttrs)?n.gioImpAttrs:JSON.parse(n.gioImpAttrs)})),c.items=d((function(){return e(n.gioImpItems)?n.gioImpItems:JSON.parse(n.gioImpItems)}));else{var s=/^gioTrack(.+)/;for(var u in n){var v=void 0,m=u.match(s);m&&"track"!==(v=o(m[1]))&&(c.properties[v]=n[u])}}return c.properties=g(c.properties),c.items=g(c.items),/^\w+$/.test(c.eventId)&&!Number.isInteger(Number(r(c.eventId.split(""))))||(c.eventId=null,c={}),c},window.ActiveXObject||"ActiveXObject"in window||navigator.userAgent.indexOf("compatible")>-1&&navigator.userAgent.indexOf("MSIE")>-1||navigator.userAgent.indexOf("Trident")>-1&&navigator.userAgent.indexOf("rv:11.0")>-1?("warn",console.log("%c[GrowingIO]：IE浏览器不支持半自动埋点，gioImpressionTracking已自动关闭！","color: #F59E0B")):(this.initIntersectionObserver(),m(document,"readystatechange",(function(){"complete"===document.readyState&&s.main("listener")}),{once:!0}),this.growingIO.emitter.on("SDK_INITIALIZED",(function(){return s.main("emitter")})),m(window,"unload",(function(){s.intersectionObserver.disconnect(),s.mutationObserver.disconnect()})))};window.gioImpressionTracking={name:"gioImpressionTracking",method:f};var p={name:"gioImpressionTracking",method:f};export{p as default};
