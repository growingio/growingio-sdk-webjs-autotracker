var t=function(){return t=Object.assign||function(t){for(var e,n=1,r=arguments.length;r>n;n++)for(var i in e=arguments[n])({}).hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},t.apply(this,arguments)};function e(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;o>i;i++)!r&&i in e||(r||(r=[].slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||[].slice.call(e))}location.protocol.replace(":","");var n=["clearUserId","getGioInfo","getLocation","getOption","init","setDataCollect","setOption","setUserId","track","setGeneralProps","clearGeneralProps"];e(e([],n,!0),["setEvar","setPage","setUser","setVisitor"],!1),e(e([],n,!0),["enableDebug","enableHT","setAutotrack","setTrackerHost","setTrackerScheme","setUserAttributes","getDeviceId","registerPlugins","sendPage","sendVisit"],!1);var r={click:"VIEW_CLICK",change:"VIEW_CHANGE",submit:"FORM_SUBMIT"},i=function(t){return Array.isArray(t)&&"[object Array]"==={}.toString.call(t)},o=function(t){return i(t)?t[t.length-1]:void 0},a=function(t){return i(t)?0===t.length:function(t){return"[object Object]"==={}.toString.call(t)&&!function(t){return null==t||void 0===t}(t)}(t)?0===function(t){return"object"==typeof t?Object.keys(t):[]}(t).length:!t},u=function(e,n,r,i){void 0===i&&(i={}),document.addEventListener?e.addEventListener(n,r,t(t({},{capture:!0}),i)):e.attachEvent?e.attachEvent("on"+n,r):e["on"+n]=r},c=["TR","LI","DL"],f=function(t,e){for(var n=0,r=e.length,i=t.length;r>n;n++,i++)t[i]=e[n];return t}(["A","BUTTON"],function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}(c)),l=["button","submit","reset"],s=["radio","checkbox","search"],h=["I","EM","svg","IMG"],d=["TEXTAREA","HTML","BODY"],v=["I","SPAN","EM","B","STRONG"],p=["tspan","text","g","rect","path","defs","clippath","desc","title","math","use"],g=/(^| |[^ ]+\-)(clear|clearfix|active|hover|enabled|current|selected|unselected|hidden|display|focus|disabled|undisabled|open|checked|unchecked|undefined|null|ng-|growing-)[^\. ]*/g,m=/^[a-zA-Z-\_][a-zA-Z\-\_0-9]+$/,y=/^([a-zA-Z\-\_0-9]+)$/,b=function(t,e){if(void 0===e&&(e=!0),t&&(null==(t=t.replace(/[\n \t]+/g," ").trim())?void 0:t.length))return t.slice(0,e?50:void 0)},x=function(t,e){if(!t||!e)return!1;if(t.length!==e.length)return!1;for(var n=0,r=t.length;r>n;n++)if(t[n]!==e[n])return!1;return!0},N=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},w=function(t,e){for(var n=0,r=e.length,i=t.length;r>n;n++,i++)t[i]=e[n];return t},E=function(t,e){return t instanceof Element&&t.hasAttribute(e)&&"false"!==t.getAttribute(e)},O=function(t){return!t||-1!==["BODY","HTML","#document"].indexOf(t.nodeName)},A=function(t,e){for(var n=t.parentNode;n&&!O(n);){if(e(n))return n;n=n.parentNode}},T=function(t){return Array.from((null==t?void 0:t.childNodes)||[]).reduce((function(t,e){return e instanceof Element?w(w(w([],N(t)),[e]),N(T(e))):t}),[])},_=function(t){return Array.from((null==t?void 0:t.childNodes)||[]).filter((function(t){return t instanceof Element}))},L=function(t){return!t.hasChildNodes()||"svg"===t.nodeName||0===_(t).length},P=function(t){return E(t,"data-growing-container")||-1!==f.indexOf(t.nodeName)},k=function(t){var e=t.nodeName;return-1!==h.indexOf(e)},I=function(t){var e,n;if(t.textContent)return!1;var r=_(t);if(0===r.length)return!1;try{for(var i=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(r),o=i.next();!o.done;o=i.next()){var a=o.value;if(!k(a)&&"SPAN"!==a.nodeName)return!1}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return!0},j=function(t){return t instanceof HTMLInputElement&&"INPUT"===t.tagName&&-1!==l.indexOf(t.type)},C=function(t,e,n){if(void 0===e&&(e=4),void 0===n&&(n=1),n>e)return!1;for(var r="svg"===t.tagName?[]:_(t),i=0;i<r.length;i++){var o=r[i];if(!C(o,e,n+1))return!1}return e>=n},S=function(t){if(!(t instanceof Element)||E(t,"data-growing-ignore"))return!0;for(var e=t.parentNode;e&&!O(e);){if(E(e,"data-growing-ignore"))return!0;e=e.parentNode}return!1};function M(t){var e;if(t instanceof Element){var n=t.getAttribute("name");if(n)return[n];if(t.hasAttribute("class")){var r=null===(e=t.getAttribute("class"))||void 0===e?void 0:e.replace(g,"").trim();if(null==r?void 0:r.length)return r.split(/\s+/).filter((function(t){return y.test(t)&&!t.match(/[a-z][A-Z][a-z][A-Z]/)&&!t.match(/[0-9][0-9][0-9][0-9]/)})).sort()}}return[]}var D=function(){function t(t){var e;this.node=t,this.tagName=this.node.nodeName,this.name=this.tagName.toLowerCase(),this.id=(e=this.node).id&&m.test(e.id)?e.id:null,this.classList=M(this.node),this.guessListAndIndex()}return t.prototype.guessListAndIndex=function(){var t,e,n=this;this._tagList=(e=this.node,-1!==c.indexOf(e.nodeName));var r,i,o,a,u,f=(r=_(this.node.parentNode),i=this.node,a=function(t,e){if(null==t||"function"!=typeof e)return-1;for(var n=0;n<t.length;n++){var r=t[n];if(e.call(void 0,r))return n}return-1}(r,o=function(t){return t.nodeName===i.nodeName}),u=function(t,e){if(null==t||"function"!=typeof e)return-1;for(var n=t.length-1;n>=0;n--){var r=t[n];if(e.call(void 0,r))return n}return-1}(r,o),-1===a||-1===u?[]:r.slice(a,u+1));if(this._tagList&&-1!==(h=f.filter((function(t){return t.tagName===n.tagName})).indexOf(this.node))&&(this._index=h+1),f.length>=3&&(null===(t=this.classList)||void 0===t?void 0:t.length)){for(var l=0,s=0,h=1;h<=f.length;h++){var d=f[h-1];if(d.tagName!==this.tagName){s=0;break}x(this.classList,M(d))&&(s+=1),this.node===d&&(l=h)}3>s||(this._pseudoList=!0,this._index=this._index||l)}},Object.defineProperty(t.prototype,"path",{get:function(){var t;return this._path||(this._path="/"+this.name,this.id&&(this._path+="#"+this.id),(null===(t=this.classList)||void 0===t?void 0:t.length)&&(this._path+="."+this.classList.join("."))),this._path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pseudoList",{get:function(){return!!this._pseudoList},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"list",{get:function(){return!!this._tagList||!!this._pseudoList},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"index",{get:function(){return function(t){if(t instanceof Element){var e=t.getAttribute("data-growing-index")||t.getAttribute("data-growing-idx")||t.getAttribute("data-index");if(e){if(/^\d{1,10}$/.test(e)&&+e>0&&2147483647>+e)return+e;window.console.error("[GioNode]：标记的index不符合规范（index必须是大于0且小于2147483647的整数字）。",e)}}}(this.node)||this._index},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"container",{get:function(){return P(this.node)||this.list},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.node.parentNode?new t(this.node.parentNode):null},enumerable:!1,configurable:!0}),t.prototype.parentPaths=function(t){void 0===t&&(t=!1);for(var e=t?[this]:[],n=this.parent;n&&!O(n.node);)e.push(n),n=n.parent;return e},t}();function H(t){if(t.hasAttribute("href")){var e=t.getAttribute("href");if(e&&0!==e.indexOf("javascript"))return(r=(n=e.slice(0,320)).length)>1&&"/"===n.charAt(r-1)?n.slice(0,r-1):n}var n,r}function U(t){if(t.src&&-1===t.src.indexOf("data:image"))return t.src}var B=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},X=function(t){return t.htmlFor||t.getAttribute("for")};function G(t){var e=t.node;return t.list?z(e):b(e.textContent)||void 0}function z(t){var e,n,r=void 0,i=!1;try{for(var o=B(Array.from(t.childNodes)),a=o.next();!a.done;a=o.next()){var u=a.value;if(u.nodeType===Node.TEXT_NODE){var c=b(u.textContent);if(c)return c}if(u.nodeType===Node.ELEMENT_NODE&&-1===["INPUT","SELECT"].indexOf(u.nodeName)){if(new D(u).pseudoList)return;i=I(u)||k(u);var f=Z(u);if(i)r=f,i=!1;else if(f||(f=z(u)),f)return f}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r}function V(t){var e=t;if(e){var n=function(t){var e=t.getAttribute("data-growing-title")||t.getAttribute("data-title")||t.getAttribute("growing-title")||t.getAttribute("title");return(null==e?void 0:e.trim())||void 0}(e);if(n)return n;var r,i,o,a=new D(t);switch(t.nodeName.toLowerCase()){case"a":return function(t){if((L(t)||I(t))&&t.textContent){var e=b(t.textContent);if(e)return e}var n=H(t);if(n){var r=n.indexOf("?");return r>-1?n.slice(0,r):n}}(e);case"svg":return function(t){var e,n;try{for(var r=B(Array.from(t.childNodes)),i=r.next();!i.done;i=r.next()){var o=i.value;if(o.nodeType===Node.ELEMENT_NODE&&"use"===o.tagName.toLowerCase()&&o.hasAttribute("xlink:href"))return o.getAttribute("xlink:href")}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}}(e);case"button":return(null===(o=(i=e).name)||void 0===o?void 0:o.length)?i.name:b(i.textContent)||z(i);case"img":return function(t){if(t.alt)return t.alt;var e=U(t);if(e){var n=e.split("?")[0].split("/");if(n.length>0)return n[n.length-1]}}(e);case"label":return G(a);case"input":return function(t){if(j(t))return t.value;if("password"!==t.type&&E(t,"data-growing-track"))return t.value;if((a=t)instanceof HTMLInputElement&&"INPUT"===a.tagName&&-1!==s.indexOf(a.type)){var e=A(t,(function(t){return"LABEL"===t.nodeName}));if(!e&&t.id)for(var n=document.body.getElementsByTagName("label"),r=0;r<n.length;r++){var i=n[r];if(X(i)===t.id){e=i;break}}if(e){var o=G(new D(e));if(o&&o.length>0)return o+" ("+t.checked+")"}return t.value}var a}(e);case"select":return Array.from((r=e).options).filter((function(t){return t.selected})).map((function(t){return t.label})).join(", ")||r.value;case"form":return function(t){var e,n,r=t.getElementsByTagName("input");try{for(var i=B(Array.from(r)),o=i.next();!o.done;o=i.next()){var a=o.value;if(("search"===a.type||"text"===a.type&&("q"===a.id||-1!==a.id.indexOf("search")||"q"===a.name||-1!==a.name.indexOf("search")))&&!S(a)){var u=Z(a);if(u)return u}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}}(e)}return L(e)?function(t){var e=b(t.textContent);if(e)return e}(e):function(t){return!(!t.hasChildNodes()||"svg"===t.nodeName)&&0===Array.from(t.childNodes).filter((function(t){return!L(t)})).length}(e)&&!I(e)?function(t){var e,n,r="";try{for(var i=B(Array.from(t.childNodes)),o=i.next();!o.done;o=i.next()){var a=o.value;r+=(a.nodeType===Node.TEXT_NODE&&a.textContent?a.textContent.trim():"")+" "}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return b(r,!1)}(e):a.container||I(t)?z(e):void 0}}function Z(t){return V(t)||void 0}var R,$=(R=function(t,e){return R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)({}).hasOwnProperty.call(e,n)&&(t[n]=e[n])},R(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+e+" is not a constructor or null");function n(){this.constructor=t}R(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),q=function(t){function e(e){var n=t.call(this,e)||this;n.node=e;var r=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}(function(t){for(var e=t.parentPaths(!0),n=Math.min(e.length,+(e.length>=10)+4),r=["","",""],i=0;i<e.length;i++){var o=e[i].path,a=e[i].name;r[0]=o+r[0],r[2]="/"+a+r[2],n>i&&(r[1]=o+r[1])}return r}(n),3),i=r[0],o=r[1],a=r[2];return n.fullXpath=i,n.xpath=o,n.skeleton=a,n}return $(e,t),Object.defineProperty(e.prototype,"href",{get:function(){return function(t){var e=t;if(e)switch(t.nodeName.toLowerCase()){case"a":return H(e);case"img":return U(e)}}(this.node)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"content",{get:function(){return Z(this.node)},enumerable:!1,configurable:!0}),e}(D),F=function(){return F=Object.assign||function(t){for(var e,n=1,r=arguments.length;r>n;n++)for(var i in e=arguments[n])({}).hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},F.apply(this,arguments)},W=function(){function t(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!0),this.origin=t,this.action=e,this.direct=n,this.target="self"===e?t:function(t){for(var e,n;t&&(n=void 0,!((e=t)instanceof Element&&-1===p.indexOf(null===(n=e.tagName)||void 0===n?void 0:n.toLowerCase())))&&t.parentNode;)t=t.parentNode;var r,i=t.parentNode;return!O(i)&&(I(i)||"BUTTON"===(r=i).tagName&&function(t){return 0!==_(t).length&&!T(t).map((function(t){return t.tagName})).some((function(t){return-1===v.indexOf(t)}))}(r))?i:t}(t),this.ignore=S(this.target),this.vnode=new q(this.target),this.tagName=this.vnode.tagName}return Object.defineProperty(t.prototype,"content",{get:function(){return this.vnode.content},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"href",{get:function(){return this.vnode.href},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"index",{get:function(){return this.vnode.index},enumerable:!1,configurable:!0}),t.prototype.inferParentIndex=function(){var e=this;return this.parentIndex||A(this.target,(function(n){var r=new t(n,e.action,!1);r.traceable()&&r.index&&(e.parentIndex=r.index)})),this.parentIndex},Object.defineProperty(t.prototype,"xpath",{get:function(){return this.vnode.xpath},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fullXpath",{get:function(){return this.vnode.fullXpath},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skeleton",{get:function(){return this.vnode.skeleton},enumerable:!1,configurable:!0}),t.prototype.info=function(t){return void 0===t&&(t=!0),t&&this.inferParentIndex(),{skeleton:this.skeleton,fullXpath:this.fullXpath,xpath:this.xpath,content:this.content,href:this.href,index:this.parentIndex||this.index}},t.prototype.traceable=function(){if(this.ignore)return!1;if(this.direct){if("click"===this.action||"hover"===this.action){if(-1!==d.indexOf(this.target.tagName))return!1;if("INPUT"===this.target.tagName&&!j(this.target))return!1;if(!P(this.target)&&!C(this.target,5))return!1}return!0}return this.vnode.container},t.prototype.trackNodes=function(){if(!this.traceable())return[];var t=[this];if("submit"!==this.action)for(var e=this.parentElement;e;){if(e.ignore)return[];e.traceable()&&t.unshift(e),e=e.parentElement}var n=void 0;return t.map((function(t){var e=t.info(!1),r=e.index;return!n&&r&&(n=r),F(F({},e),{index:n||r})}))},Object.defineProperty(t.prototype,"parentElement",{get:function(){var e=this.target.parentNode;if(e&&e.nodeName&&!O(e))return new t(e,this.action,!1)},enumerable:!1,configurable:!0}),t}(),Y=function(){function t(t){this.handler=t;var e=navigator.userAgent,n=/chrome/i.exec(e),r=/android/i.exec(e);this.hasTouch="ontouchstart"in window&&!(n&&!r)}return t.prototype.main=function(){for(var t=this.hasTouch?["touchstart"]:["mousedown"],e=this.hasTouch?["touchend","touchcancel"]:["mouseup","mouseleave"],n=this.hasTouch?["touchmove"]:["mousemove"],r=0,i=t;i.length>r;r++)u(window,i[r],this.touchStartHandler.bind(this));for(var o=0,a=n;a.length>o;o++)u(window,a[o],this.touchMoveHandler.bind(this));for(var c=0,f=e;f.length>c;c++)u(window,f[c],this.touchStopHandler.bind(this))},t.prototype.touchStartHandler=function(t){if(1>=t.which){var e=+Date.now();this.safeguard!==e&&(this.touchTimeout&&clearTimeout(this.touchTimeout),this.safeguard=e,this.touchEvent={time:e,target:t.target,x:this._page("x",t),y:this._page("y",t),isTrusted:!0,type:"click"})}},t.prototype.touchMoveHandler=function(t){var e=Math.abs(this._page("x",t)-(this.touchEvent&&this.touchEvent.x)||0),n=Math.abs(this._page("y",t)-(this.touchEvent&&this.touchEvent.y)||0);(e>10||n>10)&&(this.touchEvent=null)},t.prototype.touchStopHandler=function(t){var e=this,n=+Date.now()-(this.touchEvent&&this.touchEvent.time)||0;this.touchEvent&&200>n?this.touchTimeout=setTimeout((function(){e.handler(e.touchEvent),e.touchEvent=null}),200):this.touchEvent&&n>=200&&700>n&&(this.handler(this.touchEvent),this.touchEvent=null)},t.prototype._page=function(t,e){return(this.hasTouch?e.touches[0]:e)["page".concat(t.toUpperCase())]},t}(),K=function(e){var n=this;this.growingIO=e,this.main=function(){u(document,"submit",n._handleAction),u(document,"change",n._handleAction),n.growingIO.vdsConfig.touch?new Y(n._handleAction).main():u(document,"click",n._handleAction)},this._handleAction=function(e,i){var u=n.growingIO,c=u.vdsConfig,f=u.emitter;if(!c.autotrack)return!1;var l=e.target;if(!l)return!1;var s=new W(l,e.type,!0).trackNodes();if("click"!==e.type&&(s=a(o(s))?[]:[o(s)]),a(s))return!1;c.debug&&console.log("Action：",e.type,Date.now()),f.emit("onComposeBefore",{event:i,params:null!=e?e:{}}),s.forEach((function(i){var o=i.fullXpath,a=i.index,u=i.content,c=i.href;if(o){var f=n.growingIO.dataStore,l=f.eventContextBuilder,s=f.eventConverter,h=f.currentPage;s(t(t({eventType:r[e.type],element:[{xpath:o,index:a,textValue:u,hyperlink:c}]},l()),{pageShowTimestamp:h.time}))}}))}};window.gioEventAutoTracking={name:"gioEventAutoTracking",method:K};var J={name:"gioEventAutoTracking",method:K};export{J as default};
