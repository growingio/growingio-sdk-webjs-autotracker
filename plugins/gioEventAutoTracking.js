!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";var t=function(){return t=Object.assign||function(t){for(var e,n=1,r=arguments.length;r>n;n++)for(var i in e=arguments[n])({}).hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},t.apply(this,arguments)};function e(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;o>i;i++)!r&&i in e||(r||(r=[].slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||[].slice.call(e))}location.protocol.indexOf("http")>-1&&location.protocol.replace(":","");var n=["clearUserId","getGioInfo","getLocation","getOption","init","setDataCollect","setOption","setUserId","track","setGeneralProps","clearGeneralProps"];e(e([],n,!0),["setEvar","setPage","setUser","setVisitor"],!1),e(e([],n,!0),["enableDebug","enableHT","setAutotrack","setTrackerHost","setTrackerScheme","setUserAttributes","getVisitorId","getDeviceId","registerPlugins","sendPage","sendVisit","trackTimerStart","trackTimerPause","trackTimerResume","trackTimerEnd","removeTimer","clearTrackTimer"],!1);var r={click:"VIEW_CLICK",change:"VIEW_CHANGE",submit:"FORM_SUBMIT"},i=function(t){return"object"===c(t)&&!function(t){return["undefined","null"].includes(c(t))}(t)},o=function(t){try{var e=Array.from(t);return e[e.length-1]}catch(t){return}},a=function(t,e){return"string"===c(t)&&t.slice(0,e.length)===e},u=function(t){return function(t){return Array.isArray(t)&&"array"===c(t)}(t)?0===t.length:i(t)?0===function(t){return i(t)?Object.keys(t):[]}(t).length:!t},c=function(t){return{}.toString.call(t).slice(8,-1).toLowerCase()},f=function(e,n,r,i){void 0===i&&(i={}),document.addEventListener?e.addEventListener(n,r,t(t({},{capture:!0}),i)):e.attachEvent?e.attachEvent("on"+n,r):e["on"+n]=r},l=["TR","LI","DL"],s=function(t,e){for(var n=0,r=e.length,i=t.length;r>n;n++,i++)t[i]=e[n];return t}(["A","BUTTON"],function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}(l)),h=["button","submit","reset"],d=["radio","checkbox","search"],v=["I","EM","svg","IMG"],p=["TEXTAREA","HTML","BODY"],g=["I","SPAN","EM","B","STRONG"],m=["tspan","text","g","rect","path","defs","clippath","desc","title","math","use"],y=/(^| |[^ ]+\-)(clear|clearfix|active|hover|enabled|current|selected|unselected|hidden|display|focus|disabled|undisabled|open|checked|unchecked|undefined|null|ng-|growing-)[^\. ]*/g,b=/^[a-zA-Z-\_][a-zA-Z\-\_0-9]+$/,x=/^([a-zA-Z\-\_0-9]+)$/,N="data-growing-ignore",w=function(t,e){if(void 0===e&&(e=!0),t&&(null==(t=t.replace(/[\n \t]+/g," ").trim())?void 0:t.length))return t.slice(0,e?50:void 0)},E=function(t,e){if(!t||!e)return!1;if(t.length!==e.length)return!1;for(var n=0,r=t.length;r>n;n++)if(t[n]!==e[n])return!1;return!0},O=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},T=function(t,e){for(var n=0,r=e.length,i=t.length;r>n;n++,i++)t[i]=e[n];return t},A=function(t,e){return t instanceof Element&&t.hasAttribute(e)&&"false"!==t.getAttribute(e)},_=function(t){return!t||-1!==["BODY","HTML","#document"].indexOf(t.nodeName)},k=function(t,e){for(var n=t.parentNode;n&&!_(n);){if(e(n))return n;n=n.parentNode}},L=function(t){return Array.from((null==t?void 0:t.childNodes)||[]).reduce((function(t,e){return e instanceof Element?T(T(T([],O(t)),[e]),O(L(e))):t}),[])},P=function(t){return Array.from((null==t?void 0:t.childNodes)||[]).filter((function(t){return t instanceof Element}))},I=function(t){return!t.hasChildNodes()||"svg"===t.nodeName||0===P(t).length},C=function(t){return A(t,"data-growing-container")||-1!==s.indexOf(t.nodeName)},j=function(t){var e=t.nodeName;return-1!==v.indexOf(e)},S=function(t){var e,n;if(t.textContent)return!1;var r=P(t);if(0===r.length)return!1;try{for(var i=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(r),o=i.next();!o.done;o=i.next()){var a=o.value;if(!j(a)&&"SPAN"!==a.nodeName)return!1}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return!0},M=function(t){return t instanceof HTMLInputElement&&"INPUT"===t.tagName&&-1!==h.indexOf(t.type)},D=function(t,e,n){if(void 0===e&&(e=4),void 0===n&&(n=1),n>e)return!1;for(var r="svg"===t.tagName?[]:P(t),i=0;i<r.length;i++){var o=r[i];if(!D(o,e,n+1))return!1}return e>=n},H=function(t){if(!(t instanceof Element)||A(t,N))return!0;for(var e=t.parentNode;e&&!_(e);){if(A(e,N))return!0;e=e.parentNode}return!1};function U(t){var e;if(t instanceof Element){var n=t.getAttribute("name");if(n)return[n];if(t.hasAttribute("class")){var r=null===(e=t.getAttribute("class"))||void 0===e?void 0:e.replace(y,"").trim();if(null==r?void 0:r.length)return r.split(/\s+/).filter((function(t){return x.test(t)&&!t.match(/[a-z][A-Z][a-z][A-Z]/)&&!t.match(/[0-9][0-9][0-9][0-9]/)})).sort()}}return[]}var B=function(){function t(t){var e;this.node=t,this.tagName=this.node.nodeName,this.name=this.tagName.toLowerCase(),this.id=(e=this.node).id&&b.test(e.id)?e.id:null,this.classList=U(this.node),this.guessListAndIndex()}return t.prototype.guessListAndIndex=function(){var t,e,n=this;this._tagList=(e=this.node,-1!==l.indexOf(e.nodeName));var r,i,o,a,u,c=(r=P(this.node.parentNode),i=this.node,a=function(t,e){if(null==t||"function"!=typeof e)return-1;for(var n=0;n<t.length;n++){var r=t[n];if(e.call(void 0,r))return n}return-1}(r,o=function(t){return t.nodeName===i.nodeName}),u=function(t,e){if(null==t||"function"!=typeof e)return-1;for(var n=t.length-1;n>=0;n--){var r=t[n];if(e.call(void 0,r))return n}return-1}(r,o),-1===a||-1===u?[]:r.slice(a,u+1));if(this._tagList&&-1!==(h=c.filter((function(t){return t.tagName===n.tagName})).indexOf(this.node))&&(this._index=h+1),c.length>=3&&(null===(t=this.classList)||void 0===t?void 0:t.length)){for(var f=0,s=0,h=1;h<=c.length;h++){var d=c[h-1];if(d.tagName!==this.tagName){s=0;break}E(this.classList,U(d))&&(s+=1),this.node===d&&(f=h)}3>s||(this._pseudoList=!0,this._index=this._index||f)}},Object.defineProperty(t.prototype,"path",{get:function(){var t;return this._path||(this._path="/"+this.name,this.id&&(this._path+="#"+this.id),(null===(t=this.classList)||void 0===t?void 0:t.length)&&(this._path+="."+this.classList.join("."))),this._path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pseudoList",{get:function(){return!!this._pseudoList},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"list",{get:function(){return!!this._tagList||!!this._pseudoList},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"index",{get:function(){return function(t){if(t instanceof Element){var e=t.getAttribute("data-growing-index")||t.getAttribute("data-growing-idx")||t.getAttribute("data-index");if(e){if(/^\d{1,10}$/.test(e)&&+e>0&&2147483647>+e)return+e;window.console.error("[GioNode]：标记的index不符合规范（index必须是大于0且小于2147483647的整数字）。",e)}}}(this.node)||this._index},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"container",{get:function(){return C(this.node)||this.list},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.node.parentNode?new t(this.node.parentNode):null},enumerable:!1,configurable:!0}),t.prototype.parentPaths=function(t){void 0===t&&(t=!1);for(var e=t?[this]:[],n=this.parent;n&&!_(n.node);)e.push(n),n=n.parent;return e},t}();function X(t){if(t.hasAttribute("href")){var e=t.getAttribute("href");if(e&&0!==e.indexOf("javascript"))return(r=(n=e.slice(0,320)).length)>1&&"/"===n.charAt(r-1)?n.slice(0,r-1):n}var n,r}function G(t){if(t.src&&-1===t.src.indexOf("data:image"))return t.src}var V=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},z=function(t){return t.htmlFor||t.getAttribute("for")};function R(t){var e=t.node;return t.list?Z(e):w(e.textContent)||void 0}function Z(t){var e,n,r=void 0,i=!1;try{for(var o=V(Array.from(t.childNodes)),a=o.next();!a.done;a=o.next()){var u=a.value;if(u.nodeType===Node.TEXT_NODE){var c=w(u.textContent);if(c)return c}if(u.nodeType===Node.ELEMENT_NODE&&-1===["INPUT","SELECT"].indexOf(u.nodeName)){if(new B(u).pseudoList)return;i=S(u)||j(u);var f=q(u);if(i)r=f,i=!1;else if(f||(f=Z(u)),f)return f}}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return r}function $(t){var e=t;if(e){var n=function(t){var e=t.getAttribute("data-growing-title")||t.getAttribute("data-title")||t.getAttribute("growing-title")||t.getAttribute("title");return(null==e?void 0:e.trim())||void 0}(e);if(n)return n;var r,i,o,a=new B(t);switch(t.nodeName.toLowerCase()){case"a":return function(t){if((I(t)||S(t))&&t.textContent){var e=w(t.textContent);if(e)return e}var n=X(t);if(n){var r=n.indexOf("?");return r>-1?n.slice(0,r):n}}(e);case"svg":return function(t){var e,n;try{for(var r=V(Array.from(t.childNodes)),i=r.next();!i.done;i=r.next()){var o=i.value;if(o.nodeType===Node.ELEMENT_NODE&&"use"===o.tagName.toLowerCase()&&o.hasAttribute("xlink:href"))return o.getAttribute("xlink:href")}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}}(e);case"button":return(null===(o=(i=e).name)||void 0===o?void 0:o.length)?i.name:w(i.textContent)||Z(i);case"img":return function(t){if(t.alt)return t.alt;var e=G(t);if(e){var n=e.split("?")[0].split("/");if(n.length>0)return n[n.length-1]}}(e);case"label":return R(a);case"input":return function(t){if(M(t))return t.value;if("password"!==t.type&&A(t,"data-growing-track"))return t.value;if((a=t)instanceof HTMLInputElement&&"INPUT"===a.tagName&&-1!==d.indexOf(a.type)){var e=k(t,(function(t){return"LABEL"===t.nodeName}));if(!e&&t.id)for(var n=document.body.getElementsByTagName("label"),r=0;r<n.length;r++){var i=n[r];if(z(i)===t.id){e=i;break}}if(e){var o=R(new B(e));if(o&&o.length>0)return o+" ("+t.checked+")"}return t.value}var a}(e);case"select":return Array.from((r=e).options).filter((function(t){return t.selected})).map((function(t){return t.label})).join(", ")||r.value;case"form":return function(t){var e,n,r=t.getElementsByTagName("input");try{for(var i=V(Array.from(r)),o=i.next();!o.done;o=i.next()){var a=o.value;if(("search"===a.type||"text"===a.type&&("q"===a.id||-1!==a.id.indexOf("search")||"q"===a.name||-1!==a.name.indexOf("search")))&&!H(a)){var u=q(a);if(u)return u}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}}(e)}return I(e)?function(t){var e=w(t.textContent);if(e)return e}(e):function(t){return!(!t.hasChildNodes()||"svg"===t.nodeName)&&0===Array.from(t.childNodes).filter((function(t){return!I(t)})).length}(e)&&!S(e)?function(t){var e,n,r="";try{for(var i=V(Array.from(t.childNodes)),o=i.next();!o.done;o=i.next()){var a=o.value;r+=(a.nodeType===Node.TEXT_NODE&&a.textContent?a.textContent.trim():"")+" "}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return w(r,!1)}(e):a.container||S(t)?Z(e):void 0}}function q(t){return $(t)||void 0}var F,W=(F=function(t,e){return F=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)({}).hasOwnProperty.call(e,n)&&(t[n]=e[n])},F(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+e+" is not a constructor or null");function n(){this.constructor=t}F(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),Y=function(t){function e(e){var n=t.call(this,e)||this;n.node=e;var r=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}(function(t){for(var e=t.parentPaths(!0),n=Math.min(e.length,+(e.length>=10)+4),r=["","",""],i=0;i<e.length;i++){var o=e[i].path,a=e[i].name;r[0]=o+r[0],r[2]="/"+a+r[2],n>i&&(r[1]=o+r[1])}return r}(n),3),i=r[0],o=r[1],a=r[2];return n.fullXpath=i,n.xpath=o,n.skeleton=a,n}return W(e,t),Object.defineProperty(e.prototype,"href",{get:function(){return function(t){var e=t;if(e)switch(t.nodeName.toLowerCase()){case"a":return X(e);case"img":return G(e)}}(this.node)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"content",{get:function(){return q(this.node)},enumerable:!1,configurable:!0}),e}(B),K=function(){return K=Object.assign||function(t){for(var e,n=1,r=arguments.length;r>n;n++)for(var i in e=arguments[n])({}).hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},K.apply(this,arguments)},J=function(){function t(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!0),this.origin=t,this.action=e,this.direct=n,this.target="self"===e?t:function(t){for(var e,n;t&&(n=void 0,!((e=t)instanceof Element&&-1===m.indexOf(null===(n=e.tagName)||void 0===n?void 0:n.toLowerCase())))&&t.parentNode;)t=t.parentNode;var r,i=t.parentNode;return!_(i)&&(S(i)||"BUTTON"===(r=i).tagName&&function(t){return 0!==P(t).length&&!L(t).map((function(t){return t.tagName})).some((function(t){return-1===g.indexOf(t)}))}(r))?i:t}(t),this.ignore=H(this.target),this.vnode=new Y(this.target),this.tagName=this.vnode.tagName}return Object.defineProperty(t.prototype,"content",{get:function(){return this.vnode.content},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"href",{get:function(){return this.vnode.href},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"index",{get:function(){return this.vnode.index},enumerable:!1,configurable:!0}),t.prototype.inferParentIndex=function(){var e=this;return this.parentIndex||k(this.target,(function(n){var r=new t(n,e.action,!1);r.traceable()&&r.index&&(e.parentIndex=r.index)})),this.parentIndex},Object.defineProperty(t.prototype,"xpath",{get:function(){return this.vnode.xpath},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fullXpath",{get:function(){return this.vnode.fullXpath},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skeleton",{get:function(){return this.vnode.skeleton},enumerable:!1,configurable:!0}),t.prototype.info=function(t){return void 0===t&&(t=!0),t&&this.inferParentIndex(),{skeleton:this.skeleton,fullXpath:this.fullXpath,xpath:this.xpath,content:this.content,href:this.href,index:this.parentIndex||this.index}},t.prototype.traceable=function(){if(this.ignore)return!1;if(this.direct){if("click"===this.action||"hover"===this.action){if(-1!==p.indexOf(this.target.tagName))return!1;if("INPUT"===this.target.tagName&&!M(this.target))return!1;if(!C(this.target)&&!D(this.target,5))return!1}return!0}return this.vnode.container},t.prototype.trackNodes=function(){if(!this.traceable())return[];var t=[this];if("submit"!==this.action)for(var e=this.parentElement;e;){if(e.ignore)return[];e.traceable()&&t.unshift(e),e=e.parentElement}var n=void 0;return t.map((function(t){var e=t.info(!1),r=e.index;return!n&&r&&(n=r),K(K({},e),{index:n||r})}))},Object.defineProperty(t.prototype,"parentElement",{get:function(){var e=this.target.parentNode;if(e&&e.nodeName&&!_(e))return new t(e,this.action,!1)},enumerable:!1,configurable:!0}),t}(),Q=function(){function t(t){this.handler=t;var e=navigator.userAgent,n=/chrome/i.exec(e),r=/android/i.exec(e);this.hasTouch="ontouchstart"in window&&!(n&&!r)}return t.prototype.main=function(){for(var t=this.hasTouch?["touchstart"]:["mousedown"],e=this.hasTouch?["touchend","touchcancel"]:["mouseup","mouseleave"],n=this.hasTouch?["touchmove"]:["mousemove"],r=0,i=t;i.length>r;r++)f(window,i[r],this.touchStartHandler.bind(this));for(var o=0,a=n;a.length>o;o++)f(window,a[o],this.touchMoveHandler.bind(this));for(var u=0,c=e;c.length>u;u++)f(window,c[u],this.touchStopHandler.bind(this))},t.prototype.touchStartHandler=function(t){if(1>=t.which){var e=+Date.now();this.safeguard!==e&&(this.touchTimeout&&clearTimeout(this.touchTimeout),this.safeguard=e,this.touchEvent={time:e,target:t.target,x:this._page("x",t),y:this._page("y",t),isTrusted:!0,type:"click"})}},t.prototype.touchMoveHandler=function(t){var e=Math.abs(this._page("x",t)-(this.touchEvent&&this.touchEvent.x)||0),n=Math.abs(this._page("y",t)-(this.touchEvent&&this.touchEvent.y)||0);(e>10||n>10)&&(this.touchEvent=null)},t.prototype.touchStopHandler=function(t){var e=this,n=+Date.now()-(this.touchEvent&&this.touchEvent.time)||0;this.touchEvent&&200>n?this.touchTimeout=setTimeout((function(){e.handler(e.touchEvent),e.touchEvent=null}),200):this.touchEvent&&n>=200&&700>n&&(this.handler(this.touchEvent),this.touchEvent=null)},t.prototype._page=function(t,e){return(this.hasTouch?e.touches[0]:e)["page".concat(t.toUpperCase())]},t}();window.gioEventAutoTracking={name:"gioEventAutoTracking",method:function(e){var n=this;this.growingIO=e,this.main=function(){f(document,"submit",n._handleAction),f(document,"change",n._handleAction),n.growingIO.vdsConfig.touch?new Q(n._handleAction).main():f(document,"click",n._handleAction)},this._handleAction=function(e,i){var c=n.growingIO,f=c.vdsConfig,l=c.emitter;if(!f.autotrack)return!1;var s=e.target;if(!s)return!1;var h=new J(s,e.type,!0).trackNodes();if("click"!==e.type&&(h=u(o(h))?[]:[o(h)]),u(h))return!1;null==l||l.emit("onComposeBefore",{event:i,params:null!=e?e:{}}),h.forEach((function(i){var o=i.fullXpath,u=i.index,c=i.content,l=i.href;if(!a(i.fullXpath||"","/div#__vconsole")&&!a(i.fullXpath||"","/div#__giokit")&&(f.debug&&console.log("Action：",e.type,Date.now()),o)){var s=n.growingIO.dataStore,h=s.eventContextBuilder,d=s.eventConverter,v=s.currentPage;d(t(t({eventType:r[e.type],element:[{xpath:o,index:u,textValue:c,hyperlink:l}]},h()),{pageShowTimestamp:v.time}))}}))}}}}));
