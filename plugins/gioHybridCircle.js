var e,t,n,r,i,o,a,u,s,l=function(){return l=Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++)for(var i in t=arguments[n])({}).hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},l.apply(this,arguments)},f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},d="function"==typeof Array.from?Array.from:(t||(t=1,n=function(e){return"function"==typeof e},r=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),9007199254740991)},i=function(e){if(null!=e){if(["string","number","boolean","symbol"].indexOf(typeof e)>-1)return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in e)return Symbol.iterator;if("@@iterator"in e)return"@@iterator"}},o=function(e,t){if(null!=e&&null!=t){var r=e[t];if(null==r)return;if(!n(r))throw new TypeError(r+" is not a function");return r}},a=function(e){var t=e.next();return!t.done&&t},e=function(e){var t,u,s,l=this,f=arguments.length>1?arguments[1]:void 0;if(void 0!==f){if(!n(f))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(t=arguments[2])}var d=o(e,i(e));if(void 0!==d){u=n(l)?Object(new l):[];var c,h,p=d.call(e);if(null==p)throw new TypeError("Array.from requires an array-like or iterable object");for(s=0;;){if(!(c=a(p)))return u.length=s,u;h=c.value,u[s]=f?f.call(t,h,s):h,s++}}else{var g=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var v,m=r(g.length);for(u=n(l)?Object(new l(m)):Array(m),s=0;m>s;)v=g[s],u[s]=f?f.call(t,v,s):v,s++;u.length=m}return u}),e),c=function(e){return p(["undefined","null"],m(e))},h=function(e){return"object"===m(e)&&!c(e)},p=function(e,t){return("array"===m(e)||"string"===m(e))&&e.indexOf(t)>=0},g=d,v=function(e,t){if(!h(e))return!1;try{return"string"===m(t)?delete e[t]:"array"===m(t)?t.map((function(t){return delete e[t]})):(function(e){return"regexp"===m(e)}(t)&&function(e){return h(e)?Object.keys(e):[]}(e).forEach((function(n){t.test(n)&&v(e,n)})),!0)}catch(e){return!1}},m=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},N=function(e,t,n,r){void 0===r&&(r={}),document.addEventListener?e.addEventListener(t,n,l(l({},{capture:!0}),r)):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},T={},E={};u=E,s=f&&f.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;o>i;i++)!r&&i in t||(r||(r=[].slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||[].slice.call(t))},Object.defineProperty(u,"__esModule",{value:!0}),u.GROWING_TITLE_OLD=u.GROWING_TITLE=u.GROWING_GTITLE=u.GROWING_CDP_INDEX=u.GROWING_INDEX_OLD=u.GROWING_INDEX=u.GROWING_CONTAINER=u.GROWING_TRACK=u.GROWING_IGNORE=u.VALID_CLASS_SELECTOR=u.VALID_ID_SELECTOR=u.EXCLUDE_CLASS_RE=u.UNSUPPORTED_TAGS=u.TEXT_NODE=u.UNSUPPORTED_CLICK_TAGS=u.SUPPORTED_ICON_TAGS=u.SUPPORTED_CHANGE_TYPES=u.SUPPORTED_CLICK_INPUT_TYPES=u.SUPPORTED_CONTAINER_TAGS=u.LIST_TAGS=void 0,u.LIST_TAGS=["TR","LI","DL"],u.SUPPORTED_CONTAINER_TAGS=s(["A","BUTTON"],u.LIST_TAGS,!0),u.SUPPORTED_CLICK_INPUT_TYPES=["button","submit","reset"],u.SUPPORTED_CHANGE_TYPES=["radio","checkbox","search"],u.SUPPORTED_ICON_TAGS=["I","EM","svg","IMG"],u.UNSUPPORTED_CLICK_TAGS=["TEXTAREA","HTML","BODY"],u.TEXT_NODE=["I","SPAN","EM","B","STRONG"],u.UNSUPPORTED_TAGS=["tspan","text","g","rect","path","defs","clippath","desc","title","math","use"],u.EXCLUDE_CLASS_RE=/(^| |[^ ]+\-)(clear|clearfix|active|hover|enabled|current|selected|unselected|hidden|display|focus|disabled|undisabled|open|checked|unchecked|undefined|null|ng-|growing-)[^\. ]*/g,u.VALID_ID_SELECTOR=/^[a-zA-Z-\_][a-zA-Z\-\_0-9]+$/,u.VALID_CLASS_SELECTOR=/^([a-zA-Z\-\_0-9]+)$/,u.GROWING_IGNORE="data-growing-ignore",u.GROWING_TRACK="data-growing-track",u.GROWING_CONTAINER="data-growing-container",u.GROWING_INDEX="data-growing-index",u.GROWING_INDEX_OLD="data-growing-idx",u.GROWING_CDP_INDEX="data-index",u.GROWING_GTITLE="data-growing-title",u.GROWING_TITLE="data-title",u.GROWING_TITLE_OLD="growing-title";var I={},_={};Object.defineProperty(_,"__esModule",{value:!0}),_.lastFindIndex=_.findIndex=_.arrayEquals=_.rmBlank=_.normalizePath=_.splitNoEmpty=_.filterText=void 0,_.filterText=function(e,t){if(void 0===t&&(t=!0),e&&(null==(e=e.replace(/[\n \t]+/g," ").trim())?void 0:e.length))return e.slice(0,t?50:void 0)},_.splitNoEmpty=function(e,t){return e?e.split(t).filter((function(e){return!!e})):[]},_.normalizePath=function(e){var t=e.length;return t>1&&"/"===e.charAt(t-1)?e.slice(0,t-1):e},_.rmBlank=function(e){return e?e.replace(/[\n \t]+/g,""):""},_.arrayEquals=function(e,t){if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var n=0,r=e.length;r>n;n++)if(e[n]!==t[n])return!1;return!0},_.findIndex=function(e,t){if(null==e||"function"!=typeof t)return-1;for(var n=0;n<e.length;n++){var r=e[n];if(t.call(void 0,r))return n}return-1},_.lastFindIndex=function(e,t){if(null==e||"function"!=typeof t)return-1;for(var n=e.length-1;n>=0;n--){var r=e[n];if(t.call(void 0,r))return n}return-1},function(e){var t=f&&f.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;o>i;i++)!r&&i in t||(r||(r=[].slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||[].slice.call(t))},n=f&&f.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.removeDiffTagOnHeadAndTail=e.computeXpath=e.getMarkIndex=e.getEffectiveNode=e.isIgnore=e.depthInside=e.changeableInput=e.clickableInput=e.onlyContainsTextChildren=e.onlyContainsIconChildren=e.supportIconTag=e.isContainerTag=e.isListTag=e.isParentOfLeaf=e.isLeaf=e.getChildren=e.getDeepChildren=e.findParent=e.isRootNode=e.hasValidAttribute=void 0;var r=_,i=E,o=n(d);e.hasValidAttribute=function(e,t){return e instanceof Element&&e.hasAttribute(t)&&"false"!==e.getAttribute(t)},e.isRootNode=function(e){return!e||-1!==["BODY","HTML","#document"].indexOf(e.nodeName)},e.findParent=function(t,n){for(var r=t.parentNode;r&&!(0,e.isRootNode)(r);){if(n(r))return r;r=r.parentNode}},e.getDeepChildren=function(n){return(0,o.default)((null==n?void 0:n.childNodes)||[]).reduce((function(n,r){return r instanceof Element?t(t(t([],n,!0),[r],!1),(0,e.getDeepChildren)(r),!0):n}),[])},e.getChildren=function(e){return(0,o.default)((null==e?void 0:e.childNodes)||[]).filter((function(e){return e instanceof Element}))},e.isLeaf=function(t){return!t.hasChildNodes()||"svg"===t.nodeName||0===(0,e.getChildren)(t).length},e.isParentOfLeaf=function(t){return!(!t.hasChildNodes()||"svg"===t.nodeName)&&0===(0,o.default)(t.childNodes).filter((function(t){return!(0,e.isLeaf)(t)})).length},e.isListTag=function(e){return-1!==i.LIST_TAGS.indexOf(e.nodeName)},e.isContainerTag=function(t){return(0,e.hasValidAttribute)(t,i.GROWING_CONTAINER)||-1!==i.SUPPORTED_CONTAINER_TAGS.indexOf(t.nodeName)},e.supportIconTag=function(e){var t=e.nodeName;return-1!==i.SUPPORTED_ICON_TAGS.indexOf(t)},e.onlyContainsIconChildren=function(t){if(t.textContent)return!1;var n=(0,e.getChildren)(t);if(0===n.length)return!1;for(var r=0,i=n;r<i.length;r++){var o=i[r];if(!(0,e.supportIconTag)(o)&&"SPAN"!==o.nodeName)return!1}return!0},e.onlyContainsTextChildren=function(t){return 0!==(0,e.getChildren)(t).length&&!(0,e.getDeepChildren)(t).map((function(e){return e.tagName})).some((function(e){return-1===i.TEXT_NODE.indexOf(e)}))},e.clickableInput=function(e){return e instanceof HTMLInputElement&&"INPUT"===e.tagName&&-1!==i.SUPPORTED_CLICK_INPUT_TYPES.indexOf(e.type)},e.changeableInput=function(e){return e instanceof HTMLInputElement&&"INPUT"===e.tagName&&-1!==i.SUPPORTED_CHANGE_TYPES.indexOf(e.type)},e.depthInside=function(t,n,r){if(void 0===n&&(n=4),void 0===r&&(r=1),r>n)return!1;for(var i="svg"===t.tagName?[]:(0,e.getChildren)(t),o=0;o<i.length;o++){var a=i[o];if(!(0,e.depthInside)(a,n,r+1))return!1}return n>=r},e.isIgnore=function(t){if(!(t instanceof Element)||(0,e.hasValidAttribute)(t,i.GROWING_IGNORE))return!0;for(var n=t.parentNode;n&&!(0,e.isRootNode)(n);){if((0,e.hasValidAttribute)(n,i.GROWING_IGNORE))return!0;n=n.parentNode}return!1},e.getEffectiveNode=function(t){for(var n,r;t&&(r=void 0,!((n=t)instanceof Element&&-1===i.UNSUPPORTED_TAGS.indexOf(null===(r=n.tagName)||void 0===r?void 0:r.toLowerCase())))&&t.parentNode;)t=t.parentNode;var o,a=t.parentNode;return!(0,e.isRootNode)(a)&&((0,e.onlyContainsIconChildren)(a)||"BUTTON"===(o=a).tagName&&(0,e.onlyContainsTextChildren)(o))?a:t},e.getMarkIndex=function(e){if(e instanceof Element){var t=e.getAttribute(i.GROWING_INDEX)||e.getAttribute(i.GROWING_INDEX_OLD)||e.getAttribute(i.GROWING_CDP_INDEX);if(t){if(/^\d{1,10}$/.test(t)&&+t>0&&2147483647>+t)return+t;window.console.error("[GioNode]：标记的index不符合规范（index必须是大于0且小于2147483647的整数字）。",t)}}},e.computeXpath=function(e){for(var t=e.parentPaths(!0),n=Math.min(t.length,+(t.length>=10)+4),r=["","",""],i=0;i<t.length;i++){var o=t[i].path,a=t[i].name;r[0]=o+r[0],r[2]="/".concat(a)+r[2],n>i&&(r[1]=o+r[1])}return r},e.removeDiffTagOnHeadAndTail=function(e,t){var n=function(e){return e.nodeName===t.nodeName},i=(0,r.findIndex)(e,n),o=(0,r.lastFindIndex)(e,n);return-1===i||-1===o?[]:e.slice(i,o+1)}}(I);var O={},b={};Object.defineProperty(b,"__esModule",{value:!0});var y=E,C=_,L=I;function w(e){var t;if(e instanceof Element){var n=e.getAttribute("name");if(n)return[n];if(e.hasAttribute("class")){var r=null===(t=e.getAttribute("class"))||void 0===t?void 0:t.replace(y.EXCLUDE_CLASS_RE,"").trim();if(null==r?void 0:r.length)return r.split(/\s+/).filter((function(e){return y.VALID_CLASS_SELECTOR.test(e)&&!e.match(/[a-z][A-Z][a-z][A-Z]/)&&!e.match(/[0-9][0-9][0-9][0-9]/)})).sort()}}return[]}var x=function(){function e(e){var t;this.node=e,this.tagName=this.node.nodeName,this.name=this.tagName.toLowerCase(),this.id=(t=this.node).id&&y.VALID_ID_SELECTOR.test(t.id)?t.id:null,this.classList=w(this.node),this.guessListAndIndex()}return e.prototype.guessListAndIndex=function(){var e,t=this;this._tagList=(0,L.isListTag)(this.node);var n=(0,L.removeDiffTagOnHeadAndTail)((0,L.getChildren)(this.node.parentNode),this.node);if(this._tagList&&-1!==(o=n.filter((function(e){return e.tagName===t.tagName})).indexOf(this.node))&&(this._index=o+1),n.length>=3&&(null===(e=this.classList)||void 0===e?void 0:e.length)){for(var r=0,i=0,o=1;o<=n.length;o++){var a=n[o-1];if(a.tagName!==this.tagName){i=0;break}(0,C.arrayEquals)(this.classList,w(a))&&(i+=1),this.node===a&&(r=o)}3>i||(this._pseudoList=!0,this._index=this._index||r)}},Object.defineProperty(e.prototype,"path",{get:function(){var e;return this._path||(this._path="/".concat(this.name),this.id&&(this._path+="#".concat(this.id)),(null===(e=this.classList)||void 0===e?void 0:e.length)&&(this._path+=".".concat(this.classList.join(".")))),this._path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pseudoList",{get:function(){return!!this._pseudoList},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"list",{get:function(){return!!this._tagList||!!this._pseudoList},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return(0,L.getMarkIndex)(this.node)||this._index},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"container",{get:function(){return(0,L.isContainerTag)(this.node)||this.list},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.node.parentNode?new e(this.node.parentNode):null},enumerable:!1,configurable:!0}),e.prototype.parentPaths=function(e){void 0===e&&(e=!1);for(var t=e?[this]:[],n=this.parent;n&&!(0,L.isRootNode)(n.node);)t.push(n),n=n.parent;return t},e}();b.default=x;var D={};Object.defineProperty(D,"__esModule",{value:!0}),D.getElementHref=D.getImgHref=D.getAnchorHref=void 0;var P=_;function R(e){if(e.hasAttribute("href")){var t=e.getAttribute("href");if(t&&0!==t.indexOf("javascript"))return(0,P.normalizePath)(t.slice(0,320))}}function A(e){if(e.src&&-1===e.src.indexOf("data:image"))return e.src}D.getAnchorHref=R,D.getImgHref=A,D.getElementHref=function(e){var t=e;if(t)switch(e.nodeName.toLowerCase()){case"a":return R(t);case"img":return A(t)}};var S={},G=f&&f.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(S,"__esModule",{value:!0}),S.getElementContent=S.getFormContent=void 0;var U=I,W=D,H=E,M=G(b),k=_,j=G(d),B=function(e){return e.htmlFor||e.getAttribute("for")};function X(e){var t=e.node;return e.list?V(t):(0,k.filterText)(t.textContent)||void 0}function V(e){for(var t=void 0,n=!1,r=0,i=(0,j.default)(e.childNodes);r<i.length;r++){var o=i[r];if(o.nodeType===Node.TEXT_NODE){var a=(0,k.filterText)(o.textContent);if(a)return a}if(o.nodeType===Node.ELEMENT_NODE&&-1===["INPUT","SELECT"].indexOf(o.nodeName)){if(new M.default(o).pseudoList)return;n=(0,U.onlyContainsIconChildren)(o)||(0,U.supportIconTag)(o);var u=K(o);if(n)t=u,n=!1;else if(u||(u=V(o)),u)return u}}return t}function z(e){for(var t=e.getElementsByTagName("input"),n=0,r=(0,j.default)(t);n<r.length;n++){var i=r[n];if(("search"===i.type||"text"===i.type&&("q"===i.id||-1!==i.id.indexOf("search")||"q"===i.name||-1!==i.name.indexOf("search")))&&!(0,U.isIgnore)(i)){var o=K(i);if(o)return o}}}function K(e){return function(e){var t=e;if(t){var n=function(e){var t=e.getAttribute(H.GROWING_GTITLE)||e.getAttribute(H.GROWING_TITLE)||e.getAttribute(H.GROWING_TITLE_OLD)||e.getAttribute("title");return null==t?void 0:t.trim()}(t);if(n)return n;var r,i,o,a=new M.default(e);switch(e.nodeName.toLowerCase()){case"a":return function(e){if(((0,U.isLeaf)(e)||(0,U.onlyContainsIconChildren)(e))&&e.textContent){var t=(0,k.filterText)(e.textContent);if(t)return t}var n=(0,W.getAnchorHref)(e);if(n){var r=n.indexOf("?");return r>-1?n.slice(0,r):n}}(t);case"svg":return function(e){for(var t=0,n=(0,j.default)(e.childNodes);t<n.length;t++){var r=n[t];if(r.nodeType===Node.ELEMENT_NODE&&"use"===r.tagName.toLowerCase()&&r.hasAttribute("xlink:href"))return r.getAttribute("xlink:href")}}(t);case"button":return(null===(o=(i=t).name)||void 0===o?void 0:o.length)?i.name:(0,k.filterText)(i.textContent)||V(i);case"img":return function(e){if(e.alt)return e.alt;var t=(0,W.getImgHref)(e);if(t){var n=t.split("?")[0].split("/");if(n.length>0)return n[n.length-1]}}(t);case"label":return X(a);case"input":return function(e){if((0,U.clickableInput)(e))return e.value;if("password"!==e.type&&(0,U.hasValidAttribute)(e,H.GROWING_TRACK))return e.value;if((0,U.changeableInput)(e)){var t=(0,U.findParent)(e,(function(e){return"LABEL"===e.nodeName}));if(!t&&e.id)for(var n=document.body.getElementsByTagName("label"),r=0;r<n.length;r++){var i=n[r];if(B(i)===e.id){t=i;break}}if(t){var o=X(new M.default(t));if(o&&o.length>0)return o+" ("+e.checked+")"}return e.value}}(t);case"select":return r=t,(0,j.default)(r.options).filter((function(e){return e.selected})).map((function(e){return e.label})).join(", ")||r.value;case"form":return z(t)}return(0,U.isLeaf)(t)?function(e){var t=(0,k.filterText)(e.textContent);if(t)return t}(t):(0,U.isParentOfLeaf)(t)&&!(0,U.onlyContainsIconChildren)(t)?function(e){for(var t="",n=0,r=(0,j.default)(e.childNodes);n<r.length;n++){var i=r[n];t+=(i.nodeType===Node.TEXT_NODE&&i.textContent?i.textContent.trim():"")+" "}return(0,k.filterText)(t,!1)}(t):a.container||(0,U.onlyContainsIconChildren)(e)?V(t):void 0}}(e)||void 0}S.getFormContent=z,S.getElementContent=K;var Y,q=f&&f.__extends||(Y=function(e,t){return Y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)({}).hasOwnProperty.call(t,n)&&(e[n]=t[n])},Y(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+t+" is not a constructor or null");function n(){this.constructor=e}Y(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),F=f&&f.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(O,"__esModule",{value:!0});var Z=F(b),J=D,$=S,Q=I,ee=function(e){function t(t){var n=e.call(this,t)||this;n.node=t;var r=(0,Q.computeXpath)(n),i=r[0],o=r[1],a=r[2];return n.fullXpath=i,n.xpath=o,n.skeleton=a,n}return q(t,e),Object.defineProperty(t.prototype,"href",{get:function(){return(0,J.getElementHref)(this.node)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"content",{get:function(){return(0,$.getElementContent)(this.node)},enumerable:!1,configurable:!0}),t}(Z.default);O.default=ee;var te=f&&f.__assign||function(){return te=Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++)for(var i in t=arguments[n])({}).hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},te.apply(this,arguments)},ne=f&&f.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(T,"__esModule",{value:!0});var re,ie=E,oe=I,ae=ne(O),ue=function(){function e(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!0),this.origin=e,this.action=t,this.direct=n,this.target="self"===t?e:(0,oe.getEffectiveNode)(e),this.ignore=(0,oe.isIgnore)(this.target),this.vnode=new ae.default(this.target),this.tagName=this.vnode.tagName}return Object.defineProperty(e.prototype,"content",{get:function(){return this.vnode.content},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"href",{get:function(){return this.vnode.href},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this.vnode.index},enumerable:!1,configurable:!0}),e.prototype.inferParentIndex=function(){var t=this;return this.parentIndex||(0,oe.findParent)(this.target,(function(n){var r=new e(n,t.action,!1);r.traceable()&&r.index&&(t.parentIndex=r.index)})),this.parentIndex},Object.defineProperty(e.prototype,"xpath",{get:function(){return this.vnode.xpath},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fullXpath",{get:function(){return this.vnode.fullXpath},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skeleton",{get:function(){return this.vnode.skeleton},enumerable:!1,configurable:!0}),e.prototype.info=function(e){return void 0===e&&(e=!0),e&&this.inferParentIndex(),{skeleton:this.skeleton,fullXpath:this.fullXpath,xpath:this.xpath,content:this.content,href:this.href,index:this.parentIndex||this.index}},e.prototype.traceable=function(){if(this.ignore)return!1;if(this.direct){if("click"===this.action||"hover"===this.action){if(-1!==ie.UNSUPPORTED_CLICK_TAGS.indexOf(this.target.tagName))return!1;if("INPUT"===this.target.tagName&&!(0,oe.clickableInput)(this.target))return!1;if(!(0,oe.isContainerTag)(this.target)&&!(0,oe.depthInside)(this.target,5))return!1}return!0}return this.vnode.container},e.prototype.trackNodes=function(){if(!this.traceable())return[];var e=[this];if("submit"!==this.action)for(var t=this.parentElement;t;){if(t.ignore)return[];t.traceable()&&e.unshift(t),t=t.parentElement}var n=void 0;return e.map((function(e){var t=e.info(!1),r=t.index;return!n&&r&&(n=r),te(te({},t),{index:n||r})}))},Object.defineProperty(e.prototype,"parentElement",{get:function(){var t=this.target.parentNode;if(t&&t.nodeName&&!(0,oe.isRootNode)(t))return new e(t,this.action,!1)},enumerable:!1,configurable:!0}),e}(),se=T.default=ue,le=["i","span","em","b","strong","svg"];!function(e){e[e.OUTER=0]="OUTER",e[e.INNER_COVERED=1]="INNER_COVERED",e[e.INNER_SHOW=2]="INNER_SHOW"}(re||(re={}));var fe=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;o>i;i++)!r&&i in t||(r||(r=[].slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||[].slice.call(t))}(["HR","BR","SCRIPT","NOSCRIPT","STYLE","HEAD","BASE","LINK","META","TITLE","BODY","HTML","TEMPLATE","CODE"],E.UNSUPPORTED_CLICK_TAGS,!0),de=["SELECT","A","BUTTON","INPUT","IMG","FORM"],ce=function(e,t,n){return document.elementFromPoint(t,n)===e},he=function(){function e(e,t,n){this.node=e,this.parentNodeDesc=t,this.devicesInfo=n,this.proxy=new se(e),this.tagName=this.node.tagName,this.name=this.tagName.toLowerCase(),this.isIgnore=!!this.node.dataset.growingIgnore,this.isUnSupported=-1!==fe.indexOf(this.tagName),this.rect=this.computeWindowRect()}return e.prototype.info=function(){var e=this.desc();e.zLevel+=this.devicesInfo.webviewZLevel;var t=this.getDeviceRect(this.rect);return v(e,"isContainer"),l(l(l({},e),t),{parentXPath:this.parentNodeDesc.isContainer?this.parentNodeDesc.xpath:void 0,href:this.proxy.href,content:this.proxy.content,nodeType:this.nodeType()})},e.prototype.nodeType=function(){return"input"!==this.name||I.changeableInput(this.node)?this.node.tagName:"INPUT_BTN"},e.prototype.desc=function(){return{index:this.parentNodeDesc.index||this.proxy.index,zLevel:this.zLevel(),xpath:this.proxy.xpath,isContainer:this.isDefinedContainer()}},e.prototype.cssVisible=function(){var e=this.computedStyle();return Number(e.opacity)>0&&"visible"===e.visibility&&"none"!==e.display},e.prototype.viewportStatus=function(){var e=this.rect,t=e.top,n=e.left,r=e.width,i=e.height,o=this.devicesInfo,a=o.winWidth,u=o.winHeight;if(0>=r||0>=i)return re.OUTER;var s=this.node;return u>t&&a>n&&r>0&&i>0?ce(s,n+r/2,t+i/2)||ce(s,n+1,t+1)||ce(s,n+r-1,t+1)||ce(s,n+1,t+i-1)||ce(s,n+r-1,t+i-1)?re.INNER_SHOW:re.INNER_COVERED:re.OUTER},e.prototype.isCircleable=function(){return this.proxy.target===this.proxy.origin&&(!!this.isDefinedContainer()||!("input"===this.name&&this.node instanceof HTMLInputElement&&"password"===this.node.type)&&(-1!==de.indexOf(this.name)||(I.isLeaf(this.node)?!this.isBigBlank():this.hasBackgroundImage()&&I.depthInside(this.node,4))))},e.prototype.isSimpleContainer=function(){return"select"===this.name||this.isDefaultContainer()&&(function(e,t){if(0===e.children.length)return!1;for(var n=0,r=g(e.children);n<r.length;n++){var i=r[n];if(-1===t.indexOf(i.tagName.toLowerCase()))return!1}return!0}(this.node,le)||!this.node.childElementCount)},e.prototype.isDefinedContainer=function(){var e;return c(this.isContainer)?this.isDefaultContainer()||this.isMarkContainer()||I.isParentOfLeaf(this.node)&&(!!(null===(e=this.node.innerText)||void 0===e?void 0:e.trim().length)||function(e){var t=e.attributes;if(t.length>0)for(var n=0;n<t.length;n++){var r=t[n].value;if(r&&"false"!==r)return!0}return!1}(this.node))||"select"===this.name:!!this.isContainer},e.prototype.isDefaultContainer=function(){return-1!==E.SUPPORTED_CONTAINER_TAGS.indexOf(this.tagName)||I.clickableInput(this.node)},e.prototype.isMarkContainer=function(){return this.node.hasAttribute("data-growing-container")||this.node.hasAttribute("growing-container")},e.prototype.isBigBlank=function(){var e,t,n=null!==(t=null===(e=this.node.innerText)||void 0===e?void 0:e.trim().length)&&void 0!==t?t:0,r=this.rect,i=r.width,o=r.height,a=this.devicesInfo,u=a.winWidth,s=a.winHeight;return!n&&(i>u>>1||o>s>>1)},e.prototype.hasBackgroundImage=function(){var e=this.computedStyle().backgroundImage;return!!e&&"none"!==e&&e.length>0},e.prototype.zLevel=function(){var e=this.computedStyle(),t=e.zIndex;if("auto"!==t)return Number(t||"0")+this.parentNodeDesc.zLevel;switch(e.position){case"relative":return this.parentNodeDesc.zLevel+2;case"sticky":return this.parentNodeDesc.zLevel+3;case"absolute":return this.parentNodeDesc.zLevel+4;case"fixed":return this.parentNodeDesc.zLevel+5;default:return this.parentNodeDesc.zLevel+1}},e.prototype.computeWindowRect=function(){if(this.rect)return this.rect;var e=this.node.getBoundingClientRect(),t=e.top,n=e.bottom,r=e.left,i=e.right-r,o=n-t;return 0>t?o=t+o:t+o>this.devicesInfo.winHeight&&(o=this.devicesInfo.winHeight-t),0>r?i=r+i:r+i>this.devicesInfo.winWidth&&(i=this.devicesInfo.winWidth-r),this.rect={top:t,left:r,width:i,height:o},this.rect},e.prototype.computedStyle=function(){return window.getComputedStyle(this.node)},e.prototype.getDeviceRect=function(e){var t=this.devicesInfo,n=t.scale,r=t.webviewTop,i=t.webviewLeft;return{top:e.top*n+r,left:e.left*n+i,width:e.width*n,height:e.height*n}},e}(),pe=["DOMContentLoaded","onreadystatechange"],ge=["scroll","resize","load","beforeunload","popstate","hashchange","pagehide","unload"],ve=function(){function e(e){this.growingIO=e,this.addDomChangeListener()}return e.prototype.getDomTree=function(e,t,n,r,i,o){var a=function(e,t,n,r,i){var o=document.documentElement.clientWidth;return{winWidth:o,winHeight:document.documentElement.clientHeight,scale:n/o,webviewTop:t,webviewLeft:e,webviewWidth:n,webviewHeight:r,webviewZLevel:i}}(e,t,n,r,i),u=this.getElementsByParent(o||document.body,{isContainer:!1,zLevel:0},a),s=this.growingIO.dataStore.currentPage;return{page:{domain:s.domain,path:s.path,query:s.query,title:s.title},elements:u}},e.prototype.getElementsByParent=function(e,t,n){var r=this,i=[];return[].slice.call(e.childNodes,0).filter((function(e){return 1===e.nodeType})).forEach((function(e){var o=new he(e,t,n);if(o.cssVisible()&&!o.isIgnore){switch(o.viewportStatus()){case re.INNER_SHOW:o.isCircleable()&&i.push(o.info());break;case re.INNER_COVERED:o.isDefaultContainer()&&i.push(o.info())}o.isSimpleContainer()||[].push.apply(i,r.getElementsByParent(e,o.desc(),n))}})),i},e.prototype.addDomChangeListener=function(){var e,t=function(t){return void 0===t&&(t=""),function(){var n;"beforeunload"===t&&e&&e.disconnect(),null===(n=window.GrowingWebViewJavascriptBridge)||void 0===n||n.onDomChanged()}};(e=new MutationObserver(t("mutation"))).observe(document.body,{attributes:!0,characterData:!0,childList:!0,subtree:!0}),pe.forEach((function(e){N(document,e,t(e))})),ge.forEach((function(e){N(window,e,t(e))}))},e}(),me={name:"gioHybridCircle",method:function(){function e(t){var n,r=this;this.growingIO=t,null===(n=this.growingIO.emitter)||void 0===n||n.on("SDK_INITIALIZED",(function(){if(window.GrowingWebViewJavascriptBridge){var t=r;window.GrowingWebViewJavascriptBridge.getDomTree=function(){if(arguments.length>=4)return e.bindGetDomTree(t.growingIO),e.domHelper.getDomTree.apply(e.domHelper,arguments)}}}))}return e.bindGetDomTree=function(e){this.domHelper||(this.domHelper=new ve(e),window.GrowingWebViewJavascriptBridge.getDomTree=this.domHelper.getDomTree.bind(this.domHelper))},e}()};export{me as default};
