!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e,t,r,n,i,o,a,u="function"==typeof Array.from?Array.from:(t||(t=1,r=function(e){return"function"==typeof e},n=function(e){var t=function(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(t>0?1:-1)*Math.floor(Math.abs(t)):t}(e);return Math.min(Math.max(t,0),9007199254740991)},i=function(e){if(null!=e){if(["string","number","boolean","symbol"].indexOf(typeof e)>-1)return Symbol.iterator;if("undefined"!=typeof Symbol&&"iterator"in Symbol&&Symbol.iterator in e)return Symbol.iterator;if("@@iterator"in e)return"@@iterator"}},o=function(e,t){if(null!=e&&null!=t){var n=e[t];if(null==n)return;if(!r(n))throw new TypeError(n+" is not a function");return n}},a=function(e){var t=e.next();return!t.done&&t},e=function(e){var t,u,c,s=this,f=arguments.length>1?arguments[1]:void 0;if(void 0!==f){if(!r(f))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(t=arguments[2])}var d=o(e,i(e));if(void 0!==d){u=r(s)?Object(new s):[];var l,v,m=d.call(e);if(null==m)throw new TypeError("Array.from requires an array-like or iterable object");for(c=0;;){if(!(l=a(m)))return u.length=c,u;v=l.value,u[c]=f?f.call(t,v,c):v,c++}}else{var p=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var g,b=n(p.length);for(u=r(s)?Object(new s(b)):Array(b),c=0;b>c;)g=p[c],u[c]=f?f.call(t,g,c):g,c++;u.length=b}return u}),e),c=function(e){return l(["undefined","null"],I(e))},s=function(e){return"object"===I(e)&&!c(e)},f=function(e){return Array.isArray(e)&&"array"===I(e)},d=function(e){try{return v(e)[0]}catch(e){return}},l=function(e,t){return("array"===I(e)||"string"===I(e))&&e.indexOf(t)>=0},v=u,m=function(e){return c(e)?"":"".concat(e)},p=function(e){if("string"===I(e)){var t=function(e,t){return"string"==typeof e?e.split(""):e}(e);return"".concat(d(t).toLowerCase()).concat((r=t,void 0===n&&(n=1),f(r)&&function(e){return"number"===I(e)}(n)?r.slice(n>0?n:1,r.length):r).join(""))}var r,n;return e},g={}.hasOwnProperty,b=function(e,t){return!c(e)&&g.call(e,t)},h=function(e){return s(e)?Object.keys(e):[]},I=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()};function y(e){for(var t=1;arguments.length>t;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}!function e(t,r){function n(e,n,i){if("undefined"!=typeof document){"number"==typeof(i=y({},r,i)).expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var a in i)i[a]&&(o+="; "+a,!0!==i[a]&&(o+="="+i[a].split(";")[0]));return document.cookie=e+"="+t.write(n,e)+o}}return Object.create({set:n,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var r=document.cookie?document.cookie.split("; "):[],n={},i=0;i<r.length;i++){var o=r[i].split("="),a=o.slice(1).join("=");try{var u=decodeURIComponent(o[0]);if(n[u]=t.read(a,u),e===u)break}catch(e){}}return e?n[e]:n}},remove:function(e,t){n(e,"",y({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,y({},this.attributes,t))},withConverter:function(t){return e(y({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"});var O=function(){return O=Object.assign||function(e){for(var t,r=1,n=arguments.length;n>r;r++)for(var i in t=arguments[r])({}).hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},O.apply(this,arguments)},w=function(e){try{return e()}catch(e){return}},A=function(e){var t={};return s(e)&&function(e,r){h(e).forEach((function(r){return function(e,r){var n,i=m(r).slice(0,100);s(e)?t[i]=A(e):f(e)?(t[i]=e.slice(0,100),"cdp"===(null===(n=window.vds)||void 0===n?void 0:n.gioEnvironment)&&(t[i]=t[i].join("||"))):t[i]=c(e)?"":m(e).slice(0,1e3)}(e[r],r)}))}(e),t},k=function(e,t,r,n){void 0===n&&(n={}),document.addEventListener?e.addEventListener(t,r,O(O({},{capture:!0}),n)):e.attachEvent?e.attachEvent("on"+t,r):e["on"+t]=r};window.gioImpressionTracking={name:"gioImpressionTracking",method:function(e){var t,r=this;this.growingIO=e,this.documentReady=!1,this.main=function(e){"listener"===e?(r.documentReady=!0,r.growingIO.gioSDKInitialized&&r.initMutationObserver()):"emitter"===e&&r.documentReady&&r.initMutationObserver()},this.initIntersectionObserver=function(){r.intersectionObserver=new IntersectionObserver((function(e){var t;(f(t=e)?0===t.length:s(t)?0===h(t).length:!t)||e.map((function(e){var t=e.target.dataset;if(e.intersectionRatio>0){var n=r.getImpressionProperties(t),i=n.eventId,o=n.properties,a=n.items,u=t.id;if(u){if("once"===t.gioImpType&&b(r.sentImps,u))return;r.sentImps[u]={eventId:i,properties:o,items:a}}i&&r.growingIO.track(i,o,a)}}))}))},this.initMutationObserver=function(){if(r.mutationObserver)return!1;var e=document.querySelectorAll("[data-gio-imp-track]");v(e).map((function(e){var t;null===(t=r.intersectionObserver)||void 0===t||t.observe(e)})),r.mutationObserver=new MutationObserver((function(e){return e.map((function(e){var t;if("attributes"===e.type&&e.target.dataset.gioImpTrack)return null===(t=r.intersectionObserver)||void 0===t?void 0:t.observe(e.target)}))})),r.mutationObserver.observe(document.body,{attributes:!0,childList:!0,subtree:!0,attributeOldValue:!0,attributeFilter:["data-gio-imp-track","data-gio-imp-attrs","data-gio-imp-items",/^data-gio-track-[a-z]+$/i]})},this.getImpressionProperties=function(e){var t={eventId:void 0,properties:{}};if(!(null==e?void 0:e.gioImpTrack))return t;if(t.eventId=e.gioImpTrack,b(e,"gioImpAttrs"))t.properties=w((function(){return s(e.gioImpAttrs)?e.gioImpAttrs:JSON.parse(e.gioImpAttrs)})),t.items=w((function(){return s(e.gioImpItems)?e.gioImpItems:JSON.parse(e.gioImpItems)}));else{var r=/^gioTrack(.+)/;for(var n in e){var i=void 0,o=n.match(r);o&&"track"!==(i=p(o[1]))&&(t.properties[i]=e[n])}}return t.properties=A(t.properties),t.items=A(t.items),/^\w+$/.test(t.eventId)&&!Number.isInteger(Number(d(t.eventId.split(""))))||(t.eventId=null,t={}),t},this.sentImps={},window.ActiveXObject||"ActiveXObject"in window||navigator.userAgent.indexOf("compatible")>-1&&navigator.userAgent.indexOf("MSIE")>-1||navigator.userAgent.indexOf("Trident")>-1&&navigator.userAgent.indexOf("rv:11.0")>-1?("warn",console.log("%c [GrowingIO]：IE浏览器不支持半自动埋点，gioImpressionTracking已自动关闭！","color: #F59E0B;")):(this.initIntersectionObserver(),k(document,"readystatechange",(function(){l(["interactive","complete"],document.readyState)&&r.main("listener")}),{once:!0}),null===(t=this.growingIO.emitter)||void 0===t||t.on("SDK_INITIALIZED",(function(){return r.main("emitter")})),k(window,"unload",(function(){r.intersectionObserver.disconnect(),r.mutationObserver.disconnect()})))}}}));
